/*
 MDN polyfills: Copyright MDN. */
Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),d=this,f=function(){},l=function(){return d.apply(this instanceof f&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};f.prototype=this.prototype;l.prototype=new f;return l});
String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(a,b){b=b||0;return this.indexOf(a,b)===b}});(function(a){if(!a.console||!a.console.log){var b=function(){};a.console={log:b,debug:b,info:b,warn:b,error:b}}})(window);/*
 Copyright 2011, Sebastian Tschan, Licensed under the MIT license
*/
(function(a){var b=function(a,d,n){var t=document.createElement("img"),s,y;t.onerror=d;t.onload=function(){y&&(!n||!n.noRevoke)&&b.revokeObjectURL(y);d&&d(b.scale(t,n))};if(b.isInstanceOf("Blob",a)||b.isInstanceOf("File",a))s=y=b.createObjectURL(a),t._type=a.type;else if("string"===typeof a)s=a,n&&n.crossOrigin&&(t.crossOrigin=n.crossOrigin);else return!1;return s?(t.src=s,t):b.readFile(a,function(a){var b=a.target;b&&b.result?t.src=b.result:d&&d(a)})},d=window.createObjectURL&&window||window.URL&&
URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;b.isInstanceOf=function(a,b){return Object.prototype.toString.call(b)==="[object "+a+"]"};b.transformCoordinates=function(){};b.getTransformedOptions=function(a){return a};b.renderImageToCanvas=function(a,b,d,t,s,y,w,E,q,v){a.getContext("2d").drawImage(b,d,t,s,y,w,E,q,v);return a};b.hasCanvasOption=function(a){return a.canvas||a.crop};b.scale=function(a,d){d=d||{};var n=document.createElement("canvas"),t=a.getContext||b.hasCanvasOption(d)&&n.getContext,
s=a.naturalWidth||a.width,y=a.naturalHeight||a.height,w=s,E=y,q,v,r,B,D,F,g,p,e;e=function(){var a=Math.max((r||w)/w,(B||E)/E);1<a&&(w=Math.ceil(w*a),E=Math.ceil(E*a))};var m=function(){var a=Math.min((q||w)/w,(v||E)/E);1>a&&(w=Math.ceil(w*a),E=Math.ceil(E*a))};t&&(d=b.getTransformedOptions(d),g=d.left||0,p=d.top||0,d.sourceWidth?(D=d.sourceWidth,void 0!==d.right&&void 0===d.left&&(g=s-D-d.right)):D=s-g-(d.right||0),d.sourceHeight?(F=d.sourceHeight,void 0!==d.bottom&&void 0===d.top&&(p=y-F-d.bottom)):
F=y-p-(d.bottom||0),w=D,E=F);q=d.maxWidth;v=d.maxHeight;r=d.minWidth;B=d.minHeight;if(t&&q&&v&&d.crop)w=q,E=v,e=D/F-q/v,0>e?(F=v*D/q,void 0===d.top&&void 0===d.bottom&&(p=(y-F)/2)):0<e&&(D=q*F/v,void 0===d.left&&void 0===d.right&&(g=(s-D)/2));else{if(d.contain||d.cover)r=q=q||r,B=v=v||B;d.cover?(m(),e()):(e(),m())}if(t)return n.width=w,n.height=E,b.transformCoordinates(n,d),b.renderImageToCanvas(n,a,g,p,D,F,0,0,w,E);a.width=w;a.height=E;return a};b.createObjectURL=function(a){return d?d.createObjectURL(a):
!1};b.revokeObjectURL=function(a){return d?d.revokeObjectURL(a):!1};b.readFile=function(a,b,d){if(window.FileReader){var t=new FileReader;t.onload=t.onerror=b;d=d||"readAsDataURL";if(t[d])return t[d](a),t}return!1};"function"===typeof define&&define.amd?define(function(){return b}):a.loadImage=b})(this);/*
 Copyright 2013, Sebastian Tschan, Licensed under the MIT license
*/
(function(a){"function"===typeof define&&define.amd?define(["load-image"],a):a(window.loadImage)})(function(a){a.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice)&&function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)};a.metaDataParsers={jpeg:{65505:[]}};a.parseMetaData=function(b,d,f){f=f||{};var l=this,n=f.maxMetaDataSize||262144,t={};(!window.DataView||(!b||!(12<=b.size&&"image/jpeg"===b.type&&a.blobSlice))||!a.readFile(a.blobSlice.call(b,
0,n),function(b){b=b.target.result;var n=new DataView(b),w=2,E=n.byteLength-4,q=w,v,r;if(65496===n.getUint16(0)){for(;w<E;)if(v=n.getUint16(w),65504<=v&&65519>=v||65534===v){r=n.getUint16(w+2)+2;if(w+r>n.byteLength){console.log("Invalid meta data: Invalid segment size.");break}if(q=a.metaDataParsers.jpeg[v])for(v=0;v<q.length;v+=1)q[v].call(l,n,w,r,t,f);q=w+=r}else break;!f.disableImageHead&&6<q&&(t.imageHead=b.slice?b.slice(0,q):(new Uint8Array(b)).subarray(0,q))}else console.log("Invalid JPEG file: Missing JPEG marker.");
d(t)},"readAsArrayBuffer"))&&d(t)}});/*
 Blob.js Copyright ? 2011 Eli Grey. License: X11/MIT */
if(!("function"===typeof Blob||"object"===typeof Blob)||"undefined"===typeof URL)if(("function"===typeof Blob||"object"===typeof Blob)&&"undefined"!==typeof webkitURL)self.URL=webkitURL;else var Blob=function(a){var b=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||a.MSBlobBuilder||function(a){var b=function(a){return Object.prototype.toString.call(a).match(/^\[object\s(.*)\]$/)[1]},l=function(){this.data=[]},n=function(a,b,e){this.data=a;this.size=a.length;this.type=b;this.encoding=e},t=l.prototype,
s=n.prototype,y=a.FileReaderSync,w=function(a){this.code=this[this.name=a]},E="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),q=E.length,v=a.URL||a.webkitURL||a,r=v.createObjectURL,B=v.revokeObjectURL,D=v,F=a.btoa,g=a.atob,p=a.ArrayBuffer,e=a.Uint8Array;for(n.fake=s.fake=!0;q--;)w.prototype[E[q]]=q+1;v.createObjectURL||(D=a.URL={});D.createObjectURL=function(a){var b=a.type;null===b&&(b="application/octet-stream");
if(a instanceof n)return b="data:"+b,"base64"===a.encoding?b+";base64,"+a.data:"URI"===a.encoding?b+","+decodeURIComponent(a.data):F?b+";base64,"+F(a.data):b+","+encodeURIComponent(a.data);if(r)return r.call(v,a)};D.revokeObjectURL=function(a){"data:"!==a.substring(0,5)&&B&&B.call(v,a)};t.append=function(a){var d=this.data;if(e&&(a instanceof p||a instanceof e)){var u="";a=new e(a);for(var l=0,z=a.length;l<z;l++)u+=String.fromCharCode(a[l]);d.push(u)}else if("Blob"===b(a)||"File"===b(a))if(y)u=new y,
d.push(u.readAsBinaryString(a));else throw new w("NOT_READABLE_ERR");else a instanceof n?"base64"===a.encoding&&g?d.push(g(a.data)):"URI"===a.encoding?d.push(decodeURIComponent(a.data)):"raw"===a.encoding&&d.push(a.data):("string"!==typeof a&&(a+=""),d.push(unescape(encodeURIComponent(a))))};t.getBlob=function(a){arguments.length||(a=null);return new n(this.data.join(""),a,"raw")};t.toString=function(){return"[object BlobBuilder]"};s.slice=function(a,b,e){var d=arguments.length;3>d&&(e=null);return new n(this.data.slice(a,
1<d?b:this.data.length),e,this.encoding)};s.toString=function(){return"[object Blob]"};return l}(a);return function(a,f){var l=f?f.type||"":"",n=new b;if(a)for(var t=0,s=a.length;t<s;t++)n.append(a[t]);return n.getBlob(l)}}("undefined"!==typeof self&&self||"undefined"!==typeof window&&window||this.content||this);/*
 Canvas to Blob  Copyright 2012, Sebastian Tschan. Licensed under the MIT license */
(function(a){var b=a.HTMLCanvasElement&&a.HTMLCanvasElement.prototype,d;if(d=a.Blob)try{d=Boolean(new Blob)}catch(f){d=!1}var l=d;if(d=l)if(d=a.Uint8Array)try{d=100===(new Blob([new Uint8Array(100)])).size}catch(n){d=!1}var t=d,s=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||a.MSBlobBuilder,y=(l||s)&&a.atob&&a.ArrayBuffer&&a.Uint8Array&&function(a){var b,d,f,n;b=0<=a.split(",")[0].indexOf("base64")?atob(a.split(",")[1]):decodeURIComponent(a.split(",")[1]);d=new ArrayBuffer(b.length);f=new Uint8Array(d);
for(n=0;n<b.length;n+=1)f[n]=b.charCodeAt(n);a=a.split(",")[0].split(":")[1].split(";")[0];if(l)return new Blob([t?f:d],{type:a});f=new s;f.append(d);return f.getBlob(a)};a.HTMLCanvasElement&&!b.toBlob&&(b.mozGetAsFile?b.toBlob=function(a,d,f){f&&b.toDataURL&&y?a(y(this.toDataURL(d,f))):a(this.mozGetAsFile("blob",d))}:b.toDataURL&&y&&(b.toBlob=function(a,b,d){a(y(this.toDataURL(b,d)))}));"function"===typeof define&&define.amd?define(function(){return y}):a.dataURLtoBlob=y})(this);/*
 Copyright 2010, Sebastian Tschan, Licensed under the MIT license
*/
(function(a){"function"===typeof define&&define.amd?define(["jquery","jquery.ui.widget"],a):a(window.jQuery)})(function(a){a.support.fileInput=!(RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||a('<input type="file">').prop("disabled"));a.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader);a.support.xhrFormDataFileUpload=!!window.FormData;a.support.blobSlice=
window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);a.widget("blueimp.fileupload",{options:{dropZone:a(document),pasteZone:a(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,
uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(b,d){b=this.messages[b]||b.toString();d&&a.each(d,function(a,d){b=b.replace("{"+a+"}",d)});return b},formData:function(a){return a.serializeArray()},add:function(b,d){if(b.isDefaultPrevented())return!1;(d.autoUpload||!1!==d.autoUpload&&a(this).fileupload("option","autoUpload"))&&d.process().done(function(){d.submit()})},processData:!1,
contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:a.support.blobSlice&&function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime();this.bitrate=this.loaded=0;this.getBitrate=function(a,d,f){var l=a-this.timestamp;if(!this.bitrate||!f||l>f)this.bitrate=8*(d-this.loaded)*(1E3/l),this.loaded=d,this.timestamp=a;return this.bitrate}},
_isXHRUpload:function(b){return!b.forceIframeTransport&&(!b.multipart&&a.support.xhrFileUpload||a.support.xhrFormDataFileUpload)},_getFormData:function(b){var d;return"function"===a.type(b.formData)?b.formData(b.form):a.isArray(b.formData)?b.formData:"object"===a.type(b.formData)?(d=[],a.each(b.formData,function(a,b){d.push({name:a,value:b})}),d):[]},_getTotal:function(b){var d=0;a.each(b,function(a,b){d+=b.size||1});return d},_initProgressObject:function(b){var d={loaded:0,total:0,bitrate:0};b._progress?
a.extend(b._progress,d):b._progress=d},_initResponseObject:function(a){var d;if(a._response)for(d in a._response)a._response.hasOwnProperty(d)&&delete a._response[d];else a._response={}},_onProgress:function(b,d){if(b.lengthComputable){var f=Date.now?Date.now():(new Date).getTime(),l;if(!d._time||!d.progressInterval||!(f-d._time<d.progressInterval&&b.loaded!==b.total))d._time=f,l=Math.floor(b.loaded/b.total*(d.chunkSize||d._progress.total))+(d.uploadedBytes||0),this._progress.loaded+=l-d._progress.loaded,
this._progress.bitrate=this._bitrateTimer.getBitrate(f,this._progress.loaded,d.bitrateInterval),d._progress.loaded=d.loaded=l,d._progress.bitrate=d.bitrate=d._bitrateTimer.getBitrate(f,l,d.bitrateInterval),this._trigger("progress",a.Event("progress",{delegatedEvent:b}),d),this._trigger("progressall",a.Event("progressall",{delegatedEvent:b}),this._progress)}},_initProgressListener:function(b){var d=this,f=b.xhr?b.xhr():a.ajaxSettings.xhr();f.upload&&(a(f.upload).bind("progress",function(a){var f=a.originalEvent;
a.lengthComputable=f.lengthComputable;a.loaded=f.loaded;a.total=f.total;d._onProgress(a,b)}),b.xhr=function(){return f})},_isInstanceOf:function(a,d){return Object.prototype.toString.call(d)==="[object "+a+"]"},_initXHRData:function(b){var d=this,f,l=b.files[0],n=b.multipart||!a.support.xhrFileUpload,t=b.paramName[0];b.headers=a.extend({},b.headers);b.contentRange&&(b.headers["Content-Range"]=b.contentRange);if(!n||b.blob||!this._isInstanceOf("File",l))b.headers["Content-Disposition"]='attachment; filename="'+
encodeURI(l.name)+'"';n?a.support.xhrFormDataFileUpload&&(b.postMessage?(f=this._getFormData(b),b.blob?f.push({name:t,value:b.blob}):a.each(b.files,function(a,d){f.push({name:b.paramName[a]||t,value:d})})):(d._isInstanceOf("FormData",b.formData)?f=b.formData:(f=new FormData,a.each(this._getFormData(b),function(a,b){f.append(b.name,b.value)})),b.blob?f.append(t,b.blob,l.name):a.each(b.files,function(a,n){if(d._isInstanceOf("File",n)||d._isInstanceOf("Blob",n))f.append(b.paramName[a]||t,n,n.uploadName||
n.name)})),b.data=f):(b.contentType=l.type||"application/octet-stream",b.data=b.blob||l);b.blob=null},_initIframeSettings:function(b){var d=a("<a></a>").prop("href",b.url).prop("host");b.dataType="iframe "+(b.dataType||"");b.formData=this._getFormData(b);b.redirect&&(d&&d!==location.host)&&b.formData.push({name:b.redirectParamName||"redirect",value:b.redirect})},_initDataSettings:function(a){this._isXHRUpload(a)?(this._chunkedUpload(a,!0)||(a.data||this._initXHRData(a),this._initProgressListener(a)),
a.postMessage&&(a.dataType="postmessage "+(a.dataType||""))):this._initIframeSettings(a)},_getParamName:function(b){var d=a(b.fileInput),f=b.paramName;f?a.isArray(f)||(f=[f]):(f=[],d.each(function(){for(var b=a(this),d=b.prop("name")||"files[]",b=(b.prop("files")||[1]).length;b;)f.push(d),b-=1}),f.length||(f=[d.prop("name")||"files[]"]));return f},_initFormSettings:function(b){if(!b.form||!b.form.length)b.form=a(b.fileInput.prop("form")),b.form.length||(b.form=a(this.options.fileInput.prop("form")));
b.paramName=this._getParamName(b);b.url||(b.url=b.form.prop("action")||location.href);b.type=(b.type||"string"===a.type(b.form.prop("method"))&&b.form.prop("method")||"").toUpperCase();"POST"!==b.type&&("PUT"!==b.type&&"PATCH"!==b.type)&&(b.type="POST");b.formAcceptCharset||(b.formAcceptCharset=b.form.attr("accept-charset"))},_getAJAXSettings:function(b){b=a.extend({},this.options,b);this._initFormSettings(b);this._initDataSettings(b);return b},_getDeferredState:function(a){return a.state?a.state():
a.isResolved()?"resolved":a.isRejected()?"rejected":"pending"},_enhancePromise:function(a){a.success=a.done;a.error=a.fail;a.complete=a.always;return a},_getXHRPromise:function(b,d,f){var l=a.Deferred(),n=l.promise();d=d||this.options.context||n;!0===b?l.resolveWith(d,f):!1===b&&l.rejectWith(d,f);n.abort=l.promise;return this._enhancePromise(n)},_addConvenienceMethods:function(b,d){var f=this,l=function(b){return a.Deferred().resolveWith(f,b).promise()};d.process=function(b,t){if(b||t)d._processQueue=
this._processQueue=(this._processQueue||l([this])).pipe(function(){return d.errorThrown?a.Deferred().rejectWith(f,[d]).promise():l(arguments)}).pipe(b,t);return this._processQueue||l([this])};d.submit=function(){"pending"!==this.state()&&(d.jqXHR=this.jqXHR=!1!==f._trigger("submit",a.Event("submit",{delegatedEvent:b}),this)&&f._onSend(b,this));return this.jqXHR||f._getXHRPromise()};d.abort=function(){if(this.jqXHR)return this.jqXHR.abort();this.errorThrown="abort";f._trigger("fail",null,this);return f._getXHRPromise(!1)};
d.state=function(){if(this.jqXHR)return f._getDeferredState(this.jqXHR);if(this._processQueue)return f._getDeferredState(this._processQueue)};d.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===f._getDeferredState(this._processQueue)};d.progress=function(){return this._progress};d.response=function(){return this._response}},_getUploadedBytes:function(a){return(a=(a=(a=a.getResponseHeader("Range"))&&a.split("-"))&&1<a.length&&parseInt(a[1],10))&&a+1},_chunkedUpload:function(b,
d){b.uploadedBytes=b.uploadedBytes||0;var f=this,l=b.files[0],n=l.size,t=b.uploadedBytes,s=b.maxChunkSize||n,y=this._blobSlice,w=a.Deferred(),E=w.promise(),q,v;if(!this._isXHRUpload(b)||(!y||!(t||s<n))||b.data)return!1;if(d)return!0;if(t>=n)return l.error=b.i18n("uploadedBytes"),this._getXHRPromise(!1,b.context,[null,"error",l.error]);v=function(){var d=a.extend({},b),B=d._progress.loaded;d.blob=y.call(l,t,t+s,l.type);d.chunkSize=d.blob.size;d.contentRange="bytes "+t+"-"+(t+d.chunkSize-1)+"/"+n;f._initXHRData(d);
f._initProgressListener(d);q=(!1!==f._trigger("chunksend",null,d)&&a.ajax(d)||f._getXHRPromise(!1,d.context)).done(function(l,q,g){t=f._getUploadedBytes(g)||t+d.chunkSize;B+d.chunkSize-d._progress.loaded&&f._onProgress(a.Event("progress",{lengthComputable:!0,loaded:t-d.uploadedBytes,total:t-d.uploadedBytes}),d);b.uploadedBytes=d.uploadedBytes=t;d.result=l;d.textStatus=q;d.jqXHR=g;f._trigger("chunkdone",null,d);f._trigger("chunkalways",null,d);t<n?v():w.resolveWith(d.context,[l,q,g])}).fail(function(a,
b,g){d.jqXHR=a;d.textStatus=b;d.errorThrown=g;f._trigger("chunkfail",null,d);f._trigger("chunkalways",null,d);w.rejectWith(d.context,[a,b,g])})};this._enhancePromise(E);E.abort=function(){return q.abort()};v();return E},_beforeSend:function(a,d){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0);this._initResponseObject(d);this._initProgressObject(d);d._progress.loaded=d.loaded=d.uploadedBytes||
0;d._progress.total=d.total=this._getTotal(d.files)||1;d._progress.bitrate=d.bitrate=0;this._active+=1;this._progress.loaded+=d.loaded;this._progress.total+=d.total},_onDone:function(b,d,f,l){var n=l._progress.total,t=l._response;l._progress.loaded<n&&this._onProgress(a.Event("progress",{lengthComputable:!0,loaded:n,total:n}),l);t.result=l.result=b;t.textStatus=l.textStatus=d;t.jqXHR=l.jqXHR=f;this._trigger("done",null,l)},_onFail:function(a,d,f,l){var n=l._response;l.recalculateProgress&&(this._progress.loaded-=
l._progress.loaded,this._progress.total-=l._progress.total);n.jqXHR=l.jqXHR=a;n.textStatus=l.textStatus=d;n.errorThrown=l.errorThrown=f;this._trigger("fail",null,l)},_onAlways:function(a,d,f,l){this._trigger("always",null,l)},_onSend:function(b,d){d.submit||this._addConvenienceMethods(b,d);var f=this,l,n,t,s,y=f._getAJAXSettings(d),w=function(){f._sending+=1;y._bitrateTimer=new f._BitrateTimer;return l=l||((n||!1===f._trigger("send",a.Event("send",{delegatedEvent:b}),y))&&f._getXHRPromise(!1,y.context,
n)||f._chunkedUpload(y)||a.ajax(y)).done(function(a,b,d){f._onDone(a,b,d,y)}).fail(function(a,b,d){f._onFail(a,b,d,y)}).always(function(a,b,d){f._onAlways(a,b,d,y);f._sending-=1;f._active-=1;if(y.limitConcurrentUploads&&y.limitConcurrentUploads>f._sending)for(a=f._slots.shift();a;){if("pending"===f._getDeferredState(a)){a.resolve();break}a=f._slots.shift()}0===f._active&&f._trigger("stop")})};this._beforeSend(b,y);return this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=
this._sending?(1<this.options.limitConcurrentUploads?(t=a.Deferred(),this._slots.push(t),s=t.pipe(w)):s=this._sequence=this._sequence.pipe(w,w),s.abort=function(){n=[void 0,"abort","abort"];return!l?(t&&t.rejectWith(y.context,n),w()):l.abort()},this._enhancePromise(s)):w()},_onAdd:function(b,d){var f=this,l=!0,n=a.extend({},this.options,d),t=d.files,s=t.length,y=n.limitMultiFileUploads,w=n.limitMultiFileUploadSize,E=n.limitMultiFileUploadSizeOverhead,q=0,v=this._getParamName(n),r,B,D=0;if(w&&(!s||
void 0===t[0].size))w=void 0;if(!n.singleFileUploads&&!y&&!w||!this._isXHRUpload(n))B=[t],r=[v];else if(!n.singleFileUploads&&!w&&y){B=[];r=[];for(n=0;n<s;n+=y)B.push(t.slice(n,n+y)),q=v.slice(n,n+y),q.length||(q=v),r.push(q)}else if(!n.singleFileUploads&&w){B=[];r=[];for(n=0;n<s;n+=1)if(q+=t[n].size+E,n+1===s||q+t[n+1].size+E>w)B.push(t.slice(D,n+1)),q=v.slice(D,n+1),q.length||(q=v),r.push(q),D=n+1,q=0}else r=v;d.originalFiles=t;a.each(B||t,function(n,g){var p=a.extend({},d);p.files=B?g:[g];p.paramName=
r[n];f._initResponseObject(p);f._initProgressObject(p);f._addConvenienceMethods(b,p);return l=f._trigger("add",a.Event("add",{delegatedEvent:b}),p)});return l},_replaceFileInput:function(b){var d=b.clone(!0);a("<form></form>").append(d)[0].reset();b.after(d).detach();a.cleanData(b.unbind("remove"));this.options.fileInput=this.options.fileInput.map(function(a,l){return l===b[0]?d[0]:l});b[0]===this.element[0]&&(this.element=d)},_handleFileTreeEntry:function(b,d){var f=this,l=a.Deferred(),n=function(a){a&&
!a.entry&&(a.entry=b);l.resolve([a])},t;d=d||"";b.isFile?b._file?(b._file.relativePath=d,l.resolve(b._file)):b.file(function(a){a.relativePath=d;l.resolve(a)},n):b.isDirectory?(t=b.createReader(),t.readEntries(function(a){f._handleFileTreeEntries(a,d+b.name+"/").done(function(a){l.resolve(a)}).fail(n)},n)):l.resolve([]);return l.promise()},_handleFileTreeEntries:function(b,d){var f=this;return a.when.apply(a,a.map(b,function(a){return f._handleFileTreeEntry(a,d)})).pipe(function(){return Array.prototype.concat.apply([],
arguments)})},_getDroppedFiles:function(b){b=b||{};var d=b.items;return d&&d.length&&(d[0].webkitGetAsEntry||d[0].getAsEntry)?this._handleFileTreeEntries(a.map(d,function(a){var b;if(a.webkitGetAsEntry){if(b=a.webkitGetAsEntry())b._file=a.getAsFile();return b}return a.getAsEntry()})):a.Deferred().resolve(a.makeArray(b.files)).promise()},_getSingleFileInputFiles:function(b){b=a(b);var d=b.prop("webkitEntries")||b.prop("entries");if(d&&d.length)return this._handleFileTreeEntries(d);d=a.makeArray(b.prop("files"));
if(d.length)void 0===d[0].name&&d[0].fileName&&a.each(d,function(a,b){b.name=b.fileName;b.size=b.fileSize});else{b=b.prop("value");if(!b)return a.Deferred().resolve([]).promise();d=[{name:b.replace(/^.*\\/,"")}]}return a.Deferred().resolve(d).promise()},_getFileInputFiles:function(b){return!(b instanceof a)||1===b.length?this._getSingleFileInputFiles(b):a.when.apply(a,a.map(b,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_onChange:function(b){var d=
this,f={fileInput:a(b.target),form:a(b.target.form)};this._getFileInputFiles(f.fileInput).always(function(l){f.files=l;d.options.replaceFileInput&&d._replaceFileInput(f.fileInput);!1!==d._trigger("change",a.Event("change",{delegatedEvent:b}),f)&&d._onAdd(b,f)})},_onPaste:function(b){var d=b.originalEvent&&b.originalEvent.clipboardData&&b.originalEvent.clipboardData.items,f={files:[]};d&&d.length&&(a.each(d,function(a,b){var d=b.getAsFile&&b.getAsFile();d&&f.files.push(d)}),!1!==this._trigger("paste",
a.Event("paste",{delegatedEvent:b}),f)&&this._onAdd(b,f))},_onDrop:function(b){b.dataTransfer=b.originalEvent&&b.originalEvent.dataTransfer;var d=this,f=b.dataTransfer,l={};f&&(f.files&&f.files.length)&&(b.preventDefault(),this._getDroppedFiles(f).always(function(f){l.files=f;!1!==d._trigger("drop",a.Event("drop",{delegatedEvent:b}),l)&&d._onAdd(b,l)}))},_onDragOver:function(b){b.dataTransfer=b.originalEvent&&b.originalEvent.dataTransfer;var d=b.dataTransfer;d&&(-1!==a.inArray("Files",d.types)&&!1!==
this._trigger("dragover",a.Event("dragover",{delegatedEvent:b})))&&(b.preventDefault(),d.dropEffect="copy")},_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop}),this._on(this.options.pasteZone,{paste:this._onPaste}));a.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragover drop");this._off(this.options.pasteZone,
"paste");this._off(this.options.fileInput,"change")},_setOption:function(b,d){var f=-1!==a.inArray(b,this._specialOptions);f&&this._destroyEventHandlers();this._super(b,d);f&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var b=this.options;void 0===b.fileInput?b.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):b.fileInput instanceof a||(b.fileInput=a(b.fileInput));b.dropZone instanceof a||(b.dropZone=a(b.dropZone));
b.pasteZone instanceof a||(b.pasteZone=a(b.pasteZone))},_getRegExp:function(a){a=a.split("/");var d=a.pop();a.shift();return RegExp(a.join("/"),d)},_isRegExpOption:function(b,d){return"url"!==b&&"string"===a.type(d)&&/^\/.*\/[igm]{0,3}$/.test(d)},_initDataAttributes:function(){var b=this,d=this.options;a.each(a(this.element[0].cloneNode(!1)).data(),function(a,l){b._isRegExpOption(a,l)&&(l=b._getRegExp(l));d[a]=l})},_create:function(){this._initDataAttributes();this._initSpecialOptions();this._slots=
[];this._sequence=this._getXHRPromise(!0);this._sending=this._active=0;this._initProgressObject(this);this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(b){var d=this;b&&!this.options.disabled&&(b.fileInput&&!b.files?this._getFileInputFiles(b.fileInput).always(function(a){b.files=a;d._onAdd(null,b)}):(b.files=a.makeArray(b.files),this._onAdd(null,b)))},send:function(b){if(b&&!this.options.disabled){if(b.fileInput&&!b.files){var d=
this,f=a.Deferred(),l=f.promise(),n,t;l.abort=function(){t=!0;if(n)return n.abort();f.reject(null,"abort","abort");return l};this._getFileInputFiles(b.fileInput).always(function(a){t||(a.length?(b.files=a,n=d._onSend(null,b).then(function(a,b,d){f.resolve(a,b,d)},function(a,b,d){f.reject(a,b,d)})):f.reject())});return this._enhancePromise(l)}b.files=a.makeArray(b.files);if(b.files.length)return this._onSend(null,b)}return this._getXHRPromise(!1,b&&b.context)}})});(function(a){"function"===typeof define&&define.amd?define(["jquery","./jquery.fileupload"],a):a(window.jQuery)})(function(a){var b=a.blueimp.fileupload.prototype.options.add;a.widget("blueimp.fileupload",a.blueimp.fileupload,{options:{processQueue:[],add:function(d,f){var l=a(this);f.process(function(){return l.fileupload("process",f)});b.call(this,d,f)}},processActions:{},_processFile:function(b,f){var l=this,n=a.Deferred().resolveWith(l,[b]).promise();this._trigger("process",null,b);a.each(b.processQueue,
function(b,d){var y=function(b){return f.errorThrown?a.Deferred().rejectWith(l,[f]).promise():l.processActions[d.action].call(l,b,d)};n=n.pipe(y,d.always&&y)});n.done(function(){l._trigger("processdone",null,b);l._trigger("processalways",null,b)}).fail(function(){l._trigger("processfail",null,b);l._trigger("processalways",null,b)});return n},_transformProcessQueue:function(b){var f=[];a.each(b.processQueue,function(){var l={},n=this.action,t=!0===this.prefix?n:this.prefix;a.each(this,function(f,n){"string"===
a.type(n)&&"@"===n.charAt(0)?l[f]=b[n.slice(1)||(t?t+f.charAt(0).toUpperCase()+f.slice(1):f)]:l[f]=n});f.push(l)});b.processQueue=f},processing:function(){return this._processing},process:function(b){var f=this,l=a.extend({},this.options,b);l.processQueue&&l.processQueue.length&&(this._transformProcessQueue(l),0===this._processing&&this._trigger("processstart"),a.each(b.files,function(n){var t=n?a.extend({},l):l,s=function(){return b.errorThrown?a.Deferred().rejectWith(f,[b]).promise():f._processFile(t,
b)};t.index=n;f._processing+=1;f._processingQueue=f._processingQueue.pipe(s,s).always(function(){f._processing-=1;0===f._processing&&f._trigger("processstop")})}));return this._processingQueue},_create:function(){this._super();this._processing=0;this._processingQueue=a.Deferred().resolveWith(this).promise()}})});/*
 Copyright 2013, Sebastian Tschan, Licensed under the MIT license
*/
(function(a){"function"===typeof define&&define.amd?define("jquery load-image load-image-meta load-image-exif load-image-ios canvas-to-blob ./jquery.fileupload-process".split(" "),a):a(window.jQuery,window.loadImage)})(function(a,b){a.blueimp.fileupload.prototype.options.processQueue.unshift({action:"loadImageMetaData",disableImageHead:"@",disableExif:"@",disableExifThumbnail:"@",disableExifSub:"@",disableExifGps:"@",disabled:"@disableImageMetaDataLoad"},{action:"loadImage",prefix:!0,fileTypes:"@",
maxFileSize:"@",noRevoke:"@",disabled:"@disableImageLoad"},{action:"resizeImage",prefix:"image",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",orientation:"@",forceResize:"@",disabled:"@disableImageResize"},{action:"saveImage",quality:"@imageQuality",type:"@imageType",disabled:"@disableImageResize"},{action:"saveImageMetaData",disabled:"@disableImageMetaDataSave"},{action:"resizeImage",prefix:"preview",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",orientation:"@",
thumbnail:"@",canvas:"@",disabled:"@disableImagePreview"},{action:"setImage",name:"@imagePreviewName",disabled:"@disableImagePreview"});a.widget("blueimp.fileupload",a.blueimp.fileupload,{options:{loadImageFileTypes:/^image\/(gif|jpeg|png)$/,loadImageMaxFileSize:1E7,imageMaxWidth:1920,imageMaxHeight:1080,imageOrientation:!1,imageCrop:!1,disableImageResize:!0,previewMaxWidth:80,previewMaxHeight:80,previewOrientation:!0,previewThumbnail:!0,previewCrop:!1,previewCanvas:!0},processActions:{loadImage:function(d,
f){if(f.disabled)return d;var l=this,n=d.files[d.index],t=a.Deferred();return"number"===a.type(f.maxFileSize)&&n.size>f.maxFileSize||f.fileTypes&&!f.fileTypes.test(n.type)||!b(n,function(a){a.src&&(d.img=a);t.resolveWith(l,[d])},f)?d:t.promise()},resizeImage:function(d,f){if(f.disabled||!d.canvas&&!d.img)return d;f=a.extend({canvas:!0},f);var l=this,n=a.Deferred(),t=f.canvas&&d.canvas||d.img,s=function(a){if(a&&(a.width!==t.width||a.height!==t.height||f.forceResize))d[a.getContext?"canvas":"img"]=
a;d.preview=a;n.resolveWith(l,[d])},y;return d.exif&&(!0===f.orientation&&(f.orientation=d.exif.get("Orientation")),f.thumbnail&&(y=d.exif.get("Thumbnail")))?(b(y,s,f),n.promise()):t?(s(b.scale(t,f)),n.promise()):d},saveImage:function(b,f){if(!b.canvas||f.disabled)return b;var l=this,n=b.files[b.index],t=a.Deferred();if(b.canvas.toBlob)b.canvas.toBlob(function(a){a.name||(n.type===a.type?a.name=n.name:n.name&&(a.name=n.name.replace(/\..+$/,"."+a.type.substr(6))));n.type!==a.type&&delete b.imageHead;
b.files[b.index]=a;t.resolveWith(l,[b])},f.type||n.type,f.quality);else return b;return t.promise()},loadImageMetaData:function(d,f){if(f.disabled)return d;var l=this,n=a.Deferred();b.parseMetaData(d.files[d.index],function(b){a.extend(d,b);n.resolveWith(l,[d])},f);return n.promise()},saveImageMetaData:function(a,b){if(!a.imageHead||!a.canvas||!a.canvas.toBlob||b.disabled)return a;var l=a.files[a.index],n=new Blob([a.imageHead,this._blobSlice.call(l,20)],{type:l.type});n.name=l.name;a.files[a.index]=
n;return a},setImage:function(a,b){a.preview&&!b.disabled&&(a.files[a.index][b.name||"preview"]=a.preview);return a}}})});(function(){var a=this,b=a._,d={},f=Array.prototype,l=Object.prototype,n=f.push,t=f.slice,s=f.concat,y=l.toString,w=l.hasOwnProperty,E=f.forEach,q=f.map,v=f.reduce,r=f.reduceRight,B=f.filter,D=f.every,F=f.some,g=f.indexOf,p=f.lastIndexOf,l=Array.isArray,e=Object.keys,m=Function.prototype.bind,h=function(a){return a instanceof h?a:this instanceof h?void(this._wrapped=a):new h(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=h),exports._=h):a._=h;
h.VERSION="1.6.0";var u=h.each=h.forEach=function(a,b,C){if(null==a)return a;if(E&&a.forEach===E)a.forEach(b,C);else if(a.length===+a.length)for(var e=0,g=a.length;g>e;e++){if(b.call(C,a[e],e,a)===d)return}else for(var K=h.keys(a),e=0,g=K.length;g>e;e++)if(b.call(C,a[K[e]],K[e],a)===d)return;return a};h.map=h.collect=function(a,b,C){var e=[];return null==a?e:q&&a.map===q?a.map(b,C):(u(a,function(a,M,d){e.push(b.call(C,a,M,d))}),e)};h.reduce=h.foldl=h.inject=function(a,b,C,e){var d=2<arguments.length;
if(null==a&&(a=[]),v&&a.reduce===v)return e&&(b=h.bind(b,e)),d?a.reduce(b,C):a.reduce(b);if(u(a,function(a,M,h){d?C=b.call(e,C,a,M,h):(C=a,d=!0)}),!d)throw new TypeError("Reduce of empty array with no initial value");return C};h.reduceRight=h.foldr=function(a,b,C,e){var d=2<arguments.length;if(null==a&&(a=[]),r&&a.reduceRight===r)return e&&(b=h.bind(b,e)),d?a.reduceRight(b,C):a.reduceRight(b);var g=a.length;if(g!==+g)var K=h.keys(a),g=K.length;if(u(a,function(h,f,p){f=K?K[--g]:--g;d?C=b.call(e,C,
a[f],f,p):(C=a[f],d=!0)}),!d)throw new TypeError("Reduce of empty array with no initial value");return C};h.find=h.detect=function(a,b,C){var e;return A(a,function(a,M,d){return b.call(C,a,M,d)?(e=a,!0):void 0}),e};h.filter=h.select=function(a,b,C){var e=[];return null==a?e:B&&a.filter===B?a.filter(b,C):(u(a,function(a,M,d){b.call(C,a,M,d)&&e.push(a)}),e)};h.reject=function(a,b,C){return h.filter(a,function(a,M,e){return!b.call(C,a,M,e)},C)};h.every=h.all=function(a,b,C){b||(b=h.identity);var e=!0;
return null==a?e:D&&a.every===D?a.every(b,C):(u(a,function(a,M,h){return(e=e&&b.call(C,a,M,h))?void 0:d}),!!e)};var A=h.some=h.any=function(a,b,C){b||(b=h.identity);var e=!1;return null==a?e:F&&a.some===F?a.some(b,C):(u(a,function(a,M,h){return e||(e=b.call(C,a,M,h))?d:void 0}),!!e)};h.contains=h.include=function(a,b){return null==a?!1:g&&a.indexOf===g?-1!=a.indexOf(b):A(a,function(a){return a===b})};h.invoke=function(a,b){var C=t.call(arguments,2),e=h.isFunction(b);return h.map(a,function(a){return(e?
b:a[b]).apply(a,C)})};h.pluck=function(a,b){return h.map(a,h.property(b))};h.where=function(a,b){return h.filter(a,h.matches(b))};h.findWhere=function(a,b){return h.find(a,h.matches(b))};h.max=function(a,b,C){if(!b&&h.isArray(a)&&a[0]===+a[0]&&65535>a.length)return Math.max.apply(Math,a);var e=-1/0,d=-1/0;return u(a,function(a,M,h){M=b?b.call(C,a,M,h):a;M>d&&(e=a,d=M)}),e};h.min=function(a,b,C){if(!b&&h.isArray(a)&&a[0]===+a[0]&&65535>a.length)return Math.min.apply(Math,a);var e=1/0,d=1/0;return u(a,
function(a,M,h){M=b?b.call(C,a,M,h):a;d>M&&(e=a,d=M)}),e};h.shuffle=function(a){var b,C=0,e=[];return u(a,function(a){b=h.random(C++);e[C-1]=e[b];e[b]=a}),e};h.sample=function(a,b,C){return null==b||C?(a.length!==+a.length&&(a=h.values(a)),a[h.random(a.length-1)]):h.shuffle(a).slice(0,Math.max(0,b))};var z=function(a){return null==a?h.identity:h.isFunction(a)?a:h.property(a)};h.sortBy=function(a,b,C){return b=z(b),h.pluck(h.map(a,function(a,e,M){return{value:a,index:e,criteria:b.call(C,a,e,M)}}).sort(function(a,
b){var C=a.criteria,e=b.criteria;if(C!==e){if(C>e||void 0===C)return 1;if(e>C||void 0===e)return-1}return a.index-b.index}),"value")};var J=function(a){return function(b,C,e){var d={};return C=z(C),u(b,function(h,g){var K=C.call(e,h,g,b);a(d,K,h)}),d}};h.groupBy=J(function(a,b,C){h.has(a,b)?a[b].push(C):a[b]=[C]});h.indexBy=J(function(a,b,C){a[b]=C});h.countBy=J(function(a,b){h.has(a,b)?a[b]++:a[b]=1});h.sortedIndex=function(a,b,C,e){C=z(C);b=C.call(e,b);for(var d=0,h=a.length;h>d;){var g=d+h>>>1;
C.call(e,a[g])<b?d=g+1:h=g}return d};h.toArray=function(a){return a?h.isArray(a)?t.call(a):a.length===+a.length?h.map(a,h.identity):h.values(a):[]};h.size=function(a){return null==a?0:a.length===+a.length?a.length:h.keys(a).length};h.first=h.head=h.take=function(a,b,C){return null==a?void 0:null==b||C?a[0]:0>b?[]:t.call(a,0,b)};h.initial=function(a,b,C){return t.call(a,0,a.length-(null==b||C?1:b))};h.last=function(a,b,C){return null==a?void 0:null==b||C?a[a.length-1]:t.call(a,Math.max(a.length-b,
0))};h.rest=h.tail=h.drop=function(a,b,C){return t.call(a,null==b||C?1:b)};h.compact=function(a){return h.filter(a,h.identity)};var R=function(a,b,C){return b&&h.every(a,h.isArray)?s.apply(C,a):(u(a,function(a){h.isArray(a)||h.isArguments(a)?b?n.apply(C,a):R(a,b,C):C.push(a)}),C)};h.flatten=function(a,b){return R(a,b,[])};h.without=function(a){return h.difference(a,t.call(arguments,1))};h.partition=function(a,b){var C=[],e=[];return u(a,function(a){(b(a)?C:e).push(a)}),[C,e]};h.uniq=h.unique=function(a,
b,C,e){h.isFunction(b)&&(e=C,C=b,b=!1);C=C?h.map(a,C,e):a;var d=[],g=[];return u(C,function(C,e){(b?e&&g[g.length-1]===C:h.contains(g,C))||(g.push(C),d.push(a[e]))}),d};h.union=function(){return h.uniq(h.flatten(arguments,!0))};h.intersection=function(a){var b=t.call(arguments,1);return h.filter(h.uniq(a),function(a){return h.every(b,function(b){return h.contains(b,a)})})};h.difference=function(a){var b=s.apply(f,t.call(arguments,1));return h.filter(a,function(a){return!h.contains(b,a)})};h.zip=function(){for(var a=
h.max(h.pluck(arguments,"length").concat(0)),b=Array(a),C=0;a>C;C++)b[C]=h.pluck(arguments,""+C);return b};h.object=function(a,b){if(null==a)return{};for(var C={},e=0,d=a.length;d>e;e++)b?C[a[e]]=b[e]:C[a[e][0]]=a[e][1];return C};h.indexOf=function(a,b,C){if(null==a)return-1;var e=0,d=a.length;if(C){if("number"!=typeof C)return e=h.sortedIndex(a,b),a[e]===b?e:-1;e=0>C?Math.max(0,d+C):C}if(g&&a.indexOf===g)return a.indexOf(b,C);for(;d>e;e++)if(a[e]===b)return e;return-1};h.lastIndexOf=function(a,b,
C){if(null==a)return-1;var e=null!=C;if(p&&a.lastIndexOf===p)return e?a.lastIndexOf(b,C):a.lastIndexOf(b);for(C=e?C:a.length;C--;)if(a[C]===b)return C;return-1};h.range=function(a,b,C){1>=arguments.length&&(b=a||0,a=0);C=arguments[2]||1;for(var e=Math.max(Math.ceil((b-a)/C),0),d=0,h=Array(e);e>d;)h[d++]=a,a+=C;return h};var I=function(){};h.bind=function(a,b){var C,e;if(m&&a.bind===m)return m.apply(a,t.call(arguments,1));if(!h.isFunction(a))throw new TypeError;return C=t.call(arguments,2),e=function(){if(!(this instanceof
e))return a.apply(b,C.concat(t.call(arguments)));I.prototype=a.prototype;var d=new I;I.prototype=null;var h=a.apply(d,C.concat(t.call(arguments)));return Object(h)===h?h:d}};h.partial=function(a){var b=t.call(arguments,1);return function(){for(var C=0,e=b.slice(),d=0,g=e.length;g>d;d++)e[d]===h&&(e[d]=arguments[C++]);for(;C<arguments.length;)e.push(arguments[C++]);return a.apply(this,e)}};h.bindAll=function(a){var b=t.call(arguments,1);if(0===b.length)throw Error("bindAll must be passed function names");
return u(b,function(b){a[b]=h.bind(a[b],a)}),a};h.memoize=function(a,b){var C={};return b||(b=h.identity),function(){var e=b.apply(this,arguments);return h.has(C,e)?C[e]:C[e]=a.apply(this,arguments)}};h.delay=function(a,b){var C=t.call(arguments,2);return setTimeout(function(){return a.apply(null,C)},b)};h.defer=function(a){return h.delay.apply(h,[a,1].concat(t.call(arguments,1)))};h.throttle=function(a,b,C){var e,d,g,K=null,f=0;C||(C={});var p=function(){f=!1===C.leading?0:h.now();K=null;g=a.apply(e,
d);e=d=null};return function(){var m=h.now();f||!1!==C.leading||(f=m);var z=b-(m-f);return e=this,d=arguments,0>=z?(clearTimeout(K),K=null,f=m,g=a.apply(e,d),e=d=null):K||!1===C.trailing||(K=setTimeout(p,z)),g}};h.debounce=function(a,b,C){var e,d,g,K,f,p=function(){var m=h.now()-K;b>m?e=setTimeout(p,b-m):(e=null,C||(f=a.apply(g,d),g=d=null))};return function(){g=this;d=arguments;K=h.now();var m=C&&!e;return e||(e=setTimeout(p,b)),m&&(f=a.apply(g,d),g=d=null),f}};h.once=function(a){var b,C=!1;return function(){return C?
b:(C=!0,b=a.apply(this,arguments),a=null,b)}};h.wrap=function(a,b){return h.partial(b,a)};h.compose=function(){var a=arguments;return function(){for(var b=arguments,C=a.length-1;0<=C;C--)b=[a[C].apply(this,b)];return b[0]}};h.after=function(a,b){return function(){return 1>--a?b.apply(this,arguments):void 0}};h.keys=function(a){if(!h.isObject(a))return[];if(e)return e(a);var b=[],C;for(C in a)h.has(a,C)&&b.push(C);return b};h.values=function(a){for(var b=h.keys(a),C=b.length,e=Array(C),d=0;C>d;d++)e[d]=
a[b[d]];return e};h.pairs=function(a){for(var b=h.keys(a),C=b.length,e=Array(C),d=0;C>d;d++)e[d]=[b[d],a[b[d]]];return e};h.invert=function(a){for(var b={},C=h.keys(a),e=0,d=C.length;d>e;e++)b[a[C[e]]]=C[e];return b};h.functions=h.methods=function(a){var b=[],C;for(C in a)h.isFunction(a[C])&&b.push(C);return b.sort()};h.extend=function(a){return u(t.call(arguments,1),function(b){if(b)for(var C in b)a[C]=b[C]}),a};h.pick=function(a){var b={},C=s.apply(f,t.call(arguments,1));return u(C,function(C){C in
a&&(b[C]=a[C])}),b};h.omit=function(a){var b={},C=s.apply(f,t.call(arguments,1)),e;for(e in a)h.contains(C,e)||(b[e]=a[e]);return b};h.defaults=function(a){return u(t.call(arguments,1),function(b){if(b)for(var C in b)void 0===a[C]&&(a[C]=b[C])}),a};h.clone=function(a){return h.isObject(a)?h.isArray(a)?a.slice():h.extend({},a):a};h.tap=function(a,b){return b(a),a};var H=function(a,b,C,e){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof h&&(a=a._wrapped);b instanceof h&&
(b=b._wrapped);var d=y.call(a);if(d!=y.call(b))return!1;switch(d){case "[object String]":return a==String(b);case "[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case "[object Date]":case "[object Boolean]":return+a==+b;case "[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var g=C.length;g--;)if(C[g]==a)return e[g]==b;var g=a.constructor,K=b.constructor;if(g!==K&&(!h.isFunction(g)||
!(g instanceof g&&h.isFunction(K)&&K instanceof K))&&"constructor"in a&&"constructor"in b)return!1;C.push(a);e.push(b);g=0;K=!0;if("[object Array]"==d){if(g=a.length,K=g==b.length)for(;g--&&(K=H(a[g],b[g],C,e)););}else{for(var f in a)if(h.has(a,f)&&(g++,!(K=h.has(b,f)&&H(a[f],b[f],C,e))))break;if(K){for(f in b)if(h.has(b,f)&&!g--)break;K=!g}}return C.pop(),e.pop(),K};h.isEqual=function(a,b){return H(a,b,[],[])};h.isEmpty=function(a){if(null==a)return!0;if(h.isArray(a)||h.isString(a))return 0===a.length;
for(var b in a)if(h.has(a,b))return!1;return!0};h.isElement=function(a){return!(!a||1!==a.nodeType)};h.isArray=l||function(a){return"[object Array]"==y.call(a)};h.isObject=function(a){return a===Object(a)};u("Arguments Function String Number Date RegExp".split(" "),function(a){h["is"+a]=function(b){return y.call(b)=="[object "+a+"]"}});h.isArguments(arguments)||(h.isArguments=function(a){return!(!a||!h.has(a,"callee"))});"function"!=typeof/./&&(h.isFunction=function(a){return"function"==typeof a});
h.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))};h.isNaN=function(a){return h.isNumber(a)&&a!=+a};h.isBoolean=function(a){return!0===a||!1===a||"[object Boolean]"==y.call(a)};h.isNull=function(a){return null===a};h.isUndefined=function(a){return void 0===a};h.has=function(a,b){return w.call(a,b)};h.noConflict=function(){return a._=b,this};h.identity=function(a){return a};h.constant=function(a){return function(){return a}};h.property=function(a){return function(b){return b[a]}};h.matches=
function(a){return function(b){if(b===a)return!0;for(var C in a)if(a[C]!==b[C])return!1;return!0}};h.times=function(a,b,C){for(var e=Array(Math.max(0,a)),d=0;a>d;d++)e[d]=b.call(C,d);return e};h.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))};h.now=Date.now||function(){return(new Date).getTime()};var N={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};N.unescape=h.invert(N.escape);var P={escape:RegExp("["+h.keys(N.escape).join("")+"]","g"),
unescape:RegExp("("+h.keys(N.unescape).join("|")+")","g")};h.each(["escape","unescape"],function(a){h[a]=function(b){return null==b?"":(""+b).replace(P[a],function(b){return N[a][b]})}});h.result=function(a,b){if(null!=a){var C=a[b];return h.isFunction(C)?C.call(a):C}};h.mixin=function(a){u(h.functions(a),function(b){var C=h[b]=a[b];h.prototype[b]=function(){var a=[this._wrapped];n.apply(a,arguments);a=C.apply(h,a);return this._chain?h(a).chain():a}})};var G=0;h.uniqueId=function(a){var b=++G+"";
return a?a+b:b};h.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var S=/(.)^/,C={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},K=/\\|'|\r|\n|\t|\u2028|\u2029/g;h.template=function(a,b,e){var d;e=h.defaults({},e,h.templateSettings);var g=RegExp([(e.escape||S).source,(e.interpolate||S).source,(e.evaluate||S).source].join("|")+"|$","g"),f=0,p="__p+='";a.replace(g,function(b,e,d,h,g){return p+=a.slice(f,g).replace(K,
function(a){return"\\"+C[a]}),e&&(p+="'+\n((__t=("+e+"))==null?'':_.escape(__t))+\n'"),d&&(p+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),h&&(p+="';\n"+h+"\n__p+='"),f=g+b.length,b});p+="';\n";e.variable||(p="with(obj||{}){\n"+p+"}\n");p="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+p+"return __p;\n";try{d=new Function(e.variable||"obj","_",p)}catch(m){throw m.source=p,m;}if(b)return d(b,h);b=function(a){return d.call(this,a,h)};return b.source="function("+
(e.variable||"obj")+"){\n"+p+"}",b};h.chain=function(a){return h(a).chain()};h.mixin(h);u("pop push reverse shift sort splice unshift".split(" "),function(a){var b=f[a];h.prototype[a]=function(){var C=this._wrapped;return b.apply(C,arguments),"shift"!=a&&"splice"!=a||0!==C.length||delete C[0],this._chain?h(C).chain():C}});u(["concat","join","slice"],function(a){var b=f[a];h.prototype[a]=function(){var a=b.apply(this._wrapped,arguments);return this._chain?h(a).chain():a}});h.extend(h.prototype,{chain:function(){return this._chain=
!0,this},value:function(){return this._wrapped}});"function"==typeof define&&define.amd&&define("underscore",[],function(){return h})}).call(this);/*
 Backbone.js (c) 2010-2013 Jeremy Ashkenas, DocumentCloud Inc.  Backbone may be freely distributed under the MIT license. */
(function(){var a=this,b=a.Backbone,d=[],f=d.push,l=d.slice,n=d.splice,t;t="undefined"!==typeof exports?exports:a.Backbone={};t.VERSION="1.0.0";var s=a._;!s&&"undefined"!==typeof require&&(s=require("underscore"));t.$=a.jQuery||a.Zepto||a.ender||a.$;t.noConflict=function(){a.Backbone=b;return this};t.emulateHTTP=!1;t.emulateJSON=!1;var y=t.Events={on:function(a,b,e){if(!E(this,"on",a,[b,e])||!b)return this;this._events||(this._events={});(this._events[a]||(this._events[a]=[])).push({callback:b,context:e,
ctx:e||this});return this},once:function(a,b,e){if(!E(this,"once",a,[b,e])||!b)return this;var d=this,h=s.once(function(){d.off(a,h);b.apply(this,arguments)});h._callback=b;return this.on(a,h,e)},off:function(a,b,e){var d,h,g,f,p,m,z,n;if(!this._events||!E(this,"off",a,[b,e]))return this;if(!a&&!b&&!e)return this._events={},this;f=a?[a]:s.keys(this._events);p=0;for(m=f.length;p<m;p++)if(a=f[p],g=this._events[a]){this._events[a]=d=[];if(b||e){z=0;for(n=g.length;z<n;z++)h=g[z],(b&&b!==h.callback&&b!==
h.callback._callback||e&&e!==h.context)&&d.push(h)}d.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=l.call(arguments,1);if(!E(this,"trigger",a,b))return this;var e=this._events[a],d=this._events.all;e&&q(e,b);d&&q(d,arguments);return this},stopListening:function(a,b,e){var d=this._listeners;if(!d)return this;var h=!b&&!e;"object"===typeof b&&(e=this);a&&((d={})[a._listenerId]=a);for(var g in d)d[g].off(b,e,this),h&&delete this._listeners[g];return this}},
w=/\s+/,E=function(a,b,e,d){if(!e)return!0;if("object"===typeof e){for(var h in e)a[b].apply(a,[h,e[h]].concat(d));return!1}if(w.test(e)){e=e.split(w);h=0;for(var g=e.length;h<g;h++)a[b].apply(a,[e[h]].concat(d));return!1}return!0},q=function(a,b){var e,d=-1,h=a.length,g=b[0],f=b[1],p=b[2];switch(b.length){case 0:for(;++d<h;)(e=a[d]).callback.call(e.ctx);break;case 1:for(;++d<h;)(e=a[d]).callback.call(e.ctx,g);break;case 2:for(;++d<h;)(e=a[d]).callback.call(e.ctx,g,f);break;case 3:for(;++d<h;)(e=
a[d]).callback.call(e.ctx,g,f,p);break;default:for(;++d<h;)(e=a[d]).callback.apply(e.ctx,b)}};s.each({listenTo:"on",listenToOnce:"once"},function(a,b){y[b]=function(b,C,e){var d=this._listeners||(this._listeners={}),h=b._listenerId||(b._listenerId=s.uniqueId("l"));d[h]=b;"object"===typeof C&&(e=this);b[a](C,e,this);return this}});y.bind=y.on;y.unbind=y.off;s.extend(t,y);var v=t.Model=function(a,b){var e,d=a||{};b||(b={});this.cid=s.uniqueId("c");this.attributes={};s.extend(this,s.pick(b,r));b.parse&&
(d=this.parse(d,b)||{});if(e=s.result(this,"defaults"))d=s.defaults({},d,e);this.set(d,b);this.changed={};this.initialize.apply(this,arguments)},r=["url","urlRoot","collection"];s.extend(v.prototype,y,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return s.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return s.escape(this.get(a))},has:function(a){return null!=
this.get(a)},set:function(a,b,e){var d,h,g,f,p,m,z;if(null==a)return this;"object"===typeof a?(h=a,e=b):(h={})[a]=b;e||(e={});if(!this._validate(h,e))return!1;g=e.unset;f=e.silent;a=[];p=this._changing;this._changing=!0;p||(this._previousAttributes=s.clone(this.attributes),this.changed={});z=this.attributes;m=this._previousAttributes;this.idAttribute in h&&(this.id=h[this.idAttribute]);for(d in h)b=h[d],s.isEqual(z[d],b)||a.push(d),s.isEqual(m[d],b)?delete this.changed[d]:this.changed[d]=b,g?delete z[d]:
z[d]=b;if(!f){a.length&&(this._pending=!0);b=0;for(d=a.length;b<d;b++)this.trigger("change:"+a[b],this,z[a[b]],e)}if(p)return this;if(!f)for(;this._pending;)this._pending=!1,this.trigger("change",this,e);this._changing=this._pending=!1;return this},unset:function(a,b){return this.set(a,void 0,s.extend({},b,{unset:!0}))},clear:function(a){var b={},e;for(e in this.attributes)b[e]=void 0;return this.set(b,s.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!s.isEmpty(this.changed):s.has(this.changed,
a)},changedAttributes:function(a){if(!a)return this.hasChanged()?s.clone(this.changed):!1;var b,e=!1,d=this._changing?this._previousAttributes:this.attributes,h;for(h in a)if(!s.isEqual(d[h],b=a[h]))(e||(e={}))[h]=b;return e},previous:function(a){return null==a||!this._previousAttributes?null:this._previousAttributes[a]},previousAttributes:function(){return s.clone(this._previousAttributes)},fetch:function(a){a=a?s.clone(a):{};void 0===a.parse&&(a.parse=!0);var b=this,e=a.success;a.success=function(d){if(!b.set(b.parse(d,
a),a))return!1;e&&e(b,d,a);b.trigger("sync",b,d,a)};G(this,a);return this.sync("read",this,a)},save:function(a,b,e){var d,h=this.attributes;null==a||"object"===typeof a?(d=a,e=b):(d={})[a]=b;if(d&&(!e||!e.wait)&&!this.set(d,e))return!1;e=s.extend({validate:!0},e);if(!this._validate(d,e))return!1;d&&e.wait&&(this.attributes=s.extend({},h,d));void 0===e.parse&&(e.parse=!0);var g=this,f=e.success;e.success=function(a){g.attributes=h;var b=g.parse(a,e);e.wait&&(b=s.extend(d||{},b));if(s.isObject(b)&&
!g.set(b,e))return!1;f&&f(g,a,e);g.trigger("sync",g,a,e)};G(this,e);a=this.isNew()?"create":e.patch?"patch":"update";"patch"===a&&(e.attrs=d);a=this.sync(a,this,e);d&&e.wait&&(this.attributes=h);return a},destroy:function(a){a=a?s.clone(a):{};var b=this,e=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};a.success=function(h){(a.wait||b.isNew())&&d();e&&e(b,h,a);b.isNew()||b.trigger("sync",b,h,a)};if(this.isNew())return a.success(),!1;G(this,a);var h=this.sync("delete",this,a);a.wait||
d();return h},url:function(){var a=s.result(this,"urlRoot")||s.result(this.collection,"url")||P();return this.isNew()?a:a+("/"===a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(a){return this._validate({},s.extend(a||{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=s.extend({},this.attributes,a);var e=this.validationError=
this.validate(a,b)||null;if(!e)return!0;this.trigger("invalid",this,e,s.extend(b||{},{validationError:e}));return!1}});s.each("keys values pairs invert pick omit".split(" "),function(a){v.prototype[a]=function(){var b=l.call(arguments);b.unshift(this.attributes);return s[a].apply(s,b)}});var B=t.Collection=function(a,b){b||(b={});b.url&&(this.url=b.url);b.model&&(this.model=b.model);void 0!==b.comparator&&(this.comparator=b.comparator);this._reset();this.initialize.apply(this,arguments);a&&this.reset(a,
s.extend({silent:!0},b))},D={add:!0,remove:!0,merge:!0},F={add:!0,merge:!1,remove:!1};s.extend(B.prototype,y,{model:v,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return t.sync.apply(this,arguments)},add:function(a,b){return this.set(a,s.defaults(b||{},F))},remove:function(a,b){a=s.isArray(a)?a.slice():[a];b||(b={});var e,d,h,g;e=0;for(d=a.length;e<d;e++)if(g=this.get(a[e]))delete this._byId[g.id],delete this._byId[g.cid],h=this.indexOf(g),
this.models.splice(h,1),this.length--,b.silent||(b.index=h,g.trigger("remove",g,this,b)),this._removeReference(g);return this},set:function(a,b){b=s.defaults(b||{},D);b.parse&&(a=this.parse(a,b));s.isArray(a)||(a=a?[a]:[]);var e,d,h,g,p,m=b.at,z=this.comparator&&null==m&&!1!==b.sort,u=s.isString(this.comparator)?this.comparator:null,q=[],l=[],A={};e=0;for(d=a.length;e<d;e++)if(h=this._prepareModel(a[e],b))(g=this.get(h))?(b.remove&&(A[g.cid]=!0),b.merge&&(g.set(h.attributes,b),z&&(!p&&g.hasChanged(u))&&
(p=!0))):b.add&&(q.push(h),h.on("all",this._onModelEvent,this),this._byId[h.cid]=h,null!=h.id&&(this._byId[h.id]=h));if(b.remove){e=0;for(d=this.length;e<d;++e)A[(h=this.models[e]).cid]||l.push(h);l.length&&this.remove(l,b)}q.length&&(z&&(p=!0),this.length+=q.length,null!=m?n.apply(this.models,[m,0].concat(q)):f.apply(this.models,q));p&&this.sort({silent:!0});if(b.silent)return this;e=0;for(d=q.length;e<d;e++)(h=q[e]).trigger("add",h,this,b);p&&this.trigger("sort",this,b);return this},reset:function(a,
b){b||(b={});for(var e=0,d=this.models.length;e<d;e++)this._removeReference(this.models[e]);b.previousModels=this.models;this._reset();this.add(a,s.extend({silent:!0},b));b.silent||this.trigger("reset",this,b);return this},push:function(a,b){a=this._prepareModel(a,b);this.add(a,s.extend({at:this.length},b));return a},pop:function(a){var b=this.at(this.length-1);this.remove(b,a);return b},unshift:function(a,b){a=this._prepareModel(a,b);this.add(a,s.extend({at:0},b));return a},shift:function(a){var b=
this.at(0);this.remove(b,a);return b},slice:function(a,b){return this.models.slice(a,b)},get:function(a){return null==a?void 0:this._byId[null!=a.id?a.id:a.cid||a]},at:function(a){return this.models[a]},where:function(a,b){return s.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var e in a)if(a[e]!==b.get(e))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw Error("Cannot sort a set without a comparator");a||(a={});s.isString(this.comparator)||
1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(s.bind(this.comparator,this));a.silent||this.trigger("sort",this,a);return this},sortedIndex:function(a,b,e){b||(b=this.comparator);var d=s.isFunction(b)?b:function(a){return a.get(b)};return s.sortedIndex(this.models,a,d,e)},pluck:function(a){return s.invoke(this.models,"get",a)},fetch:function(a){a=a?s.clone(a):{};void 0===a.parse&&(a.parse=!0);var b=a.success,e=this;a.success=function(d){e[a.reset?"reset":
"set"](d,a);b&&b(e,d,a);e.trigger("sync",e,d,a)};G(this,a);return this.sync("read",this,a)},create:function(a,b){b=b?s.clone(b):{};if(!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var e=this,d=b.success;b.success=function(h){b.wait&&e.add(a,b);d&&d(a,h,b)};a.save(null,b);return a},parse:function(a,b){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(a,b){if(a instanceof v)return a.collection||
(a.collection=this),a;b||(b={});b.collection=this;var e=new this.model(a,b);return!e._validate(a,b)?(this.trigger("invalid",this,a,b),!1):e},_removeReference:function(a){this===a.collection&&delete a.collection;a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,e,d){("add"===a||"remove"===a)&&e!==this||("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))}});
s.each("forEach each map collect reduce foldl inject reduceRight foldr find detect filter select reject every all some any include contains invoke max min toArray size first head take initial rest tail drop last without indexOf shuffle lastIndexOf isEmpty chain".split(" "),function(a){B.prototype[a]=function(){var b=l.call(arguments);b.unshift(this.models);return s[a].apply(s,b)}});s.each(["groupBy","countBy","sortBy"],function(a){B.prototype[a]=function(b,e){var d=s.isFunction(b)?b:function(a){return a.get(b)};
return s[a](this.models,d,e)}});var d=t.View=function(a){this.cid=s.uniqueId("view");this._configure(a||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()},g=/^(\S+)\s*(.*)$/,p="model collection el id attributes className tagName events".split(" ");s.extend(d.prototype,y,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(a,
b){this.$el&&this.undelegateEvents();this.$el=a instanceof t.$?a:t.$(a);this.el=this.$el[0];!1!==b&&this.delegateEvents();return this},delegateEvents:function(a){if(!a&&!(a=s.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var e=a[b];s.isFunction(e)||(e=this[a[b]]);if(e){var d=b.match(g),h=d[1],d=d[2],e=s.bind(e,this),h=h+(".delegateEvents"+this.cid);if(""===d)this.$el.on(h,e);else this.$el.on(h,d,e)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+
this.cid);return this},_configure:function(a){this.options&&(a=s.extend({},s.result(this,"options"),a));s.extend(this,s.pick(a,p));this.options=a},_ensureElement:function(){if(this.el)this.setElement(s.result(this,"el"),!1);else{var a=s.extend({},s.result(this,"attributes"));this.id&&(a.id=s.result(this,"id"));this.className&&(a["class"]=s.result(this,"className"));a=t.$("<"+s.result(this,"tagName")+">").attr(a);this.setElement(a,!1)}}});t.sync=function(a,b,d){var h=e[a];s.defaults(d||(d={}),{emulateHTTP:t.emulateHTTP,
emulateJSON:t.emulateJSON});var g={type:h,dataType:"json"};d.url||(g.url=s.result(b,"url")||P());if(null==d.data&&b&&("create"===a||"update"===a||"patch"===a))g.contentType="application/json",g.data=JSON.stringify(d.attrs||b.toJSON(d));d.emulateJSON&&(g.contentType="application/x-www-form-urlencoded",g.data=g.data?{model:g.data}:{});if(d.emulateHTTP&&("PUT"===h||"DELETE"===h||"PATCH"===h)){g.type="POST";d.emulateJSON&&(g.data._method=h);var f=d.beforeSend;d.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",
h);if(f)return f.apply(this,arguments)}}"GET"!==g.type&&!d.emulateJSON&&(g.processData=!1);if("PATCH"===g.type&&window.ActiveXObject&&(!window.external||!window.external.msActiveXFilteringEnabled))g.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")};a=d.xhr=t.ajax(s.extend(g,d));b.trigger("request",b,a,d);return a};var e={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var m=t.Router=function(a){a||(a={});a.routes&&
(this.routes=a.routes);this._bindRoutes();this.initialize.apply(this,arguments)},h=/\((.*?)\)/g,u=/(\(\?)?:\w+/g,A=/\*\w+/g,z=/[\-{}\[\]+?.,\\\^$|#\s]/g;s.extend(m.prototype,y,{initialize:function(){},route:function(a,b,e){s.isRegExp(a)||(a=this._routeToRegExp(a));s.isFunction(b)&&(e=b,b="");e||(e=this[b]);var d=this;t.history.route(a,function(h){h=d._extractParameters(a,h);e&&e.apply(d,h);d.trigger.apply(d,["route:"+b].concat(h));d.trigger("route",b,h);t.history.trigger("route",d,b,h)});return this},
navigate:function(a,b){t.history.navigate(a,b);return this},_bindRoutes:function(){if(this.routes){this.routes=s.result(this,"routes");for(var a,b=s.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){a=a.replace(z,"\\$&").replace(h,"(?:$1)?").replace(u,function(a,b){return b?a:"([^/]+)"}).replace(A,"(.*?)");return RegExp("^"+a+"$")},_extractParameters:function(a,b){var e=a.exec(b).slice(1);return s.map(e,function(a){return a?decodeURIComponent(a):null})}});
var J=t.History=function(){this.handlers=[];s.bindAll(this,"checkUrl");"undefined"!==typeof window&&(this.location=window.location,this.history=window.history)},R=/^[#\/]|\s+$/g,I=/^\/+|\/+$/g,H=/msie [\w.]+/,N=/\/$/;J.started=!1;s.extend(J.prototype,y,{interval:50,getHash:function(a){return(a=(a||this).location.href.match(/#(.*)$/))?a[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=this.location.pathname;var e=this.root.replace(N,"");a.indexOf(e)||
(a=a.substr(e.length))}else a=this.getHash();return a.replace(R,"")},start:function(a){if(J.started)throw Error("Backbone.history has already been started");J.started=!0;this.options=s.extend({},{root:"/"},this.options,a);this.root=this.options.root;this._wantsHashChange=!1!==this.options.hashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=!(!this.options.pushState||!this.history||!this.history.pushState);a=this.getFragment();var b=document.documentMode,b=H.exec(navigator.userAgent.toLowerCase())&&
(!b||7>=b);this.root=("/"+this.root+"/").replace(I,"/");b&&this._wantsHashChange&&(this.iframe=t.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(a));if(this._hasPushState)t.$(window).on("popstate",this.checkUrl);else if(this._wantsHashChange&&"onhashchange"in window&&!b)t.$(window).on("hashchange",this.checkUrl);else this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval));this.fragment=a;a=this.location;b=a.pathname.replace(/[^\/]$/,
"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!b)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&(this._hasPushState&&b&&a.hash)&&(this.fragment=this.getHash().replace(R,""),this.history.replaceState({},document.title,this.root+this.fragment+a.search));if(!this.options.silent)return this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",
this.checkUrl);clearInterval(this._checkUrlInterval);J.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){a=this.getFragment();a===this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe)));if(a===this.fragment)return!1;this.iframe&&this.navigate(a);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(a){var b=this.fragment=this.getFragment(a);return s.any(this.handlers,function(a){if(a.route.test(b))return a.callback(b),!0})},
navigate:function(a,b){if(!J.started)return!1;if(!b||!0===b)b={trigger:b};a=this.getFragment(a||"");if(this.fragment!==a){this.fragment=a;var e=this.root+a;if(this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,e);else if(this._wantsHashChange)this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace));else return this.location.assign(e);
b.trigger&&this.loadUrl(a)}},_updateHash:function(a,b,e){e?(e=a.href.replace(/(javascript:|#).*$/,""),a.replace(e+"#"+b)):a.hash="#"+b}});t.history=new J;v.extend=B.extend=m.extend=d.extend=J.extend=function(a,b){var e=this,d;d=a&&s.has(a,"constructor")?a.constructor:function(){return e.apply(this,arguments)};s.extend(d,e,b);var h=function(){this.constructor=d};h.prototype=e.prototype;d.prototype=new h;a&&s.extend(d.prototype,a);d.__super__=e.prototype;return d};var P=function(){throw Error('A "url" property or function must be specified');
},G=function(a,b){var e=b.error;b.error=function(d){e&&e(a,d,b);a.trigger("error",a,d,b)}}}).call(this);/*

Copyright (c) 2008 Fred Palmer fred.palmer_at_gmail.com
base64.js: MIT Licensed.
*/
(function(a){function b(){this.buffer=[]}function d(a){this._input=a;this._index=-1;this._buffer=[]}function f(a){this._input=a;this._index=-1;this._buffer=[]}b.prototype.append=function(a){this.buffer.push(a);return this};b.prototype.toString=function(){return this.buffer.join("")};var l={codex:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var f=new b;for(a=new d(a);a.moveNext();){var l=a.current;a.moveNext();var y=a.current;a.moveNext();var w=a.current,E=
l>>2,l=(l&3)<<4|y>>4,q=(y&15)<<2|w>>6,v=w&63;isNaN(y)?q=v=64:isNaN(w)&&(v=64);f.append(this.codex.charAt(E)+this.codex.charAt(l)+this.codex.charAt(q)+this.codex.charAt(v))}return f.toString()},decode:function(a){var d=new b;for(a=new f(a);a.moveNext();){var l=a.current;if(128>l)d.append(String.fromCharCode(l));else if(191<l&&224>l){a.moveNext();var y=a.current;d.append(String.fromCharCode((l&31)<<6|y&63))}else a.moveNext(),y=a.current,a.moveNext(),d.append(String.fromCharCode((l&15)<<12|(y&63)<<6|
a.current&63))}return d.toString()}};d.prototype={current:Number.NaN,moveNext:function(){if(0<this._buffer.length)return this.current=this._buffer.shift(),!0;if(this._index>=this._input.length-1)return this.current=Number.NaN,!1;var a=this._input.charCodeAt(++this._index);13==a&&10==this._input.charCodeAt(this._index+1)&&(a=10,this._index+=2);128>a?this.current=a:(127<a&&2048>a?this.current=a>>6|192:(this.current=a>>12|224,this._buffer.push(a>>6&63|128)),this._buffer.push(a&63|128));return!0}};f.prototype=
{current:64,moveNext:function(){if(0<this._buffer.length)return this.current=this._buffer.shift(),!0;if(this._index>=this._input.length-1)return this.current=64,!1;var a=l.codex.indexOf(this._input.charAt(++this._index)),b=l.codex.indexOf(this._input.charAt(++this._index)),d=l.codex.indexOf(this._input.charAt(++this._index)),f=l.codex.indexOf(this._input.charAt(++this._index)),w=(d&3)<<6|f;this.current=a<<2|b>>4;64!=d&&this._buffer.push((b&15)<<4|d>>2);64!=f&&this._buffer.push(w);return!0}};a.Base64js=
l})(window);/*
 FileSaver.js
  A saveAs() FileSaver implementation.
  2014-01-24

  By Eli Grey, http://eligrey.com
  License: X11/MIT
    See LICENSE.md
*/
var saveAs=saveAs||"undefined"!==typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(a){if(!("undefined"!==typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var b=a.document,d=a.URL||a.webkitURL||a,f=b.createElementNS("http://www.w3.org/1999/xhtml","a"),l=!a.externalHost&&"download"in f,n=a.webkitRequestFileSystem,t=a.requestFileSystem||n||a.mozRequestFileSystem,s=function(b){(a.setImmediate||a.setTimeout)(function(){throw b;},0)},y=0,w=[],
E=function(){for(var a=w.length;a--;){var b=w[a];"string"===typeof b?d.revokeObjectURL(b):b.remove()}w.length=0},q=function(a,b,d){b=[].concat(b);for(var f=b.length;f--;){var e=a["on"+b[f]];if("function"===typeof e)try{e.call(a,d||a)}catch(m){s(m)}}},v=function(d,r){var g=this,p=d.type,e=!1,m,h,u=function(){var b=(a.URL||a.webkitURL||a).createObjectURL(d);w.push(b);return b},A=function(){q(g,["writestart","progress","write","writeend"])},z=function(){if(e||!m)m=u(d);h?h.location.href=m:window.open(m,
"_blank");g.readyState=g.DONE;A()},v=function(a){return function(){if(g.readyState!==g.DONE)return a.apply(this,arguments)}},B={create:!0,exclusive:!1},I;g.readyState=g.INIT;r||(r="download");if(l)m=u(d),b=a.document,f=b.createElementNS("http://www.w3.org/1999/xhtml","a"),f.href=m,f.download=r,p=b.createEvent("MouseEvents"),p.initMouseEvent("click",!0,!1,a,0,0,0,0,0,!1,!1,!1,!1,0,null),f.dispatchEvent(p),g.readyState=g.DONE,A();else{a.chrome&&(p&&"application/octet-stream"!==p)&&(I=d.slice||d.webkitSlice,
d=I.call(d,0,d.size,"application/octet-stream"),e=!0);n&&"download"!==r&&(r+=".download");if("application/octet-stream"===p||n)h=a;t?(y+=d.size,t(a.TEMPORARY,y,v(function(a){a.root.getDirectory("saved",B,v(function(a){var b=function(){a.getFile(r,B,v(function(a){a.createWriter(v(function(b){b.onwriteend=function(b){h.location.href=a.toURL();w.push(a);g.readyState=g.DONE;q(g,"writeend",b)};b.onerror=function(){var a=b.error;a.code!==a.ABORT_ERR&&z()};["writestart","progress","write","abort"].forEach(function(a){b["on"+
a]=g["on"+a]});b.write(d);g.abort=function(){b.abort();g.readyState=g.DONE};g.readyState=g.WRITING}),z)}),z)};a.getFile(r,{create:!1},v(function(a){a.remove();b()}),v(function(a){a.code===a.NOT_FOUND_ERR?b():z()}))}),z)}),z)):z()}},r=v.prototype,B=function(a,b){return new v(a,b)};r.abort=function(){this.readyState=this.DONE;q(this,"abort")};r.readyState=r.INIT=0;r.WRITING=1;r.DONE=2;r.error=r.onwritestart=r.onprogress=r.onwrite=r.onabort=r.onerror=r.onwriteend=null;a.addEventListener("unload",E,!1);
B.unload=function(){E();a.removeEventListener("unload",E,!1)};return B}}("undefined"!==typeof self&&self||"undefined"!==typeof window&&window||this.content);"undefined"!==typeof module&&(module.exports=saveAs);/*

 XMLWriter
 Copyright (c) 2008 Ariel Flesler
 Licensed under BSD
*/
function XMLWriter(a,b){a&&(this.encoding=a);b&&(this.version=b)}
(function(){function a(a){return a.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;").split('"').join("&quot;")}function b(a){for(var d=a.c.length;d--;)"object"==typeof a.c[d]&&b(a.c[d]);a.n=a.a=a.c=null}function d(a,b,n,t){var s=b+"<"+a.n,y=a.c.length,w,E=0;for(w in a.a)s+=" "+w+'="'+a.a[w]+'"';t.push(s+(y?">":" />"));if(y){do if(s=a.c[E++],"string"==typeof s){if(1==y)return t.push(t.pop()+s+"</"+a.n+">");t.push(b+n+s)}else"object"==typeof s&&d(s,b+n,n,t);while(E<y);t.push(b+
"</"+a.n+">")}}XMLWriter.prototype={encoding:"ISO-8859-1",version:"1.0",formatting:"indented",indentChar:"\t",indentation:1,newLine:"\n",writeStartDocument:function(a){this.close();this.stack=[];this.standalone=a},writeEndDocument:function(){this.active=this.root;this.stack=[]},writeDocType:function(a){this.doctype=a},writeStartElement:function(a,b){b&&(a=b+":"+a);var d={n:a,a:{},c:[]};this.active?(this.active.c.push(d),this.stack.push(this.active)):this.root=d;this.active=d},deleteEndElement:function(){this.stack.pop();
this.active.c.pop()},writeEndElement:function(){this.active=this.stack.pop()||this.root},writeAttributeString:function(b,d){this.active&&(this.active.a[b]=a(d))},writeString:function(b){this.active&&this.active.c.push(a(b))},writeElementString:function(b,d,n){this.writeStartElement(b,n);this.writeString(a(d));this.writeEndElement()},writeCDATA:function(a){a=a.replace(/>>]/g,"]]\x3e<![CDATA[>");this.writeString("<![CDATA["+a+"]]\x3e")},writeComment:function(a){this.writeString("\x3c!-- "+a+" --\x3e")},
flush:function(a){"undefined"==typeof a&&(a={});this.stack&&this.stack[0]&&this.writeEndDocument();var b="",n=this.indentation,t="indented"==this.formatting.toLowerCase(),s="";a.suppress_xml_tag||(s+='<?xml version="'+this.version+'" encoding="'+this.encoding+'"',void 0!==this.standalone&&(s+=' standalone="'+(this.standalone?"yes":"no")+'" '),s+=" ?>");s=[s];this.doctype&&this.root&&s.push("<!DOCTYPE "+this.root.n+" "+this.doctype+">");if(t)for(;n--;)b+=this.indentChar;this.root&&d(this.root,"",b,
s);return s.join(t?this.newLine:"")},close:function(){this.root&&b(this.root);this.active=this.root=this.stack=null},getDocument:window.ActiveXObject?function(){var a=new ActiveXObject("Microsoft.XMLDOM");a.async=!1;a.loadXML(this.flush());return a}:function(){return(new DOMParser).parseFromString(this.flush(),"text/xml")}}})();/*

 jQuery.ScrollTo, jQuery.localScroll
 Copyright (c) 2007-2014 Ariel Flesler - aflesler<a>gmail<d>com | http://flesler.blogspot.com
 Licensed under MIT
*/
(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){function b(b){return a.isFunction(b)||"object"==typeof b?b:{top:b,left:b}}var d=a.scrollTo=function(b,d,n){return a(window).scrollTo(b,d,n)};d.defaults={axis:"xy",duration:1.3<=parseFloat(a.fn.jquery)?0:1,limit:!0};d.window=function(b){return a(window)._scrollable()};a.fn._scrollable=function(){return this.map(function(){if(this.nodeName&&-1==a.inArray(this.nodeName.toLowerCase(),["iframe","#document",
"html","body"]))return this;var b=(this.contentWindow||this).document||this.ownerDocument||this;return/webkit/i.test(navigator.userAgent)||"BackCompat"==b.compatMode?b.body:b.documentElement})};a.fn.scrollTo=function(f,l,n){"object"==typeof l&&(n=l,l=0);"function"==typeof n&&(n={onAfter:n});"max"==f&&(f=9E9);n=a.extend({},d.defaults,n);l=l||n.duration;n.queue=n.queue&&1<n.axis.length;n.queue&&(l/=2);n.offset=b(n.offset);n.over=b(n.over);return this._scrollable().each(function(){function t(a){y.animate(q,
l,n.easing,a&&function(){a.call(this,w,n)})}if(null!=f){var s=this,y=a(s),w=f,E,q={},v=y.is("html,body");switch(typeof w){case "number":case "string":if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(w)){w=b(w);break}w=a(w,this);if(!w.length)return;case "object":if(w.is||w.style)E=(w=a(w)).offset()}var r=a.isFunction(n.offset)&&n.offset(s,w)||n.offset;a.each(n.axis.split(""),function(a,b){var f="x"==b?"Left":"Top",g=f.toLowerCase(),p="scroll"+f,e=s[p],m=d.max(s,b);E?(q[p]=E[g]+(v?0:e-y.offset()[g]),n.margin&&
(q[p]-=parseInt(w.css("margin"+f))||0,q[p]-=parseInt(w.css("border"+f+"Width"))||0),q[p]+=r[g]||0,n.over[g]&&(q[p]+=w["x"==b?"width":"height"]()*n.over[g])):(f=w[g],q[p]=f.slice&&"%"==f.slice(-1)?parseFloat(f)/100*m:f);n.limit&&/^\d+$/.test(q[p])&&(q[p]=0>=q[p]?0:Math.min(q[p],m));!a&&n.queue&&(e!=q[p]&&t(n.onAfterFirst),delete q[p])});t(n.onAfter)}}).end()};d.max=function(b,d){var n="x"==d?"Width":"Height",t="scroll"+n;if(!a(b).is("html,body"))return b[t]-a(b)[n.toLowerCase()]();var n="client"+n,
s=b.ownerDocument.documentElement,y=b.ownerDocument.body;return Math.max(s[t],y[t])-Math.min(s[n],y[n])};return d});/*

 jQuery outside events - v1.1 - 3/16/2010
 http://benalman.com/projects/jquery-outside-events-plugin/

 Copyright (c) 2010 "Cowboy" Ben Alman
 Dual licensed under the MIT and GPL licenses.
 http://benalman.com/about/license/
*/
(function(a,b,d){function f(f,n){function t(b){a(s).each(function(){var d=a(this);this!==b.target&&!d.has(b.target).length&&d.triggerHandler(n,[b.target])})}n=n||f+d;var s=a(),y=f+"."+n+"-special-event";a.event.special[n]={setup:function(){s=s.add(this);1===s.length&&a(b).bind(y,t)},teardown:function(){s=s.not(this);0===s.length&&a(b).unbind(y)},add:function(a){var b=a.handler;a.handler=function(a,d){a.target=d;b.apply(this,arguments)}}}}a.map(["click","mousedown","mouseup","touchstart","touchtap"],
function(a){f(a)});f("focusin","focus"+d);f("focusout","blur"+d);a.addOutsideEvent=f})(jQuery,document,"outside");/*

 jQuery UI Touch Punch 0.2.2

 Copyright 2011, Dave Furfero
 Dual licensed under the MIT or GPL Version 2 licenses.

 Depends:
  jquery.ui.widget.js
  jquery.ui.mouse.js
*/
(function(a){function b(a,b){if(!(1<a.originalEvent.touches.length)){a.preventDefault();var d=a.originalEvent.changedTouches[0],f=document.createEvent("MouseEvents");f.initMouseEvent(b,!0,!0,window,1,d.screenX,d.screenY,d.clientX,d.clientY,!1,!1,!1,!1,0,null);a.target.dispatchEvent(f)}}a.support.touch="ontouchend"in document;if(a.support.touch){var d=a.ui.mouse.prototype,f=d._mouseInit,l;d._touchStart=function(a){!l&&this._mouseCapture(a.originalEvent.changedTouches[0])&&(l=!0,this._touchMoved=!1,
b(a,"mouseover"),b(a,"mousemove"),b(a,"mousedown"))};d._touchMove=function(a){l&&(this._touchMoved=!0,b(a,"mousemove"))};d._touchEnd=function(a){l&&(b(a,"mouseup"),b(a,"mouseout"),this._touchMoved||b(a,"click"),l=!1)};d._mouseInit=function(){this.element.bind("touchstart",a.proxy(this,"_touchStart")).bind("touchmove",a.proxy(this,"_touchMove")).bind("touchend",a.proxy(this,"_touchEnd"));f.call(this)}}})(jQuery);/*

 jQuery Cookie Plugin v1.3.1
 https://github.com/carhartl/jquery-cookie

 Copyright 2013 Klaus Hartl
 Released under the MIT license
*/
(function(a){"function"===typeof define&&define.amd&&define.amd.jQuery?define(["jquery"],a):a(jQuery)})(function(a){function b(a){return a}function d(a){return decodeURIComponent(a.replace(l," "))}function f(a){0===a.indexOf('"')&&(a=a.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));return n.json?JSON.parse(a):a}var l=/\+/g,n=a.cookie=function(l,s,y){if(void 0!==s){y=a.extend({},n.defaults,y);if("number"===typeof y.expires){var w=y.expires,E=y.expires=new Date;E.setDate(E.getDate()+w)}s=n.json?
JSON.stringify(s):String(s);return document.cookie=[encodeURIComponent(l),"=",n.raw?s:encodeURIComponent(s),y.expires?"; expires="+y.expires.toUTCString():"",y.path?"; path="+y.path:"",y.domain?"; domain="+y.domain:"",y.secure?"; secure":""].join("")}s=n.raw?b:d;y=document.cookie.split("; ");for(var w=l?void 0:{},E=0,q=y.length;E<q;E++){var v=y[E].split("="),r=s(v.shift()),v=s(v.join("="));if(l&&l===r){w=f(v);break}l||(w[r]=f(v))}return w};n.defaults={};a.removeCookie=function(b,d){return void 0!==
a.cookie(b)?(a.cookie(b,"",a.extend(d,{expires:-1})),!0):!1}});/*
 
 jQuery dragscrollable Plugin
 version: 1.0 (25-Jun-2009)
 Copyright (c) 2009 Miquel Herrera

 Dual licensed under the MIT and GPL licenses:
   http://www.opensource.org/licenses/mit-license.php
   http://www.gnu.org/licenses/gpl.html

*/
(function(a){a.fn.dragscrollable=function(b){var d=a.extend({dragSelector:">:first",acceptPropagatedEvent:!0,preventDefault:!0,filter:null,dragScale:null},b||{}),f={mouseDownHandler:function(b){if(1!=b.which||!b.data.acceptPropagatedEvent&&b.target!=this)return!1;if(!d.filter||d.filter(b))if(b.data.lastCoord={left:b.clientX,top:b.clientY},a.event.add(document,"mouseup",f.mouseUpHandler,b.data),a.event.add(document,"mousemove",f.mouseMoveHandler,b.data),b.data.preventDefault)return b.preventDefault(),
!1},mouseMoveHandler:function(a){if(!d.filter||d.filter(a)){var b=d.dragScale?d.dragScale():1,f=(a.clientX-a.data.lastCoord.left)*b,b=(a.clientY-a.data.lastCoord.top)*b;a.data.scrollable.scrollLeft(a.data.scrollable.scrollLeft()-f);a.data.scrollable.scrollTop(a.data.scrollable.scrollTop()-b);a.data.lastCoord={left:a.clientX,top:a.clientY};if(a.data.preventDefault)return a.preventDefault(),!1}},mouseUpHandler:function(b){a.event.remove(document,"mousemove",f.mouseMoveHandler);a.event.remove(document,
"mouseup",f.mouseUpHandler);if(b.data.preventDefault)return b.preventDefault(),!1}};this.each(function(){var b={scrollable:a(this),acceptPropagatedEvent:d.acceptPropagatedEvent,preventDefault:d.preventDefault};a(this).find(d.dragSelector).bind("mousedown",b,f.mouseDownHandler)})}})(jQuery);jQuery.fn.noSelect=function(){return this.bind("selectstart dragstart mousedown",function(){return!1}).css({MozUserSelect:"none",msUserSelect:"none",webkitUserSelect:"none",userSelect:"none"})};/*
 LICENSE (BSD):

 Copyright 2013 David Bau, all rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are met:

   1. Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.

   2. Redistributions in binary form must reproduce the above copyright
      notice, this list of conditions and the following disclaimer in the
      documentation and/or other materials provided with the distribution.

   3. Neither the name of this module nor the names of its contributors may
      be used to endorse or promote products derived from this software
      without specific prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/
(function(a,b,d,f,l,n){function t(a){var b,d=a.length,p=this,e=0,m=p.i=p.j=0,h=p.S=[];for(d||(a=[d++]);e<f;)h[e]=e++;for(e=0;e<f;e++)h[e]=h[m=B&m+a[e%d]+(b=h[e])],h[m]=b;(p.g=function(a){for(var b,e=0,d=p.i,h=p.j,g=p.S;a--;)b=g[d=B&d+1],e=e*f+g[B&(g[d]=g[h=B&h+b])+(g[h]=b)];p.i=d;p.j=h;return e})(f)}function s(a,b){var d=[],p=(typeof a)[0],e;if(b&&"o"==p)for(e in a)if(a.hasOwnProperty(e))try{d.push(s(a[e],b-1))}catch(f){}return d.length?d:"s"==p?a:a+"\x00"}function y(a,b){for(var d=a+"",p,e=0;e<d.length;)b[B&
e]=B&(p^=19*b[B&e])+d.charCodeAt(e++);return E(b)}function w(d){try{return a.crypto.getRandomValues(d=new Uint8Array(f)),E(d)}catch(q){return[+new Date,a.document,a.history,a.navigator,a.screen,E(b)]}}function E(a){return String.fromCharCode.apply(0,a)}var q=d.pow(f,l),v=d.pow(2,n),r=2*v,B=f-1;d.seedrandom=function(a,n){var g=[],p=y(s(n?[a,E(b)]:0 in arguments?a:w(),3),g),e=new t(g);y(E(e.S),b);d.random=function(){for(var a=e.g(l),b=q,d=0;a<v;)a=(a+d)*f,b*=f,d=e.g(1);for(;a>=r;)a/=2,b/=2,d>>>=1;return(a+
d)/b};return p};y(d.random(),b)})(this,[],Math,256,6,52);/*
 MIT License - http://www.opensource.org/licenses/mit-license.php

 For usage and examples, visit:
 http://timeago.yarp.com/

 Copyright (c) 2008-2013, Ryan McGeary (ryan -[at]- mcgeary [*dot*] org)
*/
(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){function b(){var b;b=a(this);if(!b.data("timeago")){b.data("timeago",{datetime:f.datetime(b)});var l=a.trim(b.text());0<l.length&&(!f.isTime(b)||!b.attr("title"))&&b.attr("title",l)}b=b.data("timeago");isNaN(b.datetime)||a(this).text(d(b.datetime));return this}function d(a){return f.inWords((new Date).getTime()-a.getTime())}a.timeago=function(b){return b instanceof Date?d(b):"string"===typeof b?d(a.timeago.parse(b)):
"number"===typeof b?d(new Date(b)):d(a.timeago.datetime(b))};var f=a.timeago;a.extend(a.timeago,{settings:{refreshMillis:6E4,allowFuture:!1,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(b){function d(q,
r){return(a.isFunction(q)?q(r,b):q).replace(/%d/i,f.numbers&&f.numbers[r]||r)}var f=this.settings.strings,l=f.prefixAgo,w=f.suffixAgo;this.settings.allowFuture&&0>b&&(l=f.prefixFromNow,w=f.suffixFromNow);var E=Math.abs(b)/1E3,q=E/60,v=q/60,r=v/24,B=r/365,E=45>E&&d(f.seconds,Math.round(E))||90>E&&d(f.minute,1)||45>q&&d(f.minutes,Math.round(q))||90>q&&d(f.hour,1)||24>v&&d(f.hours,Math.round(v))||42>v&&d(f.day,1)||30>r&&d(f.days,Math.round(r))||45>r&&d(f.month,1)||365>r&&d(f.months,Math.round(r/30))||
1.5>B&&d(f.year,1)||d(f.years,Math.round(B)),q=f.wordSeparator||"";void 0===f.wordSeparator&&(q=" ");return a.trim([l,E,w].join(q))},parse:function(b){b=a.trim(b);b=b.replace(/\.\d+/,"");b=b.replace(/-/,"/").replace(/-/,"/");b=b.replace(/T/," ").replace(/Z/," UTC");b=b.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2");return new Date(b)},datetime:function(b){b=f.isTime(b)?a(b).attr("datetime"):a(b).attr("title");return f.parse(b)},isTime:function(b){return"time"===a(b).get(0).tagName.toLowerCase()}});var l=
{init:function(){var d=a.proxy(b,this);d();var l=f.settings;0<l.refreshMillis&&setInterval(d,l.refreshMillis)},update:function(d){a(this).data("timeago",{datetime:f.parse(d)});b.apply(this)}};a.fn.timeago=function(a,b){var d=a?l[a]:l.init;if(!d)throw Error("Unknown function name '"+a+"' for timeago");this.each(function(){d.call(this,b)});return this};document.createElement("abbr");document.createElement("time")});(function(){var a,b,d,f,l,n,t,s,y,w,E,q,v,r,B,D,F,g,p,e=[].slice,m=[].indexOf||function(a){for(var b=0,e=this.length;b<e;b++)if(b in this&&this[b]===a)return b;return-1};a=jQuery;a.payment={};a.payment.fn={};a.fn.payment=function(){var b,d;d=arguments[0];b=2<=arguments.length?e.call(arguments,1):[];return a.payment.fn[d].apply(this,b)};l=/(\d{1,4})/g;f=[{type:"maestro",pattern:/^(5018|5020|5038|6304|6759|676[1-3])/,format:l,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"dinersclub",
pattern:/^(36|38|30[0-5])/,format:l,length:[14],cvcLength:[3],luhn:!0},{type:"laser",pattern:/^(6706|6771|6709)/,format:l,length:[16,17,18,19],cvcLength:[3],luhn:!0},{type:"jcb",pattern:/^35/,format:l,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",pattern:/^62/,format:l,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"discover",pattern:/^(6011|65|64[4-9]|622)/,format:l,length:[16],cvcLength:[3],luhn:!0},{type:"mastercard",pattern:/^5[1-5]/,format:l,length:[16],cvcLength:[3],luhn:!0},{type:"amex",
pattern:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:!0},{type:"visa",pattern:/^4/,format:l,length:[13,14,15,16],cvcLength:[3],luhn:!0}];b=function(a){var b,e,d;a=(a+"").replace(/\D/g,"");e=0;for(d=f.length;e<d;e++)if(b=f[e],b.pattern.test(a))return b};d=function(a){var b,e,d;e=0;for(d=f.length;e<d;e++)if(b=f[e],b.type===a)return b};v=function(a){var b,e,d,g,f;e=!0;d=0;b=(a+"").split("").reverse();g=0;for(f=b.length;g<f;g++){a=b[g];a=parseInt(a,10);if(e=!e)a*=2;
9<a&&(a-=9);d+=a}return 0===d%10};q=function(a){var b;return null!=a.prop("selectionStart")&&a.prop("selectionStart")!==a.prop("selectionEnd")||"undefined"!==typeof document&&null!==document&&null!=(b=document.selection)&&"function"===typeof b.createRange&&b.createRange().text?!0:!1};r=function(b){return setTimeout(function(){var e,d;e=a(b.currentTarget);d=e.val();d=a.payment.formatCardNumber(d);return e.val(d)})};s=function(e){var d,g,f,p,m,q;f=String.fromCharCode(e.which);if(/^\d+$/.test(f)&&(d=
a(e.currentTarget),q=d.val(),g=b(q+f),p=(q.replace(/\D/g,"")+f).length,m=16,g&&(m=g.length[g.length.length-1]),!(p>=m)&&!(null!=d.prop("selectionStart")&&d.prop("selectionStart")!==q.length))){g=g&&"amex"===g.type?/^(\d{4}|\d{4}\s\d{6})$/:/(?:^|\s)(\d{4})$/;if(g.test(q))return e.preventDefault(),d.val(q+" "+f);if(g.test(q+f))return e.preventDefault(),d.val(q+f+" ")}};n=function(b){var e,d;e=a(b.currentTarget);d=e.val();if(!b.meta&&8===b.which&&!(null!=e.prop("selectionStart")&&e.prop("selectionStart")!==
d.length)){if(/\d\s$/.test(d))return b.preventDefault(),e.val(d.replace(/\d\s$/,""));if(/\s\d?$/.test(d))return b.preventDefault(),e.val(d.replace(/\s\d?$/,""))}};y=function(b){var e,d;d=String.fromCharCode(b.which);if(/^\d+$/.test(d)){e=a(b.currentTarget);d=e.val()+d;if(/^\d$/.test(d)&&"0"!==d&&"1"!==d)return b.preventDefault(),e.val("0"+d+" / ");if(/^\d\d$/.test(d))return b.preventDefault(),e.val(""+d+" / ")}};w=function(b){var e;e=String.fromCharCode(b.which);if(/^\d+$/.test(e)&&(b=a(b.currentTarget),
e=b.val(),/^\d\d$/.test(e)))return b.val(""+e+" / ")};E=function(b){var e;if("/"===String.fromCharCode(b.which)&&(b=a(b.currentTarget),e=b.val(),/^\d$/.test(e)&&"0"!==e))return b.val("0"+e+" / ")};t=function(b){var e,d;if(!b.meta&&(e=a(b.currentTarget),d=e.val(),8===b.which&&!(null!=e.prop("selectionStart")&&e.prop("selectionStart")!==d.length))){if(/\d(\s|\/)+$/.test(d))return b.preventDefault(),e.val(d.replace(/\d(\s|\/)*$/,""));if(/\s\/\s?\d?$/.test(d))return b.preventDefault(),e.val(d.replace(/\s\/\s?\d?$/,
""))}};g=function(a){if(a.metaKey||a.ctrlKey)return!0;if(32===a.which)return!1;if(0===a.which||33>a.which)return!0;a=String.fromCharCode(a.which);return!!/[\d\s]/.test(a)};D=function(e){var d;d=a(e.currentTarget);e=String.fromCharCode(e.which);if(/^\d+$/.test(e)&&!q(d))return e=(d.val()+e).replace(/\D/g,""),(d=b(e))?e.length<=d.length[d.length.length-1]:16>=e.length};F=function(b){var e;e=a(b.currentTarget);b=String.fromCharCode(b.which);if(/^\d+$/.test(b)&&!q(e)&&(e=e.val()+b,e=e.replace(/\D/g,""),
6<e.length))return!1};B=function(b){var e;e=a(b.currentTarget);b=String.fromCharCode(b.which);if(/^\d+$/.test(b))return e=e.val()+b,4>=e.length};p=function(b){var e,d;b=a(b.currentTarget);e=b.val();d=a.payment.cardType(e)||"unknown";if(!b.hasClass(d)){var g,p,m;m=[];g=0;for(p=f.length;g<p;g++)e=f[g],m.push(e.type);b.removeClass("unknown");b.removeClass(m.join(" "));b.addClass(d);b.toggleClass("identified","unknown"!==d);return b.trigger("payment.cardType",d)}};a.payment.fn.formatCardCVC=function(){this.payment("restrictNumeric");
this.on("keypress",B);return this};a.payment.fn.formatCardExpiry=function(){this.payment("restrictNumeric");this.on("keypress",F);this.on("keypress",y);this.on("keypress",E);this.on("keypress",w);this.on("keydown",t);return this};a.payment.fn.formatCardNumber=function(){this.payment("restrictNumeric");this.on("keypress",D);this.on("keypress",s);this.on("keydown",n);this.on("keyup",p);this.on("paste",r);return this};a.payment.fn.restrictNumeric=function(){this.on("keypress",g);return this};a.payment.fn.cardExpiryVal=
function(){return a.payment.cardExpiryVal(a(this).val())};a.payment.cardExpiryVal=function(a){var b,e;a=a.replace(/\s/g,"");b=a.split("/",2);a=b[0];e=b[1];if(2===(null!=e?e.length:void 0)&&/^\d+$/.test(e))b=(new Date).getFullYear(),b=b.toString().slice(0,2),e=b+e;a=parseInt(a,10);e=parseInt(e,10);return{month:a,year:e}};a.payment.validateCardNumber=function(a){var e,d;a=(a+"").replace(/\s+|-/g,"");if(!/^\d+$/.test(a))return!1;e=b(a);return!e?!1:(d=a.length,0<=m.call(e.length,d))&&(!1===e.luhn||v(a))};
a.payment.validateCardExpiry=function(b,e){var d,g;"object"===typeof b&&"month"in b&&(d=b,b=d.month,e=d.year);if(!b||!e)return!1;b=a.trim(b);e=a.trim(e);if(!/^\d+$/.test(b)||!/^\d+$/.test(e)||!(12>=parseInt(b,10)))return!1;2===e.length&&(d=(new Date).getFullYear(),d=d.toString().slice(0,2),e=d+e);g=new Date(e,b);d=new Date;g.setMonth(g.getMonth()-1);g.setMonth(g.getMonth()+1,1);return g>d};a.payment.validateCardCVC=function(b,e){var g,f;b=a.trim(b);return!/^\d+$/.test(b)?!1:e?(g=b.length,0<=m.call(null!=
(f=d(e))?f.cvcLength:void 0,g)):3<=b.length&&4>=b.length};a.payment.cardType=function(a){var e;return!a?null:(null!=(e=b(a))?e.type:void 0)||null};a.payment.formatCardNumber=function(a){var e,d,g;e=b(a);if(!e)return a;d=e.length[e.length.length-1];a=a.replace(/\D/g,"");a=a.slice(0,+d+1||9E9);if(e.format.global)return null!=(g=a.match(e.format))?g.join(" "):void 0;a=e.format.exec(a);null!=a&&a.shift();return null!=a?a.join(" "):void 0}}).call(this);(function(a,b,d){(function(a){"function"==typeof define&&define.amd?define(["jquery"],a):jQuery&&!jQuery.fn.sparkline&&a(jQuery)})(function(f){var l={},n,t,s,y,w,E,q,v,r,B,D,F,g,p,e,m,h,u,A,z,J,R,I,H,N,P,G,S=0;n=function(){var a,b;return a=function(){this.init.apply(this,arguments)},1<arguments.length?(arguments[0]?(a.prototype=f.extend(new arguments[0],arguments[arguments.length-1]),a._super=arguments[0].prototype):a.prototype=arguments[arguments.length-1],2<arguments.length&&(b=Array.prototype.slice.call(arguments,
1,-1),b.unshift(a.prototype),f.extend.apply(f,b))):a.prototype=arguments[0],a.prototype.cls=a,a};f.SPFormatClass=t=n({fre:/\{\{([\w.]+?)(:(.+?))?\}\}/g,precre:/(\w+)\.(\d+)/,init:function(a,b){this.format=a;this.fclass=b},render:function(a,b,e){var g=this,h,f,p,m,z;return this.format.replace(this.fre,function(q,r,l,H){var n;return f=r,p=H,h=g.precre.exec(f),h?(z=h[2],f=h[1]):z=!1,m=a[f],m===d?"":p&&b&&b[p]?(n=b[p],n.get?b[p].get(m)||m:b[p][m]||m):(v(m)&&(e.get("numberFormatter")?m=e.get("numberFormatter")(m):
m=F(m,z,e.get("numberDigitGroupCount"),e.get("numberDigitGroupSep"),e.get("numberDecimalMark"))),m)})}});f.spformat=function(a,b){return new t(a,b)};s=function(a,b,e){return a<b?b:a>e?e:a};y=function(a,e){var d;return 2===e?(d=b.floor(a.length/2),a.length%2?a[d]:(a[d-1]+a[d])/2):a.length%2?(d=(a.length*e+e)/4,d%1?(a[b.floor(d)]+a[b.floor(d)-1])/2:a[d-1]):(d=(a.length*e+2)/4,d%1?(a[b.floor(d)]+a[b.floor(d)-1])/2:a[d-1])};w=function(a){var b;switch(a){case "undefined":a=d;break;case "null":a=null;break;
case "true":a=!0;break;case "false":a=!1;break;default:b=parseFloat(a),a==b&&(a=b)}return a};E=function(a){var b,e=[];for(b=a.length;b--;)e[b]=w(a[b]);return e};q=function(a,b){var e,d,g=[];e=0;for(d=a.length;e<d;e++)a[e]!==b&&g.push(a[e]);return g};v=function(a){return!isNaN(parseFloat(a))&&isFinite(a)};F=function(a,b,e,d,g){var h;a=(!1===b?parseFloat(a).toString():a.toFixed(b)).split("");h=0>(h=f.inArray(".",a))?a.length:h;h<a.length&&(a[h]=g);for(b=h-e;0<b;b-=e)a.splice(b,0,d);return a.join("")};
r=function(a,b,e){var d;for(d=b.length;d--;)if(!(e&&null===b[d])&&b[d]!==a)return!1;return!0};D=function(a){return f.isArray(a)?a:[a]};B=function(b){var e;a.createStyleSheet?a.createStyleSheet().cssText=b:(e=a.createElement("style"),e.type="text/css",a.getElementsByTagName("head")[0].appendChild(e),e["string"==typeof a.body.style.WebkitAppearance?"innerText":"innerHTML"]=b)};f.fn.simpledraw=function(b,e,g,h){var p,m;if(g&&(p=this.data("_jqs_vcanvas")))return p;if(!1===f.fn.sparkline.canvas)return!1;
if(f.fn.sparkline.canvas===d)if(g=a.createElement("canvas"),!g.getContext||!g.getContext("2d")){if(!a.namespaces||a.namespaces.v)return f.fn.sparkline.canvas=!1,!1;a.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML");f.fn.sparkline.canvas=function(a,b,e,d){return new P(a,b,e)}}else f.fn.sparkline.canvas=function(a,b,e,d){return new N(a,b,e,d)};return b===d&&(b=f(this).innerWidth()),e===d&&(e=f(this).innerHeight()),p=f.fn.sparkline.canvas(b,e,this,h),m=f(this).data("_jqs_mhandler"),
m&&m.registerCanvas(p),p};f.fn.cleardraw=function(){var a=this.data("_jqs_vcanvas");a&&a.reset()};f.RangeMapClass=g=n({init:function(a){var b,e,d=[];for(b in a)a.hasOwnProperty(b)&&"string"==typeof b&&-1<b.indexOf(":")&&(e=b.split(":"),e[0]=0===e[0].length?-Infinity:parseFloat(e[0]),e[1]=0===e[1].length?Infinity:parseFloat(e[1]),e[2]=a[b],d.push(e));this.map=a;this.rangelist=d||!1},get:function(a){var b=this.rangelist,e,g;if((e=this.map[a])!==d)return e;if(b)for(e=b.length;e--;)if(g=b[e],g[0]<=a&&
g[1]>=a)return g[2];return d}});f.range_map=function(a){return new g(a)};p=n({init:function(a,b){this.$el=f(a);this.options=b;this.currentPageY=this.currentPageX=0;this.el=a;this.splist=[];this.tooltip=null;this.over=!1;this.displayTooltips=!b.get("disableTooltips");this.highlightEnabled=!b.get("disableHighlight")},registerSparkline:function(a){this.splist.push(a);this.over&&this.updateDisplay()},registerCanvas:function(a){var b=f(a.canvas);this.canvas=a;this.$canvas=b;b.mouseenter(f.proxy(this.mouseenter,
this));b.mouseleave(f.proxy(this.mouseleave,this));b.click(f.proxy(this.mouseclick,this))},reset:function(a){this.splist=[];this.tooltip&&a&&(this.tooltip.remove(),this.tooltip=d)},mouseclick:function(a){var b=f.Event("sparklineClick");b.originalEvent=a;b.sparklines=this.splist;this.$el.trigger(b)},mouseenter:function(b){f(a.body).unbind("mousemove.jqs");f(a.body).bind("mousemove.jqs",f.proxy(this.mousemove,this));this.over=!0;this.currentPageX=b.pageX;this.currentPageY=b.pageY;this.currentEl=b.target;
!this.tooltip&&this.displayTooltips&&(this.tooltip=new e(this.options),this.tooltip.updatePosition(b.pageX,b.pageY));this.updateDisplay()},mouseleave:function(){f(a.body).unbind("mousemove.jqs");var b=this.splist,e=b.length,d=!1,g,h;this.over=!1;this.currentEl=null;this.tooltip&&(this.tooltip.remove(),this.tooltip=null);for(h=0;h<e;h++)g=b[h],g.clearRegionHighlight()&&(d=!0);d&&this.canvas.render()},mousemove:function(a){this.currentPageX=a.pageX;this.currentPageY=a.pageY;this.currentEl=a.target;
this.tooltip&&this.tooltip.updatePosition(a.pageX,a.pageY);this.updateDisplay()},updateDisplay:function(){var a=this.splist,b=a.length,e=!1,d=this.$canvas.offset(),g=this.currentPageX-d.left,h=this.currentPageY-d.top,p,m;if(this.over){for(p=0;p<b;p++)d=a[p],(m=d.setRegionHighlight(this.currentEl,g,h))&&(e=!0);if(e){e=f.Event("sparklineRegionChange");e.sparklines=this.splist;this.$el.trigger(e);if(this.tooltip){e="";for(p=0;p<b;p++)d=a[p],e+=d.getCurrentRegionTooltip();this.tooltip.setContent(e)}this.disableHighlight||
this.canvas.render()}null===m&&this.mouseleave()}}});e=n({sizeStyle:"position: static !important;display: block !important;visibility: hidden !important;float: left !important;",init:function(b){var e=b.get("tooltipClassname","jqstooltip"),d=this.sizeStyle;this.container=b.get("tooltipContainer")||a.body;this.tooltipOffsetX=b.get("tooltipOffsetX",10);this.tooltipOffsetY=b.get("tooltipOffsetY",12);f("#jqssizetip").remove();f("#jqstooltip").remove();this.sizetip=f("<div/>",{id:"jqssizetip",style:d,
"class":e});this.tooltip=f("<div/>",{id:"jqstooltip","class":e}).appendTo(this.container);b=this.tooltip.offset();this.offsetLeft=b.left;this.offsetTop=b.top;this.hidden=!0;f(window).unbind("resize.jqs scroll.jqs");f(window).bind("resize.jqs scroll.jqs",f.proxy(this.updateWindowDims,this));this.updateWindowDims()},updateWindowDims:function(){this.scrollTop=f(window).scrollTop();this.scrollLeft=f(window).scrollLeft();this.scrollRight=this.scrollLeft+f(window).width();this.updatePosition()},getSize:function(a){this.sizetip.html(a).appendTo(this.container);
this.width=this.sizetip.width()+1;this.height=this.sizetip.height();this.sizetip.remove()},setContent:function(a){a?(this.getSize(a),this.tooltip.html(a).css({width:this.width,height:this.height,visibility:"visible"}),this.hidden&&(this.hidden=!1,this.updatePosition())):(this.tooltip.css("visibility","hidden"),this.hidden=!0)},updatePosition:function(a,b){if(a===d){if(this.mousex===d)return;a=this.mousex-this.offsetLeft;b=this.mousey-this.offsetTop}else this.mousex=a-=this.offsetLeft,this.mousey=
b-=this.offsetTop;this.height&&(this.width&&!this.hidden)&&(b-=this.height+this.tooltipOffsetY,a+=this.tooltipOffsetX,b<this.scrollTop&&(b=this.scrollTop),a<this.scrollLeft?a=this.scrollLeft:a+this.width>this.scrollRight&&(a=this.scrollRight-this.width),this.tooltip.css({left:a,top:b}))},remove:function(){this.tooltip.remove();this.sizetip.remove();this.sizetip=this.tooltip=d;f(window).unbind("resize.jqs scroll.jqs")}});f(function(){B('.jqstooltip { position: absolute;left: 0px;top: 0px;visibility: hidden;background: rgb(0, 0, 0) transparent;background-color: rgba(0,0,0,0.6);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000);-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000)";color: white;font: 10px arial, san serif;text-align: left;white-space: nowrap;padding: 5px;border: 1px solid white;z-index: 10000;}.jqsfield { color: white;font: 10px arial, san serif;text-align: left;}')});
G=[];f.fn.sparkline=function(b,e){return this.each(function(){var g=new f.fn.sparkline.options(this,e),h=f(this),m,z;m=function(){var e,m,z,q,r;if("html"===b||b===d){e=this.getAttribute(g.get("tagValuesAttribute"));if(e===d||null===e)e=h.html();e=e.replace(/(^\s*\x3c!--)|(--\x3e\s*$)|\s+/g,"").split(",")}else e=b;m="auto"===g.get("width")?e.length*g.get("defaultPixelsPerValue"):g.get("width");if("auto"===g.get("height")){if(!g.get("composite")||!f.data(this,"_jqs_vcanvas"))q=a.createElement("span"),
q.innerHTML="a",h.html(q),z=f(q).innerHeight()||f(q).height(),f(q).remove()}else z=g.get("height");g.get("disableInteraction")?r=!1:(r=f.data(this,"_jqs_mhandler"),r?g.get("composite")||r.reset():(r=new p(this,g),f.data(this,"_jqs_mhandler",r)));g.get("composite")&&!f.data(this,"_jqs_vcanvas")?f.data(this,"_jqs_errnotify")||(alert("Attempted to attach a composite sparkline to an element with no existing sparkline"),f.data(this,"_jqs_errnotify",!0)):(z=new (f.fn.sparkline[g.get("type")])(this,e,g,
m,z),z.render(),r&&r.registerSparkline(z))};if(f(this).html()&&!g.get("disableHiddenCheck")&&f(this).is(":hidden")||!f(this).parents("body").length){if(!g.get("composite")&&f.data(this,"_jqs_pending"))for(z=G.length;z;z--)G[z-1][0]==this&&G.splice(z-1,1);G.push([this,m]);f.data(this,"_jqs_pending",!0)}else m.call(this)})};f.fn.sparkline.defaults={common:{type:"line",lineColor:"#00f",fillColor:"#cdf",defaultPixelsPerValue:3,width:"auto",height:"auto",composite:!1,tagValuesAttribute:"values",tagOptionsPrefix:"spark",
enableTagOptions:!1,enableHighlight:!0,highlightLighten:1.4,tooltipSkipNull:!0,tooltipPrefix:"",tooltipSuffix:"",disableHiddenCheck:!1,numberFormatter:!1,numberDigitGroupCount:3,numberDigitGroupSep:",",numberDecimalMark:".",disableTooltips:!1,disableInteraction:!1},line:{spotColor:"#f80",highlightSpotColor:"#5f5",highlightLineColor:"#f22",spotRadius:1.5,minSpotColor:"#f80",maxSpotColor:"#f80",lineWidth:1,normalRangeMin:d,normalRangeMax:d,normalRangeColor:"#ccc",drawNormalOnTop:!1,chartRangeMin:d,
chartRangeMax:d,chartRangeMinX:d,chartRangeMaxX:d,tooltipFormat:new t('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{y}}{{suffix}}')},bar:{barColor:"#3366cc",negBarColor:"#f44",stackedBarColor:"#3366cc #dc3912 #ff9900 #109618 #66aa00 #dd4477 #0099c6 #990099".split(" "),zeroColor:d,nullColor:d,zeroAxis:!0,barWidth:4,barSpacing:1,chartRangeMax:d,chartRangeMin:d,chartRangeClip:!1,colorMap:d,tooltipFormat:new t('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{value}}{{suffix}}')},
tristate:{barWidth:4,barSpacing:1,posBarColor:"#6f6",negBarColor:"#f44",zeroBarColor:"#999",colorMap:{},tooltipFormat:new t('<span style="color: {{color}}">&#9679;</span> {{value:map}}'),tooltipValueLookups:{map:{"-1":"Loss",0:"Draw",1:"Win"}}},discrete:{lineHeight:"auto",thresholdColor:d,thresholdValue:0,chartRangeMax:d,chartRangeMin:d,chartRangeClip:!1,tooltipFormat:new t("{{prefix}}{{value}}{{suffix}}")},bullet:{targetColor:"#f33",targetWidth:3,performanceColor:"#33f",rangeColors:["#d3dafe","#a8b6ff",
"#7f94ff"],base:d,tooltipFormat:new t("{{fieldkey:fields}} - {{value}}"),tooltipValueLookups:{fields:{r:"Range",p:"Performance",t:"Target"}}},pie:{offset:0,sliceColors:"#3366cc #dc3912 #ff9900 #109618 #66aa00 #dd4477 #0099c6 #990099".split(" "),borderWidth:0,borderColor:"#000",tooltipFormat:new t('<span style="color: {{color}}">&#9679;</span> {{value}} ({{percent.1}}%)')},box:{raw:!1,boxLineColor:"#000",boxFillColor:"#cdf",whiskerColor:"#000",outlierLineColor:"#333",outlierFillColor:"#fff",medianColor:"#f00",
showOutliers:!0,outlierIQR:1.5,spotRadius:1.5,target:d,targetColor:"#4a2",chartRangeMax:d,chartRangeMin:d,tooltipFormat:new t("{{field:fields}}: {{value}}"),tooltipFormatFieldlistKey:"field",tooltipValueLookups:{fields:{lq:"Lower Quartile",med:"Median",uq:"Upper Quartile",lo:"Left Outlier",ro:"Right Outlier",lw:"Left Whisker",rw:"Right Whisker"}}}};f.sparkline_display_visible=function(){var a,b,e,d=[];b=0;for(e=G.length;b<e;b++)a=G[b][0],f(a).is(":visible")&&!f(a).parents().is(":hidden")?(G[b][1].call(a),
f.data(G[b][0],"_jqs_pending",!1),d.push(b)):!f(a).closest("html").length&&!f.data(a,"_jqs_pending")&&(f.data(G[b][0],"_jqs_pending",!1),d.push(b));for(b=d.length;b;b--)G.splice(d[b-1],1)};f.fn.sparkline.options=n({init:function(a,b){var e,d,g,h;this.userOptions=b=b||{};this.tag=a;this.tagValCache={};d=f.fn.sparkline.defaults;g=d.common;this.tagOptionsPrefix=b.enableTagOptions&&(b.tagOptionsPrefix||g.tagOptionsPrefix);h=this.getTagSetting("type");h===l?e=d[b.type||g.type]:e=d[h];this.mergedOptions=
f.extend({},g,e,b)},getTagSetting:function(a){var b=this.tagOptionsPrefix,e,g;if(!1===b||b===d)return l;if(this.tagValCache.hasOwnProperty(a))a=this.tagValCache.key;else{a=this.tag.getAttribute(b+a);if(a===d||null===a)a=l;else if("["===a.substr(0,1)){a=a.substr(1,a.length-2).split(",");for(b=a.length;b--;)a[b]=w(a[b].replace(/(^\s*)|(\s*$)/g,""))}else if("{"===a.substr(0,1)){e=a.substr(1,a.length-2).split(",");a={};for(b=e.length;b--;)g=e[b].split(":",2),a[g[0].replace(/(^\s*)|(\s*$)/g,"")]=w(g[1].replace(/(^\s*)|(\s*$)/g,
""))}else a=w(a);this.tagValCache.key=a}return a},get:function(a,b){var e=this.getTagSetting(a),g;return e!==l?e:(g=this.mergedOptions[a])===d?b:g}});f.fn.sparkline._base=n({disabled:!1,init:function(a,b,e,g,h){this.el=a;this.$el=f(a);this.values=b;this.options=e;this.width=g;this.height=h;this.currentRegion=d},initTarget:function(){var a=!this.options.get("disableInteraction");(this.target=this.$el.simpledraw(this.width,this.height,this.options.get("composite"),a))?(this.canvasWidth=this.target.pixelWidth,
this.canvasHeight=this.target.pixelHeight):this.disabled=!0},render:function(){return this.disabled?(this.el.innerHTML="",!1):!0},getRegion:function(a,b){},setRegionHighlight:function(a,b,e){var g=this.currentRegion,h=!this.options.get("disableHighlight"),p;return b>this.canvasWidth||e>this.canvasHeight||0>b||0>e?null:(p=this.getRegion(a,b,e),g!==p?(g!==d&&h&&this.removeHighlight(),this.currentRegion=p,p!==d&&h&&this.renderHighlight(),!0):!1)},clearRegionHighlight:function(){return this.currentRegion!==
d?(this.removeHighlight(),this.currentRegion=d,!0):!1},renderHighlight:function(){this.changeHighlight(!0)},removeHighlight:function(){this.changeHighlight(!1)},changeHighlight:function(a){},getCurrentRegionTooltip:function(){var a=this.options,b="",e=[],g,h,p,m,z,q,r,l,n;if(this.currentRegion===d)return"";g=this.getCurrentRegionFields();if(h=a.get("tooltipFormatter"))return h(this,a,g);a.get("tooltipChartTitle")&&(b+='<div class="jqs jqstitle">'+a.get("tooltipChartTitle")+"</div>\n");h=this.options.get("tooltipFormat");
if(!h)return"";f.isArray(h)||(h=[h]);f.isArray(g)||(g=[g]);p=this.options.get("tooltipFormatFieldlist");m=this.options.get("tooltipFormatFieldlistKey");if(p&&m){z=[];for(q=g.length;q--;)r=g[q][m],-1!=(n=f.inArray(r,p))&&(z[n]=g[q]);g=z}p=h.length;l=g.length;for(q=0;q<p;q++){r=h[q];"string"==typeof r&&(r=new t(r));m=r.fclass||"jqsfield";for(n=0;n<l;n++)if(!g[n].isNull||!a.get("tooltipSkipNull"))f.extend(g[n],{prefix:a.get("tooltipPrefix"),suffix:a.get("tooltipSuffix")}),z=r.render(g[n],a.get("tooltipValueLookups"),
a),e.push('<div class="'+m+'">'+z+"</div>")}return e.length?b+e.join("\n"):""},getCurrentRegionFields:function(){},calcHighlightColor:function(a,e){var d=e.get("highlightColor"),g=e.get("highlightLighten"),h,p,f;if(d)return d;if(g&&(d=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(a)||/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(a))){p=[];h=4===a.length?16:1;for(f=0;3>f;f++)p[f]=s(b.round(parseInt(d[f+1],16)*h*g),0,255);return"rgb("+p.join(",")+")"}return a}});m={changeHighlight:function(a){var b=
this.currentRegion,e=this.target,d=this.regionShapes[b],g;d&&(g=this.renderRegion(b,a),f.isArray(g)||f.isArray(d)?(e.replaceWithShapes(d,g),this.regionShapes[b]=f.map(g,function(a){return a.id})):(e.replaceWithShape(d,g),this.regionShapes[b]=g.id))},render:function(){var a=this.values,b=this.target,e=this.regionShapes,d,g,h;if(this.cls._super.render.call(this)){for(g=a.length;g--;)if(a=this.renderRegion(g))if(f.isArray(a)){d=[];for(h=a.length;h--;)a[h].append(),d.push(a[h].id);e[g]=d}else a.append(),
e[g]=a.id;else e[g]=null;b.render()}}};f.fn.sparkline.line=h=n(f.fn.sparkline._base,{type:"line",init:function(a,b,e,d,g){h._super.init.call(this,a,b,e,d,g);this.vertices=[];this.regionMap=[];this.xvalues=[];this.yvalues=[];this.yminmax=[];this.lastShapeId=this.hightlightSpotId=null;this.initTarget()},getRegion:function(a,b,e){e=this.regionMap;for(a=e.length;a--;)if(null!==e[a]&&b>=e[a][0]&&b<=e[a][1])return e[a][2];return d},getCurrentRegionFields:function(){var a=this.currentRegion;return{isNull:null===
this.yvalues[a],x:this.xvalues[a],y:this.yvalues[a],color:this.options.get("lineColor"),fillColor:this.options.get("fillColor"),offset:a}},renderHighlight:function(){var a=this.target,b=this.vertices[this.currentRegion],e=this.options,g=e.get("spotRadius"),h=e.get("highlightSpotColor"),e=e.get("highlightLineColor"),p,f;b&&(g&&h&&(p=a.drawCircle(b[0],b[1],g,d,h),this.highlightSpotId=p.id,a.insertAfterShape(this.lastShapeId,p)),e&&(f=a.drawLine(b[0],this.canvasTop,b[0],this.canvasTop+this.canvasHeight,
e),this.highlightLineId=f.id,a.insertAfterShape(this.lastShapeId,f)))},removeHighlight:function(){var a=this.target;this.highlightSpotId&&(a.removeShapeId(this.highlightSpotId),this.highlightSpotId=null);this.highlightLineId&&(a.removeShapeId(this.highlightLineId),this.highlightLineId=null)},scanValues:function(){var a=this.values,e=a.length,d=this.xvalues,g=this.yvalues,h=this.yminmax,p,f,m,z,q;for(p=0;p<e;p++)f=a[p],m="string"==typeof a[p],z="object"==typeof a[p]&&a[p]instanceof Array,q=m&&a[p].split(":"),
m&&2===q.length?(d.push(Number(q[0])),g.push(Number(q[1])),h.push(Number(q[1]))):z?(d.push(f[0]),g.push(f[1]),h.push(f[1])):(d.push(p),null===a[p]||"null"===a[p]?g.push(null):(g.push(Number(f)),h.push(Number(f))));this.options.get("xvalues")&&(d=this.options.get("xvalues"));this.maxy=this.maxyorg=b.max.apply(b,h);this.miny=this.minyorg=b.min.apply(b,h);this.maxx=b.max.apply(b,d);this.minx=b.min.apply(b,d);this.xvalues=d;this.yvalues=g;this.yminmax=h},processRangeOptions:function(){var a=this.options,
b=a.get("normalRangeMin"),e=a.get("normalRangeMax");b!==d&&(b<this.miny&&(this.miny=b),e>this.maxy&&(this.maxy=e));a.get("chartRangeMin")!==d&&(a.get("chartRangeClip")||a.get("chartRangeMin")<this.miny)&&(this.miny=a.get("chartRangeMin"));a.get("chartRangeMax")!==d&&(a.get("chartRangeClip")||a.get("chartRangeMax")>this.maxy)&&(this.maxy=a.get("chartRangeMax"));a.get("chartRangeMinX")!==d&&(a.get("chartRangeClipX")||a.get("chartRangeMinX")<this.minx)&&(this.minx=a.get("chartRangeMinX"));a.get("chartRangeMaxX")!==
d&&(a.get("chartRangeClipX")||a.get("chartRangeMaxX")>this.maxx)&&(this.maxx=a.get("chartRangeMaxX"))},drawNormalRange:function(a,e,g,h,p){var f=this.options.get("normalRangeMin"),m=this.options.get("normalRangeMax");e+=b.round(g-g*((m-this.miny)/p));g=b.round(g*(m-f)/p);this.target.drawRect(a,e,h,g,d,this.options.get("normalRangeColor")).append()},render:function(){var a=this.options,e=this.target,p=this.canvasWidth,m=this.canvasHeight,z=this.vertices,q=a.get("spotRadius"),r=this.regionMap,l,n,H,
v,I,u,A,B,J,w,N,G,s,t,y,D,F;if(h._super.render.call(this)&&(this.scanValues(),this.processRangeOptions(),y=this.xvalues,D=this.yvalues,this.yminmax.length&&!(2>this.yvalues.length))){v=I=0;l=0===this.maxx-this.minx?1:this.maxx-this.minx;n=0===this.maxy-this.miny?1:this.maxy-this.miny;H=this.yvalues.length-1;q&&(p<4*q||m<4*q)&&(q=0);if(q){if((t=a.get("highlightSpotColor")&&!a.get("disableInteraction"))||a.get("minSpotColor")||a.get("spotColor")&&D[H]===this.miny)m-=b.ceil(q);if(t||a.get("maxSpotColor")||
a.get("spotColor")&&D[H]===this.maxy)m-=b.ceil(q),v+=b.ceil(q);if(t||(a.get("minSpotColor")||a.get("maxSpotColor"))&&(D[0]===this.miny||D[0]===this.maxy))I+=b.ceil(q),p-=b.ceil(q);if(t||a.get("spotColor")||a.get("minSpotColor")||a.get("maxSpotColor")&&(D[H]===this.miny||D[H]===this.maxy))p-=b.ceil(q)}m--;a.get("normalRangeMin")!==d&&!a.get("drawNormalOnTop")&&this.drawNormalRange(I,v,m,p,n);A=[];B=[A];s=null;t=D.length;for(F=0;F<t;F++)J=y[F],N=y[F+1],w=D[F],G=I+b.round((J-this.minx)*(p/l)),N=F<t-
1?I+b.round((N-this.minx)*(p/l)):p,N=G+(N-G)/2,r[F]=[s||0,N,F],s=N,null===w?F&&(null!==D[F-1]&&(A=[],B.push(A)),z.push(null)):(w<this.miny&&(w=this.miny),w>this.maxy&&(w=this.maxy),A.length||A.push([G,v+m]),u=[G,v+b.round(m-m*((w-this.miny)/n))],A.push(u),z.push(u));z=[];r=[];u=B.length;for(F=0;F<u;F++)A=B[F],A.length&&(a.get("fillColor")&&(A.push([A[A.length-1][0],v+m]),r.push(A.slice(0)),A.pop()),2<A.length&&(A[0]=[A[0][0],A[1][1]]),z.push(A));u=r.length;for(F=0;F<u;F++)e.drawShape(r[F],a.get("fillColor"),
a.get("fillColor")).append();a.get("normalRangeMin")!==d&&a.get("drawNormalOnTop")&&this.drawNormalRange(I,v,m,p,n);u=z.length;for(F=0;F<u;F++)e.drawShape(z[F],a.get("lineColor"),d,a.get("lineWidth")).append();if(q&&a.get("valueSpots")){A=a.get("valueSpots");A.get===d&&(A=new g(A));for(F=0;F<t;F++)(B=A.get(D[F]))&&e.drawCircle(I+b.round((y[F]-this.minx)*(p/l)),v+b.round(m-m*((D[F]-this.miny)/n)),q,d,B).append()}q&&a.get("spotColor")&&null!==D[H]&&e.drawCircle(I+b.round((y[y.length-1]-this.minx)*(p/
l)),v+b.round(m-m*((D[H]-this.miny)/n)),q,d,a.get("spotColor")).append();this.maxy!==this.minyorg&&(q&&a.get("minSpotColor")&&(J=y[f.inArray(this.minyorg,D)],e.drawCircle(I+b.round((J-this.minx)*(p/l)),v+b.round(m-m*((this.minyorg-this.miny)/n)),q,d,a.get("minSpotColor")).append()),q&&a.get("maxSpotColor")&&(J=y[f.inArray(this.maxyorg,D)],e.drawCircle(I+b.round((J-this.minx)*(p/l)),v+b.round(m-m*((this.maxyorg-this.miny)/n)),q,d,a.get("maxSpotColor")).append()));this.lastShapeId=e.getLastShapeId();
this.canvasTop=v;e.render()}}});f.fn.sparkline.bar=u=n(f.fn.sparkline._base,m,{type:"bar",init:function(a,e,h,p,m){var z=parseInt(h.get("barWidth"),10),r=parseInt(h.get("barSpacing"),10),l=h.get("chartRangeMin"),n=h.get("chartRangeMax"),H=h.get("chartRangeClip"),v=Infinity,I=-Infinity,A,B,J,N,G,t,y,F,D,P;u._super.init.call(this,a,e,h,p,m);a=0;for(p=e.length;a<p;a++)if(m=e[a],(A="string"==typeof m&&-1<m.indexOf(":"))||f.isArray(m))G=!0,A&&(m=e[a]=E(m.split(":"))),m=q(m,null),A=b.min.apply(b,m),m=b.max.apply(b,
m),A<v&&(v=A),m>I&&(I=m);this.stacked=G;this.regionShapes={};this.barWidth=z;this.barSpacing=r;this.totalBarWidth=z+r;this.width=e.length*z+(e.length-1)*r;this.initTarget();H&&(B=l===d?-Infinity:l,N=n===d?Infinity:n);l=[];z=G?[]:l;n=[];r=[];a=0;for(p=e.length;a<p;a++)if(G){A=e[a];e[a]=F=[];n[a]=0;t=z[a]=r[a]=0;for(y=A.length;t<y;t++)m=F[t]=H?s(A[t],B,N):A[t],null!==m&&(0<m&&(n[a]+=m),0>v&&0<I?0>m?r[a]+=b.abs(m):z[a]+=m:z[a]+=b.abs(m-(0>m?I:v)),l.push(m))}else m=H?s(e[a],B,N):e[a],m=e[a]=w(m),null!==
m&&l.push(m);this.max=H=b.max.apply(b,l);this.min=e=b.min.apply(b,l);this.stackMax=I=G?b.max.apply(b,n):H;this.stackMin=G?b.min.apply(b,l):e;h.get("chartRangeMin")!==d&&(h.get("chartRangeClip")||h.get("chartRangeMin")<e)&&(e=h.get("chartRangeMin"));h.get("chartRangeMax")!==d&&(h.get("chartRangeClip")||h.get("chartRangeMax")>H)&&(H=h.get("chartRangeMax"));this.zeroAxis=v=h.get("zeroAxis",!0);0>=e&&0<=H&&v?J=0:0==v?J=e:0<e?J=e:J=H;this.xaxisOffset=J;B=G?b.max.apply(b,z)+b.max.apply(b,r):H-e;this.canvasHeightEf=
v&&0>e?this.canvasHeight-2:this.canvasHeight-1;e<J?(P=G&&0<=H?I:H,D=(P-J)/B*this.canvasHeight,D!==b.ceil(D)&&(this.canvasHeightEf-=2,D=b.ceil(D))):D=this.canvasHeight;this.yoffset=D;f.isArray(h.get("colorMap"))?(this.colorMapByIndex=h.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=h.get("colorMap"),this.colorMapByValue&&this.colorMapByValue.get===d&&(this.colorMapByValue=new g(this.colorMapByValue)));this.range=B},getRegion:function(a,e,g){a=b.floor(e/this.totalBarWidth);
return 0>a||a>=this.values.length?d:a},getCurrentRegionFields:function(){var a=this.currentRegion,b=D(this.values[a]),e=[],d,g;for(g=b.length;g--;)d=b[g],e.push({isNull:null===d,value:d,color:this.calcColor(g,d,a),offset:a});return e},calcColor:function(a,b,e){var g=this.colorMapByIndex,h=this.colorMapByValue,p=this.options,m,z;return this.stacked?m=p.get("stackedBarColor"):m=0>b?p.get("negBarColor"):p.get("barColor"),0===b&&p.get("zeroColor")!==d&&(m=p.get("zeroColor")),h&&(z=h.get(b))?m=z:g&&g.length>
e&&(m=g[e]),f.isArray(m)?m[a%m.length]:m},renderRegion:function(a,e){var g=this.values[a],h=this.options,p=this.xaxisOffset,m=[],z=this.range,q=this.stacked,l=this.target,n=a*this.totalBarWidth,H=this.canvasHeightEf,v=this.yoffset,I,u,A,B,J,w,N,G,g=f.isArray(g)?g:[g];w=g.length;B=r(null,g);G=r(p,g,!0);if(B)return h.get("nullColor")?(A=e?h.get("nullColor"):this.calcHighlightColor(h.get("nullColor"),h),I=0<v?v-1:v,l.drawRect(n,I,this.barWidth-1,0,A,A)):d;B=v;for(J=0;J<w;J++){A=g[J];if(q&&A===p){if(!G||
N)continue;N=!0}0<z?u=b.floor(H*(b.abs(A-p)/z))+1:u=1;A<p||A===p&&0===v?(I=B,B+=u):(I=v-u,v-=u);A=this.calcColor(J,A,a);e&&(A=this.calcHighlightColor(A,h));m.push(l.drawRect(n,I,this.barWidth-1,u-1,A,A))}return 1===m.length?m[0]:m}});f.fn.sparkline.tristate=A=n(f.fn.sparkline._base,m,{type:"tristate",init:function(a,b,e,h,p){var m=parseInt(e.get("barWidth"),10),z=parseInt(e.get("barSpacing"),10);A._super.init.call(this,a,b,e,h,p);this.regionShapes={};this.barWidth=m;this.barSpacing=z;this.totalBarWidth=
m+z;this.values=f.map(b,Number);this.width=b.length*m+(b.length-1)*z;f.isArray(e.get("colorMap"))?(this.colorMapByIndex=e.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=e.get("colorMap"),this.colorMapByValue&&this.colorMapByValue.get===d&&(this.colorMapByValue=new g(this.colorMapByValue)));this.initTarget()},getRegion:function(a,e,d){return b.floor(e/this.totalBarWidth)},getCurrentRegionFields:function(){var a=this.currentRegion;return{isNull:this.values[a]===
d,value:this.values[a],color:this.calcColor(this.values[a],a),offset:a}},calcColor:function(a,b){var e=this.values,d=this.options,g=this.colorMapByIndex,h=this.colorMapByValue,p,m;return h&&(m=h.get(a))?p=m:g&&g.length>b?p=g[b]:0>e[b]?p=d.get("negBarColor"):0<e[b]?p=d.get("posBarColor"):p=d.get("zeroBarColor"),p},renderRegion:function(a,e){var d=this.values,g=this.options,h=this.target,p,m,f,z;m=b.round(h.pixelHeight/2);f=a*this.totalBarWidth;0>d[a]?(z=m,p=m-1):0<d[a]?(z=0,p=m-1):(z=m-1,p=2);d=this.calcColor(d[a],
a);if(null!==d)return e&&(d=this.calcHighlightColor(d,g)),h.drawRect(f,z,this.barWidth-1,p-1,d,d)}});f.fn.sparkline.discrete=z=n(f.fn.sparkline._base,m,{type:"discrete",init:function(a,e,g,h,p){z._super.init.call(this,a,e,g,h,p);this.regionShapes={};this.values=e=f.map(e,Number);this.min=b.min.apply(b,e);this.max=b.max.apply(b,e);this.range=this.max-this.min;this.width=h="auto"===g.get("width")?2*e.length:this.width;this.interval=b.floor(h/e.length);this.itemWidth=h/e.length;g.get("chartRangeMin")!==
d&&(g.get("chartRangeClip")||g.get("chartRangeMin")<this.min)&&(this.min=g.get("chartRangeMin"));g.get("chartRangeMax")!==d&&(g.get("chartRangeClip")||g.get("chartRangeMax")>this.max)&&(this.max=g.get("chartRangeMax"));this.initTarget();this.target&&(this.lineHeight="auto"===g.get("lineHeight")?b.round(0.3*this.canvasHeight):g.get("lineHeight"))},getRegion:function(a,e,d){return b.floor(e/this.itemWidth)},getCurrentRegionFields:function(){var a=this.currentRegion;return{isNull:this.values[a]===d,
value:this.values[a],offset:a}},renderRegion:function(a,e){var d=this.options,g=this.min,h=this.range,p=this.interval,m=this.target,f=this.lineHeight,z=this.canvasHeight-f,q,r,l,n;return r=s(this.values[a],g,this.max),n=a*p,q=b.round(z-z*((r-g)/h)),l=d.get("thresholdColor")&&r<d.get("thresholdValue")?d.get("thresholdColor"):d.get("lineColor"),e&&(l=this.calcHighlightColor(l,d)),m.drawLine(n,q,n,q+f,l)}});f.fn.sparkline.bullet=J=n(f.fn.sparkline._base,{type:"bullet",init:function(a,e,g,h,p){var m;
J._super.init.call(this,a,e,g,h,p);this.values=e=E(e);a=e.slice();a[0]=null===a[0]?a[2]:a[0];a[1]=null===e[1]?a[2]:a[1];a=b.min.apply(b,e);m=b.max.apply(b,e);g.get("base")===d?a=0>a?a:0:a=g.get("base");this.min=a;this.max=m;this.range=m-a;this.shapes={};this.valueShapes={};this.regiondata={};this.width=h="auto"===g.get("width")?"4.0em":h;this.target=this.$el.simpledraw(h,p,g.get("composite"));e.length||(this.disabled=!0);this.initTarget()},getRegion:function(a,b,e){a=this.target.getShapeAt(a,b,e);
return a!==d&&this.shapes[a]!==d?this.shapes[a]:d},getCurrentRegionFields:function(){var a=this.currentRegion;return{fieldkey:a.substr(0,1),value:this.values[a.substr(1)],region:a}},changeHighlight:function(a){var b=this.currentRegion,e=this.valueShapes[b],d;delete this.shapes[e];switch(b.substr(0,1)){case "r":d=this.renderRange(b.substr(1),a);break;case "p":d=this.renderPerformance(a);break;case "t":d=this.renderTarget(a)}this.valueShapes[b]=d.id;this.shapes[d.id]=b;this.target.replaceWithShape(e,
d)},renderRange:function(a,e){var d=b.round(this.canvasWidth*((this.values[a]-this.min)/this.range)),g=this.options.get("rangeColors")[a-2];return e&&(g=this.calcHighlightColor(g,this.options)),this.target.drawRect(0,0,d-1,this.canvasHeight-1,g,g)},renderPerformance:function(a){var e=b.round(this.canvasWidth*((this.values[1]-this.min)/this.range)),d=this.options.get("performanceColor");return a&&(d=this.calcHighlightColor(d,this.options)),this.target.drawRect(0,b.round(0.3*this.canvasHeight),e-1,
b.round(0.4*this.canvasHeight)-1,d,d)},renderTarget:function(a){var e=b.round(this.canvasWidth*((this.values[0]-this.min)/this.range)-this.options.get("targetWidth")/2),d=b.round(0.1*this.canvasHeight),g=this.canvasHeight-2*d,h=this.options.get("targetColor");return a&&(h=this.calcHighlightColor(h,this.options)),this.target.drawRect(e,d,this.options.get("targetWidth")-1,g-1,h,h)},render:function(){var a=this.values.length,b=this.target,e,d;if(J._super.render.call(this)){for(e=2;e<a;e++)d=this.renderRange(e).append(),
this.shapes[d.id]="r"+e,this.valueShapes["r"+e]=d.id;null!==this.values[1]&&(d=this.renderPerformance().append(),this.shapes[d.id]="p1",this.valueShapes.p1=d.id);null!==this.values[0]&&(d=this.renderTarget().append(),this.shapes[d.id]="t0",this.valueShapes.t0=d.id);b.render()}}});f.fn.sparkline.pie=R=n(f.fn.sparkline._base,{type:"pie",init:function(a,e,d,g,h){var p=0;R._super.init.call(this,a,e,d,g,h);this.shapes={};this.valueShapes={};this.values=e=f.map(e,Number);"auto"===d.get("width")&&(this.width=
this.height);if(0<e.length)for(a=e.length;a--;)p+=e[a];this.total=p;this.initTarget();this.radius=b.floor(b.min(this.canvasWidth,this.canvasHeight)/2)},getRegion:function(a,b,e){a=this.target.getShapeAt(a,b,e);return a!==d&&this.shapes[a]!==d?this.shapes[a]:d},getCurrentRegionFields:function(){var a=this.currentRegion;return{isNull:this.values[a]===d,value:this.values[a],percent:100*(this.values[a]/this.total),color:this.options.get("sliceColors")[a%this.options.get("sliceColors").length],offset:a}},
changeHighlight:function(a){var b=this.currentRegion;a=this.renderSlice(b,a);var e=this.valueShapes[b];delete this.shapes[e];this.target.replaceWithShape(e,a);this.valueShapes[b]=a.id;this.shapes[a.id]=b},renderSlice:function(a,e){var g=this.target,h=this.options,p=this.radius,m=h.get("borderWidth"),f=h.get("offset"),z=2*b.PI,q=this.values,r=this.total,f=f?2*b.PI*(f/360):0,l,n,H,v,I;v=q.length;for(H=0;H<v;H++){n=l=f;0<r&&(n=f+z*(q[H]/r));if(a===H)return I=h.get("sliceColors")[H%h.get("sliceColors").length],
e&&(I=this.calcHighlightColor(I,h)),g.drawPieSlice(p,p,p-m,l,n,d,I);f=n}},render:function(){var a=this.target,e=this.values,g=this.options,h=this.radius,p=g.get("borderWidth"),m;if(R._super.render.call(this)){p&&a.drawCircle(h,h,b.floor(h-p/2),g.get("borderColor"),d,p).append();for(g=e.length;g--;)e[g]&&(m=this.renderSlice(g).append(),this.valueShapes[g]=m.id,this.shapes[m.id]=g);a.render()}}});f.fn.sparkline.box=I=n(f.fn.sparkline._base,{type:"box",init:function(a,b,e,d,g){I._super.init.call(this,
a,b,e,d,g);this.values=f.map(b,Number);this.width="auto"===e.get("width")?"4.0em":d;this.initTarget();this.values.length||(this.disabled=1)},getRegion:function(){return 1},getCurrentRegionFields:function(){var a=[{field:"lq",value:this.quartiles[0]},{field:"med",value:this.quartiles[1]},{field:"uq",value:this.quartiles[2]}];return this.loutlier!==d&&a.push({field:"lo",value:this.loutlier}),this.routlier!==d&&a.push({field:"ro",value:this.routlier}),this.lwhisker!==d&&a.push({field:"lw",value:this.lwhisker}),
this.rwhisker!==d&&a.push({field:"rw",value:this.rwhisker}),a},render:function(){var a=this.target,e=this.values,g=e.length,h=this.options,p=this.canvasWidth,m=this.canvasHeight,f=h.get("chartRangeMin")===d?b.min.apply(b,e):h.get("chartRangeMin"),z=h.get("chartRangeMax")===d?b.max.apply(b,e):h.get("chartRangeMax"),q=0,r,l,n,H,v,A,u,B,J;if(I._super.render.call(this)){if(h.get("raw"))h.get("showOutliers")&&5<e.length?(l=e[0],r=e[1],H=e[2],v=e[3],A=e[4],u=e[5],B=e[6]):(r=e[0],H=e[1],v=e[2],A=e[3],u=
e[4]);else if(e.sort(function(a,b){return a-b}),H=y(e,1),v=y(e,2),A=y(e,3),n=A-H,h.get("showOutliers")){r=u=d;for(l=0;l<g;l++)r===d&&e[l]>H-n*h.get("outlierIQR")&&(r=e[l]),e[l]<A+n*h.get("outlierIQR")&&(u=e[l]);l=e[0];B=e[g-1]}else r=e[0],u=e[g-1];this.quartiles=[H,v,A];this.lwhisker=r;this.rwhisker=u;this.loutlier=l;this.routlier=B;e=p/(z-f+1);h.get("showOutliers")&&(q=b.ceil(h.get("spotRadius")),p-=2*b.ceil(h.get("spotRadius")),e=p/(z-f+1),l<r&&a.drawCircle((l-f)*e+q,m/2,h.get("spotRadius"),h.get("outlierLineColor"),
h.get("outlierFillColor")).append(),B>u&&a.drawCircle((B-f)*e+q,m/2,h.get("spotRadius"),h.get("outlierLineColor"),h.get("outlierFillColor")).append());a.drawRect(b.round((H-f)*e+q),b.round(0.1*m),b.round((A-H)*e),b.round(0.8*m),h.get("boxLineColor"),h.get("boxFillColor")).append();a.drawLine(b.round((r-f)*e+q),b.round(m/2),b.round((H-f)*e+q),b.round(m/2),h.get("lineColor")).append();a.drawLine(b.round((r-f)*e+q),b.round(m/4),b.round((r-f)*e+q),b.round(m-m/4),h.get("whiskerColor")).append();a.drawLine(b.round((u-
f)*e+q),b.round(m/2),b.round((A-f)*e+q),b.round(m/2),h.get("lineColor")).append();a.drawLine(b.round((u-f)*e+q),b.round(m/4),b.round((u-f)*e+q),b.round(m-m/4),h.get("whiskerColor")).append();a.drawLine(b.round((v-f)*e+q),b.round(0.1*m),b.round((v-f)*e+q),b.round(0.9*m),h.get("medianColor")).append();h.get("target")&&(J=b.ceil(h.get("spotRadius")),a.drawLine(b.round((h.get("target")-f)*e+q),b.round(m/2-J),b.round((h.get("target")-f)*e+q),b.round(m/2+J),h.get("targetColor")).append(),a.drawLine(b.round((h.get("target")-
f)*e+q-J),b.round(m/2),b.round((h.get("target")-f)*e+q+J),b.round(m/2),h.get("targetColor")).append());a.render()}}});H=n({init:function(a,b,e,d){this.target=a;this.id=b;this.type=e;this.args=d},append:function(){return this.target.appendShape(this),this}});m=n({_pxregex:/(\d+)(px)?\s*$/i,init:function(a,b,e){a&&(this.width=a,this.height=b,this.target=e,this.lastShapeId=null,e[0]&&(e=e[0]),f.data(e,"_jqs_vcanvas",this))},drawLine:function(a,b,e,d,g,h){return this.drawShape([[a,b],[e,d]],g,h)},drawShape:function(a,
b,e,d){return this._genShape("Shape",[a,b,e,d])},drawCircle:function(a,b,e,d,g,h){return this._genShape("Circle",[a,b,e,d,g,h])},drawPieSlice:function(a,b,e,d,g,h,p){return this._genShape("PieSlice",[a,b,e,d,g,h,p])},drawRect:function(a,b,e,d,g,h){return this._genShape("Rect",[a,b,e,d,g,h])},getElement:function(){return this.canvas},getLastShapeId:function(){return this.lastShapeId},reset:function(){alert("reset not implemented")},_insert:function(a,b){f(b).html(a)},_calculatePixelDims:function(a,
b,e){(b=this._pxregex.exec(b))?this.pixelHeight=b[1]:this.pixelHeight=f(e).height();(b=this._pxregex.exec(a))?this.pixelWidth=b[1]:this.pixelWidth=f(e).width()},_genShape:function(a,b){var e=S++;return b.unshift(e),new H(this,e,a,b)},appendShape:function(a){alert("appendShape not implemented")},replaceWithShape:function(a,b){alert("replaceWithShape not implemented")},insertAfterShape:function(a,b){alert("insertAfterShape not implemented")},removeShapeId:function(a){alert("removeShapeId not implemented")},
getShapeAt:function(a,b,e){alert("getShapeAt not implemented")},render:function(){alert("render not implemented")}});N=n(m,{init:function(b,e,g,h){N._super.init.call(this,b,e,g);this.canvas=a.createElement("canvas");g[0]&&(g=g[0]);f.data(g,"_jqs_vcanvas",this);f(this.canvas).css({display:"inline-block",width:b,height:e,verticalAlign:"top"});this._insert(this.canvas,g);this._calculatePixelDims(b,e,this.canvas);this.canvas.width=this.pixelWidth;this.canvas.height=this.pixelHeight;this.interact=h;this.shapes=
{};this.shapeseq=[];this.currentTargetShapeId=d;f(this.canvas).css({width:this.pixelWidth,height:this.pixelHeight})},_getContext:function(a,b,e){var g=this.canvas.getContext("2d");return a!==d&&(g.strokeStyle=a),g.lineWidth=e===d?1:e,b!==d&&(g.fillStyle=b),g},reset:function(){this._getContext().clearRect(0,0,this.pixelWidth,this.pixelHeight);this.shapes={};this.shapeseq=[];this.currentTargetShapeId=d},_drawShape:function(a,b,e,g,h){h=this._getContext(e,g,h);var p,m;h.beginPath();h.moveTo(b[0][0]+
0.5,b[0][1]+0.5);p=1;for(m=b.length;p<m;p++)h.lineTo(b[p][0]+0.5,b[p][1]+0.5);e!==d&&h.stroke();g!==d&&h.fill();this.targetX!==d&&this.targetY!==d&&h.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=a)},_drawCircle:function(a,e,g,h,p,m,f){f=this._getContext(p,m,f);f.beginPath();f.arc(e,g,h,0,2*b.PI,!1);this.targetX!==d&&this.targetY!==d&&f.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=a);p!==d&&f.stroke();m!==d&&f.fill()},_drawPieSlice:function(a,b,e,g,h,
p,m,f){var z=this._getContext(m,f);z.beginPath();z.moveTo(b,e);z.arc(b,e,g,h,p,!1);z.lineTo(b,e);z.closePath();m!==d&&z.stroke();f&&z.fill();this.targetX!==d&&this.targetY!==d&&z.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=a)},_drawRect:function(a,b,e,d,g,h,p){return this._drawShape(a,[[b,e],[b+d,e],[b+d,e+g],[b,e+g],[b,e]],h,p)},appendShape:function(a){return this.shapes[a.id]=a,this.shapeseq.push(a.id),this.lastShapeId=a.id,a.id},replaceWithShape:function(a,b){var e=this.shapeseq,
d;this.shapes[b.id]=b;for(d=e.length;d--;)e[d]==a&&(e[d]=b.id);delete this.shapes[a]},replaceWithShapes:function(a,b){var e=this.shapeseq,d={},g,h,p;for(h=a.length;h--;)d[a[h]]=!0;for(h=e.length;h--;)g=e[h],d[g]&&(e.splice(h,1),delete this.shapes[g],p=h);for(h=b.length;h--;)e.splice(p,0,b[h].id),this.shapes[b[h].id]=b[h]},insertAfterShape:function(a,b){var e=this.shapeseq,d;for(d=e.length;d--;)if(e[d]===a){e.splice(d+1,0,b.id);this.shapes[b.id]=b;break}},removeShapeId:function(a){var b=this.shapeseq,
e;for(e=b.length;e--;)if(b[e]===a){b.splice(e,1);break}delete this.shapes[a]},getShapeAt:function(a,b,e){return this.targetX=b,this.targetY=e,this.render(),this.currentTargetShapeId},render:function(){var a=this.shapeseq,b=this.shapes,e=a.length,d,g;this._getContext().clearRect(0,0,this.pixelWidth,this.pixelHeight);for(g=0;g<e;g++)d=a[g],d=b[d],this["_draw"+d.type].apply(this,d.args);this.interact||(this.shapes={},this.shapeseq=[])}});P=n(m,{init:function(b,e,d){P._super.init.call(this,b,e,d);d[0]&&
(d=d[0]);f.data(d,"_jqs_vcanvas",this);this.canvas=a.createElement("span");f(this.canvas).css({display:"inline-block",position:"relative",overflow:"hidden",width:b,height:e,margin:"0px",padding:"0px",verticalAlign:"top"});this._insert(this.canvas,d);this._calculatePixelDims(b,e,this.canvas);this.canvas.width=this.pixelWidth;this.canvas.height=this.pixelHeight;this.canvas.insertAdjacentHTML("beforeEnd",'<v:group coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'" style="position:absolute;top:0;left:0;width:'+
this.pixelWidth+"px;height="+this.pixelHeight+'px;"></v:group>');this.group=f(this.canvas).children()[0];this.rendered=!1;this.prerender=""},_drawShape:function(a,b,e,g,h){var p=[],m,f,z,q,r,l,n;n=0;for(l=b.length;n<l;n++)p[n]=""+b[n][0]+","+b[n][1];return m=p.splice(0,1),h=h===d?1:h,f=e===d?' stroked="false" ':' strokeWeight="'+h+'px" strokeColor="'+e+'" ',z=g===d?' filled="false"':' fillColor="'+g+'" filled="true" ',q=p[0]===p[p.length-1]?"x ":"",r='<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+
" "+this.pixelHeight+'"  id="jqsshape'+a+'" '+f+z+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path="m '+m+" l "+p.join(", ")+" "+q+'e"> </v:shape>',r},_drawCircle:function(a,b,e,g,h,p,m){var f,z,q;return b-=g,e-=g,f=h===d?' stroked="false" ':' strokeWeight="'+m+'px" strokeColor="'+h+'" ',z=p===d?' filled="false"':' fillColor="'+p+'" filled="true" ',q='<v:oval  id="jqsshape'+a+'" '+f+z+' style="position:absolute;top:'+
e+"px; left:"+b+"px; width:"+2*g+"px; height:"+2*g+'px"></v:oval>',q},_drawPieSlice:function(a,e,g,h,p,m,f,z){var q,r,l,n,H,v,A,I;if(p===m)return"";m-p===2*b.PI&&(p=0,m=2*b.PI);r=e+b.round(b.cos(p)*h);l=g+b.round(b.sin(p)*h);n=e+b.round(b.cos(m)*h);H=g+b.round(b.sin(m)*h);if(r===n&&l===H){if(m-p<b.PI)return"";r=n=e+h;l=H=g}return r===n&&l===H&&m-p<b.PI?"":(q=[e-h,g-h,e+h,g+h,r,l,n,H],v=f===d?' stroked="false" ':' strokeWeight="1px" strokeColor="'+f+'" ',A=z===d?' filled="false"':' fillColor="'+z+
'" filled="true" ',I='<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'"  id="jqsshape'+a+'" '+v+A+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path="m '+e+","+g+" wa "+q.join(", ")+' x e"> </v:shape>',I)},_drawRect:function(a,b,e,d,g,h,p){return this._drawShape(a,[[b,e],[b,e+g],[b+d,e+g],[b+d,e],[b,e]],h,p)},reset:function(){this.group.innerHTML=""},appendShape:function(a){var b=this["_draw"+
a.type].apply(this,a.args);return this.rendered?this.group.insertAdjacentHTML("beforeEnd",b):this.prerender+=b,this.lastShapeId=a.id,a.id},replaceWithShape:function(a,b){var e=f("#jqsshape"+a),d=this["_draw"+b.type].apply(this,b.args);e[0].outerHTML=d},replaceWithShapes:function(a,b){var e=f("#jqsshape"+a[0]),d="",g=b.length,h;for(h=0;h<g;h++)d+=this["_draw"+b[h].type].apply(this,b[h].args);e[0].outerHTML=d;for(h=1;h<a.length;h++)f("#jqsshape"+a[h]).remove()},insertAfterShape:function(a,b){var e=
f("#jqsshape"+a),d=this["_draw"+b.type].apply(this,b.args);e[0].insertAdjacentHTML("afterEnd",d)},removeShapeId:function(a){a=f("#jqsshape"+a);this.group.removeChild(a[0])},getShapeAt:function(a,b,e){return a.id.substr(8)},render:function(){this.rendered||(this.group.innerHTML=this.prerender,this.rendered=!0)}})})})(document,Math);/*

Rapha?l 2.1.0 - JavaScript Vector Library
Copyright ? 2008-2012 Dmitry Baranovskiy (http://raphaeljs.com)
Copyright ? 2008-2012 Sencha Labs (http://sencha.com)
Licensed under the MIT license.
*/
(function(a){var b=/[\.\/]/,d=function(){},f=function(a,b){return a-b},l,n,t={n:{}},s=function(a,b){var d=n,q=Array.prototype.slice.call(arguments,2),v=s.listeners(a),r=0,B,t=[],F={},g=[],p=l;l=a;for(var e=n=0,m=v.length;e<m;e++)"zIndex"in v[e]&&(t.push(v[e].zIndex),0>v[e].zIndex&&(F[v[e].zIndex]=v[e]));for(t.sort(f);0>t[r];)if(B=F[t[r++]],g.push(B.apply(b,q)),n)return n=d,g;for(e=0;e<m;e++)if(B=v[e],"zIndex"in B)if(B.zIndex==t[r]){g.push(B.apply(b,q));if(n)break;do if(r++,(B=F[t[r]])&&g.push(B.apply(b,
q)),n)break;while(B)}else F[B.zIndex]=B;else if(g.push(B.apply(b,q)),n)break;n=d;l=p;return g.length?g:null};s.listeners=function(a){a=a.split(b);var d=t,f,q,l,r,n,s,F,g=[d],p=[];l=0;for(r=a.length;l<r;l++){F=[];n=0;for(s=g.length;n<s;n++){d=g[n].n;f=[d[a[l]],d["*"]];for(q=2;q--;)(d=f[q])&&(F.push(d),p=p.concat(d.f||[]))}g=F}return p};s.on=function(a,f){for(var l=a.split(b),q=t,n=0,r=l.length;n<r;n++)q=q.n,!q[l[n]]&&(q[l[n]]={n:{}}),q=q[l[n]];q.f=q.f||[];n=0;for(r=q.f.length;n<r;n++)if(q.f[n]==f)return d;
q.f.push(f);return function(a){+a==+a&&(f.zIndex=+a)}};s.stop=function(){n=1};s.nt=function(a){return a?RegExp("(?:\\.|\\/|^)"+a+"(?:\\.|\\/|$)").test(l):l};s.off=s.unbind=function(a,d){var f=a.split(b),q,l,r,n,s,F,g=[t];n=0;for(s=f.length;n<s;n++)for(F=0;F<g.length;F+=r.length-2){r=[F,1];q=g[F].n;if("*"!=f[n])q[f[n]]&&r.push(q[f[n]]);else for(l in q)q.hasOwnProperty(l)&&r.push(q[l]);g.splice.apply(g,r)}n=0;for(s=g.length;n<s;n++)for(q=g[n];q.n;){if(d){if(q.f){F=0;for(f=q.f.length;F<f;F++)if(q.f[F]==
d){q.f.splice(F,1);break}!q.f.length&&delete q.f}for(l in q.n)if(q.n.hasOwnProperty(l)&&q.n[l].f){r=q.n[l].f;F=0;for(f=r.length;F<f;F++)if(r[F]==d){r.splice(F,1);break}!r.length&&delete q.n[l].f}}else for(l in delete q.f,q.n)q.n.hasOwnProperty(l)&&q.n[l].f&&delete q.n[l].f;q=q.n}};s.once=function(a,b){var d=function(){var f=b.apply(this,arguments);s.unbind(a,d);return f};return s.on(a,d)};s.version="0.3.4";s.toString=function(){return"You are running Eve 0.3.4"};"undefined"!=typeof module&&module.exports?
module.exports=s:"undefined"!=typeof define?define("eve",[],function(){return s}):a.eve=s})(this);
(function(){function a(a){for(var b=0;b<T.length;b++)T[b].el.paper==a&&T.splice(b--,1)}function b(a,b,e,d,g,h){e=Q(e);var m,z,q,l,A,u,v=a.ms,B={},N={},G={};if(d){u=0;for(t=T.length;u<t;u++){var C=T[u];if(C.el.id==b.id&&C.anim==a){C.percent!=e?(T.splice(u,1),q=1):z=C;b.attr(C.totalOrigin);break}}}else d=+N;u=0;for(var t=a.percents.length;u<t;u++){if(a.percents[u]==e||a.percents[u]>d*a.top){e=a.percents[u];A=a.percents[u-1]||0;v=v/a.top*(e-A);l=a.percents[u+1];m=a.anim[e];break}d&&b.attr(a.anim[a.percents[u]])}if(m){if(z)z.initstatus=
d,z.start=new Date-z.ms*d;else{for(var s in m)if(m[p](s)&&(ga[p](s)||b.paper.customAttributes[p](s)))switch(B[s]=b.attr(s),null==B[s]&&(B[s]=ja[s]),N[s]=m[s],ga[s]){case O:G[s]=(N[s]-B[s])/v;break;case "colour":B[s]=r.getRGB(B[s]);u=r.getRGB(N[s]);G[s]={r:(u.r-B[s].r)/v,g:(u.g-B[s].g)/v,b:(u.b-B[s].b)/v};break;case "path":u=na(B[s],N[s]);C=u[1];B[s]=u[0];G[s]=[];u=0;for(t=B[s].length;u<t;u++){G[s][u]=[0];for(var w=1,y=B[s][u].length;w<y;w++)G[s][u][w]=(C[u][w]-B[s][u][w])/v}break;case "transform":u=
b._;if(t=ab(u[s],N[s])){B[s]=t.from;N[s]=t.to;G[s]=[];G[s].real=!0;u=0;for(t=B[s].length;u<t;u++){G[s][u]=[B[s][u][0]];w=1;for(y=B[s][u].length;w<y;w++)G[s][u][w]=(N[s][u][w]-B[s][u][w])/v}}else t=b.matrix||new n,u={_:{transform:u.transform},getBBox:function(){return b.getBBox(1)}},B[s]=[t.a,t.b,t.c,t.d,t.e,t.f],Ia(u,N[s]),N[s]=u._.transform,G[s]=[(u.matrix.a-t.a)/v,(u.matrix.b-t.b)/v,(u.matrix.c-t.c)/v,(u.matrix.d-t.d)/v,(u.matrix.e-t.e)/v,(u.matrix.f-t.f)/v];break;case "csv":t=I(m[s])[H](D);C=I(B[s])[H](D);
if("clip-rect"==s){B[s]=C;G[s]=[];for(u=C.length;u--;)G[s][u]=(t[u]-B[s][u])/v}N[s]=t;break;default:t=[][J](m[s]);C=[][J](B[s]);G[s]=[];for(u=b.paper.customAttributes[s].length;u--;)G[s][u]=((t[u]||0)-(C[u]||0))/v}u=m.easing;s=r.easing_formulas[u];if(!s)if((s=I(u).match(aa))&&5==s.length){var F=s;s=function(a){return f(a,+F[1],+F[2],+F[3],+F[4],v)}}else s=bb;u=m.start||a.start||+new Date;C={anim:a,percent:e,timestamp:u,start:u+(a.del||0),status:0,initstatus:d||0,stop:!1,ms:v,easing:s,from:B,diff:G,
to:N,el:b,callback:m.callback,prev:A,next:l,repeat:h||a.times,origin:b.attr(),totalOrigin:g};T.push(C);if(d&&(!z&&!q)&&(C.stop=!0,C.start=new Date-v*d,1==T.length))return va();q&&(C.start=new Date-C.ms*d);1==T.length&&Ja(va)}eve("raphael.anim.start."+b.id,b,a)}}function d(a,b){var e=[],d={};this.ms=b;this.times=1;if(a){for(var g in a)a[p](g)&&(d[Q(g)]=a[g],e.push(Q(g)));e.sort($a)}this.anim=d;this.top=e[e.length-1];this.percents=e}function f(a,b,e,d,g,h){function p(a,b){var e,d,g,h;g=a;for(d=0;8>
d;d++){h=((z*g+f)*g+m)*g-a;if(K(h)<b)return g;e=(3*z*g+2*f)*g+m;if(1E-6>K(e))break;g-=h/e}e=0;d=1;g=a;if(g<e)return e;if(g>d)return d;for(;e<d;){h=((z*g+f)*g+m)*g;if(K(h-a)<b)break;a>h?e=g:d=g;g=(d-e)/2+e}return g}var m=3*b,f=3*(d-b)-m,z=1-m-f,q=3*e,r=3*(g-e)-q,l=1-q-r;return function(a,b){var e=p(a,b);return((l*e+r)*e+q)*e}(a,1/(200*h))}function l(){return this.x+R+this.y+R+this.width+" \u00d7 "+this.height}function n(a,b,e,d,g,h){null!=a?(this.a=+a,this.b=+b,this.c=+e,this.d=+d,this.e=+g,this.f=
+h):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}function t(a,b,e){a=r._path2curve(a);b=r._path2curve(b);for(var d,g,h,p,m,f,z,q,l,n,u=e?0:[],H=0,v=a.length;H<v;H++){var A=a[H];if("M"==A[0])d=m=A[1],g=f=A[2];else{"C"==A[0]?(l=[d,g].concat(A.slice(1)),d=l[6],g=l[7]):(l=[d,g,d,g,m,f,m,f],d=m,g=f);for(var A=0,I=b.length;A<I;A++){var B=b[A];if("M"==B[0])h=z=B[1],p=q=B[2];else{"C"==B[0]?(n=[h,p].concat(B.slice(1)),h=n[6],p=n[7]):(n=[h,p,h,p,z,q,z,q],h=z,p=q);var s=l,J=n,B=e,G=r.bezierBBox(s),
t=r.bezierBBox(J);if(r.isBBoxIntersect(G,t)){for(var G=y.apply(0,s),t=y.apply(0,J),G=~~(G/5),t=~~(t/5),N=[],w=[],F={},D=B?0:[],P=0;P<G+1;P++){var R=r.findDotsAtSegment.apply(r,s.concat(P/G));N.push({x:R.x,y:R.y,t:P/G})}for(P=0;P<t+1;P++)R=r.findDotsAtSegment.apply(r,J.concat(P/t)),w.push({x:R.x,y:R.y,t:P/t});for(P=0;P<G;P++)for(s=0;s<t;s++){var O=N[P],E=N[P+1],J=w[s],R=w[s+1],M=0.0010>K(E.x-O.x)?"y":"x",W=0.0010>K(R.x-J.x)?"y":"x",L;L=O.x;var V=O.y,Z=E.x,aa=E.y,Q=J.x,Y=J.y,ea=R.x,X=R.y;if(S(L,Z)<
C(Q,ea)||C(L,Z)>S(Q,ea)||S(V,aa)<C(Y,X)||C(V,aa)>S(Y,X))L=void 0;else{var T=(L*aa-V*Z)*(Q-ea)-(L-Z)*(Q*X-Y*ea),ja=(L*aa-V*Z)*(Y-X)-(V-aa)*(Q*X-Y*ea),U=(L-Z)*(Y-X)-(V-aa)*(Q-ea);if(U){var T=T/U,ja=ja/U,U=+T.toFixed(2),ga=+ja.toFixed(2);L=U<+C(L,Z).toFixed(2)||U>+S(L,Z).toFixed(2)||U<+C(Q,ea).toFixed(2)||U>+S(Q,ea).toFixed(2)||ga<+C(V,aa).toFixed(2)||ga>+S(V,aa).toFixed(2)||ga<+C(Y,X).toFixed(2)||ga>+S(Y,X).toFixed(2)?void 0:{x:T,y:ja}}else L=void 0}L&&F[L.x.toFixed(4)]!=L.y.toFixed(4)&&(F[L.x.toFixed(4)]=
L.y.toFixed(4),O=O.t+K((L[M]-O[M])/(E[M]-O[M]))*(E.t-O.t),J=J.t+K((L[W]-J[W])/(R[W]-J[W]))*(R.t-J.t),0<=O&&1>=O&&0<=J&&1>=J&&(B?D++:D.push({x:L.x,y:L.y,t1:O,t2:J})))}B=D}else B=B?0:[];if(e)u+=B;else{G=0;for(t=B.length;G<t;G++)B[G].segment1=H,B[G].segment2=A,B[G].bez1=l,B[G].bez2=n;u=u.concat(B)}}}}}return u}function s(a,b,e,d,g,h,p,m,f){if(!(0>f||y(a,b,e,d,g,h,p,m)<f)){var z=0.5,q=1-z,l;for(l=y(a,b,e,d,g,h,p,m,q);0.01<K(l-f);)z/=2,q+=(l<f?1:-1)*z,l=y(a,b,e,d,g,h,p,m,q);return q}}function y(a,b,e,
d,g,h,p,m,f){null==f&&(f=1);f=(1<f?1:0>f?0:f)/2;for(var z=[-0.1252,0.1252,-0.3678,0.3678,-0.5873,0.5873,-0.7699,0.7699,-0.9041,0.9041,-0.9816,0.9816],q=[0.2491,0.2491,0.2335,0.2335,0.2032,0.2032,0.1601,0.1601,0.1069,0.1069,0.0472,0.0472],l=0,r=0;12>r;r++)var n=f*z[r]+f,u=n*(n*(-3*a+9*e-9*g+3*p)+6*a-12*e+6*g)-3*a+3*e,n=n*(n*(-3*b+9*d-9*h+3*m)+6*b-12*d+6*h)-3*b+3*d,l=l+q[r]*G.sqrt(u*u+n*n);return f*l}function w(a,b){for(var e=[],d=0,g=a.length;g-2*!b>d;d+=2){var h=[{x:+a[d-2],y:+a[d-1]},{x:+a[d],y:+a[d+
1]},{x:+a[d+2],y:+a[d+3]},{x:+a[d+4],y:+a[d+5]}];b?d?g-4==d?h[3]={x:+a[0],y:+a[1]}:g-2==d&&(h[2]={x:+a[0],y:+a[1]},h[3]={x:+a[2],y:+a[3]}):h[0]={x:+a[g-2],y:+a[g-1]}:g-4==d?h[3]=h[2]:d||(h[0]={x:+a[d],y:+a[d+1]});e.push(["C",(-h[0].x+6*h[1].x+h[2].x)/6,(-h[0].y+6*h[1].y+h[2].y)/6,(h[1].x+6*h[2].x-h[3].x)/6,(h[1].y+6*h[2].y-h[3].y)/6,h[2].x,h[2].y])}return e}function E(){return this.hex}function q(a,b,e){function d(){var g=Array.prototype.slice.call(arguments,0),h=g.join("\u2400"),m=d.cache=d.cache||
{},f=d.count=d.count||[];if(m[p](h)){a:for(var g=f,f=h,q=0,l=g.length;q<l;q++)if(g[q]===f){g.push(g.splice(q,1)[0]);break a}return e?e(m[h]):m[h]}1E3<=f.length&&delete m[f.shift()];f.push(h);m[h]=a[z](b,g);return e?e(m[h]):m[h]}return d}function v(a){if(Object(a)!==a)return a;var b=new a.constructor,e;for(e in a)a[p](e)&&(b[e]=v(a[e]));return b}function r(a){if(r.is(a,"function"))return B?a():eve.on("raphael.DOMload",a);if(r.is(a,W))return r._engine.create[z](r,a.splice(0,3+r.is(a[0],O))).add(a);
var b=Array.prototype.slice.call(arguments,0);if(r.is(b[b.length-1],"function")){var e=b.pop();return B?e.call(r._engine.create[z](r,b)):eve.on("raphael.DOMload",function(){e.call(r._engine.create[z](r,b))})}return r._engine.create[z](r,arguments)}r.version="2.1.0";r.eve=eve;var B,D=/[, ]+/,F={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},g=/\{(\d+)\}/g,p="hasOwnProperty",e={doc:document,win:window},m=Object.prototype[p].call(e.win,"Raphael"),h=e.win.Raphael,u=function(){this.ca=this.customAttributes=
{}},A,z="apply",J="concat",R=" ",I=String,H="split",N="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[H](R),P=I.prototype.toLowerCase,G=Math,S=G.max,C=G.min,K=G.abs,M=G.pow,L=G.PI,O="number",W="array",V=Object.prototype.toString;r._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i;var Z=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i,
Y={NaN:1,Infinity:1,"-Infinity":1},aa=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,X=G.round,Q=parseFloat,da=parseInt,ea=I.prototype.toUpperCase,ja=r._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,
rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},ga=r._availableAnimAttrs={blur:O,"clip-rect":"csv",cx:O,cy:O,fill:"colour","fill-opacity":O,"font-size":O,height:O,opacity:O,path:"path",r:O,rx:O,ry:O,stroke:"colour","stroke-opacity":O,"stroke-width":O,transform:"transform",width:O,x:O,y:O},ua=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,
Wa={hs:1,rg:1},Xa=/,?([achlmqrstvxz]),?/gi,Ya=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/ig,
Za=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/ig,Ha=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/ig;
r._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/;var ma={},$a=function(a,b){return Q(a)-Q(b)},cb=function(){},bb=function(a){return a},wa=r._rectPath=function(a,b,e,d,g){return g?[["M",a+g,b],["l",e-2*g,0],["a",g,g,0,0,1,
g,g],["l",0,d-2*g],["a",g,g,0,0,1,-g,g],["l",2*g-e,0],["a",g,g,0,0,1,-g,-g],["l",0,2*g-d],["a",g,g,0,0,1,g,-g],["z"]]:[["M",a,b],["l",e,0],["l",0,d],["l",-e,0],["z"]]},Ka=function(a,b,e,d){null==d&&(d=e);return[["M",a,b],["m",0,-d],["a",e,d,0,1,1,0,2*d],["a",e,d,0,1,1,0,-2*d],["z"]]},oa=r._getPath={path:function(a){return a.attr("path")},circle:function(a){a=a.attrs;return Ka(a.cx,a.cy,a.r)},ellipse:function(a){a=a.attrs;return Ka(a.cx,a.cy,a.rx,a.ry)},rect:function(a){a=a.attrs;return wa(a.x,a.y,
a.width,a.height,a.r)},image:function(a){a=a.attrs;return wa(a.x,a.y,a.width,a.height)},text:function(a){a=a._getBBox();return wa(a.x,a.y,a.width,a.height)}},xa=r.mapPath=function(a,b){if(!b)return a;var e,d,g,h,p,m,f;a=na(a);g=0;for(p=a.length;g<p;g++){f=a[g];h=1;for(m=f.length;h<m;h+=2)e=b.x(f[h],f[h+1]),d=b.y(f[h],f[h+1]),f[h]=e,f[h+1]=d}return a};r._g=e;r.type=e.win.SVGAngle||e.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML";if("VML"==r.type){var ya=
e.doc.createElement("div"),pa;ya.innerHTML='<v:shape adj="1"/>';pa=ya.firstChild;pa.style.behavior="url(#default#VML)";if(!pa||"object"!=typeof pa.adj)return r.type="";ya=null}r.svg=!(r.vml="VML"==r.type);r._Paper=u;r.fn=A=u.prototype=r.prototype;r._id=0;r._oid=0;r.is=function(a,b){b=P.call(b);return"finite"==b?!Y[p](+a):"array"==b?a instanceof Array:"null"==b&&null===a||b==typeof a&&null!==a||"object"==b&&a===Object(a)||"array"==b&&Array.isArray&&Array.isArray(a)||V.call(a).slice(8,-1).toLowerCase()==
b};r.angle=function(a,b,e,d,g,h){return null==g?(a-=e,b-=d,!a&&!b?0:(180*G.atan2(-b,-a)/L+540)%360):r.angle(a,b,g,h)-r.angle(e,d,g,h)};r.rad=function(a){return a%360*L/180};r.deg=function(a){return 180*a/L%360};r.snapTo=function(a,b,e){e=r.is(e,"finite")?e:10;if(r.is(a,W))for(var d=a.length;d--;){if(K(a[d]-b)<=e)return a[d]}else{a=+a;d=b%a;if(d<e)return b-d;if(d>a-e)return b-d+a}return b};r.createUUID=function(a,b){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(a,b).toUpperCase()}}(/[xy]/g,
function(a){var b=16*G.random()|0;return("x"==a?b:b&3|8).toString(16)});r.setWindow=function(a){eve("raphael.setWindow",r,e.win,a);e.win=a;e.doc=e.win.document;r._engine.initWin&&r._engine.initWin(e.win)};var qa=function(a){if(r.vml){var b=/^\s+|\s+$/g,d;try{var g=new ActiveXObject("htmlfile");g.write("<body>");g.close();d=g.body}catch(h){d=createPopup().document.body}var p=d.createTextRange();qa=q(function(a){try{d.style.color=I(a).replace(b,"");var e=p.queryCommandValue("ForeColor");return"#"+("000000"+
((e&255)<<16|e&65280|(e&16711680)>>>16).toString(16)).slice(-6)}catch(g){return"none"}})}else{var m=e.doc.createElement("i");m.title="Rapha\u00ebl Colour Picker";m.style.display="none";e.doc.body.appendChild(m);qa=q(function(a){m.style.color=a;return e.doc.defaultView.getComputedStyle(m,"").getPropertyValue("color")})}return qa(a)},db=function(){return"hsb("+[this.h,this.s,this.b]+")"},eb=function(){return"hsl("+[this.h,this.s,this.l]+")"},La=function(){return this.hex},Ma=function(a,b,e){null==b&&
r.is(a,"object")&&"r"in a&&"g"in a&&"b"in a&&(e=a.b,b=a.g,a=a.r);null==b&&r.is(a,"string")&&(e=r.getRGB(a),a=e.r,b=e.g,e=e.b);if(1<a||1<b||1<e)a/=255,b/=255,e/=255;return[a,b,e]},Na=function(a,b,e,d){a*=255;b*=255;e*=255;a={r:a,g:b,b:e,hex:r.rgb(a,b,e),toString:La};r.is(d,"finite")&&(a.opacity=d);return a};r.color=function(a){var b;r.is(a,"object")&&"h"in a&&"s"in a&&"b"in a?(b=r.hsb2rgb(a),a.r=b.r,a.g=b.g,a.b=b.b,a.hex=b.hex):r.is(a,"object")&&"h"in a&&"s"in a&&"l"in a?(b=r.hsl2rgb(a),a.r=b.r,a.g=
b.g,a.b=b.b,a.hex=b.hex):(r.is(a,"string")&&(a=r.getRGB(a)),r.is(a,"object")&&"r"in a&&"g"in a&&"b"in a?(b=r.rgb2hsl(a),a.h=b.h,a.s=b.s,a.l=b.l,b=r.rgb2hsb(a),a.v=b.b):(a={hex:"none"},a.r=a.g=a.b=a.h=a.s=a.v=a.l=-1));a.toString=La;return a};r.hsb2rgb=function(a,b,e,d){this.is(a,"object")&&"h"in a&&"s"in a&&"b"in a&&(e=a.b,b=a.s,a=a.h,d=a.o);var g,h,p;a=360*a%360/60;p=e*b;b=p*(1-K(a%2-1));e=g=h=e-p;a=~~a;e+=[p,b,0,0,b,p][a];g+=[b,p,p,b,0,0][a];h+=[0,0,b,p,p,b][a];return Na(e,g,h,d)};r.hsl2rgb=function(a,
b,e,d){this.is(a,"object")&&"h"in a&&"s"in a&&"l"in a&&(e=a.l,b=a.s,a=a.h);if(1<a||1<b||1<e)a/=360,b/=100,e/=100;var g,h,p;a=360*a%360/60;p=2*b*(0.5>e?e:1-e);b=p*(1-K(a%2-1));e=g=h=e-p/2;a=~~a;e+=[p,b,0,0,b,p][a];g+=[b,p,p,b,0,0][a];h+=[0,0,b,p,p,b][a];return Na(e,g,h,d)};r.rgb2hsb=function(a,b,e){e=Ma(a,b,e);a=e[0];b=e[1];e=e[2];var d,g;d=S(a,b,e);g=d-C(a,b,e);a=60*(((0==g?0:d==a?(b-e)/g:d==b?(e-a)/g+2:(a-b)/g+4)+360)%6)/360;return{h:a,s:0==g?0:g/d,b:d,toString:db}};r.rgb2hsl=function(a,b,e){e=Ma(a,
b,e);a=e[0];b=e[1];e=e[2];var d,g,h;d=S(a,b,e);g=C(a,b,e);h=d-g;a=60*(((0==h?0:d==a?(b-e)/h:d==b?(e-a)/h+2:(a-b)/h+4)+360)%6)/360;d=(d+g)/2;return{h:a,s:0==h?0:0.5>d?h/(2*d):h/(2-2*d),l:d,toString:eb}};r._path2string=function(){return this.join(",").replace(Xa,"$1")};r._preload=function(a,b){var d=e.doc.createElement("img");d.style.cssText="position:absolute;left:-9999em;top:-9999em";d.onload=function(){b.call(this);this.onload=null;e.doc.body.removeChild(this)};d.onerror=function(){e.doc.body.removeChild(this)};
e.doc.body.appendChild(d);d.src=a};r.getRGB=q(function(a){if(!a||(a=I(a)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:E};if("none"==a)return{r:-1,g:-1,b:-1,hex:"none",toString:E};!Wa[p](a.toLowerCase().substring(0,2))&&"#"!=a.charAt()&&(a=qa(a));var b,e,d,g,h,m;if(a=a.match(Z)){a[2]&&(d=da(a[2].substring(5),16),e=da(a[2].substring(3,5),16),b=da(a[2].substring(1,3),16));a[3]&&(d=da((h=a[3].charAt(3))+h,16),e=da((h=a[3].charAt(2))+h,16),b=da((h=a[3].charAt(1))+h,16));a[4]&&(m=a[4][H](ua),
b=Q(m[0]),"%"==m[0].slice(-1)&&(b*=2.55),e=Q(m[1]),"%"==m[1].slice(-1)&&(e*=2.55),d=Q(m[2]),"%"==m[2].slice(-1)&&(d*=2.55),"rgba"==a[1].toLowerCase().slice(0,4)&&(g=Q(m[3])),m[3]&&"%"==m[3].slice(-1)&&(g/=100));if(a[5])return m=a[5][H](ua),b=Q(m[0]),"%"==m[0].slice(-1)&&(b*=2.55),e=Q(m[1]),"%"==m[1].slice(-1)&&(e*=2.55),d=Q(m[2]),"%"==m[2].slice(-1)&&(d*=2.55),("deg"==m[0].slice(-3)||"\u00b0"==m[0].slice(-1))&&(b/=360),"hsba"==a[1].toLowerCase().slice(0,4)&&(g=Q(m[3])),m[3]&&"%"==m[3].slice(-1)&&
(g/=100),r.hsb2rgb(b,e,d,g);if(a[6])return m=a[6][H](ua),b=Q(m[0]),"%"==m[0].slice(-1)&&(b*=2.55),e=Q(m[1]),"%"==m[1].slice(-1)&&(e*=2.55),d=Q(m[2]),"%"==m[2].slice(-1)&&(d*=2.55),("deg"==m[0].slice(-3)||"\u00b0"==m[0].slice(-1))&&(b/=360),"hsla"==a[1].toLowerCase().slice(0,4)&&(g=Q(m[3])),m[3]&&"%"==m[3].slice(-1)&&(g/=100),r.hsl2rgb(b,e,d,g);a={r:b,g:e,b:d,toString:E};a.hex="#"+(16777216|d|e<<8|b<<16).toString(16).slice(1);r.is(g,"finite")&&(a.opacity=g);return a}return{r:-1,g:-1,b:-1,hex:"none",
error:1,toString:E}},r);r.hsb=q(function(a,b,e){return r.hsb2rgb(a,b,e).hex});r.hsl=q(function(a,b,e){return r.hsl2rgb(a,b,e).hex});r.rgb=q(function(a,b,e){return"#"+(16777216|e|b<<8|a<<16).toString(16).slice(1)});r.getColor=function(a){a=this.getColor.start=this.getColor.start||{h:0,s:1,b:a||0.75};var b=this.hsb2rgb(a.h,a.s,a.b);a.h+=0.075;1<a.h&&(a.h=0,a.s-=0.2,0>=a.s&&(this.getColor.start={h:0,s:1,b:a.b}));return b.hex};r.getColor.reset=function(){delete this.start};r.parsePathString=function(a){if(!a)return null;
var b=ha(a);if(b.arr)return fa(b.arr);var e={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},d=[];r.is(a,W)&&r.is(a[0],W)&&(d=fa(a));d.length||I(a).replace(Ya,function(a,b,g){var h=[];a=b.toLowerCase();g.replace(Ha,function(a,b){b&&h.push(+b)});"m"==a&&2<h.length&&(d.push([b][J](h.splice(0,2))),a="l",b="m"==b?"l":"L");if("r"==a)d.push([b][J](h));else for(;h.length>=e[a]&&!(d.push([b][J](h.splice(0,e[a]))),!e[a]););});d.toString=r._path2string;b.arr=fa(d);return d};r.parseTransformString=q(function(a){if(!a)return null;
var b=[];r.is(a,W)&&r.is(a[0],W)&&(b=fa(a));b.length||I(a).replace(Za,function(a,e,d){var g=[];P.call(e);d.replace(Ha,function(a,b){b&&g.push(+b)});b.push([e][J](g))});b.toString=r._path2string;return b});var ha=function(a){var b=ha.ps=ha.ps||{};b[a]?b[a].sleep=100:b[a]={sleep:100};setTimeout(function(){for(var e in b)b[p](e)&&e!=a&&(b[e].sleep--,!b[e].sleep&&delete b[e])});return b[a]};r.findDotsAtSegment=function(a,b,e,d,g,h,p,m,f){var z=1-f,q=M(z,3),l=M(z,2),r=f*f,n=r*f,u=q*a+3*l*f*e+3*z*f*f*g+
n*p,q=q*b+3*l*f*d+3*z*f*f*h+n*m,l=a+2*f*(e-a)+r*(g-2*e+a),n=b+2*f*(d-b)+r*(h-2*d+b),H=e+2*f*(g-e)+r*(p-2*g+e),r=d+2*f*(h-d)+r*(m-2*h+d);a=z*a+f*e;b=z*b+f*d;g=z*g+f*p;h=z*h+f*m;m=90-180*G.atan2(l-H,n-r)/L;(l>H||n<r)&&(m+=180);return{x:u,y:q,m:{x:l,y:n},n:{x:H,y:r},start:{x:a,y:b},end:{x:g,y:h},alpha:m}};r.bezierBBox=function(a,b,e,d,g,h,p,m){r.is(a,"array")||(a=[a,b,e,d,g,h,p,m]);a=Oa.apply(null,a);return{x:a.min.x,y:a.min.y,x2:a.max.x,y2:a.max.y,width:a.max.x-a.min.x,height:a.max.y-a.min.y}};r.isPointInsideBBox=
function(a,b,e){return b>=a.x&&b<=a.x2&&e>=a.y&&e<=a.y2};r.isBBoxIntersect=function(a,b){var e=r.isPointInsideBBox;return e(b,a.x,a.y)||e(b,a.x2,a.y)||e(b,a.x,a.y2)||e(b,a.x2,a.y2)||e(a,b.x,b.y)||e(a,b.x2,b.y)||e(a,b.x,b.y2)||e(a,b.x2,b.y2)||(a.x<b.x2&&a.x>b.x||b.x<a.x2&&b.x>a.x)&&(a.y<b.y2&&a.y>b.y||b.y<a.y2&&b.y>a.y)};r.pathIntersection=function(a,b){return t(a,b)};r.pathIntersectionNumber=function(a,b){return t(a,b,1)};r.isPointInsidePath=function(a,b,e){var d=r.pathBBox(a);return r.isPointInsideBBox(d,
b,e)&&1==t(a,[["M",b,e],["H",d.x2+10]],1)%2};r._removedFactory=function(a){return function(){eve("raphael.log",null,"Rapha\u00ebl: you are calling to method \u201c"+a+"\u201d of removed object",a)}};var za=r.pathBBox=function(a){var b=ha(a);if(b.bbox)return b.bbox;if(!a)return{x:0,y:0,width:0,height:0,x2:0,y2:0};a=na(a);for(var e=0,d=0,g=[],h=[],p,m=0,f=a.length;m<f;m++)p=a[m],"M"==p[0]?(e=p[1],d=p[2],g.push(e),h.push(d)):(e=Oa(e,d,p[1],p[2],p[3],p[4],p[5],p[6]),g=g[J](e.min.x,e.max.x),h=h[J](e.min.y,
e.max.y),e=p[5],d=p[6]);a=C[z](0,g);p=C[z](0,h);g=S[z](0,g);h=S[z](0,h);h={x:a,y:p,x2:g,y2:h,width:g-a,height:h-p};b.bbox=v(h);return h},fa=function(a){a=v(a);a.toString=r._path2string;return a},fb=r._pathToRelative=function(a){var b=ha(a);if(b.rel)return fa(b.rel);if(!r.is(a,W)||!r.is(a&&a[0],W))a=r.parsePathString(a);var e=[],d=0,g=0,h=0,p=0,m=0;"M"==a[0][0]&&(d=a[0][1],g=a[0][2],h=d,p=g,m++,e.push(["M",d,g]));for(var f=a.length;m<f;m++){var z=e[m]=[],q=a[m];if(q[0]!=P.call(q[0]))switch(z[0]=P.call(q[0]),
z[0]){case "a":z[1]=q[1];z[2]=q[2];z[3]=q[3];z[4]=q[4];z[5]=q[5];z[6]=+(q[6]-d).toFixed(3);z[7]=+(q[7]-g).toFixed(3);break;case "v":z[1]=+(q[1]-g).toFixed(3);break;case "m":h=q[1],p=q[2];default:for(var l=1,n=q.length;l<n;l++)z[l]=+(q[l]-(l%2?d:g)).toFixed(3)}else{e[m]=[];"m"==q[0]&&(h=q[1]+d,p=q[2]+g);z=0;for(l=q.length;z<l;z++)e[m][z]=q[z]}q=e[m].length;switch(e[m][0]){case "z":d=h;g=p;break;case "h":d+=+e[m][q-1];break;case "v":g+=+e[m][q-1];break;default:d+=+e[m][q-2],g+=+e[m][q-1]}}e.toString=
r._path2string;b.rel=fa(e);return e},Pa=r._pathToAbsolute=function(a){var b=ha(a);if(b.abs)return fa(b.abs);if(!r.is(a,W)||!r.is(a&&a[0],W))a=r.parsePathString(a);if(!a||!a.length)return[["M",0,0]];var e=[],d=0,g=0,h=0,p=0,m=0;"M"==a[0][0]&&(d=+a[0][1],g=+a[0][2],h=d,p=g,m++,e[0]=["M",d,g]);for(var f=3==a.length&&"M"==a[0][0]&&"R"==a[1][0].toUpperCase()&&"Z"==a[2][0].toUpperCase(),z,q=m,l=a.length;q<l;q++){e.push(m=[]);z=a[q];if(z[0]!=ea.call(z[0]))switch(m[0]=ea.call(z[0]),m[0]){case "A":m[1]=z[1];
m[2]=z[2];m[3]=z[3];m[4]=z[4];m[5]=z[5];m[6]=+(z[6]+d);m[7]=+(z[7]+g);break;case "V":m[1]=+z[1]+g;break;case "H":m[1]=+z[1]+d;break;case "R":for(var n=[d,g][J](z.slice(1)),u=2,H=n.length;u<H;u++)n[u]=+n[u]+d,n[++u]=+n[u]+g;e.pop();e=e[J](w(n,f));break;case "M":h=+z[1]+d,p=+z[2]+g;default:u=1;for(H=z.length;u<H;u++)m[u]=+z[u]+(u%2?d:g)}else if("R"==z[0])n=[d,g][J](z.slice(1)),e.pop(),e=e[J](w(n,f)),m=["R"][J](z.slice(-2));else{n=0;for(u=z.length;n<u;n++)m[n]=z[n]}switch(m[0]){case "Z":d=h;g=p;break;
case "H":d=m[1];break;case "V":g=m[1];break;case "M":h=m[m.length-2],p=m[m.length-1];default:d=m[m.length-2],g=m[m.length-1]}}e.toString=r._path2string;b.abs=fa(e);return e},Qa=function(a,b,e,d,g,h){var m=1/3,p=2/3;return[m*a+p*e,m*b+p*d,m*g+p*e,m*h+p*d,g,h]},Ra=function(a,b,e,d,g,h,m,p,f,z){var l=120*L/180,n=L/180*(+g||0),r=[],u,A=q(function(a,b,e){var d=a*G.cos(e)-b*G.sin(e);a=a*G.sin(e)+b*G.cos(e);return{x:d,y:a}});if(z)B=z[0],u=z[1],h=z[2],v=z[3];else{u=A(a,b,-n);a=u.x;b=u.y;u=A(p,f,-n);p=u.x;
f=u.y;G.cos(L/180*g);G.sin(L/180*g);u=(a-p)/2;B=(b-f)/2;v=u*u/(e*e)+B*B/(d*d);1<v&&(v=G.sqrt(v),e*=v,d*=v);var v=e*e,I=d*d,v=(h==m?-1:1)*G.sqrt(K((v*I-v*B*B-I*u*u)/(v*B*B+I*u*u)));h=v*e*B/d+(a+p)/2;var v=v*-d*u/e+(b+f)/2,B=G.asin(((b-v)/d).toFixed(9));u=G.asin(((f-v)/d).toFixed(9));B=a<h?L-B:B;u=p<h?L-u:u;0>B&&(B=2*L+B);0>u&&(u=2*L+u);m&&B>u&&(B-=2*L);!m&&u>B&&(u-=2*L)}if(K(u-B)>l){var r=u,I=p,s=f;u=B+l*(m&&u>B?1:-1);p=h+e*G.cos(u);f=v+d*G.sin(u);r=Ra(p,f,e,d,g,0,m,I,s,[u,r,h,v])}h=u-B;g=G.cos(B);
l=G.sin(B);m=G.cos(u);u=G.sin(u);h=G.tan(h/4);e=4/3*e*h;h*=4/3*d;d=[a,b];a=[a+e*l,b-h*g];b=[p+e*u,f-h*m];p=[p,f];a[0]=2*d[0]-a[0];a[1]=2*d[1]-a[1];if(z)return[a,b,p][J](r);r=[a,b,p][J](r).join()[H](",");z=[];p=0;for(f=r.length;p<f;p++)z[p]=p%2?A(r[p-1],r[p],n).y:A(r[p],r[p+1],n).x;return z},ra=function(a,b,e,d,g,h,m,p,f){var z=1-f;return{x:M(z,3)*a+3*M(z,2)*f*e+3*z*f*f*g+M(f,3)*m,y:M(z,3)*b+3*M(z,2)*f*d+3*z*f*f*h+M(f,3)*p}},Oa=q(function(a,b,e,d,g,h,m,p){var f=g-2*e+a-(m-2*g+e),q=2*(e-a)-2*(g-e),
l=a-e,r=(-q+G.sqrt(q*q-4*f*l))/2/f,f=(-q-G.sqrt(q*q-4*f*l))/2/f,n=[b,p],u=[a,m],H;"1e12"<K(r)&&(r=0.5);"1e12"<K(f)&&(f=0.5);0<r&&1>r&&(H=ra(a,b,e,d,g,h,m,p,r),u.push(H.x),n.push(H.y));0<f&&1>f&&(H=ra(a,b,e,d,g,h,m,p,f),u.push(H.x),n.push(H.y));f=h-2*d+b-(p-2*h+d);q=2*(d-b)-2*(h-d);l=b-d;r=(-q+G.sqrt(q*q-4*f*l))/2/f;f=(-q-G.sqrt(q*q-4*f*l))/2/f;"1e12"<K(r)&&(r=0.5);"1e12"<K(f)&&(f=0.5);0<r&&1>r&&(H=ra(a,b,e,d,g,h,m,p,r),u.push(H.x),n.push(H.y));0<f&&1>f&&(H=ra(a,b,e,d,g,h,m,p,f),u.push(H.x),n.push(H.y));
return{min:{x:C[z](0,u),y:C[z](0,n)},max:{x:S[z](0,u),y:S[z](0,n)}}}),na=r._path2curve=q(function(a,b){var e=!b&&ha(a);if(!b&&e.curve)return fa(e.curve);var d=Pa(a),g=b&&Pa(b),h={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},m={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},p=function(a,b){var e,d;if(!a)return["C",b.x,b.y,b.x,b.y,b.x,b.y];!(a[0]in{T:1,Q:1})&&(b.qx=b.qy=null);switch(a[0]){case "M":b.X=a[1];b.Y=a[2];break;case "A":a=["C"][J](Ra[z](0,[b.x,b.y][J](a.slice(1))));break;case "S":e=b.x+(b.x-(b.bx||
b.x));d=b.y+(b.y-(b.by||b.y));a=["C",e,d][J](a.slice(1));break;case "T":b.qx=b.x+(b.x-(b.qx||b.x));b.qy=b.y+(b.y-(b.qy||b.y));a=["C"][J](Qa(b.x,b.y,b.qx,b.qy,a[1],a[2]));break;case "Q":b.qx=a[1];b.qy=a[2];a=["C"][J](Qa(b.x,b.y,a[1],a[2],a[3],a[4]));break;case "L":a=["C"][J]([b.x,b.y,a[1],a[2],a[1],a[2]]);break;case "H":a=["C"][J]([b.x,b.y,a[1],b.y,a[1],b.y]);break;case "V":a=["C"][J]([b.x,b.y,b.x,a[1],b.x,a[1]]);break;case "Z":a=["C"][J]([b.x,b.y,b.X,b.Y,b.X,b.Y])}return a},f=function(a,b){if(7<a[b].length){a[b].shift();
for(var e=a[b];e.length;)a.splice(b++,0,["C"][J](e.splice(0,6)));a.splice(b,1);r=S(d.length,g&&g.length||0)}},q=function(a,b,e,h,m){a&&b&&"M"==a[m][0]&&"M"!=b[m][0]&&(b.splice(m,0,["M",h.x,h.y]),e.bx=0,e.by=0,e.x=a[m][1],e.y=a[m][2],r=S(d.length,g&&g.length||0))},l=0,r=S(d.length,g&&g.length||0);for(;l<r;l++){d[l]=p(d[l],h);f(d,l);g&&(g[l]=p(g[l],m));g&&f(g,l);q(d,g,h,m,l);q(g,d,m,h,l);var n=d[l],u=g&&g[l],H=n.length,v=g&&u.length;h.x=n[H-2];h.y=n[H-1];h.bx=Q(n[H-4])||h.x;h.by=Q(n[H-3])||h.y;m.bx=
g&&(Q(u[v-4])||m.x);m.by=g&&(Q(u[v-3])||m.y);m.x=g&&u[v-2];m.y=g&&u[v-1]}g||(e.curve=fa(d));return g?[d,g]:d},null,fa);r._parseDots=q(function(a){for(var b=[],e=0,d=a.length;e<d;e++){var g={},h=a[e].match(/^([^:]*):?([\d\.]*)/);g.color=r.getRGB(h[1]);if(g.color.error)return null;g.color=g.color.hex;h[2]&&(g.offset=h[2]+"%");b.push(g)}e=1;for(d=b.length-1;e<d;e++)if(!b[e].offset){a=Q(b[e-1].offset||0);h=0;for(g=e+1;g<d;g++)if(b[g].offset){h=b[g].offset;break}h||(h=100,g=d);h=Q(h);for(h=(h-a)/(g-e+
1);e<g;e++)a+=h,b[e].offset=a+"%"}return b});var sa=r._tear=function(a,b){a==b.top&&(b.top=a.prev);a==b.bottom&&(b.bottom=a.next);a.next&&(a.next.prev=a.prev);a.prev&&(a.prev.next=a.next)};r._tofront=function(a,b){b.top!==a&&(sa(a,b),a.next=null,a.prev=b.top,b.top.next=a,b.top=a)};r._toback=function(a,b){b.bottom!==a&&(sa(a,b),a.next=b.bottom,a.prev=null,b.bottom.prev=a,b.bottom=a)};r._insertafter=function(a,b,e){sa(a,e);b==e.top&&(e.top=a);b.next&&(b.next.prev=a);a.next=b.next;a.prev=b;b.next=a};
r._insertbefore=function(a,b,e){sa(a,e);b==e.bottom&&(e.bottom=a);b.prev&&(b.prev.next=a);a.prev=b.prev;b.prev=a;a.next=b};var gb=r.toMatrix=function(a,b){var e=za(a),d={_:{transform:""},getBBox:function(){return e}};Ia(d,b);return d.matrix};r.transformPath=function(a,b){return xa(a,gb(a,b))};var Ia=r._extractTransform=function(a,b){if(null==b)return a._.transform;b=I(b).replace(/\.{3}|\u2026/g,a._.transform||"");var e=r.parseTransformString(b),d=0,g=0,h=0,m=1,p=1,f=a._,h=new n;f.transform=e||[];
if(e)for(var g=0,z=e.length;g<z;g++){var q=e[g],l=q.length,u=I(q[0]).toLowerCase(),H=q[0]!=u,v=H?h.invert():0,A,B,s,J,G;"t"==u&&3==l?H?(A=v.x(0,0),B=v.y(0,0),s=v.x(q[1],q[2]),J=v.y(q[1],q[2]),h.translate(s-A,J-B)):h.translate(q[1],q[2]):"r"==u?2==l?(G=G||a.getBBox(1),h.rotate(q[1],G.x+G.width/2,G.y+G.height/2),d+=q[1]):4==l&&(H?(s=v.x(q[2],q[3]),J=v.y(q[2],q[3]),h.rotate(q[1],s,J)):h.rotate(q[1],q[2],q[3]),d+=q[1]):"s"==u?2==l||3==l?(G=G||a.getBBox(1),h.scale(q[1],q[l-1],G.x+G.width/2,G.y+G.height/
2),m*=q[1],p*=q[l-1]):5==l&&(H?(s=v.x(q[3],q[4]),J=v.y(q[3],q[4]),h.scale(q[1],q[2],s,J)):h.scale(q[1],q[2],q[3],q[4]),m*=q[1],p*=q[2]):"m"==u&&7==l&&h.add(q[1],q[2],q[3],q[4],q[5],q[6]);f.dirtyT=1;a.matrix=h}a.matrix=h;f.sx=m;f.sy=p;f.deg=d;f.dx=g=h.e;f.dy=h=h.f;1==m&&1==p&&!d&&f.bbox?(f.bbox.x+=+g,f.bbox.y+=+h):f.dirtyT=1},Sa=function(a){var b=a[0];switch(b.toLowerCase()){case "t":return[b,0,0];case "m":return[b,1,0,0,1,0,0];case "r":return 4==a.length?[b,0,a[2],a[3]]:[b,0];case "s":return 5==a.length?
[b,1,1,a[3],a[4]]:3==a.length?[b,1,1]:[b,1]}},ab=r._equaliseTransform=function(a,b){b=I(b).replace(/\.{3}|\u2026/g,a);a=r.parseTransformString(a)||[];b=r.parseTransformString(b)||[];for(var e=S(a.length,b.length),d=[],g=[],h=0,m,p,f,z;h<e;h++){f=a[h]||Sa(b[h]);z=b[h]||Sa(f);if(f[0]!=z[0]||"r"==f[0].toLowerCase()&&(f[2]!=z[2]||f[3]!=z[3])||"s"==f[0].toLowerCase()&&(f[3]!=z[3]||f[4]!=z[4]))return;d[h]=[];g[h]=[];m=0;for(p=S(f.length,z.length);m<p;m++)m in f&&(d[h][m]=f[m]),m in z&&(g[h][m]=z[m])}return{from:d,
to:g}};r._getContainer=function(a,b,d,g){var h;h=null==g&&!r.is(a,"object")?e.doc.getElementById(a):a;if(null!=h)return h.tagName?null==b?{container:h,width:h.style.pixelWidth||h.offsetWidth,height:h.style.pixelHeight||h.offsetHeight}:{container:h,width:b,height:d}:{container:1,x:a,y:b,width:d,height:g}};r.pathToRelative=fb;r._engine={};r.path2curve=na;r.matrix=function(a,b,e,d,g,h){return new n(a,b,e,d,g,h)};(function(a){function b(a){var d=G.sqrt(e(a));a[0]&&(a[0]/=d);a[1]&&(a[1]/=d)}function e(a){return a[0]*
a[0]+a[1]*a[1]}a.add=function(a,b,e,d,g,h){var m=[[],[],[]],p=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]];b=[[a,e,g],[b,d,h],[0,0,1]];a&&a instanceof n&&(b=[[a.a,a.c,a.e],[a.b,a.d,a.f],[0,0,1]]);for(a=0;3>a;a++)for(e=0;3>e;e++){for(d=g=0;3>d;d++)g+=p[a][d]*b[d][e];m[a][e]=g}this.a=m[0][0];this.b=m[1][0];this.c=m[0][1];this.d=m[1][1];this.e=m[0][2];this.f=m[1][2]};a.invert=function(){var a=this.a*this.d-this.b*this.c;return new n(this.d/a,-this.b/a,-this.c/a,this.a/a,(this.c*this.f-this.d*
this.e)/a,(this.b*this.e-this.a*this.f)/a)};a.clone=function(){return new n(this.a,this.b,this.c,this.d,this.e,this.f)};a.translate=function(a,b){this.add(1,0,0,1,a,b)};a.scale=function(a,b,e,d){null==b&&(b=a);(e||d)&&this.add(1,0,0,1,e,d);this.add(a,0,0,b,0,0);(e||d)&&this.add(1,0,0,1,-e,-d)};a.rotate=function(a,b,e){a=r.rad(a);b=b||0;e=e||0;var d=+G.cos(a).toFixed(9);a=+G.sin(a).toFixed(9);this.add(d,a,-a,d,b,e);this.add(1,0,0,1,-b,-e)};a.x=function(a,b){return a*this.a+b*this.c+this.e};a.y=function(a,
b){return a*this.b+b*this.d+this.f};a.get=function(a){return+this[I.fromCharCode(97+a)].toFixed(4)};a.toString=function(){return r.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()};a.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"};
a.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]};a.split=function(){var a={};a.dx=this.e;a.dy=this.f;var d=[[this.a,this.c],[this.b,this.d]];a.scalex=G.sqrt(e(d[0]));b(d[0]);a.shear=d[0][0]*d[1][0]+d[0][1]*d[1][1];d[1]=[d[1][0]-d[0][0]*a.shear,d[1][1]-d[0][1]*a.shear];a.scaley=G.sqrt(e(d[1]));b(d[1]);a.shear/=a.scaley;var g=-d[0][1],d=d[1][1];0>d?(a.rotate=r.deg(G.acos(d)),0>g&&(a.rotate=360-a.rotate)):a.rotate=r.deg(G.asin(g));a.isSimple=!+a.shear.toFixed(9)&&(a.scalex.toFixed(9)==
a.scaley.toFixed(9)||!a.rotate);a.isSuperSimple=!+a.shear.toFixed(9)&&a.scalex.toFixed(9)==a.scaley.toFixed(9)&&!a.rotate;a.noRotation=!+a.shear.toFixed(9)&&!a.rotate;return a};a.toTransformString=function(a){a=a||this[H]();return a.isSimple?(a.scalex=+a.scalex.toFixed(4),a.scaley=+a.scaley.toFixed(4),a.rotate=+a.rotate.toFixed(4),(a.dx||a.dy?"t"+[a.dx,a.dy]:"")+(1!=a.scalex||1!=a.scaley?"s"+[a.scalex,a.scaley,0,0]:"")+(a.rotate?"r"+[a.rotate,0,0]:"")):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),
this.get(4),this.get(5)]}})(n.prototype);var ta=navigator.userAgent.match(/Version\/(.*?)\s/)||navigator.userAgent.match(/Chrome\/(\d+)/);"Apple Computer, Inc."==navigator.vendor&&(ta&&4>ta[1]||"iP"==navigator.platform.slice(0,2))||"Google Inc."==navigator.vendor&&ta&&8>ta[1]?A.safari=function(){var a=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout(function(){a.remove()})}:A.safari=cb;for(var hb=function(){this.returnValue=!1},ib=function(){this.cancelBubble=!0},jb=
function(){if(e.doc.addEventListener)return function(a,b,d,g){var h=function(a){return d.call(g,a,a.clientX+(e.doc.documentElement.scrollLeft||e.doc.body.scrollLeft),a.clientY+(e.doc.documentElement.scrollTop||e.doc.body.scrollTop))};a.addEventListener(b,h,!1);return function(){a.removeEventListener(b,h,!1);return!0}};if(e.doc.attachEvent)return function(a,b,d,g){var h=function(a){a=a||e.win.event;var b=a.clientX+(e.doc.documentElement.scrollLeft||e.doc.body.scrollLeft),h=a.clientY+(e.doc.documentElement.scrollTop||
e.doc.body.scrollTop);a.preventDefault=a.preventDefault||hb;a.stopPropagation=a.stopPropagation||ib;return d.call(g,a,b,h)};a.attachEvent("on"+b,h);return function(){a.detachEvent("on"+b,h);return!0}}}(),ia=[],Aa=function(a){for(var b=a.clientX,d=a.clientY,g=e.doc.documentElement.scrollTop||e.doc.body.scrollTop,h=e.doc.documentElement.scrollLeft||e.doc.body.scrollLeft,m,p=ia.length;p--;){m=ia[p];a.preventDefault();var f=m.el.node,z,q=f.nextSibling,l=f.parentNode,r=f.style.display;e.win.opera&&l.removeChild(f);
f.style.display="none";z=m.el.paper.getElementByPoint(b,d);f.style.display=r;e.win.opera&&(q?l.insertBefore(f,q):l.appendChild(f));z&&eve("raphael.drag.over."+m.el.id,m.el,z);b+=h;d+=g;eve("raphael.drag.move."+m.el.id,m.move_scope||m.el,b-m.el._drag.x,d-m.el._drag.y,b,d,a)}},Ba=function(a){r.unmousemove(Aa).unmouseup(Ba);for(var b=ia.length,e;b--;)e=ia[b],e.el._drag={},eve("raphael.drag.end."+e.el.id,e.end_scope||e.start_scope||e.move_scope||e.el,a);ia=[]},U=r.el={},Ta=N.length;Ta--;)(function(a){r[a]=
U[a]=function(b,d){r.is(b,"function")&&(this.events=this.events||[],this.events.push({name:a,f:b,unbind:jb(this.shape||this.node||e.doc,a,b,d||this)}));return this};r["un"+a]=U["un"+a]=function(b){for(var e=this.events||[],d=e.length;d--;)if(e[d].name==a&&e[d].f==b){e[d].unbind();e.splice(d,1);!e.length&&delete this.events;break}return this}})(N[Ta]);U.data=function(a,b){var e=ma[this.id]=ma[this.id]||{};if(1==arguments.length){if(r.is(a,"object")){for(var d in a)a[p](d)&&this.data(d,a[d]);return this}eve("raphael.data.get."+
this.id,this,e[a],a);return e[a]}e[a]=b;eve("raphael.data.set."+this.id,this,b,a);return this};U.removeData=function(a){null==a?ma[this.id]={}:ma[this.id]&&delete ma[this.id][a];return this};U.hover=function(a,b,e,d){return this.mouseover(a,e).mouseout(b,d||e)};U.unhover=function(a,b){return this.unmouseover(a).unmouseout(b)};var ka=[];U.drag=function(a,b,d,g,h,m){function p(f){(f.originalEvent||f).preventDefault();var z=e.doc.documentElement.scrollTop||e.doc.body.scrollTop,q=e.doc.documentElement.scrollLeft||
e.doc.body.scrollLeft;this._drag.x=f.clientX+q;this._drag.y=f.clientY+z;this._drag.id=f.identifier;!ia.length&&r.mousemove(Aa).mouseup(Ba);ia.push({el:this,move_scope:g,start_scope:h,end_scope:m});b&&eve.on("raphael.drag.start."+this.id,b);a&&eve.on("raphael.drag.move."+this.id,a);d&&eve.on("raphael.drag.end."+this.id,d);eve("raphael.drag.start."+this.id,h||g||this,f.clientX+q,f.clientY+z,f)}this._drag={};ka.push({el:this,start:p});this.mousedown(p);return this};U.onDragOver=function(a){a?eve.on("raphael.drag.over."+
this.id,a):eve.unbind("raphael.drag.over."+this.id)};U.undrag=function(){for(var a=ka.length;a--;)ka[a].el==this&&(this.unmousedown(ka[a].start),ka.splice(a,1),eve.unbind("raphael.drag.*."+this.id));!ka.length&&r.unmousemove(Aa).unmouseup(Ba)};A.circle=function(a,b,e){a=r._engine.circle(this,a||0,b||0,e||0);this.__set__&&this.__set__.push(a);return a};A.rect=function(a,b,e,d,g){a=r._engine.rect(this,a||0,b||0,e||0,d||0,g||0);this.__set__&&this.__set__.push(a);return a};A.ellipse=function(a,b,e,d){a=
r._engine.ellipse(this,a||0,b||0,e||0,d||0);this.__set__&&this.__set__.push(a);return a};A.path=function(a){a&&!r.is(a,"string")&&!r.is(a[0],W)&&(a+="");var b=r._engine.path(r.format[z](r,arguments),this);this.__set__&&this.__set__.push(b);return b};A.image=function(a,b,e,d,g){a=r._engine.image(this,a||"about:blank",b||0,e||0,d||0,g||0);this.__set__&&this.__set__.push(a);return a};A.text=function(a,b,e){a=r._engine.text(this,a||0,b||0,I(e));this.__set__&&this.__set__.push(a);return a};A.set=function(a){!r.is(a,
"array")&&(a=Array.prototype.splice.call(arguments,0,arguments.length));var b=new la(a);this.__set__&&this.__set__.push(b);return b};A.setStart=function(a){this.__set__=a||this.set()};A.setFinish=function(a){a=this.__set__;delete this.__set__;return a};A.setSize=function(a,b){return r._engine.setSize.call(this,a,b)};A.setViewBox=function(a,b,e,d,g){return r._engine.setViewBox.call(this,a,b,e,d,g)};A.top=A.bottom=null;A.raphael=r;A.getElementByPoint=function(a,b){var d,g,h=this.canvas,m=e.doc.elementFromPoint(a,
b);if(e.win.opera&&"svg"==m.tagName){g=h.getBoundingClientRect();d=h.ownerDocument;var p=d.body,f=d.documentElement;d=g.top+(e.win.pageYOffset||f.scrollTop||p.scrollTop)-(f.clientTop||p.clientTop||0);g=g.left+(e.win.pageXOffset||f.scrollLeft||p.scrollLeft)-(f.clientLeft||p.clientLeft||0);p=h.createSVGRect();p.x=a-g;p.y=b-d;p.width=p.height=1;d=h.getIntersectionList(p,null);d.length&&(m=d[d.length-1])}if(!m)return null;for(;m.parentNode&&m!=h.parentNode&&!m.raphael;)m=m.parentNode;m==this.canvas.parentNode&&
(m=h);return m=m&&m.raphael?this.getById(m.raphaelid):null};A.getById=function(a){for(var b=this.bottom;b;){if(b.id==a)return b;b=b.next}return null};A.forEach=function(a,b){for(var e=this.bottom;e&&!1!==a.call(b,e);)e=e.next;return this};A.getElementsByPoint=function(a,b){var e=this.set();this.forEach(function(d){d.isPointInside(a,b)&&e.push(d)});return e};U.isPointInside=function(a,b){var e=this.realPath=this.realPath||oa[this.type](this);return r.isPointInsidePath(e,a,b)};U.getBBox=function(a){if(this.removed)return{};
var b=this._;if(a){if(b.dirty||!b.bboxwt)this.realPath=oa[this.type](this),b.bboxwt=za(this.realPath),b.bboxwt.toString=l,b.dirty=0;return b.bboxwt}if(b.dirty||b.dirtyT||!b.bbox){if(b.dirty||!this.realPath)b.bboxwt=0,this.realPath=oa[this.type](this);b.bbox=za(xa(this.realPath,this.matrix));b.bbox.toString=l;b.dirty=b.dirtyT=0}return b.bbox};U.clone=function(){if(this.removed)return null;var a=this.paper[this.type]().attr(this.attr());this.__set__&&this.__set__.push(a);return a};U.glow=function(a){if("text"==
this.type)return null;a=a||{};var b=(a.width||10)+(+this.attr("stroke-width")||1),e=a.fill||!1,d=a.opacity||0.5,g=a.offsetx||0,h=a.offsety||0;a=a.color||"#000";for(var m=b/2,p=this.paper,f=p.set(),z=this.realPath||oa[this.type](this),z=this.matrix?xa(z,this.matrix):z,q=1;q<m+1;q++)f.push(p.path(z).attr({stroke:a,fill:e?a:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(b/m*q).toFixed(3),opacity:+(d/m).toFixed(3)}));return f.insertBefore(this).translate(g,h)};var Ca=function(a,
b,e,d,g,h,m,p,f){return null==f?y(a,b,e,d,g,h,m,p):r.findDotsAtSegment(a,b,e,d,g,h,m,p,s(a,b,e,d,g,h,m,p,f))},Da=function(a,b){return function(e,d,g){e=na(e);for(var h,m,p,f,z="",q={},l=0,u=0,n=e.length;u<n;u++){p=e[u];if("M"==p[0])h=+p[1],m=+p[2];else{f=Ca(h,m,p[1],p[2],p[3],p[4],p[5],p[6]);if(l+f>d){if(b&&!q.start){h=Ca(h,m,p[1],p[2],p[3],p[4],p[5],p[6],d-l);z+=["C"+h.start.x,h.start.y,h.m.x,h.m.y,h.x,h.y];if(g)return z;q.start=z;z=["M"+h.x,h.y+"C"+h.n.x,h.n.y,h.end.x,h.end.y,p[5],p[6]].join();
l+=f;h=+p[5];m=+p[6];continue}if(!a&&!b)return h=Ca(h,m,p[1],p[2],p[3],p[4],p[5],p[6],d-l),{x:h.x,y:h.y,alpha:h.alpha}}l+=f;h=+p[5];m=+p[6]}z+=p.shift()+p}q.end=z;h=a?l:b?q:r.findDotsAtSegment(h,m,p[0],p[1],p[2],p[3],p[4],p[5],1);h.alpha&&(h={x:h.x,y:h.y,alpha:h.alpha});return h}},Ua=Da(1),Va=Da(),Ea=Da(0,1);r.getTotalLength=Ua;r.getPointAtLength=Va;r.getSubpath=function(a,b,e){if(1E-6>this.getTotalLength(a)-e)return Ea(a,b).end;a=Ea(a,e,1);return b?Ea(a,b).end:a};U.getTotalLength=function(){if("path"==
this.type)return this.node.getTotalLength?this.node.getTotalLength():Ua(this.attrs.path)};U.getPointAtLength=function(a){if("path"==this.type)return Va(this.attrs.path,a)};U.getSubpath=function(a,b){if("path"==this.type)return r.getSubpath(this.attrs.path,a,b)};var ca=r.easing_formulas={linear:function(a){return a},"<":function(a){return M(a,1.7)},">":function(a){return M(a,0.48)},"<>":function(a){var b=0.48-a/1.04,e=G.sqrt(0.1734+b*b);a=e-b;a=M(K(a),1/3)*(0>a?-1:1);b=-e-b;b=M(K(b),1/3)*(0>b?-1:1);
a=a+b+0.5;return 3*(1-a)*a*a+a*a*a},backIn:function(a){return a*a*(2.70158*a-1.70158)},backOut:function(a){a-=1;return a*a*(2.70158*a+1.70158)+1},elastic:function(a){return a==!!a?a:M(2,-10*a)*G.sin(2*(a-0.075)*L/0.3)+1},bounce:function(a){var b;a<1/2.75?b=7.5625*a*a:a<2/2.75?(a-=1.5/2.75,b=7.5625*a*a+0.75):a<2.5/2.75?(a-=2.25/2.75,b=7.5625*a*a+0.9375):(a-=2.625/2.75,b=7.5625*a*a+0.984375);return b}};ca.easeIn=ca["ease-in"]=ca["<"];ca.easeOut=ca["ease-out"]=ca[">"];ca.easeInOut=ca["ease-in-out"]=
ca["<>"];ca["back-in"]=ca.backIn;ca["back-out"]=ca.backOut;var T=[],Ja=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){setTimeout(a,16)},va=function(){for(var a=+new Date,e=0;e<T.length;e++){var d=T[e];if(!d.el.removed&&!d.paused){var g=a-d.start,h=d.ms,m=d.easing,f=d.from,z=d.diff,q=d.to,l=d.el,u={},n,H={},v;d.initstatus?(g=(d.initstatus*d.anim.top-d.prev)/(d.percent-d.prev)*
h,d.status=d.initstatus,delete d.initstatus,d.stop&&T.splice(e--,1)):d.status=(d.prev+(d.percent-d.prev)*(g/h))/d.anim.top;if(!(0>g))if(g<h){var A=m(g/h),I;for(I in f)if(f[p](I)){switch(ga[I]){case O:n=+f[I]+A*h*z[I];break;case "colour":n="rgb("+[Fa(X(f[I].r+A*h*z[I].r)),Fa(X(f[I].g+A*h*z[I].g)),Fa(X(f[I].b+A*h*z[I].b))].join()+")";break;case "path":n=[];g=0;for(m=f[I].length;g<m;g++){n[g]=[f[I][g][0]];q=1;for(H=f[I][g].length;q<H;q++)n[g][q]=+f[I][g][q]+A*h*z[I][g][q];n[g]=n[g].join(R)}n=n.join(R);
break;case "transform":if(z[I].real){n=[];g=0;for(m=f[I].length;g<m;g++){n[g]=[f[I][g][0]];q=1;for(H=f[I][g].length;q<H;q++)n[g][q]=f[I][g][q]+A*h*z[I][g][q]}}else n=function(a){return+f[I][a]+A*h*z[I][a]},n=[["m",n(0),n(1),n(2),n(3),n(4),n(5)]];break;case "csv":if("clip-rect"==I){n=[];for(g=4;g--;)n[g]=+f[I][g]+A*h*z[I][g]}break;default:m=[][J](f[I]);n=[];for(g=l.paper.customAttributes[I].length;g--;)n[g]=+m[g]+A*h*z[I][g]}u[I]=n}l.attr(u);(function(a,b,e){setTimeout(function(){eve("raphael.anim.frame."+
a,b,e)})})(l.id,l,d.anim)}else{(function(a,b,e){setTimeout(function(){eve("raphael.anim.frame."+b.id,b,e);eve("raphael.anim.finish."+b.id,b,e);r.is(a,"function")&&a.call(b)})})(d.callback,l,d.anim);l.attr(q);T.splice(e--,1);if(1<d.repeat&&!d.next){for(v in q)q[p](v)&&(H[v]=d.totalOrigin[v]);d.el.attr(H);b(d.anim,d.el,d.anim.percents[0],null,d.totalOrigin,d.repeat-1)}d.next&&!d.stop&&b(d.anim,d.el,d.next,null,d.totalOrigin,d.repeat)}}}r.svg&&l&&l.paper&&l.paper.safari();T.length&&Ja(va)},Fa=function(a){return 255<
a?255:0>a?0:a};U.animateWith=function(a,e,g,h,m,p){if(this.removed)return p&&p.call(this),this;g=g instanceof d?g:r.animation(g,h,m,p);b(g,this,g.percents[0],null,this.attr());g=0;for(h=T.length;g<h;g++)if(T[g].anim==e&&T[g].el==a){T[h-1].start=T[g].start;break}return this};U.onAnimation=function(a){a?eve.on("raphael.anim.frame."+this.id,a):eve.unbind("raphael.anim.frame."+this.id);return this};d.prototype.delay=function(a){var b=new d(this.anim,this.ms);b.times=this.times;b.del=+a||0;return b};d.prototype.repeat=
function(a){var b=new d(this.anim,this.ms);b.del=this.del;b.times=G.floor(S(a,0))||1;return b};r.animation=function(a,b,e,g){if(a instanceof d)return a;if(r.is(e,"function")||!e)g=g||e||null,e=null;a=Object(a);b=+b||0;var h={},m,f;for(f in a)a[p](f)&&Q(f)!=f&&Q(f)+"%"!=f&&(m=!0,h[f]=a[f]);if(!m)return new d(a,b);e&&(h.easing=e);g&&(h.callback=g);return new d({100:h},b)};U.animate=function(a,e,g,h){if(this.removed)return h&&h.call(this),this;a=a instanceof d?a:r.animation(a,e,g,h);b(a,this,a.percents[0],
null,this.attr());return this};U.setTime=function(a,b){a&&null!=b&&this.status(a,C(b,a.ms)/a.ms);return this};U.status=function(a,e){var d=[],g=0,h,m;if(null!=e)return b(a,this,-1,C(e,1)),this;for(h=T.length;g<h;g++)if(m=T[g],m.el.id==this.id&&(!a||m.anim==a)){if(a)return m.status;d.push({anim:m.anim,status:m.status})}return a?0:d};U.pause=function(a){for(var b=0;b<T.length;b++)T[b].el.id==this.id&&(!a||T[b].anim==a)&&!1!==eve("raphael.anim.pause."+this.id,this,T[b].anim)&&(T[b].paused=!0);return this};
U.resume=function(a){for(var b=0;b<T.length;b++)if(T[b].el.id==this.id&&(!a||T[b].anim==a)){var e=T[b];!1!==eve("raphael.anim.resume."+this.id,this,e.anim)&&(delete e.paused,this.status(e.anim,e.status))}return this};U.stop=function(a){for(var b=0;b<T.length;b++)T[b].el.id==this.id&&(!a||T[b].anim==a)&&!1!==eve("raphael.anim.stop."+this.id,this,T[b].anim)&&T.splice(b--,1);return this};eve.on("raphael.remove",a);eve.on("raphael.clear",a);U.toString=function(){return"Rapha\u00ebl\u2019s object"};var la=
function(a){this.items=[];this.length=0;this.type="set";if(a)for(var b=0,e=a.length;b<e;b++)a[b]&&(a[b].constructor==U.constructor||a[b].constructor==la)&&(this[this.items.length]=this.items[this.items.length]=a[b],this.length++)},ba=la.prototype;ba.push=function(){for(var a,b,e=0,d=arguments.length;e<d;e++)(a=arguments[e])&&(a.constructor==U.constructor||a.constructor==la)&&(b=this.items.length,this[b]=this.items[b]=a,this.length++);return this};ba.pop=function(){this.length&&delete this[this.length--];
return this.items.pop()};ba.forEach=function(a,b){for(var e=0,d=this.items.length;e<d&&!1!==a.call(b,this.items[e],e);e++);return this};for(var Ga in U)U[p](Ga)&&(ba[Ga]=function(a){return function(){var b=arguments;return this.forEach(function(e){e[a][z](e,b)})}}(Ga));ba.attr=function(a,b){if(a&&r.is(a,W)&&r.is(a[0],"object"))for(var e=0,d=a.length;e<d;e++)this.items[e].attr(a[e]);else{e=0;for(d=this.items.length;e<d;e++)this.items[e].attr(a,b)}return this};ba.clear=function(){for(;this.length;)this.pop()};
ba.splice=function(a,b,e){a=0>a?S(this.length+a,0):a;b=S(0,C(this.length-a,b));var d=[],g=[],h=[],m;for(m=2;m<arguments.length;m++)h.push(arguments[m]);for(m=0;m<b;m++)g.push(this[a+m]);for(;m<this.length-a;m++)d.push(this[a+m]);var p=h.length;for(m=0;m<p+d.length;m++)this.items[a+m]=this[a+m]=m<p?h[m]:d[m-p];for(m=this.items.length=this.length-=b-p;this[m];)delete this[m++];return new la(g)};ba.exclude=function(a){for(var b=0,e=this.length;b<e;b++)if(this[b]==a)return this.splice(b,1),!0};ba.animate=
function(a,b,e,d){(r.is(e,"function")||!e)&&(d=e||null);var g=this.items.length,h=g,m=this,p;if(!g)return this;d&&(p=function(){!--g&&d.call(m)});e=r.is(e,"string")?e:p;b=r.animation(a,b,e,p);for(a=this.items[--h].animate(b);h--;)this.items[h]&&!this.items[h].removed&&this.items[h].animateWith(a,b,b);return this};ba.insertAfter=function(a){for(var b=this.items.length;b--;)this.items[b].insertAfter(a);return this};ba.getBBox=function(){for(var a=[],b=[],e=[],d=[],g=this.items.length;g--;)if(!this.items[g].removed){var h=
this.items[g].getBBox();a.push(h.x);b.push(h.y);e.push(h.x+h.width);d.push(h.y+h.height)}a=C[z](0,a);b=C[z](0,b);e=S[z](0,e);d=S[z](0,d);return{x:a,y:b,x2:e,y2:d,width:e-a,height:d-b}};ba.clone=function(a){a=new la;for(var b=0,e=this.items.length;b<e;b++)a.push(this.items[b].clone());return a};ba.toString=function(){return"Rapha\u00ebl\u2018s set"};r.registerFont=function(a){if(!a.face)return a;this.fonts=this.fonts||{};var b={w:a.w,face:{},glyphs:{}},e=a.face["font-family"],d;for(d in a.face)a.face[p](d)&&
(b.face[d]=a.face[d]);this.fonts[e]?this.fonts[e].push(b):this.fonts[e]=[b];if(!a.svg){b.face["units-per-em"]=da(a.face["units-per-em"],10);for(var g in a.glyphs)if(a.glyphs[p](g)&&(e=a.glyphs[g],b.glyphs[g]={w:e.w,k:{},d:e.d&&"M"+e.d.replace(/[mlcxtrv]/g,function(a){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[a]||"M"})+"z"},e.k))for(var h in e.k)e[p](h)&&(b.glyphs[g].k[h]=e.k[h])}return a};A.getFont=function(a,b,e,d){d=d||"normal";e=e||"normal";b=+b||{normal:400,bold:700,lighter:300,bolder:800}[b]||
400;if(r.fonts){var g=r.fonts[a];if(!g){a=RegExp("(^|\\s)"+a.replace(/[^\w\d\s+!~.:_-]/g,"")+"(\\s|$)","i");for(var h in r.fonts)if(r.fonts[p](h)&&a.test(h)){g=r.fonts[h];break}}var m;if(g){h=0;for(a=g.length;h<a&&!(m=g[h],m.face["font-weight"]==b&&(m.face["font-style"]==e||!m.face["font-style"])&&m.face["font-stretch"]==d);h++);}return m}};A.print=function(a,b,e,d,g,h,m){h=h||"middle";m=S(C(m||0,1),-1);var p=I(e)[H](""),f=0,z=0,q="";r.is(d,e)&&(d=this.getFont(d));if(d){e=(g||16)/d.face["units-per-em"];
var l=d.face.bbox[H](D);g=+l[0];var n=l[3]-l[1],u=0;h=+l[1]+("baseline"==h?n+ +d.face.descent:n/2);for(var l=0,v=p.length;l<v;l++){if("\n"==p[l])z=B=f=0,u+=n;else var A=z&&d.glyphs[p[l-1]]||{},B=d.glyphs[p[l]],f=f+(z?(A.w||d.w)+(A.k&&A.k[p[l]]||0)+d.w*m:0),z=1;B&&B.d&&(q+=r.transformPath(B.d,["t",f*e,u*e,"s",e,e,g,h,"t",(a-g)/e,(b-h)/e]))}}return this.path(q).attr({fill:"#000",stroke:"none"})};A.add=function(a){if(r.is(a,"array"))for(var b=this.set(),e=0,d=a.length,g;e<d;e++)g=a[e]||{},F[p](g.type)&&
b.push(this[g.type]().attr(g));return b};r.format=function(a,b){var e=r.is(b,W)?[0][J](b):arguments;a&&r.is(a,"string")&&e.length-1&&(a=a.replace(g,function(a,b){return null==e[++b]?"":e[b]}));return a||""};r.fullfill=function(){var a=/\{([^\}]+)\}/g,b=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,e=function(a,e,d){var g=d;e.replace(b,function(a,b,e,d,h){b=b||d;g&&(b in g&&(g=g[b]),"function"==typeof g&&h&&(g=g()))});return g=(null==g||g==d?a:g)+""};return function(b,d){return String(b).replace(a,
function(a,b){return e(a,b,d)})}}();r.ninja=function(){m?e.win.Raphael=h:delete Raphael;return r};r.st=ba;(function(a,b,e){function d(){/in/.test(a.readyState)?setTimeout(d,9):r.eve("raphael.DOMload")}null==a.readyState&&a.addEventListener&&(a.addEventListener(b,e=function(){a.removeEventListener(b,e,!1);a.readyState="complete"},!1),a.readyState="loading");d()})(document,"DOMContentLoaded");m?e.win.Raphael=r:Raphael=r;eve.on("raphael.DOMload",function(){B=!0})})();
window.Raphael.svg&&function(a){var b=String,d=parseFloat,f=parseInt,l=Math,n=l.max,t=l.abs,s=l.pow,y=/[, ]+/,w=a.eve,E={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},q={};a.toString=function(){return"Your browser supports SVG.\nYou are running Rapha\u00ebl "+this.version};var v=function(e,d){if(d){"string"==typeof e&&(e=v(e));for(var g in d)d.hasOwnProperty(g)&&("xlink:"==
g.substring(0,6)?e.setAttributeNS("http://www.w3.org/1999/xlink",g.substring(6),b(d[g])):e.setAttribute(g,b(d[g])))}else e=a._g.doc.createElementNS("http://www.w3.org/2000/svg",e),e.style&&(e.style.webkitTapHighlightColor="rgba(0,0,0,0)");return e},r=function(e,g){var h="linear",m=e.id+g,p=0.5,f=0.5,q=e.node,u=e.paper,r=q.style,A=a._g.doc.getElementById(m);if(!A){g=b(g).replace(a._radial_gradient,function(a,b,e){h="radial";b&&e&&(p=d(b),f=d(e),a=2*(0.5<f)-1,0.25<s(p-0.5,2)+s(f-0.5,2)&&(f=l.sqrt(0.25-
s(p-0.5,2))*a+0.5)&&0.5!=f&&(f=f.toFixed(5)-1E-5*a));return""});g=g.split(/\s*\-\s*/);if("linear"==h){A=g.shift();A=-d(A);if(isNaN(A))return null;var B=[0,0,l.cos(a.rad(A)),l.sin(a.rad(A))],A=1/(n(t(B[2]),t(B[3]))||1);B[2]*=A;B[3]*=A;0>B[2]&&(B[0]=-B[2],B[2]=0);0>B[3]&&(B[1]=-B[3],B[3]=0)}var w=a._parseDots(g);if(!w)return null;m=m.replace(/[\(\)\s,\xb0#]/g,"_");e.gradient&&m!=e.gradient.id&&(u.defs.removeChild(e.gradient),delete e.gradient);if(!e.gradient){A=v(h+"Gradient",{id:m});e.gradient=A;v(A,
"radial"==h?{fx:p,fy:f}:{x1:B[0],y1:B[1],x2:B[2],y2:B[3],gradientTransform:e.matrix.invert()});u.defs.appendChild(A);u=0;for(B=w.length;u<B;u++)A.appendChild(v("stop",{offset:w[u].offset?w[u].offset:u?"100%":"0%","stop-color":w[u].color||"#fff"}))}}v(q,{fill:"url(#"+m+")",opacity:1,"fill-opacity":1});r.fill="";r.opacity=1;return r.fillOpacity=1},B=function(a){var b=a.getBBox(1);v(a.pattern,{patternTransform:a.matrix.invert()+" translate("+b.x+","+b.y+")"})},D=function(e,d,g){if("path"==e.type){for(var h=
b(d).toLowerCase().split("-"),m=e.paper,p=g?"end":"start",f=e.node,l=e.attrs,n=l["stroke-width"],u=h.length,r="classic",A,B,s,t,w,y=3,F=3,D=5;u--;)switch(h[u]){case "block":case "classic":case "oval":case "diamond":case "open":case "none":r=h[u];break;case "wide":F=5;break;case "narrow":F=2;break;case "long":y=5;break;case "short":y=2}"open"==r?(y+=2,F+=2,D+=2,s=1,t=g?4:1,w={fill:"none",stroke:l.stroke}):(t=s=y/2,w={fill:l.stroke,stroke:"none"});e._.arrows?g?(e._.arrows.endPath&&q[e._.arrows.endPath]--,
e._.arrows.endMarker&&q[e._.arrows.endMarker]--):(e._.arrows.startPath&&q[e._.arrows.startPath]--,e._.arrows.startMarker&&q[e._.arrows.startMarker]--):e._.arrows={};if("none"!=r){h="raphael-marker-"+r;u="raphael-marker-"+p+r+y+F;a._g.doc.getElementById(h)?q[h]++:(m.defs.appendChild(v(v("path"),{"stroke-linecap":"round",d:E[r],id:h})),q[h]=1);var X=a._g.doc.getElementById(u),Q;X?(q[u]++,Q=X.getElementsByTagName("use")[0]):(X=v(v("marker"),{id:u,markerHeight:F,markerWidth:y,orient:"auto",refX:t,refY:F/
2}),Q=v(v("use"),{"xlink:href":"#"+h,transform:(g?"rotate(180 "+y/2+" "+F/2+") ":"")+"scale("+y/D+","+F/D+")","stroke-width":(1/((y/D+F/D)/2)).toFixed(4)}),X.appendChild(Q),m.defs.appendChild(X),q[u]=1);v(Q,w);m=s*("diamond"!=r&&"oval"!=r);g?(A=e._.arrows.startdx*n||0,B=a.getTotalLength(l.path)-m*n):(A=m*n,B=a.getTotalLength(l.path)-(e._.arrows.enddx*n||0));w={};w["marker-"+p]="url(#"+u+")";if(B||A)w.d=Raphael.getSubpath(l.path,A,B);v(f,w);e._.arrows[p+"Path"]=h;e._.arrows[p+"Marker"]=u;e._.arrows[p+
"dx"]=m;e._.arrows[p+"Type"]=r;e._.arrows[p+"String"]=d}else g?(A=e._.arrows.startdx*n||0,B=a.getTotalLength(l.path)-A):(A=0,B=a.getTotalLength(l.path)-(e._.arrows.enddx*n||0)),e._.arrows[p+"Path"]&&v(f,{d:Raphael.getSubpath(l.path,A,B)}),delete e._.arrows[p+"Path"],delete e._.arrows[p+"Marker"],delete e._.arrows[p+"dx"],delete e._.arrows[p+"Type"],delete e._.arrows[p+"String"];for(w in q)q.hasOwnProperty(w)&&!q[w]&&(e=a._g.doc.getElementById(w))&&e.parentNode.removeChild(e)}},F={"":[0],none:[0],
"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},g=function(a,e,d){if(e=F[b(e).toLowerCase()]){var g=a.attrs["stroke-width"]||"1";d={round:g,square:g,butt:0}[a.attrs["stroke-linecap"]||d["stroke-linecap"]]||0;for(var h=[],m=e.length;m--;)h[m]=e[m]*g+(m%2?1:-1)*d;v(a.node,{"stroke-dasharray":h.join(",")})}},p=function(d,h){var m=d.node,p=d.attrs,q=m.style.visibility;m.style.visibility="hidden";for(var l in h)if(h.hasOwnProperty(l)&&
a._availableAttrs.hasOwnProperty(l)){var u=h[l];p[l]=u;switch(l){case "blur":d.blur(u);break;case "href":case "title":case "target":var A=m.parentNode;if("a"!=A.tagName.toLowerCase()){var s=v("a");A.insertBefore(s,m);s.appendChild(m);A=s}"target"==l?A.setAttributeNS("http://www.w3.org/1999/xlink","show","blank"==u?"new":u):A.setAttributeNS("http://www.w3.org/1999/xlink",l,u);break;case "cursor":m.style.cursor=u;break;case "transform":d.transform(u);break;case "arrow-start":D(d,u);break;case "arrow-end":D(d,
u,1);break;case "clip-rect":A=b(u).split(y);if(4==A.length){d.clip&&d.clip.parentNode.parentNode.removeChild(d.clip.parentNode);var s=v("clipPath"),w=v("rect");s.id=a.createUUID();v(w,{x:A[0],y:A[1],width:A[2],height:A[3]});s.appendChild(w);d.paper.defs.appendChild(s);v(m,{"clip-path":"url(#"+s.id+")"});d.clip=w}if(!u&&(u=m.getAttribute("clip-path")))(u=a._g.doc.getElementById(u.replace(/(^url\(#|\)$)/g,"")))&&u.parentNode.removeChild(u),v(m,{"clip-path":""}),delete d.clip;break;case "path":"path"==
d.type&&(v(m,{d:u?p.path=a._pathToAbsolute(u):"M0,0"}),d._.dirty=1,d._.arrows&&("startString"in d._.arrows&&D(d,d._.arrows.startString),"endString"in d._.arrows&&D(d,d._.arrows.endString,1)));break;case "width":if(m.setAttribute(l,u),d._.dirty=1,p.fx)l="x",u=p.x;else break;case "x":p.fx&&(u=-p.x-(p.width||0));case "rx":if("rx"==l&&"rect"==d.type)break;case "cx":m.setAttribute(l,u);d.pattern&&B(d);d._.dirty=1;break;case "height":if(m.setAttribute(l,u),d._.dirty=1,p.fy)l="y",u=p.y;else break;case "y":p.fy&&
(u=-p.y-(p.height||0));case "ry":if("ry"==l&&"rect"==d.type)break;case "cy":m.setAttribute(l,u);d.pattern&&B(d);d._.dirty=1;break;case "r":"rect"==d.type?v(m,{rx:u,ry:u}):m.setAttribute(l,u);d._.dirty=1;break;case "src":"image"==d.type&&m.setAttributeNS("http://www.w3.org/1999/xlink","href",u);break;case "stroke-width":if(1!=d._.sx||1!=d._.sy)u/=n(t(d._.sx),t(d._.sy))||1;d.paper._vbSize&&(u*=d.paper._vbSize);m.setAttribute(l,u);p["stroke-dasharray"]&&g(d,p["stroke-dasharray"],h);d._.arrows&&("startString"in
d._.arrows&&D(d,d._.arrows.startString),"endString"in d._.arrows&&D(d,d._.arrows.endString,1));break;case "stroke-dasharray":g(d,u,h);break;case "fill":var F=b(u).match(a._ISURL);if(F){var s=v("pattern"),E=v("image");s.id=a.createUUID();v(s,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1});v(E,{x:0,y:0,"xlink:href":F[1]});s.appendChild(E);(function(b){a._preload(F[1],function(){var a=this.offsetWidth,e=this.offsetHeight;v(b,{width:a,height:e});v(E,{width:a,height:e});d.paper.safari()})})(s);
d.paper.defs.appendChild(s);v(m,{fill:"url(#"+s.id+")"});d.pattern=s;d.pattern&&B(d);break}A=a.getRGB(u);if(A.error){if(("circle"==d.type||"ellipse"==d.type||"r"!=b(u).charAt())&&r(d,u)){if("opacity"in p||"fill-opacity"in p)if(A=a._g.doc.getElementById(m.getAttribute("fill").replace(/^url\(#|\)$/g,""))){var L=A.getElementsByTagName("stop");v(L[L.length-1],{"stop-opacity":("opacity"in p?p.opacity:1)*("fill-opacity"in p?p["fill-opacity"]:1)})}p.gradient=u;p.fill="none";break}}else delete h.gradient,
delete p.gradient,!a.is(p.opacity,"undefined")&&a.is(h.opacity,"undefined")&&v(m,{opacity:p.opacity}),!a.is(p["fill-opacity"],"undefined")&&a.is(h["fill-opacity"],"undefined")&&v(m,{"fill-opacity":p["fill-opacity"]});A.hasOwnProperty("opacity")&&v(m,{"fill-opacity":1<A.opacity?A.opacity/100:A.opacity});case "stroke":A=a.getRGB(u);m.setAttribute(l,A.hex);"stroke"==l&&A.hasOwnProperty("opacity")&&v(m,{"stroke-opacity":1<A.opacity?A.opacity/100:A.opacity});"stroke"==l&&d._.arrows&&("startString"in d._.arrows&&
D(d,d._.arrows.startString),"endString"in d._.arrows&&D(d,d._.arrows.endString,1));break;case "gradient":("circle"==d.type||"ellipse"==d.type||"r"!=b(u).charAt())&&r(d,u);break;case "opacity":p.gradient&&!p.hasOwnProperty("stroke-opacity")&&v(m,{"stroke-opacity":1<u?u/100:u});case "fill-opacity":if(p.gradient){(A=a._g.doc.getElementById(m.getAttribute("fill").replace(/^url\(#|\)$/g,"")))&&(L=A.getElementsByTagName("stop"),v(L[L.length-1],{"stop-opacity":u}));break}default:"font-size"==l&&(u=f(u,10)+
"px"),A=l.replace(/(\-.)/g,function(a){return a.substring(1).toUpperCase()}),m.style[A]=u,d._.dirty=1,m.setAttribute(l,u)}}e(d,h);m.style.visibility=q},e=function(e,d){if("text"==e.type&&(d.hasOwnProperty("text")||d.hasOwnProperty("font")||d.hasOwnProperty("font-size")||d.hasOwnProperty("x")||d.hasOwnProperty("y"))){var g=e.attrs,h=e.node,m=h.firstChild?f(a._g.doc.defaultView.getComputedStyle(h.firstChild,"").getPropertyValue("font-size"),10):10;if(d.hasOwnProperty("text")){for(g.text=d.text;h.firstChild;)h.removeChild(h.firstChild);
for(var p=b(d.text).split("\n"),q=[],l,u=0,n=p.length;u<n;u++)l=v("tspan"),u&&v(l,{dy:1.2*m,x:g.x}),l.appendChild(a._g.doc.createTextNode(p[u])),h.appendChild(l),q[u]=l}else{q=h.getElementsByTagName("tspan");u=0;for(n=q.length;u<n;u++)u?v(q[u],{dy:1.2*m,x:g.x}):v(q[0],{dy:0})}v(h,{x:g.x,y:g.y});e._.dirty=1;h=e._getBBox();(g=g.y-(h.y+h.height/2))&&a.is(g,"finite")&&v(q[0],{dy:g})}},m=function(b,e){this[0]=this.node=b;b.raphael=!0;this.id=a._oid++;b.raphaelid=this.id;this.matrix=a.matrix();this.realPath=
null;this.paper=e;this.attrs=this.attrs||{};this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1};!e.bottom&&(e.bottom=this);(this.prev=e.top)&&(e.top.next=this);e.top=this;this.next=null},h=a.el;m.prototype=h;h.constructor=m;a._engine.path=function(a,b){var e=v("path");b.canvas&&b.canvas.appendChild(e);e=new m(e,b);e.type="path";p(e,{fill:"none",stroke:"#000",path:a});return e};h.rotate=function(a,e,g){if(this.removed)return this;a=b(a).split(y);a.length-1&&(e=d(a[1]),g=d(a[2]));a=d(a[0]);null==
g&&(e=g);if(null==e||null==g)g=this.getBBox(1),e=g.x+g.width/2,g=g.y+g.height/2;this.transform(this._.transform.concat([["r",a,e,g]]));return this};h.scale=function(a,e,g,h){if(this.removed)return this;a=b(a).split(y);a.length-1&&(e=d(a[1]),g=d(a[2]),h=d(a[3]));a=d(a[0]);null==e&&(e=a);null==h&&(g=h);if(null==g||null==h)var m=this.getBBox(1);g=null==g?m.x+m.width/2:g;h=null==h?m.y+m.height/2:h;this.transform(this._.transform.concat([["s",a,e,g,h]]));return this};h.translate=function(a,e){if(this.removed)return this;
a=b(a).split(y);a.length-1&&(e=d(a[1]));a=d(a[0])||0;this.transform(this._.transform.concat([["t",a,+e||0]]));return this};h.transform=function(b){var e=this._;if(null==b)return e.transform;a._extractTransform(this,b);this.clip&&v(this.clip,{transform:this.matrix.invert()});this.pattern&&B(this);this.node&&v(this.node,{transform:this.matrix});if(1!=e.sx||1!=e.sy)b=this.attrs.hasOwnProperty("stroke-width")?this.attrs["stroke-width"]:1,this.attr({"stroke-width":b});return this};h.hide=function(){!this.removed&&
this.paper.safari(this.node.style.display="none");return this};h.show=function(){!this.removed&&this.paper.safari(this.node.style.display="");return this};h.remove=function(){if(!this.removed&&this.node.parentNode){var b=this.paper;b.__set__&&b.__set__.exclude(this);w.unbind("raphael.*.*."+this.id);this.gradient&&b.defs.removeChild(this.gradient);a._tear(this,b);"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.removeChild(this.node.parentNode):this.node.parentNode.removeChild(this.node);
for(var e in this)this[e]="function"==typeof this[e]?a._removedFactory(e):null;this.removed=!0}};h._getBBox=function(){if("none"==this.node.style.display){this.show();var a=!0}var b={};try{b=this.node.getBBox()}catch(e){}finally{b=b||{}}a&&this.hide();return b};h.attr=function(b,e){if(this.removed)return this;if(null==b){var d={},g;for(g in this.attrs)this.attrs.hasOwnProperty(g)&&(d[g]=this.attrs[g]);d.gradient&&"none"==d.fill&&(d.fill=d.gradient)&&delete d.gradient;d.transform=this._.transform;
return d}if(null==e&&a.is(b,"string")){if("fill"==b&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;if("transform"==b)return this._.transform;g=b.split(y);for(var d={},h=0,m=g.length;h<m;h++)b=g[h],b in this.attrs?d[b]=this.attrs[b]:a.is(this.paper.customAttributes[b],"function")?d[b]=this.paper.customAttributes[b].def:d[b]=a._availableAttrs[b];return m-1?d:d[g[0]]}if(null==e&&a.is(b,"array")){d={};h=0;for(m=b.length;h<m;h++)d[b[h]]=this.attr(b[h]);return d}null!=e?(d={},
d[b]=e):null!=b&&a.is(b,"object")&&(d=b);for(h in d)w("raphael.attr."+h+"."+this.id,this,d[h]);for(h in this.paper.customAttributes)if(this.paper.customAttributes.hasOwnProperty(h)&&d.hasOwnProperty(h)&&a.is(this.paper.customAttributes[h],"function"))for(m in g=this.paper.customAttributes[h].apply(this,[].concat(d[h])),this.attrs[h]=d[h],g)g.hasOwnProperty(m)&&(d[m]=g[m]);p(this,d);return this};h.toFront=function(){if(this.removed)return this;"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.appendChild(this.node.parentNode):
this.node.parentNode.appendChild(this.node);var b=this.paper;b.top!=this&&a._tofront(this,b);return this};h.toBack=function(){if(this.removed)return this;var b=this.node.parentNode;"a"==b.tagName.toLowerCase()?b.parentNode.insertBefore(this.node.parentNode,this.node.parentNode.parentNode.firstChild):b.firstChild!=this.node&&b.insertBefore(this.node,this.node.parentNode.firstChild);a._toback(this,this.paper);return this};h.insertAfter=function(b){if(this.removed)return this;var e=b.node||b[b.length-
1].node;e.nextSibling?e.parentNode.insertBefore(this.node,e.nextSibling):e.parentNode.appendChild(this.node);a._insertafter(this,b,this.paper);return this};h.insertBefore=function(b){if(this.removed)return this;var e=b.node||b[0].node;e.parentNode.insertBefore(this.node,e);a._insertbefore(this,b,this.paper);return this};h.blur=function(b){if(0!==+b){var e=v("filter"),d=v("feGaussianBlur");this.attrs.blur=b;e.id=a.createUUID();v(d,{stdDeviation:+b||1.5});e.appendChild(d);this.paper.defs.appendChild(e);
this._blur=e;v(this.node,{filter:"url(#"+e.id+")"})}else this._blur&&(this._blur.parentNode.removeChild(this._blur),delete this._blur,delete this.attrs.blur),this.node.removeAttribute("filter")};a._engine.circle=function(a,b,e,d){var g=v("circle");a.canvas&&a.canvas.appendChild(g);a=new m(g,a);a.attrs={cx:b,cy:e,r:d,fill:"none",stroke:"#000"};a.type="circle";v(g,a.attrs);return a};a._engine.rect=function(a,b,e,d,g,h){var p=v("rect");a.canvas&&a.canvas.appendChild(p);a=new m(p,a);a.attrs={x:b,y:e,
width:d,height:g,r:h||0,rx:h||0,ry:h||0,fill:"none",stroke:"#000"};a.type="rect";v(p,a.attrs);return a};a._engine.ellipse=function(a,b,e,d,g){var h=v("ellipse");a.canvas&&a.canvas.appendChild(h);a=new m(h,a);a.attrs={cx:b,cy:e,rx:d,ry:g,fill:"none",stroke:"#000"};a.type="ellipse";v(h,a.attrs);return a};a._engine.image=function(a,b,e,d,g,h){var p=v("image");v(p,{x:e,y:d,width:g,height:h,preserveAspectRatio:"none"});p.setAttributeNS("http://www.w3.org/1999/xlink","href",b);a.canvas&&a.canvas.appendChild(p);
a=new m(p,a);a.attrs={x:e,y:d,width:g,height:h,src:b};a.type="image";return a};a._engine.text=function(b,e,d,g){var h=v("text");b.canvas&&b.canvas.appendChild(h);b=new m(h,b);b.attrs={x:e,y:d,"text-anchor":"middle",text:g,font:a._availableAttrs.font,stroke:"none",fill:"#000"};b.type="text";p(b,b.attrs);return b};a._engine.setSize=function(a,b){this.width=a||this.width;this.height=b||this.height;this.canvas.setAttribute("width",this.width);this.canvas.setAttribute("height",this.height);this._viewBox&&
this.setViewBox.apply(this,this._viewBox);return this};a._engine.create=function(){var b=a._getContainer.apply(0,arguments),e=b&&b.container,d=b.x,g=b.y,h=b.width,b=b.height;if(!e)throw Error("SVG container not found.");var m=v("svg"),p,d=d||0,g=g||0,h=h||512,b=b||342;v(m,{height:b,version:1.1,width:h,xmlns:"http://www.w3.org/2000/svg"});1==e?(m.style.cssText="overflow:hidden;position:absolute;left:"+d+"px;top:"+g+"px",a._g.doc.body.appendChild(m),p=1):(m.style.cssText="overflow:hidden;position:relative",
e.firstChild?e.insertBefore(m,e.firstChild):e.appendChild(m));e=new a._Paper;e.width=h;e.height=b;e.canvas=m;e.clear();e._left=e._top=0;p&&(e.renderfix=function(){});e.renderfix();return e};a._engine.setViewBox=function(a,b,e,d,g){w("raphael.setViewBox",this,this._viewBox,[a,b,e,d,g]);var h=n(e/this.width,d/this.height),m=this.top,p=g?"meet":"xMinYMin",f;null==a?(this._vbSize&&(h=1),delete this._vbSize,f="0 0 "+this.width+" "+this.height):(this._vbSize=h,f=a+" "+b+" "+e+" "+d);for(v(this.canvas,{viewBox:f,
preserveAspectRatio:p});h&&m;)p="stroke-width"in m.attrs?m.attrs["stroke-width"]:1,m.attr({"stroke-width":p}),m._.dirty=1,m._.dirtyT=1,m=m.prev;this._viewBox=[a,b,e,d,!!g];return this};a.prototype.renderfix=function(){var a=this.canvas,b=a.style,e;try{e=a.getScreenCTM()||a.createSVGMatrix()}catch(d){e=a.createSVGMatrix()}a=-e.e%1;e=-e.f%1;if(a||e)a&&(this._left=(this._left+a)%1,b.left=this._left+"px"),e&&(this._top=(this._top+e)%1,b.top=this._top+"px")};a.prototype.clear=function(){a.eve("raphael.clear",
this);for(var b=this.canvas;b.firstChild;)b.removeChild(b.firstChild);this.bottom=this.top=null;(this.desc=v("desc")).appendChild(a._g.doc.createTextNode("Created with Rapha\u00ebl "+a.version));b.appendChild(this.desc);b.appendChild(this.defs=v("defs"))};a.prototype.remove=function(){w("raphael.remove",this);this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var b in this)this[b]="function"==typeof this[b]?a._removedFactory(b):null};var u=a.st,A;for(A in h)h.hasOwnProperty(A)&&
!u.hasOwnProperty(A)&&(u[A]=function(a){return function(){var b=arguments;return this.forEach(function(e){e[a].apply(e,b)})}}(A))}(window.Raphael);
window.Raphael.vml&&function(a){var b=String,d=parseFloat,f=Math,l=f.round,n=f.max,t=f.min,s=f.abs,y=/[, ]+/,w=a.eve,E={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},q=/([clmz]),?([^clmz]*)/gi,v=/ progid:\S+Blur\([^\)]+\)/g,r=/-?[^,\s-]+/g,B={path:1,rect:1,image:1},D={circle:1,ellipse:1},F=function(e){var d=/[ahqstv]/ig,g=a._pathToAbsolute;b(e).match(d)&&(g=a._path2curve);d=/[clmz]/g;if(g==a._pathToAbsolute&&!b(e).match(d))return e=b(e).replace(q,function(a,b,e){var d=[],g="m"==b.toLowerCase(),
h=E[b];e.replace(r,function(a){g&&2==d.length&&(h+=d+E["m"==b?"l":"L"],d=[]);d.push(l(21600*a))});return h+d});var d=g(e),h;e=[];for(var m=0,p=d.length;m<p;m++){g=d[m];h=d[m][0].toLowerCase();"z"==h&&(h="x");for(var f=1,u=g.length;f<u;f++)h+=l(21600*g[f])+(f!=u-1?",":"");e.push(h)}return e.join(" ")},g=function(b,e,d){var g=a.matrix();g.rotate(-b,0.5,0.5);return{dx:g.x(e,d),dy:g.y(e,d)}},p=function(a,b,e,d,h,m){var p=a._,f=a.matrix,q=p.fillpos;a=a.node;var l=a.style,u=1,n="",r=21600/b,A=21600/e;l.visibility=
"hidden";if(b&&e){a.coordsize=s(r)+" "+s(A);l.rotation=m*(0>b*e?-1:1);if(m){var v=g(m,d,h);d=v.dx;h=v.dy}0>b&&(n+="x");0>e&&(n+=" y")&&(u=-1);l.flip=n;a.coordorigin=d*-r+" "+h*-A;if(q||p.fillsize)d=(d=a.getElementsByTagName("fill"))&&d[0],a.removeChild(d),q&&(v=g(m,f.x(q[0],q[1]),f.y(q[0],q[1])),d.position=v.dx*u+" "+v.dy*u),p.fillsize&&(d.size=p.fillsize[0]*s(b)+" "+p.fillsize[1]*s(e)),a.appendChild(d);l.visibility="visible"}};a.toString=function(){return"Your browser doesn\u2019t support SVG. Falling down to VML.\nYou are running Rapha\u00ebl "+
this.version};var e=function(a,e,d){e=b(e).toLowerCase().split("-");d=d?"end":"start";for(var g=e.length,h="classic",m="medium",p="medium";g--;)switch(e[g]){case "block":case "classic":case "oval":case "diamond":case "open":case "none":h=e[g];break;case "wide":case "narrow":p=e[g];break;case "long":case "short":m=e[g]}a=a.node.getElementsByTagName("stroke")[0];a[d+"arrow"]=h;a[d+"arrowlength"]=m;a[d+"arrowwidth"]=p},m=function(g,m){g.attrs=g.attrs||{};var f=g.node,q=g.attrs,u=f.style,r=B[g.type]&&
(m.x!=q.x||m.y!=q.y||m.width!=q.width||m.height!=q.height||m.cx!=q.cx||m.cy!=q.cy||m.rx!=q.rx||m.ry!=q.ry||m.r!=q.r),A=D[g.type]&&(q.cx!=m.cx||q.cy!=m.cy||q.r!=m.r||q.rx!=m.rx||q.ry!=m.ry),v;for(v in m)m.hasOwnProperty(v)&&(q[v]=m[v]);r&&(q.path=a._getPath[g.type](g),g._.dirty=1);m.href&&(f.href=m.href);m.title&&(f.title=m.title);m.target&&(f.target=m.target);m.cursor&&(u.cursor=m.cursor);"blur"in m&&g.blur(m.blur);if(m.path&&"path"==g.type||r)f.path=F(~b(q.path).toLowerCase().indexOf("r")?a._pathToAbsolute(q.path):
q.path),"image"==g.type&&(g._.fillpos=[q.x,q.y],g._.fillsize=[q.width,q.height],p(g,1,1,0,0,0));"transform"in m&&g.transform(m.transform);A&&(u=+q.cx,r=+q.cy,A=+q.rx||+q.r||0,v=+q.ry||+q.r||0,f.path=a.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",l(21600*(u-A)),l(21600*(r-v)),l(21600*(u+A)),l(21600*(r+v)),l(21600*u)));"clip-rect"in m&&(u=b(m["clip-rect"]).split(y),4==u.length&&(u[2]=+u[2]+ +u[0],u[3]=+u[3]+ +u[1],r=f.clipRect||a._g.doc.createElement("div"),A=r.style,A.clip=a.format("rect({1}px {2}px {3}px {0}px)",
u),f.clipRect||(A.position="absolute",A.top=0,A.left=0,A.width=g.paper.width+"px",A.height=g.paper.height+"px",f.parentNode.insertBefore(r,f),r.appendChild(f),f.clipRect=r)),m["clip-rect"]||f.clipRect&&(f.clipRect.style.clip="auto"));g.textpath&&(u=g.textpath.style,m.font&&(u.font=m.font),m["font-family"]&&(u.fontFamily='"'+m["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,"")+'"'),m["font-size"]&&(u.fontSize=m["font-size"]),m["font-weight"]&&(u.fontWeight=m["font-weight"]),m["font-style"]&&
(u.fontStyle=m["font-style"]));"arrow-start"in m&&e(g,m["arrow-start"]);"arrow-end"in m&&e(g,m["arrow-end"],1);if(null!=m.opacity||null!=m["stroke-width"]||null!=m.fill||null!=m.src||null!=m.stroke||null!=m["stroke-width"]||null!=m["stroke-opacity"]||null!=m["fill-opacity"]||null!=m["stroke-dasharray"]||null!=m["stroke-miterlimit"]||null!=m["stroke-linejoin"]||null!=m["stroke-linecap"]){u=(u=f.getElementsByTagName("fill"))&&u[0];!u&&(u=z("fill"));"image"==g.type&&m.src&&(u.src=m.src);m.fill&&(u.on=
!0);if(null==u.on||"none"==m.fill||null===m.fill)u.on=!1;u.on&&m.fill&&((r=b(m.fill).match(a._ISURL))?(u.parentNode==f&&f.removeChild(u),u.rotate=!0,u.src=r[1],u.type="tile",A=g.getBBox(1),u.position=A.x+" "+A.y,g._.fillpos=[A.x,A.y],a._preload(r[1],function(){g._.fillsize=[this.offsetWidth,this.offsetHeight]})):(u.color=a.getRGB(m.fill).hex,u.src="",u.type="solid",a.getRGB(m.fill).error&&(g.type in{circle:1,ellipse:1}||"r"!=b(m.fill).charAt())&&h(g,m.fill,u)&&(q.fill="none",q.gradient=m.fill,u.rotate=
!1)));if("fill-opacity"in m||"opacity"in m)A=((+q["fill-opacity"]+1||2)-1)*((+q.opacity+1||2)-1)*((+a.getRGB(m.fill).o+1||2)-1),A=t(n(A,0),1),u.opacity=A,u.src&&(u.color="none");f.appendChild(u);u=f.getElementsByTagName("stroke")&&f.getElementsByTagName("stroke")[0];r=!1;!u&&(r=u=z("stroke"));if(m.stroke&&"none"!=m.stroke||m["stroke-width"]||null!=m["stroke-opacity"]||m["stroke-dasharray"]||m["stroke-miterlimit"]||m["stroke-linejoin"]||m["stroke-linecap"])u.on=!0;("none"==m.stroke||null===m.stroke||
null==u.on||0==m.stroke||0==m["stroke-width"])&&(u.on=!1);A=a.getRGB(m.stroke);u.on&&m.stroke&&(u.color=A.hex);A=((+q["stroke-opacity"]+1||2)-1)*((+q.opacity+1||2)-1)*((+A.o+1||2)-1);v=0.75*(d(m["stroke-width"])||1);A=t(n(A,0),1);null==m["stroke-width"]&&(v=q["stroke-width"]);m["stroke-width"]&&(u.weight=v);v&&1>v&&(A*=v)&&(u.weight=1);u.opacity=A;m["stroke-linejoin"]&&(u.joinstyle=m["stroke-linejoin"]||"miter");u.miterlimit=m["stroke-miterlimit"]||8;m["stroke-linecap"]&&(u.endcap="butt"==m["stroke-linecap"]?
"flat":"square"==m["stroke-linecap"]?"square":"round");m["stroke-dasharray"]&&(A={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"},u.dashstyle=A.hasOwnProperty(m["stroke-dasharray"])?A[m["stroke-dasharray"]]:"");r&&f.appendChild(u)}if("text"==g.type){g.paper.canvas.style.display="";f=g.paper.span;r=q.font&&q.font.match(/\d+(?:\.\d*)?(?=px)/);u=f.style;q.font&&(u.font=q.font);
q["font-family"]&&(u.fontFamily=q["font-family"]);q["font-weight"]&&(u.fontWeight=q["font-weight"]);q["font-style"]&&(u.fontStyle=q["font-style"]);r=d(q["font-size"]||r&&r[0])||10;u.fontSize=100*r+"px";g.textpath.string&&(f.innerHTML=b(g.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));f=f.getBoundingClientRect();g.W=q.w=(f.right-f.left)/100;g.H=q.h=(f.bottom-f.top)/100;g.X=q.x;g.Y=q.y+g.H/2;("x"in m||"y"in m)&&(g.path.v=a.format("m{0},{1}l{2},{1}",l(21600*q.x),
l(21600*q.y),l(21600*q.x)+1));f="x y text font font-family font-weight font-style font-size".split(" ");u=0;for(r=f.length;u<r;u++)if(f[u]in m){g._.dirty=1;break}switch(q["text-anchor"]){case "start":g.textpath.style["v-text-align"]="left";g.bbx=g.W/2;break;case "end":g.textpath.style["v-text-align"]="right";g.bbx=-g.W/2;break;default:g.textpath.style["v-text-align"]="center",g.bbx=0}g.textpath.style["v-text-kern"]=!0}},h=function(e,g,h){e.attrs=e.attrs||{};var m=Math.pow,p="linear",q=".5 .5";e.attrs.gradient=
g;g=b(g).replace(a._radial_gradient,function(a,b,e){p="radial";b&&e&&(b=d(b),e=d(e),0.25<m(b-0.5,2)+m(e-0.5,2)&&(e=f.sqrt(0.25-m(b-0.5,2))*(2*(0.5<e)-1)+0.5),q=b+" "+e);return""});g=g.split(/\s*\-\s*/);if("linear"==p){var u=g.shift(),u=-d(u);if(isNaN(u))return null}g=a._parseDots(g);if(!g)return null;e=e.shape||e.node;if(g.length){e.removeChild(h);h.on=!0;h.method="none";h.color=g[0].color;h.color2=g[g.length-1].color;for(var l=[],r=0,n=g.length;r<n;r++)g[r].offset&&l.push(g[r].offset+" "+g[r].color);
h.colors=l.length?l.join():"0% "+h.color;"radial"==p?(h.type="gradientTitle",h.focus="100%",h.focussize="0 0",h.focusposition=q,h.angle=0):(h.type="gradient",h.angle=(270-u)%360);e.appendChild(h)}return 1},u=function(b,e){this[0]=this.node=b;b.raphael=!0;this.id=a._oid++;b.raphaelid=this.id;this.Y=this.X=0;this.attrs={};this.paper=e;this.matrix=a.matrix();this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1};!e.bottom&&(e.bottom=this);(this.prev=e.top)&&(e.top.next=this);e.top=this;this.next=
null},A=a.el;u.prototype=A;A.constructor=u;A.transform=function(e){if(null==e)return this._.transform;var d=this.paper._viewBoxShift,g=d?"s"+[d.scale,d.scale]+"-1-1t"+[d.dx,d.dy]:"",h;d&&(h=e=b(e).replace(/\.{3}|\u2026/g,this._.transform||""));a._extractTransform(this,g+e);var d=this.matrix.clone(),m=this.skew;e=this.node;var g=~b(this.attrs.fill).indexOf("-"),f=!b(this.attrs.fill).indexOf("url(");d.translate(-0.5,-0.5);f||g||"image"==this.type?(m.matrix="1 0 0 1",m.offset="0 0",m=d.split(),g&&m.noRotation||
!m.isSimple?(e.style.filter=d.toFilter(),g=this.getBBox(),m=this.getBBox(1),d=g.x-m.x,g=g.y-m.y,e.coordorigin=-21600*d+" "+-21600*g,p(this,1,1,d,g,0)):(e.style.filter="",p(this,m.scalex,m.scaley,m.dx,m.dy,m.rotate))):(e.style.filter="",m.matrix=b(d),m.offset=d.offset());h&&(this._.transform=h);return this};A.rotate=function(a,e,g){if(this.removed)return this;if(null!=a){a=b(a).split(y);a.length-1&&(e=d(a[1]),g=d(a[2]));a=d(a[0]);null==g&&(e=g);if(null==e||null==g)g=this.getBBox(1),e=g.x+g.width/2,
g=g.y+g.height/2;this._.dirtyT=1;this.transform(this._.transform.concat([["r",a,e,g]]));return this}};A.translate=function(a,e){if(this.removed)return this;a=b(a).split(y);a.length-1&&(e=d(a[1]));a=d(a[0])||0;e=+e||0;this._.bbox&&(this._.bbox.x+=a,this._.bbox.y+=e);this.transform(this._.transform.concat([["t",a,e]]));return this};A.scale=function(a,e,g,h){if(this.removed)return this;a=b(a).split(y);a.length-1&&(e=d(a[1]),g=d(a[2]),h=d(a[3]),isNaN(g)&&(g=null),isNaN(h)&&(h=null));a=d(a[0]);null==e&&
(e=a);null==h&&(g=h);if(null==g||null==h)var m=this.getBBox(1);g=null==g?m.x+m.width/2:g;h=null==h?m.y+m.height/2:h;this.transform(this._.transform.concat([["s",a,e,g,h]]));this._.dirtyT=1;return this};A.hide=function(){!this.removed&&(this.node.style.display="none");return this};A.show=function(){!this.removed&&(this.node.style.display="");return this};A._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}};A.remove=function(){if(!this.removed&&
this.node.parentNode){this.paper.__set__&&this.paper.__set__.exclude(this);a.eve.unbind("raphael.*.*."+this.id);a._tear(this,this.paper);this.node.parentNode.removeChild(this.node);this.shape&&this.shape.parentNode.removeChild(this.shape);for(var b in this)this[b]="function"==typeof this[b]?a._removedFactory(b):null;this.removed=!0}};A.attr=function(b,e){if(this.removed)return this;if(null==b){var d={},g;for(g in this.attrs)this.attrs.hasOwnProperty(g)&&(d[g]=this.attrs[g]);d.gradient&&"none"==d.fill&&
(d.fill=d.gradient)&&delete d.gradient;d.transform=this._.transform;return d}if(null==e&&a.is(b,"string")){if("fill"==b&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;g=b.split(y);for(var d={},h=0,p=g.length;h<p;h++)b=g[h],b in this.attrs?d[b]=this.attrs[b]:a.is(this.paper.customAttributes[b],"function")?d[b]=this.paper.customAttributes[b].def:d[b]=a._availableAttrs[b];return p-1?d:d[g[0]]}if(this.attrs&&null==e&&a.is(b,"array")){d={};h=0;for(p=b.length;h<p;h++)d[b[h]]=this.attr(b[h]);
return d}null!=e&&(d={},d[b]=e);null==e&&a.is(b,"object")&&(d=b);for(h in d)w("raphael.attr."+h+"."+this.id,this,d[h]);if(d){for(h in this.paper.customAttributes)if(this.paper.customAttributes.hasOwnProperty(h)&&d.hasOwnProperty(h)&&a.is(this.paper.customAttributes[h],"function"))for(p in g=this.paper.customAttributes[h].apply(this,[].concat(d[h])),this.attrs[h]=d[h],g)g.hasOwnProperty(p)&&(d[p]=g[p]);d.text&&"text"==this.type&&(this.textpath.string=d.text);m(this,d)}return this};A.toFront=function(){!this.removed&&
this.node.parentNode.appendChild(this.node);this.paper&&this.paper.top!=this&&a._tofront(this,this.paper);return this};A.toBack=function(){if(this.removed)return this;this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),a._toback(this,this.paper));return this};A.insertAfter=function(b){if(this.removed)return this;b.constructor==a.st.constructor&&(b=b[b.length-1]);b.node.nextSibling?b.node.parentNode.insertBefore(this.node,b.node.nextSibling):
b.node.parentNode.appendChild(this.node);a._insertafter(this,b,this.paper);return this};A.insertBefore=function(b){if(this.removed)return this;b.constructor==a.st.constructor&&(b=b[0]);b.node.parentNode.insertBefore(this.node,b.node);a._insertbefore(this,b,this.paper);return this};A.blur=function(b){var e=this.node.runtimeStyle,d=e.filter,d=d.replace(v,"");0!==+b?(this.attrs.blur=b,e.filter=d+"  progid:DXImageTransform.Microsoft.Blur(pixelradius="+(+b||1.5)+")",e.margin=a.format("-{0}px 0 0 -{0}px",
l(+b||1.5))):(e.filter=d,e.margin=0,delete this.attrs.blur)};a._engine.path=function(a,b){var e=z("shape");e.style.cssText="position:absolute;left:0;top:0;width:1px;height:1px";e.coordsize="21600 21600";e.coordorigin=b.coordorigin;var d=new u(e,b),g={fill:"none",stroke:"#000"};a&&(g.path=a);d.type="path";d.path=[];d.Path="";m(d,g);b.canvas.appendChild(e);g=z("skew");g.on=!0;e.appendChild(g);d.skew=g;d.transform("");return d};a._engine.rect=function(b,e,d,g,h,m){var p=a._rectPath(e,d,g,h,m);b=b.path(p);
var f=b.attrs;b.X=f.x=e;b.Y=f.y=d;b.W=f.width=g;b.H=f.height=h;f.r=m;f.path=p;b.type="rect";return b};a._engine.ellipse=function(a,b,e,d,g){a=a.path();a.X=b-d;a.Y=e-g;a.W=2*d;a.H=2*g;a.type="ellipse";m(a,{cx:b,cy:e,rx:d,ry:g});return a};a._engine.circle=function(a,b,e,d){a=a.path();a.X=b-d;a.Y=e-d;a.W=a.H=2*d;a.type="circle";m(a,{cx:b,cy:e,r:d});return a};a._engine.image=function(b,e,d,g,h,m){var f=a._rectPath(d,g,h,m);b=b.path(f).attr({stroke:"none"});var q=b.attrs,u=b.node,l=u.getElementsByTagName("fill")[0];
q.src=e;b.X=q.x=d;b.Y=q.y=g;b.W=q.width=h;b.H=q.height=m;q.path=f;b.type="image";l.parentNode==u&&u.removeChild(l);l.rotate=!0;l.src=e;l.type="tile";b._.fillpos=[d,g];b._.fillsize=[h,m];u.appendChild(l);p(b,1,1,0,0,0);return b};a._engine.text=function(e,d,g,h){var p=z("shape"),f=z("path"),q=z("textpath");d=d||0;g=g||0;h=h||"";f.v=a.format("m{0},{1}l{2},{1}",l(21600*d),l(21600*g),l(21600*d)+1);f.textpathok=!0;q.string=b(h);q.on=!0;p.style.cssText="position:absolute;left:0;top:0;width:1px;height:1px";
p.coordsize="21600 21600";p.coordorigin="0 0";var r=new u(p,e),n={fill:"#000",stroke:"none",font:a._availableAttrs.font,text:h};r.shape=p;r.path=f;r.textpath=q;r.type="text";r.attrs.text=b(h);r.attrs.x=d;r.attrs.y=g;r.attrs.w=1;r.attrs.h=1;m(r,n);p.appendChild(q);p.appendChild(f);e.canvas.appendChild(p);e=z("skew");e.on=!0;p.appendChild(e);r.skew=e;r.transform("");return r};a._engine.setSize=function(b,e){var d=this.canvas.style;this.width=b;this.height=e;b==+b&&(b+="px");e==+e&&(e+="px");d.width=
b;d.height=e;d.clip="rect(0 "+b+" "+e+" 0)";this._viewBox&&a._engine.setViewBox.apply(this,this._viewBox);return this};a._engine.setViewBox=function(b,e,d,g,h){a.eve("raphael.setViewBox",this,this._viewBox,[b,e,d,g,h]);var m=this.width,p=this.height,f=1/n(d/m,g/p),q,u;h&&(q=p/g,u=m/d,d*q<m&&(b-=(m-d*q)/2/q),g*u<p&&(e-=(p-g*u)/2/u));this._viewBox=[b,e,d,g,!!h];this._viewBoxShift={dx:-b,dy:-e,scale:f};this.forEach(function(a){a.transform("...")});return this};var z;a._engine.initWin=function(a){var b=
a.document;b.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!b.namespaces.rvml&&b.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),z=function(a){return b.createElement("<rvml:"+a+' class="rvml">')}}catch(e){z=function(a){return b.createElement("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}};a._engine.initWin(a._g.win);a._engine.create=function(){var b=a._getContainer.apply(0,arguments),e=b.container,d=b.height,g=b.width,h=b.x,b=b.y;if(!e)throw Error("VML container not found.");
var m=new a._Paper,p=m.canvas=a._g.doc.createElement("div"),f=p.style,h=h||0,b=b||0,g=g||512,d=d||342;m.width=g;m.height=d;g==+g&&(g+="px");d==+d&&(d+="px");m.coordsize="21600000 21600000";m.coordorigin="0 0";m.span=a._g.doc.createElement("span");m.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;";p.appendChild(m.span);f.cssText=a.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",
g,d);1==e?(a._g.doc.body.appendChild(p),f.left=h+"px",f.top=b+"px",f.position="absolute"):e.firstChild?e.insertBefore(p,e.firstChild):e.appendChild(p);m.renderfix=function(){};return m};a.prototype.clear=function(){a.eve("raphael.clear",this);this.canvas.innerHTML="";this.span=a._g.doc.createElement("span");this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;";this.canvas.appendChild(this.span);this.bottom=this.top=null};a.prototype.remove=
function(){a.eve("raphael.remove",this);this.canvas.parentNode.removeChild(this.canvas);for(var b in this)this[b]="function"==typeof this[b]?a._removedFactory(b):null;return!0};var J=a.st,R;for(R in A)A.hasOwnProperty(R)&&!J.hasOwnProperty(R)&&(J[R]=function(a){return function(){var b=arguments;return this.forEach(function(e){e[a].apply(e,b)})}}(R))}(window.Raphael);/*

 marked - a markdown parser
 Copyright (c) 2011-2013, Christopher Jeffrey. (MIT Licensed)
*/
(function(){function a(a){this.tokens=[];this.tokens.links={};this.options=a||y.defaults;this.rules=w.normal;this.options.gfm&&(this.rules=this.options.tables?w.tables:w.gfm)}function b(a,b){this.options=b||y.defaults;this.links=a;this.rules=E.normal;this.renderer=this.options.renderer||new d;if(!this.links)throw Error("Tokens array requires a `links` property.");this.options.gfm?this.rules=this.options.breaks?E.breaks:E.gfm:this.options.pedantic&&(this.rules=E.pedantic)}function d(){}function f(a){this.tokens=
[];this.token=null;this.options=a||y.defaults;this.options.renderer=this.options.renderer||new d;this.renderer=this.options.renderer}function l(a,b){return a.replace(!b?/&(?!#?\w+;)/g:/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function n(a,b){a=a.source;b=b||"";return function B(d,f){if(!d)return RegExp(a,b);f=f.source||f;f=f.replace(/(^|[^\[])\^/g,"$1");a=a.replace(d,f);return B}}function t(){}function s(a){for(var b=1,d,f;b<arguments.length;b++)for(f in d=
arguments[b],d)Object.prototype.hasOwnProperty.call(d,f)&&(a[f]=d[f]);return a}function y(b,d,r){if(r||"function"===typeof d){r||(r=d,d=null);d=s({},y.defaults,d||{});var n=d.highlight,t;try{t=a.lex(b,d)}catch(w){return r(w)}var g,p;try{g=f.parse(t,d)}catch(e){p=e}d.highlight=n;return p?r(p):r(null,g)}try{return d&&(d=s({},y.defaults,d)),f.parse(a.lex(b,d),d)}catch(m){m.message+="\nPlease report this to https://github.com/chjj/marked.";if((d||y.defaults).silent)return"<p>An error occured:</p><pre>"+
l(m.message+"",!0)+"</pre>";throw m;}}var w={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:t,hr:/^( *[-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,nptable:t,lheading:/^([^\n]+)\n *(=|-){2,} *(?:\n+|$)/,blockquote:/^( *>[^\n]+(\n[^\n]+)*\n*)+/,list:/^( *)(bull) [\s\S]+?(?:hr|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment|closed|closing) *(?:\n{2,}|\s*$)/,def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +["(']([^\n]+)[")'])?imgsize *(?:\n+|$)/,table:t,paragraph:/^((?:[^\n]+\n?(?!hr|heading|lheading|blockquote|tag|def))+)\n*/,
text:/^[^\n]+/,_imgsize:/(\s+([0-9]+)\s*x?\s*([0-9]+)?)?/};w.def=n(w.def)("imgsize",w._imgsize)();w.taskbullet=/(- \[([xX/\\ ])\])/;w.olbullet=/\d+\.|taskbullet/;w.bullet=/(?:taskbullet|[*+-]|olbullet)/;w.bullet=n(w.bullet)("olbullet",w.olbullet)("taskbullet",w.taskbullet)();w.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/;w.item=n(w.item,"gm")(/bull/g,w.bullet)();w.list=n(w.list)(/bull/g,w.bullet)("hr",/\n+(?=(?: *[-*_]){3,} *(?:\n+|$))/)();w._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|@)\\b";
w.html=n(w.html)("comment",/\x3c!--[\s\S]*?--\x3e/)("closed",/<(tag)[\s\S]+?<\/\1>/)("closing",/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,w._tag)();w.paragraph=n(w.paragraph)("hr",w.hr)("heading",w.heading)("lheading",w.lheading)("blockquote",w.blockquote)("tag","<"+w._tag)("def",w.def)();w.normal=s({},w);w.gfm=s({},w.normal,{fences:/^ *(`{3,}|~{3,}) *(\S+)? *\n([\s\S]+?)\s*\1 *(?:\n+|$)/,paragraph:/^/});w.gfm.paragraph=n(w.paragraph)("(?!","(?!"+w.gfm.fences.source.replace("\\1","\\2")+"|"+w.list.source.replace("\\1",
"\\3")+"|")();w.tables=s({},w.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/});a.rules=w;a.lex=function(b,d){return(new a(d)).lex(b)};a.prototype.lex=function(a){a=a.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n");return this.token(a,!0)};a.prototype.token=function(a,b){a=a.replace(/^ +$/gm,"");for(var d,f,l,n,g,p,e,m,h;a;){if(l=this.rules.newline.exec(a))a=
a.substring(l[0].length),1<l[0].length&&this.tokens.push({type:"space"});if(l=this.rules.code.exec(a))a=a.substring(l[0].length),l=l[0].replace(/^ {4}/gm,""),this.tokens.push({type:"code",text:!this.options.pedantic?l.replace(/\n+$/,""):l});else if(l=this.rules.fences.exec(a))a=a.substring(l[0].length),this.tokens.push({type:"code",lang:l[2],text:l[3]});else if(l=this.rules.heading.exec(a))a=a.substring(l[0].length),this.tokens.push({type:"heading",depth:l[1].length,text:l[2]});else if(b&&(l=this.rules.nptable.exec(a))){a=
a.substring(l[0].length);e={type:"table",header:l[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:l[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:l[3].replace(/\n$/,"").split("\n")};for(m=0;m<e.align.length;m++)/^ *-+: *$/.test(e.align[m])?e.align[m]="right":/^ *:-+: *$/.test(e.align[m])?e.align[m]="center":/^ *:-+ *$/.test(e.align[m])?e.align[m]="left":e.align[m]=null;for(m=0;m<e.cells.length;m++)e.cells[m]=e.cells[m].split(/ *\| */);this.tokens.push(e)}else if(l=this.rules.lheading.exec(a))a=
a.substring(l[0].length),this.tokens.push({type:"heading",depth:"="===l[2]?1:2,text:l[1]});else if(l=this.rules.hr.exec(a))a=a.substring(l[0].length),this.tokens.push({type:"hr"});else if(l=this.rules.blockquote.exec(a))a=a.substring(l[0].length),this.tokens.push({type:"blockquote_start"}),l=l[0].replace(/^ *> ?/gm,""),this.token(l,b),this.tokens.push({type:"blockquote_end"});else if(l=this.rules.list.exec(a)){a=a.substring(l[0].length);n=l[2];g=w.taskbullet.exec(n);this.tokens.push({type:"list_start",
ordered:w.olbullet.test(n),olstart:n.replace(/[^0-9]/,""),tasklist:!!g});l=l[0].match(this.rules.item);d=!1;h=l.length;for(m=0;m<h;m++){e=l[m];f=e.length;p=w.bullet.exec(e)[0];e=e.replace(p,"");p=w.taskbullet.exec(p);~e.indexOf("\n ")&&(f-=e.length,e=!this.options.pedantic?e.replace(RegExp("^ {1,"+f+"}","gm"),""):e.replace(/^ {1,4}/gm,""));if(this.options.smartLists&&m!==h-1&&(f=w.bullet.exec(l[m+1])[0],n!==f&&(!p||!g)&&!(1<n.length&&1<f.length)))a=l.slice(m+1).join("\n")+a,m=h-1;f=d||/\n\n(?!\s*$)/.test(e);
m!==h-1&&(d="\n"===e.charAt(e.length-1),f||(f=d));this.tokens.push({type:f?"loose_item_start":"list_item_start",taskstate:p?p[2]:void 0});this.token(e,!1);this.tokens.push({type:"list_item_end"})}this.tokens.push({type:"list_end"})}else if(l=this.rules.html.exec(a))a=a.substring(l[0].length),this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:"pre"===l[1]||"script"===l[1]||"style"===l[1],text:l[0]});else if(b&&(l=this.rules.def.exec(a)))a=a.substring(l[0].length),this.tokens.links[l[1].toLowerCase()]=
{href:l[2],title:l[3]};else if(b&&(l=this.rules.table.exec(a))){a=a.substring(l[0].length);e={type:"table",header:l[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:l[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:l[3].replace(/(?: *\| *)?\n$/,"").split("\n")};for(m=0;m<e.align.length;m++)/^ *-+: *$/.test(e.align[m])?e.align[m]="right":/^ *:-+: *$/.test(e.align[m])?e.align[m]="center":/^ *:-+ *$/.test(e.align[m])?e.align[m]="left":e.align[m]=null;for(m=0;m<e.cells.length;m++)e.cells[m]=e.cells[m].replace(/^ *\| *| *\| *$/g,
"").split(/ *\| */);this.tokens.push(e)}else if(b&&(l=this.rules.paragraph.exec(a)))a=a.substring(l[0].length),this.tokens.push({type:"paragraph",text:"\n"===l[1].charAt(l[1].length-1)?l[1].slice(0,-1):l[1]});else if(l=this.rules.text.exec(a))a=a.substring(l[0].length),this.tokens.push({type:"text",text:l[0]});else if(a)throw Error("Infinite loop on byte: "+a.charCodeAt(0));}return this.tokens};var E={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ >]+(@|:\/)[^ >]+|#([^ >]+))>/,url:t,tag:/^\x3c!--[\s\S]*?--\x3e|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,
link:/^!?\[(inside)\]\(hrefimgsize\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^\b_((?:__|[\s\S])+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,code:/^(`+)\s*([\s\S]*?[^`])\s*\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:t,text:/^[\s\S]+?(?=[\\<!\[_*`]| {2,}\n|$)/,latex:/^(\$\$([\s\S]*?)\$\$|\\\\\[([\s\S]*?)\\\\\]|\\\\\(([\s\S]*?)\\\\\))/,_inside:/(?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*/,_href:/\s*<?([\s\S]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/};
E.link=n(E.link)("inside",E._inside)("href",E._href)("imgsize",w._imgsize)();E.reflink=n(E.reflink)("inside",E._inside)();E.normal=s({},E);E.pedantic=s({},E.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/});E.gfm=s({},E.normal,{escape:n(E.escape)("])","~|])")(),url:/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:n(E.text)("]|","~]|")("|","|https?://|")()});E.breaks=s({},E.gfm,{br:n(E.br)("{2,}",
"*")(),text:n(E.gfm.text)("{2,}","*")()});b.rules=E;b.output=function(a,d,f){return(new b(d,f)).output(a)};b.prototype.output=function(a){for(var b="",d,f;a;)if(f=this.rules.latex.exec(a)){a=a.substring(f[0].length);for(d=f[0];d;)if(f=this.rules.escape.exec(d))d=d.substring(f[0].length),b+=f[1];else if(f=this.rules.text.exec(d))d=d.substring(f[0].length),b+=f[0];else if(d)throw Error("Infinite loop on latex byte: "+d.charCodeAt(0));}else if(f=this.rules.escape.exec(a))a=a.substring(f[0].length),b+=
f[1];else if(f=this.rules.autolink.exec(a))a=a.substring(f[0].length),"@"===f[2]?(f=":"===f[1].charAt(6)?this.mangle(f[1].substring(7)):this.mangle(f[1]),d=this.mangle("mailto:")+f):d=f=l(f[1]),b+=this.renderer.link(d,null,f);else if(f=this.rules.url.exec(a))a=a.substring(f[0].length),d=f=l(f[1]),b+=this.renderer.link(d,null,f);else if(f=this.rules.tag.exec(a))a=a.substring(f[0].length),b+=this.options.sanitize?l(f[0]):f[0];else if(f=this.rules.link.exec(a))a=a.substring(f[0].length),b+=this.outputLink(f,
{href:f[2],title:f[3],width:f[5],height:f[6]});else if((f=this.rules.reflink.exec(a))||(f=this.rules.nolink.exec(a)))a=a.substring(f[0].length),d=(f[2]||f[1]).replace(/\s+/g," "),d=this.links[d.toLowerCase()],!d||!d.href?(b+=f[0].charAt(0),a=f[0].substring(1)+a):b+=this.outputLink(f,d);else if(f=this.rules.strong.exec(a))a=a.substring(f[0].length),b+=this.renderer.strong(this.output(f[2]||f[1]));else if(f=this.rules.em.exec(a))a=a.substring(f[0].length),b+=this.renderer.em(this.output(f[2]||f[1]));
else if(f=this.rules.code.exec(a))a=a.substring(f[0].length),b+=this.renderer.codespan(l(f[2],!0));else if(f=this.rules.br.exec(a))a=a.substring(f[0].length),b+=this.renderer.br();else if(f=this.rules.del.exec(a))a=a.substring(f[0].length),b+=this.renderer.del(this.output(f[1]));else if(f=this.rules.text.exec(a))a=a.substring(f[0].length),b+=l(this.smartypants(f[0]));else if(a)throw Error("Infinite loop on byte: "+a.charCodeAt(0));return b};b.prototype.outputLink=function(a,b){var d=l(b.href),f=b.title?
l(b.title):null,n=b.width?l(b.width)+"px":null,s=b.height?l(b.height)+"px":null;d.split(":")[0].toLowerCase()in{javascript:1,data:1}&&(d=d.replace(/[^:]*/,"http"));return"!"!==a[0].charAt(0)?this.renderer.link(d,f,this.output(a[1])):this.renderer.image(d,f,l(a[1]),n,s)};b.prototype.smartypants=function(a){return!this.options.smartypants?a:a.replace(/--/g,"\u2014").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1\u2018").replace(/'/g,"\u2019").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1\u201c").replace(/"/g,"\u201d").replace(/\.{3}/g,
"\u2026")};b.prototype.mangle=function(a){for(var b="",d=a.length,f=0,l;f<d;f++)l=a.charCodeAt(f),0.5<Math.random()&&(l="x"+l.toString(16)),b+="&#"+l+";";return b};d.prototype.code=function(a,b){return!b?"<pre><code>"+l(a,!0)+"\n</code></pre>":'<pre><code class="lang-'+b+'">'+l(a)+"\n</code></pre>\n"};d.prototype.blockquote=function(a){return"<blockquote>\n"+a+"</blockquote>\n"};d.prototype.html=function(a){return a};d.prototype.heading=function(a,b,d,f){return"<h"+b+">"+a+"</h"+b+">\n"};d.prototype.hr=
function(){return"<hr>\n"};d.prototype.list=function(a,b,d,f){b=b?'ol start="'+d+'"':"ul";return"<"+b+(f?' class = "tasklist"':"")+">\n"+a+"</"+b+">\n"};d.prototype.listitem=function(a){return"<li>"+a+"</li>\n"};d.prototype.checkbox=function(a){var b;b='<input type="checkbox" class="tasklist-checkbox"';a&&(b+=" checked");return b+">"};d.prototype.paragraph=function(a){return"<p>"+a+"</p>\n"};d.prototype.table=function(a,b){return"<table>\n<thead>\n"+a+"</thead>\n<tbody>\n"+b+"</tbody>\n</table>\n"};
d.prototype.tablerow=function(a){return"<tr>\n"+a+"</tr>\n"};d.prototype.tablecell=function(a,b){var d=b.header?"th":"td";return(b.align?"<"+d+' style="text-align:'+b.align+'">':"<"+d+">")+a+"</"+d+">\n"};d.prototype.strong=function(a){return"<strong>"+a+"</strong>"};d.prototype.em=function(a){return"<em>"+a+"</em>"};d.prototype.codespan=function(a){return"<code>"+a+"</code>"};d.prototype.br=function(){return"<br>"};d.prototype.del=function(a){return"<del>"+a+"</del>"};d.prototype.link=function(a,
b,d){a='<a href="'+a+'"';b&&(a+=' title="'+b+'"');return a+(">"+d+"</a>")};d.prototype.image=function(a,b,d,f,l){a='<img src="'+a+'" alt="'+d+'"';b&&(a+=' title="'+b+'"');f&&(a+=' width="'+f+'"');l&&(a+=' width="'+l+'"');return a+">"};f.parse=function(a,b,d){return(new f(b,d)).parse(a)};f.prototype.parse=function(a){this.inline=new b(a.links,this.options,this.renderer);this.tokens=a.reverse();for(a="";this.next();)a+=this.tok();return a};f.prototype.next=function(){return this.token=this.tokens.pop()};
f.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0};f.prototype.parseText=function(){for(var a=this.token.text;"text"===this.peek().type;)a+="\n"+this.next().text;return this.inline.output(a)};f.prototype.tok=function(){switch(this.token.type){case "space":return"";case "hr":return this.renderer.hr();case "heading":return this.renderer.heading(this.inline.output(this.token.text),this.token.depth);case "code":return this.renderer.code(this.token.text,this.token.lang);case "table":var a=
"",b="",d,f,l,n;l="";for(d=0;d<this.token.header.length;d++)l+=this.renderer.tablecell(this.inline.output(this.token.header[d]),{header:!0,align:this.token.align[d]});a+=this.renderer.tablerow(l);for(d=0;d<this.token.cells.length;d++){f=this.token.cells[d];l="";for(n=0;n<f.length;n++)l+=this.renderer.tablecell(this.inline.output(f[n]),{header:!1,align:this.token.align[n]});b+=this.renderer.tablerow(l)}return this.renderer.table(a,b);case "blockquote_start":for(b="";"blockquote_end"!==this.next().type;)b+=
this.tok();return this.renderer.blockquote(b);case "list_start":b="";a=this.token.ordered;d=!isNaN(this.token.olstart)?this.token.olstart:1;for(f=this.token.tasklist;"list_end"!==this.next().type;)b+=this.tok();return this.renderer.list(b,a,d,f);case "list_item_start":b="";a="undefined"!==typeof this.token.taskstate;d=this.token.taskstate&&/\S/.test(this.token.taskstate);for(a&&(b+=this.renderer.checkbox(d));"list_item_end"!==this.next().type;)b+="text"===this.token.type?this.parseText():this.tok();
return this.renderer.listitem(b);case "loose_item_start":b="";a="undefined"!==typeof this.token.taskstate;d=this.token.taskstate&&/\S/.test(this.token.taskstate);for(a&&(b+=this.renderer.checkbox(d));"list_item_end"!==this.next().type;)b+=this.tok();return this.renderer.listitem(b);case "html":return b=!this.token.pre&&!this.options.pedantic?this.inline.output(this.token.text):this.token.text,this.renderer.html(b);case "paragraph":return this.renderer.paragraph(this.inline.output(this.token.text));
case "text":return this.renderer.paragraph(this.parseText())}};t.exec=t;y.options=y.setOptions=function(a){s(y.defaults,a);return y};y.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!1,silent:!1,smartypants:!1,renderer:new d};y.Parser=f;y.parser=f.parse;y.Renderer=d;y.Lexer=a;y.lexer=a.lex;y.InlineLexer=b;y.inlineLexer=b.output;y.parse=y;"object"===typeof exports?module.exports=y:"function"===typeof define&&define.amd?define(function(){return y}):this.marked=y}).call(function(){return this||
("undefined"!==typeof window?window:global)}());(function(){function a(a,b,e){a=n(a,255);b=n(b,255);e=n(e,255);var d=B(a,b,e),h=r(a,b,e),f,l=(d+h)/2;if(d==h)f=h=0;else{var q=d-h,h=0.5<l?q/(2-d-h):q/(d+h);switch(d){case a:f=(b-e)/q+(b<e?6:0);break;case b:f=(e-a)/q+2;break;case e:f=(a-b)/q+4}f/=6}return{h:f,s:h,l:l}}function b(a,b,e){function d(a,b,e){0>e&&(e+=1);1<e&&(e-=1);return e<1/6?a+6*(b-a)*e:0.5>e?b:e<2/3?a+6*(b-a)*(2/3-e):a}a=n(a,360);b=n(b,100);e=n(e,100);if(0===b)e=b=a=e;else{var h=0.5>e?e*(1+b):e+b-e*b,f=2*e-h;e=d(f,h,a+1/3);b=d(f,h,
a);a=d(f,h,a-1/3)}return{r:255*e,g:255*b,b:255*a}}function d(a,b,e){a=n(a,255);b=n(b,255);e=n(e,255);var d=B(a,b,e),h=r(a,b,e),f,l=d-h;if(d==h)f=0;else{switch(d){case a:f=(b-e)/l+(b<e?6:0);break;case b:f=(e-a)/l+2;break;case e:f=(a-b)/l+4}f/=6}return{h:f,s:0===d?0:l/d,v:d}}function f(a,b,e,d){return[t(Math.round(255*parseFloat(d)).toString(16)),t(v(a).toString(16)),t(v(b).toString(16)),t(v(e).toString(16))].join("")}function l(a){a=parseFloat(a);if(isNaN(a)||0>a||1<a)a=1;return a}function n(a,b){"string"==
typeof a&&-1!=a.indexOf(".")&&1===parseFloat(a)&&(a="100%");var e="string"===typeof a&&-1!=a.indexOf("%");a=r(b,B(0,parseFloat(a)));e&&(a=parseInt(a*b,10)/100);return 1E-6>q.abs(a-b)?1:a%b/parseFloat(b)}function t(a){return 1==a.length?"0"+a:""+a}function s(a){1>=a&&(a=100*a+"%");return a}var y=/^[\s,#]+/,w=/\s+$/,E=0,q=Math,v=q.round,r=q.min,B=q.max,D=function p(a,d){var h,f,A,z,t;a=a?a:"";d=d||{};if(a instanceof p)return a;if(!(this instanceof p))return new p(a,d);f=a;t={r:0,g:0,b:0};var D=1;A=
h=!1;"string"==typeof f&&(f=f.replace(y,"").replace(w,"").toLowerCase(),f=(z=F.rgb.exec(f))?{r:z[1],g:z[2],b:z[3]}:(z=F.rgba.exec(f))?{r:z[1],g:z[2],b:z[3],a:z[4]}:(z=F.hsl.exec(f))?{h:z[1],s:z[2],l:z[3]}:(z=F.hsla.exec(f))?{h:z[1],s:z[2],l:z[3],a:z[4]}:(z=F.hsv.exec(f))?{h:z[1],s:z[2],v:z[3]}:(z=F.hex8.exec(f))?{a:parseInt(z[1],16)/255,r:parseInt(z[2],16),g:parseInt(z[3],16),b:parseInt(z[4],16),format:"hex8"}:(z=F.hex6.exec(f))?{r:parseInt(z[1],16),g:parseInt(z[2],16),b:parseInt(z[3],16),format:"hex"}:
(z=F.hex3.exec(f))?{r:parseInt(z[1]+""+z[1],16),g:parseInt(z[2]+""+z[2],16),b:parseInt(z[3]+""+z[3],16),format:"hex"}:!1);if("object"==typeof f){if(f.hasOwnProperty("r")&&f.hasOwnProperty("g")&&f.hasOwnProperty("b"))t={r:255*n(f.r,255),g:255*n(f.g,255),b:255*n(f.b,255)},h=!0,A="%"===String(f.r).substr(-1)?"prgb":"rgb";else if(f.hasOwnProperty("h")&&f.hasOwnProperty("s")&&f.hasOwnProperty("v")){f.s=s(f.s);f.v=s(f.v);A=f.h;var I=f.s;t=f.v;A=6*n(A,360);I=n(I,100);t=n(t,100);h=q.floor(A);var H=A-h;A=
t*(1-I);z=t*(1-H*I);I=t*(1-(1-H)*I);h%=6;t={r:255*[t,z,A,A,I,t][h],g:255*[I,t,t,z,A,A][h],b:255*[A,A,I,t,t,z][h]};h=!0;A="hsv"}else f.hasOwnProperty("h")&&f.hasOwnProperty("s")&&f.hasOwnProperty("l")&&(f.s=s(f.s),f.l=s(f.l),t=b(f.h,f.s,f.l),h=!0,A="hsl");f.hasOwnProperty("a")&&(D=f.a)}D=l(D);f=f.format||A;A=r(255,B(t.r,0));z=r(255,B(t.g,0));t=r(255,B(t.b,0));this._r=A;this._g=z;this._b=t;this._a=D;this._roundA=v(100*this._a)/100;this._format=d.format||f;this._gradientType=d.gradientType;1>this._r&&
(this._r=v(this._r));1>this._g&&(this._g=v(this._g));1>this._b&&(this._b=v(this._b));this._ok=h;this._tc_id=E++};D.prototype={getAlpha:function(){return this._a},setAlpha:function(a){this._a=l(a);this._roundA=v(100*this._a)/100},toHsv:function(){var a=d(this._r,this._g,this._b);return{h:360*a.h,s:a.s,v:a.v,a:this._a}},toHsvString:function(){var a=d(this._r,this._g,this._b),b=v(360*a.h),m=v(100*a.s),a=v(100*a.v);return 1==this._a?"hsv("+b+", "+m+"%, "+a+"%)":"hsva("+b+", "+m+"%, "+a+"%, "+this._roundA+
")"},toHsl:function(){var b=a(this._r,this._g,this._b);return{h:360*b.h,s:b.s,l:b.l,a:this._a}},toHslString:function(){var b=a(this._r,this._g,this._b),e=v(360*b.h),d=v(100*b.s),b=v(100*b.l);return 1==this._a?"hsl("+e+", "+d+"%, "+b+"%)":"hsla("+e+", "+d+"%, "+b+"%, "+this._roundA+")"},toHex:function(a){var b=this._g,d=this._b,b=[t(v(this._r).toString(16)),t(v(b).toString(16)),t(v(d).toString(16))];return a=a&&b[0].charAt(0)==b[0].charAt(1)&&b[1].charAt(0)==b[1].charAt(1)&&b[2].charAt(0)==b[2].charAt(1)?
b[0].charAt(0)+b[1].charAt(0)+b[2].charAt(0):b.join("")},toHexString:function(a){return"#"+this.toHex(a)},toHex8:function(){return f(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:v(this._r),g:v(this._g),b:v(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+v(this._r)+", "+v(this._g)+", "+v(this._b)+")":"rgba("+v(this._r)+", "+v(this._g)+", "+v(this._b)+", "+this._roundA+")"},toFilter:function(a){var b="#"+f(this._r,
this._g,this._b,this._a),d=b,h=this._gradientType?"GradientType = 1, ":"";a&&(d=D(a).toHex8String());return"progid:DXImageTransform.Microsoft.gradient("+h+"startColorstr="+b+",endColorstr="+d+")"}};D.fromRatio=function(a,b){if("object"==typeof a){var d={},h;for(h in a)a.hasOwnProperty(h)&&(d[h]="a"===h?a[h]:s(a[h]));a=d}return D(a,b)};D.equals=function(a,b){return!a||!b?!1:D(a).toRgbString()==D(b).toRgbString()};D.desaturate=function(a,b){b=0===b?0:b||10;var d=D(a).toHsl();d.s-=b/100;d.s=r(1,B(0,
d.s));return D(d)};D.saturate=function(a,b){b=0===b?0:b||10;var d=D(a).toHsl();d.s+=b/100;d.s=r(1,B(0,d.s));return D(d)};D.greyscale=function(a){return D.desaturate(a,100)};D.lighten=function(a,b){b=0===b?0:b||10;var d=D(a).toHsl();d.l+=b/100;d.l=r(1,B(0,d.l));return D(d)};D.darken=function(a,b){b=0===b?0:b||10;var d=D(a).toHsl();d.l-=b/100;d.l=r(1,B(0,d.l));return D(d)};D.complement=function(a){a=D(a).toHsl();a.h=(a.h+180)%360;return D(a)};D.triad=function(a){var b=D(a).toHsl(),d=b.h;return[D(a),
D({h:(d+120)%360,s:b.s,l:b.l}),D({h:(d+240)%360,s:b.s,l:b.l})]};D.tetrad=function(a){var b=D(a).toHsl(),d=b.h;return[D(a),D({h:(d+90)%360,s:b.s,l:b.l}),D({h:(d+180)%360,s:b.s,l:b.l}),D({h:(d+270)%360,s:b.s,l:b.l})]};D.splitcomplement=function(a){var b=D(a).toHsl(),d=b.h;return[D(a),D({h:(d+72)%360,s:b.s,l:b.l}),D({h:(d+216)%360,s:b.s,l:b.l})]};D.analogous=function(a,b,d){b=b||6;d=d||30;var h=D(a).toHsl();d=360/d;a=[D(a)];for(h.h=(h.h-(d*b>>1)+720)%360;--b;)h.h=(h.h+d)%360,a.push(D(h));return a};D.monochromatic=
function(a,b){b=b||6;for(var d=D(a).toHsv(),h=d.h,f=d.s,d=d.v,l=[],n=1/b;b--;)l.push(D({h:h,s:f,v:d})),d=(d+n)%1;return l};var F={rgb:RegExp("rgb[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),rgba:RegExp("rgba[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),
hsl:RegExp("hsl[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),hsla:RegExp("hsla[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),hsv:RegExp("hsv[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),
hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};"undefined"!==typeof module&&module.exports?module.exports=D:"function"===typeof define&&define.amd?define(function(){return D}):window.tinytinycolor=D})();var APIClientModel=Backbone.Model.extend({idAttribute:"_id"}),APIClientCollection=Backbone.Collection.extend({model:APIClientModel,url:"/api/1/clients"}),clientDetailsTemplate=" <div class='error'></div><div class='sparkline requests'></div><div class='sparkline users'></div><div class='field'><div class='about'>The name of the application. This will be displayed to your users when Coggle asks them to authorize your application.</div><span class='input-label'>Application Name</span><input class='name' value='<%-name%>' /></div><div class='field'><div class='about'>The ID of your client application. You'll need this when you're using the Coggle OAuth2 APIs.</div><span class='input-label'>Client ID</span><input class='clientsecret selects' value='<%-_id%>' readonly/></div><div class='field clientsecret'><div class='about'>This is your client secret. You'll need this to use the OAuth2 APIs. Keep it safe and <b>don't share it with anyone</b>.</div><span class='input-label'>Client Secret</span><div class='wrap'><a class='refresh'><img src='"+
CDN+"/img/refresh.png'></a><input class='clientsecret selects' value='<%-clientSecret%>' readonly/></div></div><div class='field'><div class='about'>Users get redirected back here after the authentication process. It should handle the access codes and error codes from Coggle.</div><span class='input-label'>Redirect URL</span><input class='redirecturi' value='<%-redirectURI%>' placeholder='Redirect URL' /></div><div class='opensource'><div class='field'><div class='about'>The location where someone can look at the code for your application. This might be a github project for example.</div><span class='input-label'>Repository URL</span><input class='repoUrl' value='<%-repoUrl%>' placeholder='Source code repository URL'/></div><div class='field'><div class='about'>The address where your application is running and where anyone can freely use it.</div><span class='input-label'>Application URL</span><input class='appUrl' value='<%-appUrl%>' placeholder='Application URL'/></div></div><a class=' button red delete'><span class='action'>Delete</span><span class='sure'>I&#39;m sure</span></a><a class='open-sourced button green'>Go Open</a><div class='save-message'></div>",
tooltipTemplate=" <% _.each(series, function(s) { %><div class='name'><b><%-s.name%></b>: <%-s.value%></div><% }) %><div class='label'><%-time%></div><div class='label'><%-timeago%></div>",APIClientDetailsView=Backbone.View.extend({tagName:"div",className:"client-details",tooltip:_.template(tooltipTemplate),template:_.template(clientDetailsTemplate),events:{"keypress input":"updateOnEnter","blur input:not([readonly])":"close","click .refresh":"generateSecret","click .selects":"select","click .delete":"deleteAreYouSure",
"click .sure":"remove","click .open-sourced":"showOpenSource"},initialize:function(){_.bindAll(this,"render","renderSparklines","close","edit","updateOnEnter");this.model.bind("change",this.render);this.bind("selected",function(){this.$el.parent().find(".selected").removeClass("selected");this.$el.addClass("selected")}.bind(this))},render:function(){var a=this.model.toJSON();$(this.el).html(this.template(a));this.model.get("opensource")?this.showOpenSource():this.hideOpenSource();"initializing"==
this.model.get("status")?(this.$el.find(".error").show(),this.$el.find(".error").text("Client is disabled while we validate your payment details!")):"active"!=this.model.get("status")&&"trialing"!=this.model.get("status")&&(this.$el.find(".error").show(),this.$el.find(".error").text("Subscription is not active. Check your card and its expiry date."));return this},renderSparklines:function(a,b){var d={type:"line",width:"100%",height:"50px",lineColor:"#d1d1d3",fillColor:"#d1d1d3",spotColor:null,minSpotColor:null,
maxSpotColor:null,highlightLineColor:null,spotRadius:0,tooltipChartTitle:"Users",disableInteraction:!b,tooltipFormatter:function(a,b,d){a=a.maxx-d.x+1;var f=new Date;f.setTime(f.getTime()-864E5*a);1>=a?timeago="Yesterday":1<a&&(timeago=a+" days ago");a={time:f.toDateString(),timeago:timeago,series:[{name:b.mergedOptions.tooltipChartTitle,value:d.y}]};"Requests"==b.mergedOptions.tooltipChartTitle&&a.series.push({name:"Errors",value:this.model.get("failure")[d.x]});return this.tooltip(a)}.bind(this)};
a.find(".sparkline.users").sparkline(this.model.get("users"),d);d.fillColor=d.lineColor="#C5C5C5";d.tooltipChartTitle="Requests";var f=_.zip(this.model.get("success"),this.model.get("failure")),f=f.map(function(a){return a[0]+a[1]});d.chartRangeMax=_.max(f);a.find(".sparkline.requests").sparkline(f,d)},generateSecret:function(){this.model.save({clientSecret:null},{wait:!0})},select:function(a){$(a.target).select()},edit:function(a){$(this.el).addClass("editing");this.input.focus()},message:function(a){this.saveMessageTimer&&
clearTimeout(this.saveMessageTimer);this.$el.find(".save-message").html(a);this.$el.find(".save-message").show();this.saveMessageTimer=setTimeout(function(){this.$el.find(".save-message").fadeOut()}.bind(this),2E3)},close:function(){this.message("Saving...");this.model.save({name:this.$el.find("input.name").val(),redirectURI:this.$el.find("input.redirecturi").val(),appUrl:this.$el.find("input.appUrl").val(),repoUrl:this.$el.find("input.repoUrl").val()},{wait:!0,success:function(){this.message("Saved")}.bind(this),
error:function(){this.message("Save failed!")}.bind(this)});$(this.el).removeClass("editing")},updateOnEnter:function(a){13==a.keyCode&&$(a.target).blur()},deleteAreYouSure:function(){this.$el.find(".delete").addClass("disabled").addClass("areyousure");window.setTimeout(function(){this.$el.find(".delete").removeClass("disabled")}.bind(this),1E3);window.setTimeout(function(){this.$el.find(".delete").removeClass("areyousure")}.bind(this),6E3)},remove:function(a){this.$el.find(".delete").hasClass("disabled")||
(this.model.destroy({wait:!0}),this.$el.slideUp(function(){this.$el.remove()}.bind(this)))},showOpenSource:function(a){a&&(this.openSourceHoldOpen=!0);this.$el.find(".open-sourced").hide();this.$el.find(".opensource").show()},hideOpenSource:function(){this.openSourceHoldOpen?this.$el.find(".open-sourced").hide():(this.$el.find(".open-sourced").show(),this.$el.find(".opensource").hide())}}),clientTemplate=" <div class='name'><%-name%></div><div class='tags'></div>",APIClientView=Backbone.View.extend({tagName:"li",
className:"client",template:_.template(clientTemplate),events:{click:"selected"},initialize:function(){_.bindAll(this,"render","selected","remove");this.model.bind("change",this.render);this.model.bind("destroy",this.remove)},render:function(){$(this.el).html(this.template(this.model.toJSON()));"past_due"==this.model.get("status")?(this.addTag("overdue","Subscription is overdue but we're still serving requests").addClass("overdue"),this.$el.addClass("active")):"initializing"==this.model.get("status")?
this.addTag("pending","We're waiting for your payment details to be entered or approved"):"active"==this.model.get("status")||"trialing"==this.model.get("status")?(this.addTag("active","Subscription is billing").addClass("active"),this.$el.addClass("active")):(this.addTag("inactive","Subscription has failed or been cancelled").addClass("inactive"),this.$el.removeClass("active"));this.model.get("opensource")&&this.addTag("open source","Reduced rates open source application. Yay!");return this},remove:function(){this.$el.slideUp(function(){this.$el.remove()}.bind(this))},
addTag:function(a,b){b||(b="");var d=$('<span class="tag" title="'+_.escape(b)+'">'+_.escape(a)+"</span>");this.$el.find(".tags").append(d);return d},selected:function(){this.clientDetails||(this.clientDetails=new APIClientDetailsView({model:this.model}));$(this.options.details).html(this.clientDetails.render().el);this.clientDetails.delegateEvents();this.clientDetails.trigger("selected")}}),clientListTemplate=" <ul class='clients cogglelist'><li class='create-client selected'>Add Client</li></ul><div class='details'></div>",
chooseClientTypeTemplate=" <div class='choose-type'><div class='open-source'><h3>Open Source</h3><p class='description'>Share your code with the world, help others and save money! What's not to like?</p><p class='pricing'>\u00a33/active user/month<br> + request usage</p><input type='text' name='repoUrl' placeholder='Source code repository URL'/><input type='text' name='appUrl' placeholder='Application URL'/><div class='button green create'>Go Open</div></div><div class='closed-source'><h3>Closed Source</h3><p class='description'>Keep your code private, keep your app private, take advantage of Coggle.</p><p class='pricing'>\u00a310/month subscription <br>+ \u00a33/active user/month <br>+ request usage</p><div class='button green create'>Go Closed</div></div><div class='requestusage'><h3>Request Usage</h3><p>First 10,000 requests per month free, then:</p><p><span class='path'>GET /api/1/diagrams</span><span class='price'>\u00a30.005/request</span></p><p><span class='path'>GET /api/1/diagrams/:diagram/nodes</span><span class='price'>\u00a30.005/request</span></p><p><span class='path'>everything else</span><span class='price'>\u00a30.00025/request</span></p></div></div>",
APIClientList=Backbone.View.extend({tagName:"div",className:"client-list",template:_.template(clientListTemplate),chooseTemplate:_.template(chooseClientTypeTemplate),events:{"click .create-client":"showChoose","click .open-source .create":"createOpenSource","click .closed-source .create":"createClosedSource","click li":"select"},initialize:function(){_.bindAll(this,"addOne","addAll","render","select");this.collection.bind("add",this.addOne);this.collection.bind("reset",this.addAll);this.collection.bind("all",
this.render);this.once("added",function(a){a.$el.click()});$(this.el).html(this.template());this.showChoose()},showChoose:function(){this.$el.find(".selected").removeClass("selected");this.$el.find(".details").html(this.chooseTemplate());this.$el.find(".details");this.$el.find(".create-client").addClass("selected")},createOpenSource:function(){var a=this.$el.find('.open-source input[name="appUrl"]').val(),b=this.$el.find('.open-source input[name="repoUrl"]').val();a&&b&&(this.collection.create({failure:[0,
0],success:[0,0],users:[0,0],appUrl:a,repoUrl:b},{wait:!0}),this.once("added",function(a,b){a.selected()}))},select:function(a){a=$(a.target).closest("li");var b=this.$el.find(".details"),d=b.position().top+b.height(),d=a.position().top+a.height()-d;0>d&&(d=0);b.css("margin-top",d);this.$el.find(".selected").removeClass("selected");a.addClass("selected")},createClosedSource:function(){this.collection.create({failure:[0,0],success:[0,0],users:[0,0]},{wait:!0});this.once("added",function(a,b){a.selected()})},
render:function(){return this},addOne:function(a){var b=new APIClientView({model:a,details:this.$el.find(".details")});$(this.el).find(".clients .create-client").before(b.render().el);this.trigger("added",b,a);b.trigger("added")},addAll:function(){this.collection.sort();this.collection.each(this.addOne)}});var AccessModel=Backbone.Model.extend({idAttribute:"user",revoke:function(a){var b=this.get("permissions"),d=a,f=!1;"string"===typeof a&&(d=[a]);d.map(function(a){-1!=b.indexOf(a)&&(b.splice(b.indexOf(a),1),f=!0)}.bind(this));f&&(this.set("permissions",b),this.save())},grant:function(a){var b=this.get("permissions"),d=a,f=!1;"string"===typeof a&&(d=[a]);d.map(function(a){-1==b.indexOf(a)&&(b.push(a),f=!0)}.bind(this));f&&(this.set("permissions",b),this.save())}}),AccessCollection=Backbone.Collection.extend({model:AccessModel,
initialize:function(a,b){var d=b.resource.url;"string"!==typeof d&&(d=b.resource.url());this.url=d+"/access"},getMe:function(){var a=this.get(globalUserId);a&&(a.url=this.url+"/me");return a},myId:function(){return globalUserId}}),accessTemplate=" <div class='icons'>   <img src='"+CDN+"/img/bin.png' class='icon delete'> </div> <div class='access'>   <div title='<%- name %>' style='background:url(<%- picture %>); background-size: 100%; background-repeat: no-repeat; background-position:50%' class='user-icon'></div>   <span class='name'></span>   <span class='tags'></span> </div>",
AccessView=Backbone.View.extend({tagName:"li",attributes:function(){return{id:this.model.get("_id")}},template:_.template(accessTemplate),events:{"click    .delete":"remove"},initialize:function(){_.bindAll(this,"render","remove","setContent");this.model.bind("change",this.render)},render:function(){var a=this.model.toJSON();a.picture||(a.picture=CDN+"/img/anon.png");$(this.el).html(this.template(a));this.el.view=this;this.setContent();return this},setContent:function(){var a=this.model.get("name"),
b=[];this.model.get("user")==this.options.userId&&(b.push("you"),this.$el.addClass("fixed"),this.$(".delete").hide());this.model.get("user")==this.options.ownerId&&b.push("creator");b=b.map(function(a){return'<span class="tag">'+a+"</span>"});this.$(".tags").html(b.join(""));this.$(".name").text(a)},remove:function(){this.model.destroy({success:function(){$(this.el).remove()}.bind(this)})}}),accessTemplate=" <h3><%- readers %></h3> <ul class='readers access cogglelist' permission='read'></ul> <h3><%- writers %></h3> <ul class='writers access cogglelist' permission='write'><li class='org-specific fixed'>Organisation wide permissions</li></ul> <h3 class='org-specific admins'><%- admins %></h3> <ul class='org-specific admins access cogglelist' permission='admin'></ul> </div>",
AccessList=Backbone.View.extend({tagName:"div",template:_.template(accessTemplate),events:{},initialize:function(){_.bindAll(this,"addOne","render","addAll","render");var a=this.model.getAccess(),b=this.model.getInvites();a.bind("add",this.addOne);a.bind("reset",this.addAll);a.reset().fetch();b.bind("add",this.addOne);b.bind("reset",this.addAll);b.reset().fetch()},render:function(){var a={readers:this.options.readers?this.options.readers:"Readers",writers:this.options.writers?this.options.writers:
"Writers",admins:this.options.admins?this.options.admins:"Owners"};$(this.el).html(this.template(a));return this},addDragging:function(){this.$el.find("ul.access").sortable({connectWith:this.$el.find("ul.access"),dropOnEmpty:!0,items:"li.held:not(.fixed)",delay:0,stop:function(a,b){var d=b.item.parent().attr("permission");"read"==d?(console.log("revoking",["write","admin","clone"]),b.item[0].view.model.revoke(["write","admin","clone"])):"write"==d?(b.item[0].view.model.grant("write"),b.item[0].view.model.grant("clone"),
b.item[0].view.model.revoke("admin")):b.item[0].view.model.grant(["write","admin","clone"])}})},addOne:function(a){var b;if(a.get("email")){if(a.get("cancelled")||a.get("accepted"))return;b=new InviteView({model:a})}else{if(0==a.get("permissions").length)return;b=new AccessView({model:a,userId:this.options.userId,ownerId:this.options.ownerId})}-1!=a.get("permissions").indexOf("admin")?(this.$el.find(".admins").show(),this.$el.find("ul.admins").append(b.render().el)):-1!=a.get("permissions").indexOf("write")?
this.$el.find(".writers").append(b.render().el):this.$el.find(".readers").append(b.render().el);b.$el.disableSelection();clickAndHold(b.$el);b.$el.bind("hold",function(a,b){$(this).addClass("held");$(this).trigger(b)});b.$el.bind("unhold",function(){$(this).removeClass("held")});this.addDragging()},addAll:function(){this.render()}});var chatTemplate=" <ul class='userlist'> </ul> <ul class='history'> </ul> <textarea placeholder='Enter your message' class='input'></textarea> ",messageTemplate=" <li class='chat-message'> <span class='chatter'><%=name%></span> <span class='message'><%=message%></span> </li>",iconTemplate=" <li class='chatter-icon user<%=_id%>'><div class='chat-icon' style='background:<%=colour%>'></div> <%-name%> </li> ",systemMessageTemplate=" <li class='system'><%-message%> </li> ",ChatView=Backbone.View.extend({tagName:"div",
className:"chat",chatTemplate:_.template(chatTemplate),iconTemplate:_.template(iconTemplate),messageTemplate:_.template(messageTemplate),systemMessageTemplate:_.template(systemMessageTemplate),events:{"keypress .input":"acceptOnEnter","resize window":"resizeChat"},initialize:function(){_.bindAll(this,"render","remove","addMessage","addJoin","addLeave","onAck","reset","resizeChat");this.model.bind("joined",this.addJoin);this.model.bind("left",this.addLeave);this.model.bind("chat",this.addMessage);
this.model.bind("chatAck",this.onAck);this.model.bind("disconnect",this.reset);this.model.bind("error",this.reset);this.model.bind("host_move",this.reset)},render:function(){$(this.el).html(this.chatTemplate());this.resizeChat();return this},addMessage:function(a){var b=this.model.get("user",a.from);a.name=b.name;var b=this.$el.find(".history"),d=b[0].scrollHeight-b.scrollTop()<=b.outerHeight();b.append(this.messageTemplate(a));d&&b.animate({scrollTop:b.prop("scrollHeight")},200)},addJoin:function(a){a=
this.model.get("user",a._id);this.$el.find(".userlist").append(this.iconTemplate(a));this.$el.find(".history").append(this.systemMessageTemplate({message:a.name+" joined"}));this.resizeChat()},addLeave:function(a){var b=this.model.get("user",a._id);this.$el.find(".user"+a._id).remove();this.$el.find(".history").append(this.systemMessageTemplate({message:b.name+" left"}));this.resizeChat()},acceptOnEnter:function(a){13==a.keyCode&&this.submit()},onAck:function(){this.$el.find(".input").val("");this.$el.find(".input").prop("disabled",
!1);("iOS"==BrowserDetect.OS||"Android"==BrowserDetect.OS||"Blackberry"==BrowserDetect.OS)&&this.$el.find(".input").blur()},reset:function(){this.$el.find(".chatter-icon").remove();this.resizeChat()},resizeChat:function(){var a=this.$el.find(".userlist");a.is(":visible")&&this.$el.find(".history").css({top:a.position().top+a.height()})},submit:function(){var a=this.$el.find(".input").val();""!=a.trim()&&(this.$el.find(".input").prop("disabled",!0),this.model.send(a),_gaq.push(["_trackEvent","Chat",
"Send"]))}});
function ChatModel(a,b){this.socket=a;this.users={count:0};this.bind=function(){return this.socket.on.apply(this.socket,arguments)};this.get=function(a,b){if("user"==a)return this.users[b]};this.send=function(a){this.socket.emit("chat",a)};this.connectTo=function(a){var f=this;a.on("joined",function(a){a.colour=b(a._id);f.users[a._id]=a;f.users.count++});a.on("disconnect",function(a){f.users={count:0}});a.on("host_move",function(){f.users={count:0}});a.on("left",function(a){f.users.count--})};this.connectTo(this.socket)}
;var cheatTemplate='<h3>Controls</h3> <ul>   <li>     <div class="left">Add Branch:</div>     <div class="right">       <span>click</span>       <div class="diagram-button plus"></div>     </div>   </li>   <li>     <div class="left">Remove Branch:</div>     <div class="right">       <div class="key remove">alt</div>       <span>+ click  </span>       <div class="diagram-button cross"></div>     </div>   </li>   <li>     <div class="left">Insert Branch:</div>     <div class="right">       <div class="key">shift</div>       <span>+ click </span>       <div class="diagram-button arrow"></div>     </div>   </li>   <li>     <div class="left">Move Branch: </div>     <div class="right">       <div>drag anything!</div>     </div>   </li>   <li>     <div class="left">Transplant Branch: </div>     <div class="right">       <div class="key">shift</div>       <span>+ drag </span>       <div class="diagram-button arrow"></div>     </div>   </li>   <li>     <div class="left">Change Colours: </div>     <div class="right">       <span>click a branch</span>     </div>   </li>   <li>     <div class="left">Add <a target="_blank" href="http://bloggle.coggle.it/add-images-to-a-coggle/">Images</a>: </div>     <div class="right">       <div>drag and drop</div>     </div>   </li> </ul> <h3>Shortcuts</h3> <ul>   <li>     <div class="left">Undo: </div>     <div class="right">       <div class="key undo"> ctrl </div>       <span>+ </span>       <div class="key">Z </div>     </div>   </li>   <li>     <div class="left">Redo:</div>     <div class="right">       <div class="key undo"> ctrl </div>       <span>+</span>       <div class="key">shift</div>       <span>+</span>       <div class="key">Z</div>     </div>   </li>   <li>     <div class="left"><h4>When typing:</h4></div>   </li>   <li>     <div class="left">New Item: </div>     <div class="right">       <div class="key">shift</div>       <span>+</span>       <div class="key">return</div>     </div>   </li>   <li>     <div class="left">New Child Item: </div>     <div class="right">       <div class="key">tab</div>     </div>   </li>   <li>     <div class="left">Jump to Parent: </div>     <div class="right">       <div class="key">shift</div>       <span>+</span>       <div class="key">tab</div>     </div>   </li> </ul>',
CheatView=Backbone.View.extend({tagName:"div",className:"cheats",template:_.template(cheatTemplate),events:{},initialize:function(){_.bindAll(this,"render")},render:function(){$(this.el).html(this.template());return this}});var CustomerModel=Backbone.Model.extend({idAttribute:"id",url:function(){return"/api/1/me/customer"}}),createCustomerTemplate=" <div class='setup'>You've not set up your payment details yet. <a class='setup-now'>Setup now.</a></div><form action='/api/1/me/customer' method='POST' class='payment-form'>  <div class='payment-errors'></div>  <div class='form-row'>    <input class='cardnumber' autocompletetype='cc-number' placeholder='Card number' type='text' size='23' data-stripe='number' />    <input class='cvc' type='text' size='3' data-stripe='cvc' placeholder='CVC'/>  </div>  <div class='form-row'>    <input class='exp-month' type='hidden' size='2' data-stripe='exp-month'/>    <input class='exp-year'  type='hidden' size='4' data-stripe='exp-year' />    <input class='exp' autocomplete='on' size='8' type='text' placeholder='MM/YYYY' />    <button type='submit' class='button green'>Save</button>    <a class='input-label cancel'>Cancel</a>  </div></form>",
customerTemplate="<div class='card'>Payment set up to use <%-cards.data[0].type%> ending in <%-cards.data[0].last4%>. <a class='setup-now'>Change</a></div>",CustomerView=Backbone.View.extend({tagName:"div",className:"customer",createTemplate:_.template(createCustomerTemplate),customerTemplate:_.template(customerTemplate),events:{"submit .payment-form":"submit","click .setup-now":"setup","click .cancel":"cancel"},initialize:function(){_.bindAll(this,"render","submit","stripeResponseHandler","setup");
this.model.bind("change",this.render)},render:function(){var a=this.model.toJSON();console.log("rendering");!a.default_card||this.$el.hasClass("setting-up")?(console.log("as setup screen"),$(this.el).html(this.createTemplate()),this.$el.removeClass("configured"),this.addValidation()):(console.log("as customer"),this.$el.html(this.customerTemplate(a)),this.$el.addClass("configured"));return this},addValidation:function(){this.$el.find(".cardnumber").payment("formatCardNumber");this.$el.find(".cardnumber").bind("blur validate",
function(){$.payment.validateCardNumber($(this).val())?$(this).removeClass("error"):$(this).addClass("error")});this.$el.find(".cvc").payment("formatCardCVC");this.$el.find(".cvc").bind("blur validate",function(){$.payment.validateCardCVC($(this).val())?$(this).removeClass("error"):$(this).addClass("error")});this.$el.find(".exp").payment("formatCardExpiry");this.$el.find(".exp").bind("blur validate",function(){var a=$.payment.cardExpiryVal($(this).val());$.payment.validateCardExpiry(a.month,a.year)?
$(this).removeClass("error"):$(this).addClass("error")})},setup:function(){this.$el.addClass("setting-up");this.render()},cancel:function(){this.$el.removeClass("setting-up");this.render()},error:function(a){var b=this.$el.find(".payment-form");!a||0==a.length?b.find(".payment-errors").hide():b.find(".payment-errors").text(a).show()},stripeResponseHandler:function(a,b){var d=this.$el.find(".payment-form");b.error?(this.error(b.error.message),d.find("button").prop("disabled",!1)):(this.error(null),
this.model.save({token:b},{wait:!0,type:"PUT",success:function(){this.$el.removeClass("setting-up");this.render()}.bind(this),error:function(a,b){console.log(b);this.error(b.responseJSON.details);d.find("button").prop("disabled",!1)}.bind(this)}))},submit:function(){var a=this.$el.find(".payment-form"),b=$.payment.cardExpiryVal(a.find(".exp").val());b||a.find(".exp").addClass("error");a.find(".exp-month").val(b.month);a.find(".exp-year").val(b.year);a.find("input").trigger("validate");if(0<a.find(".error").length)return!1;
a.find("button").prop("disabled",!0);Stripe.card.createToken(a,this.stripeResponseHandler);return!1}});var DiagramModel=Backbone.Model.extend({idAttribute:"_id",url:function(){return"/api/1/diagrams/"+this.get("_id")},getAccess:function(){this.accessCollection||(this.accessCollection=new AccessCollection([],{resource:this}));return this.accessCollection},getInvites:function(){this.inviteCollection||(this.inviteCollection=new InviteCollection([],{resource:this}));return this.inviteCollection},getPrivateLinks:function(){this.privateLinkCollection||(this.privateLinkCollection=new PrivateLinkCollection([],
{resource:this}));return this.privateLinkCollection},getOrganisation:function(){this.organisation||(this.organisation=new OrganisationModel(this));return this.organisation}}),DiagramCollection=Backbone.Collection.extend({model:DiagramModel,comparator:function(a){return-(new Date(a.get("timestamp"))).getTime()},url:"/api/1/diagrams",makeClone:function(a){_gaq.push(["_trackEvent","Clone","Current"]);trackOutboundLink(this.url+"/"+a,!0);this.create({},{type:"post",url:this.url+"/"+a,wait:!0})},search:function(a){var b=
a.toLowerCase().split(/[ ,]+/);return _(this.filter(function(d){var f=(d.get("title")||"").toLowerCase(),l=!0;b.map(function(a){-1==f.search(a)&&(l=!1)});""==a&&(l=!0);return l}))}}),diagramTemplate=" <div class='diagram-icons icons' >   <img src='"+CDN+"/img/sharing.png' title='Share with collaborators' class='icon share'>   <img src='"+CDN+"/img/clone.png' title='Create a copy' class='icon clone'>   <img src='"+CDN+"/img/bin.png' title='Remove from this list' class='icon delete'>   <img src='"+
CDN+"/img/undo.png' title='Undo removal' class='icon undo'> </div> <div class='diagramInfo'>  <div class='display'>   <img src='"+CDN+"/img/modified.png' class='changeIcon'>   <a class='title'></a>  </div> </div>",DiagramView=Backbone.View.extend({tagName:"li",className:"diagram",template:_.template(diagramTemplate),events:{"click    .diagram-icons>.delete":"remove","click    .undo":"unremove","click    .share":"share","click    .clone":"makeClone",hold:"held",unhold:"unheld","keypress .title-input":"updateOnEnter"},
initialize:function(){_.bindAll(this,"render","close","resetSearch","highlightSearch");this.$el.attr("diagram",this.model.get("_id"));this.model.bind("change",this.render);this.model.bind("filtered",this.highlightSearch);this.el.view=this;$("body").bind("filter",this.resetSearch)},render:function(){$(this.el).html(this.template(this.model.toJSON()));this.setContent();this.options.userId==this.model.get("owner_id")&&this.$el.addClass("owner");this.model.get("my_access").map(function(a){this.$el.addClass("permission-"+
a)}.bind(this));return this},setContent:function(){var a=window.Diagram.toTitleText(this.model.get("title"))||this.model.get("title")||"Unnamed Coggle";this.$(".title").text(a);this.$(".title").attr("href","/diagram/"+this.model.get("_id"));this.input=this.$(".title-input");this.input.bind("blur",this.close);this.model.get("modified")&&this.$(".changeIcon").css("opacity",1);this.input.val(a)},edit:function(a){$(this.el).addClass("editing");this.input.focus()},held:function(a,b){$(this.el).addClass("held");
$(this.el).find(".diagramInfo").trigger(b)},unheld:function(a,b){$(this.el).removeClass("held")},close:function(){this.model.save({title:this.input.val()});$(this.el).removeClass("editing")},updateOnEnter:function(a){13==a.keyCode&&this.close()},share:function(a){if(!this.shareView){this.shareView=new DiagramShareView({model:this.model,userId:this.options.userId});var b=this.shareView.render().el;$("body").append(b)}$(".share-view").hide();this.shareView.$el.show();this.shareView.$el.position({my:"right top",
at:"right bottom",of:this.$el,collision:"none"});this.shareView.$el.closeable(function(a){a.hide()});a.stopPropagation()},remove:function(){var a=this.model.getAccess.bind(this.model)();a.fetch({success:function(){this.previous_organisation||(this.previous_organisation=this.model.get("organisation"));a.getMe()&&a.getMe().revoke("list");this.previous_organisation&&(console.log("removing from org",this.previous_organisation),this.model.set("organisation",null),this.model.save());$(this.el).addClass("deleted")}.bind(this)})},
unremove:function(){var a=this.model.getAccess();a.fetch({success:function(){a.getMe().grant("list");this.previous_organisation&&(console.log("restoring to org",this.previous_organisation),this.model.set("organisation",this.previous_organisation),this.model.save({wait:!0,success:function(){this.previous_organisation=void 0}.bind(this)}));$(this.el).removeClass("deleted")}.bind(this)})},makeClone:function(){this.model.collection.makeClone(this.model.get("_id"))},highlightSearch:function(){this.$el.show();
this.$el.addClass("filtered")},resetSearch:function(){this.$el.hide();this.$el.removeClass("filtered")}}),DiagramList=Backbone.View.extend({tagName:"ul",className:"cogglelist diagram-list",events:{},initialize:function(){_.bindAll(this,"addOne","addAll","render");this.collection.bind("add",this.addOne);this.collection.bind("reset",this.addAll);this.collection.bind("all",this.render)},render:function(){return this},addOne:function(a){var b=new DiagramView({model:a,userId:this.options.userId});-1!=
a.get("my_access").indexOf("write")&&clickAndHold(b.render().$el);$(this.el).append(b.render().el)},addAll:function(){this.collection.sort();this.collection.each(this.addOne)}});var coggleFacts=[{id:"math",text:"Did you know you can write math in Coggles? (Yeah, geeky!) Use \\\\( LaTeX here \\\\) to try it out!",weight:1,more:"http://bloggle.coggle.it/add-math-to-coggles/"},{id:"collaborate",text:"Did you know that you can can collaborate in real-time with others? You can! Look for the share button in the top right.",weight:1,more:"http://bloggle.coggle.it/how-to-collaborate-with-others-in-coggle/"},{id:"share",text:"Did you know that you can edit a Coggle at the same time as someone else? You can! Look for the share button in the top right.",
weight:1,more:"http://bloggle.coggle.it/how-to-share-your-coggle-with-others/"},{id:"chat",text:"Did you know that you can chat with everyone else editing the Coggle at the same time? You can! Look for the chat icon in the top right.",weight:1,more:"http://bloggle.coggle.it/how-to-collaborate-with-others-in-coggle/"},{id:"font",text:"Did you know you can use a fixed-width code font in Coggles? You can!<p>Just use `backticks` around the text, it also stops other special syntax from being interpreted.",
weight:1,more:"http://bloggle.coggle.it/coggle-markdown-reference/"},{id:"bold",text:"Did you know you can use **bold text** in Coggles?<p>Just use **double asterisks** where you want the emphasis!",weight:1,more:"http://bloggle.coggle.it/coggle-markdown-reference/"},{id:"italic",text:"Did you know you can use *italic text* in Coggles?<p>Just use *asterisks* where you want the emphasis!",weight:1,more:"http://bloggle.coggle.it/coggle-markdown-reference/"},{id:"links",text:"Did you know you can put links in Coggles? You can!<p>They work like this:<br>[description](http://example.com)",
weight:1,more:"http://bloggle.coggle.it/coggle-markdown-reference/"},{id:"download",text:"Did you know that you can download your Coggle as a PDF or an image. You can! Look for the download button in the top right of the screen",weight:1,more:"http://bloggle.coggle.it/how-to-export-a-coggle-as-a-vector-pdf/"},{id:"markdown",text:'Did you know that Coggle uses <a href="http://daringfireball.net/projects/markdown/">markdown syntax</a>? It does!<p>Try out links like this: &lt;http://example.com&gt;',
weight:1,more:"http://bloggle.coggle.it/coggle-markdown-reference/"},{id:"latex",text:'Did you know Coggle supports LaTeX formulae? It does!<p>Use \\\\( LaTeX here \\\\) to try it out! Check out <a href="http://en.wikibooks.org/wiki/LaTeX/Mathematics">this link</a> for syntax help.',weight:1,more:"http://bloggle.coggle.it/add-math-to-coggles/"},{id:"move",text:"Want that item on a different part of the Coggle? No problem! Hold shift while dragging an item to reattach it somewhere else.",weight:1,
more:""},{id:"fontsize",text:"Text too big? Too small? Coggle supports browser zoom!<br> use [ctrl] [+] / [ctrl] [-] in most browsers!",weight:1,more:"http://bloggle.coggle.it/change-the-text-size-in-a-coggle/"},{id:"zoomin",text:"Did you know you can zoom in for a closer look? You can!<br> use [ctrl] [+] in most browsers!",weight:1,more:""},{id:"zoomout",text:"Did you know you can zoom out to see the big picture? You can!<br> use [ctrl] [-] in most browsers!",weight:1,more:""},{id:"markdown2",text:'Did you know that <a href="http://daringfireball.net/projects/markdown/">Markdown</a> is awesome? It is, and Coggle supports it!',
weight:1,more:"http://bloggle.coggle.it/coggle-markdown-reference/"},{id:"pdf",text:"You can download your Coggle as a PDF! Look for the download button in the top right of the screen.",weight:1,more:"http://bloggle.coggle.it/how-to-export-a-coggle-as-a-vector-pdf/"},{id:"png",text:"You can download your Coggle as an Image! Look for the download button in the top right of the screen.",weight:1,more:"http://bloggle.coggle.it/how-to-export-a-coggle-as-an-image/"},{id:"latex2",text:'Did you know Coggle supports LaTeX for math? It does!<p>Use \\\\( \\LaTeX here \\\\) to try it out! Here\'s <a href="http://en.wikibooks.org/wiki/LaTeX/Mathematics">a syntax guide</a>.',
weight:1,more:"http://bloggle.coggle.it/add-math-to-coggles/"},{id:"history",text:"Did you know you can view the history of who changed what, when in your Coggle? You can! Click the history icon in the top right.",weight:1,more:"http://bloggle.coggle.it/how-to-see-who-made-changes/"},{id:"images",text:"Did you know you can put images in your Coggle? You can!<p>Just drag and drop an image from your computer to wherever you want it.",weight:1,more:""},{id:"images2",text:"Did you know you can use images in Coggles? You can!<p>Just drag and drop an image from your computer to wherever you want it. A mini version of the image is uploaded and saved!",
weight:1,more:"http://bloggle.coggle.it/add-images-to-a-coggle/"},{id:"multipleimages",text:"Did you know you can add multiple images at the same time? You can!<p>Select multiple files on your computer, then drag them onto your Coggle.",weight:1,more:"http://bloggle.coggle.it/add-images-to-a-coggle/"},{id:"plaintext-in",text:"Did you know you can drag & drop plain text files onto Coggle to import them? You can!<p>If your file has indentation, Coggle will even add structure to the imported text.",
weight:1,more:"http://bloggle.coggle.it/import-other-files-to-coggle/"},{id:"freemind-in",text:"Did you know you can drag & drop Freemind .mm files onto Coggle to import them? You can!",weight:1,more:""},{id:"link-drag",text:"Did you know you can drag a URL from your address bar onto a Coggle to make a link to that site? You can!",weight:1,more:""},{id:"text-size",text:"Did you know you can change the font? You can!<p>Use #, ##, or ### at the start of a line to make the text bigger.",weight:1,more:""},
{id:"md-reference",text:'Did you know you can use Markdown in Coggles to add links, images and more? You can!<p>Here\'s the <a href="http://bloggle.coggle.it/coggle-markdown-reference/">complete reference</a>.',weight:1,more:""},{id:"multiline-keys",text:"Did you know you can break text over multiple lines? You can! Hold [ctrl] while pressing [return] to insert a newline. You can also drag the corner of the edit field downwards, and then use [return] normally.",weight:1,more:"http://bloggle.coggle.it/use-multi-line-text-in-coggles/"},
{id:"multiline-drag",text:"Did you know you can break text over multiple lines? You can! Drag the corner of the edit field downwards, then [return] will insert a newline instead of saving your edits. You can also hold [ctrl] while pressing [return] to insert a newline while typing.",weight:1,more:"http://bloggle.coggle.it/use-multi-line-text-in-coggles/"},{id:"resize-images",text:"Did you know you can resize images? you can! Drag an image onto your Coggle from anywhere on the internet (provided you have permission to use it), and then drag the lower right corner of the image to resize it.",
weight:1,more:""},{id:"image-size",text:'Did you know we support a Markdown extension to specify image size? We do! Specify a 200 by 100 pixel image like this: ![image description](http://url.to.image "optional title" 200x100)',weight:1,more:""},{id:"bold-kbshort",text:"Did you know you can use keyboard shortcuts to add **bold text** in Coggles? You can! Just press [ctrl]+[b] (or [cmd]+[b] on macs) with the text you want bold selected.",weight:1,more:""},{id:"shortcuts-1",text:"Did you know you can edit your Coggle using only the keyboard? You can, here's how:<p>[tab] to add a child node<br>[shift]+[tab] to move to the parent<br>[shift]+[return] to add a sibling",
weight:1,more:""},{id:"shortcuts-2",text:"Did you know you can select which branch to edit using keyboard shortcuts? You can!<p>Use [alt]+[shift]+arrow keys to move along branches.",weight:1,more:""},{id:"task-lists",text:'Did you know you can <a href="https://help.github.com/articles/github-flavored-markdown">Markdown</a> to add checklists to Coggles? You can, here\'s an example:<p>- [ ] unchecked checkbox<br>- [X] checked checkbox</p><p>Clicking on a checkbox automatically changes the markdown, too.',
weight:1,more:""}],FactModel=Backbone.Model.extend({idAttribute:"id"}),FactCollection=Backbone.Collection.extend({model:FactModel,url:"#facts"}),factTemplate="<span class='text'><%=text%></span><span class='more'><%=more%></span>",FactView=Backbone.View.extend({tagName:"li",className:"fact",template:_.template(factTemplate),events:{},initialize:function(){_.bindAll(this,"render")},render:function(){var a=this.model.toJSON();a.more&&0<a.more.length&&(a.more='<div><a target="_blank" href="'+a.more+
'">read more...</a></div>');$(this.el).html(this.template(a));return this}}),randomFactTemplate="<h3>Coggle Fact<a class='next'>another!</a></h3><ul class='fact-list'></ul>",RandomFact=Backbone.View.extend({tagName:"div",className:"random-fact",index:0,template:_.template(randomFactTemplate),events:{"click .next":"random"},initialize:function(){_.bindAll(this,"render");Math.seedrandom("063819253",!0)},render:function(){$(this.el).html(this.template());$(this.el).find("h3").disableSelection();return this},
display:function(a){this.index=a;a=this.collection.at(this.index);a=new FactView({model:a});$(this.el).find(".fact-list").empty();$(this.el).find(".fact-list").append(a.render().el)},random:function(){var a=this.collection.length,a=Math.floor(Math.random()*a);this.display(a)},next:function(){var a=++this.index%this.collection.length;this.display(a)}}),FactList=Backbone.View.extend({tagName:"ul",className:"fact-list",events:{},initialize:function(){_.bindAll(this,"addOne","addAll","render");this.collection.bind("add",
this.addOne);this.collection.bind("reset",this.addAll);this.collection.bind("all",this.render)},render:function(){return this},addOne:function(a){a=new FactView({model:a});$(this.el).append(a.render().el)},addAll:function(){this.collection.each(this.addOne)}});var GenericInvite=Backbone.Model.extend({idAttribute:"email"}),GenericInviteCollection=Backbone.Collection.extend({model:GenericInvite,url:"/api/1/invites"}),genericInviteTemplate=" <div class='invite-icons icons'> </div> <div class='invite'>  <div class='display'>   <span class='title'></span>  </div> </div>",GenericInviteView=Backbone.View.extend({tagName:"li",template:_.template(genericInviteTemplate),events:{},initialize:function(){_.bindAll(this,"render");this.model.bind("change",this.render)},
render:function(){$(this.el).html(this.template(this.model.toJSON()));this.setContent();return this},setContent:function(){var a=this.model.get("email");this.$(".title").text(a)}}),GenericInviteList=Backbone.View.extend({tagName:"ul",className:"cogglelist",events:{},initialize:function(){_.bindAll(this,"addOne","addAll","render");this.collection.bind("add",this.addOne);this.collection.bind("reset",this.addAll);this.collection.bind("all",this.render)},render:function(){return this},addOne:function(a){a=
new GenericInviteView({model:a});$(this.el).append(a.render().el)},addAll:function(){this.collection.each(this.addOne)}}),genericSharingTemplate=" <div class='email-input'> <h2>Invite Someone to Coggle</h2> <p class='tip'>Send coworkers, friends, or family a personalised Coggle recommendation via email.</p><div class='email-list'></div> <div class='inputs'> <input name='emails' class='emails' placeholder='friend@example.com'></input> <ul class='google-contacts'></ul> <textarea name='message' class='message' placeholder='An optional message to include in the email'></textarea> </div> <div><div class='green button'>SEND</div></div></div> <br/><img src='"+
CDN+"/img/move-spinner.gif' style='display:none' class='spinner'> <div class='fb-like' data-href='https://www.facebook.com/coggleit' data-send='false' data-width='180' data-show-faces='false' data-font='lucida grande' style='margin-right: 10px'></div><a href='https://twitter.com/CoggleIt' class='twitter-follow-button' data-show-count='false' data-lang='en' data-size='large'>Follow @CoggleIt</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src='//platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document,'script','twitter-wjs');\x3c/script>",
GenericShareView=Backbone.View.extend({tagName:"div",className:"share-view dialog",template:_.template(genericSharingTemplate),events:{"click .green.button":"submit","contacts .inputs":"addAutocomplete"},initialize:function(){_.bindAll(this,"render","remove","submit");this.invite_view=new GenericInviteList({collection:this.collection})},render:function(){$(this.el).html(this.template());this.$el.click(function(a){a.stopPropagation();a.preventDefault()});this.$el.find(".inputs").googleContacts({target:this.$el.find(".google-contacts")[0]});
this.$(".email-list").append(this.invite_view.render().el);return this},addAutocomplete:function(a,b){var d=[];b.map(function(a){a.email&&(0<a.name.length?a.email.map(function(b){d.push(a.name+" <"+b.address+">")}):a.email.map(function(a){d.push(a.address)}))});this.autoCompleteAdded||(this.autoCompleteAdded=!0,this.$el.find(".emails").autocomplete({delay:100,minLength:2,source:function(a,b){b($.ui.autocomplete.filter(d,a.term.split(/,\s*/).pop()))},focus:function(){return!1},select:function(a,b){var d=
this.value.split(/,\s*/);d.pop();d.push(b.item.value);d.push("");this.value=d.join(", ");return!1}}))},submit:function(){var a=this.$el.find(".inputs").googleContacts.state.selected(),b=this.$el.find(".emails").val();this.$el.find(".spinner").show();var b=b.split(/([^@]*@[^\s,;@]*)[\s,;@]*/),b=b.map(function(a){a=a.substring(a.indexOf("<")+1).replace(" ","");return-1!=a.indexOf(">")?a.substring(0,a.indexOf(">")):a}),b=b.map(function(a){return a.replace(/[<>]/g,"")}),b=_.reject(b,function(a){return""==
a}),b=b.concat(a),d=this.$el.find(".message").val();d==this.$el.find(".message").attr("over")&&(d=void 0);b.map(function(a){this.collection.create({email:a,message:d},{wait:!1,type:"PUT",success:function(){this.$el.find("input").val("");this.$el.find(".inputs").googleContacts.state.clearSelection()}.bind(this),complete:function(){this.$el.find(".spinner").hide()}.bind(this)})}.bind(this));_gaq.push(["_trackEvent","Invite","Generic",void 0,b.length])}});var HistoryView=Backbone.View.extend({tagName:"ul",className:"dates",most_recent_date:null,from:null,events:{},initialize:function(){_.bindAll(this,"reset","addTimes","render")},shouldDisplayLabel:function(a,b){return 216E5>(new Date).getTime()-b.getTime()||b.toDateString()!=a.toDateString()?!0:!1},reset:function(a){this.revisionSelected(this.most_recent_date,a)},revisionSelected:function(a,b){this.from==a?b&&b(!1):$.ajax({url:"/api/1/diagrams/"+this.options.diagramId+"/history",data:{from_date:this.from.toJSON(),
to_date:a.toJSON()}}).done(function(d){d.error?b&&b(d.error):(this.from=a,$.each(d,function(a,b){try{this.options.diagram.onDelta(b,!0)}catch(d){console.log("failed to apply:",d,b)}}.bind(this)),b&&b())}.bind(this))},addTimes:function(a){if(1>=a.length)return this.$el.discreteSlider("addStop",{label:"no history yet",data:new Date});a=a.map(function(a){return new Date(a)});var b=a[0];this.$el.discreteSlider("addStop",{label:$.timeago(b),data:b});for(var d=1;d<a.length-1;d++){var f=a[d];this.shouldDisplayLabel(b,
f)?(this.$el.discreteSlider("addStop",{label:$.timeago(f),data:f}),b=f):this.$el.discreteSlider("addStop",{label:$.timeago(f),"class":"stop",data:f})}this.$el.discreteSlider("addStop",{label:$.timeago(a[a.length-1])+" (current)",data:a[a.length-1]});this.$el.discreteSlider("addSlider");this.most_recent_date=this.from=a[a.length-1];var l=0,n=null,t='<img src="'+CDN+'/img/clone.png" class="cloneimg">',s='<img src="'+CDN+'/img/clone.png" class="clonedone">',y="/api/1/diagrams/"+this.options.diagramId;
this.$el.off("positionchange");this.$el.on("positionchange",function(a,b){this.$el.attr("disabled","disabled");window.setTimeout(function(){this.$el.attr("disabled",!1)}.bind(this),3E3<=l?3E3:l+=500);var d=new Date($(b).attr("data"));_gaq.push(["_trackEvent","History","Change"]);this.revisionSelected(d,function(a){if(a)return console.log(a);d!=n&&(null!=n&&$("#clonelink").remove(),$("<a>",{id:"clonelink",href:"#",html:t,title:"Create a copy of this version.",height:"15px",width:"15px"}).on("click",
function(){$("<img>",{id:"clonespinner",src:CDN+"/img/move-spinner.gif",width:"15px",height:"15px"}).prependTo(this);$(this).text("");$(this).off("click");_gaq.push(["_trackEvent","Clone",d.toString()]);trackOutboundLink(y,!0);$.post(y,{date:d},function(a,b,d){$("#clonespinner").remove();a="/diagram/"+a._id;$("#clonelink").attr({href:a,title:"Open the copy of this version."}).html(s);(a=window.open(a,"_blank"))&&a.focus()},"json");return!1}).prependTo(b),n=d)})}.bind(this))},render:function(){this.$el.empty();
var a=$.discreteSlider.maxElements(this.$el.parent());$.ajax({url:"/api/1/diagrams/"+this.options.diagramId+"/dates",data:{limit:a}}).done(function(a){this.addTimes(a)}.bind(this));return this}});var InviteModel=AccessModel.extend({idAttribute:"email"}),InviteCollection=Backbone.Collection.extend({model:InviteModel,initialize:function(a,b){this.url=b.resource.url()+"/invites"}}),inviteTemplate=" <div class='icons'>   <img src='"+CDN+"/img/bin.png' class='icon delete'> </div> <div class='content invite'>   <span class='email'></span>   <span class='notes'></span> </div>",InviteView=Backbone.View.extend({tagName:"li",template:_.template(inviteTemplate),events:{"click    .delete":"remove"},initialize:function(){_.bindAll(this,
"render");this.model.bind("change",this.render)},render:function(){$(this.el).html(this.template(this.model.toJSON()));this.el.view=this;this.setContent();return this},setContent:function(){var a=this.model.get("email");this.$(".email").text(a)},remove:function(){this.model.destroy({success:function(){$(this.el).remove()}.bind(this)})}});var MessageModel=Backbone.Model.extend({idAttribute:"_id"}),MessageCollection=Backbone.Collection.extend({model:MessageModel,url:"/api/1/messages"}),Messages=new MessageCollection;$(window).ready(function(){if(!$.cookie.isprinting){Messages.bind("add",function(a){notifications[a.get("type")](a.get("message"))});var a=function(){Messages.fetch({global:!1});setTimeout(a,12E5)};a()}});var memberIconTemplate=" <div title='<%- name %>' style='background:url(<%- picture %>); background-size: 100%; background-repeat: no-repeat; background-position:50%; background-color: #555' class='user-icon'><div class='initials'><%- initials %></div></div> ",MemberIconView=Backbone.View.extend({tagName:"li",className:"member",template:_.template(memberIconTemplate),events:{"click .user-icon":"showAccess"},initialize:function(){_.bindAll(this,"render","setContent","removed");this.model.bind("change",
this.render);this.model.bind("destroy",this.removed)},showAccess:function(){if(!this.accessView&&(this.model.collection.getMe().id==this.model.id||-1!=this.model.collection.getMe().get("permissions").indexOf("admin")))this.accessView=new OrganisationAccessView({model:this.model}),this.$el.append(this.accessView.render().$el.hide());this.accessView&&this.accessView.$el.animate({width:"toggle"},55)},render:function(){var a=this.model.toJSON();a.initials="";a.picture||(a.initials="??",a.name&&(a.initials=
a.name.split(" ").map(function(a){return a[0]}).join("")),a.picture=CDN+"/img/anon-member.png");$(this.el).html(this.template(a));this.setContent();return this},removed:function(){this.$el.hide();this.model.id==this.model.collection.getMe().id&&this.model.collection.trigger("left");_gaq.push(["_trackEvent","Organisation","Left"])},setContent:function(){}}),MemberIconList=Backbone.View.extend({tagName:"ul",className:"members",events:{},initialize:function(){_.bindAll(this,"addOne","addAll","render");
this.collection.bind("add",this.addOne);this.collection.bind("reset",this.addAll);this.collection.bind("all",this.render)},render:function(){this.addAll();return this},addOne:function(a){-1!=a.get("permissions").indexOf("read")&&(a=new MemberIconView({model:a}),$(this.el).append(a.render().el))},addAll:function(){this.$el.empty();this.collection.each(this.addOne)}}),OrganisationModel=Backbone.Model.extend({idAttribute:"_id",getDiagrams:function(){this.diagrams||(this.diagrams=new DiagramCollection({url:this.url()+
"/diagrams"}));return this.diagrams},getAccess:function(){this.access||(this.access=new AccessCollection([],{resource:this}));return this.access},getInvites:function(){this.inviteCollection||(this.inviteCollection=new InviteCollection([],{resource:this}));return this.inviteCollection},searchDiagrams:function(a){return this.getDiagrams().search(a)}}),OrganisationCollection=Backbone.Collection.extend({model:OrganisationModel,comparator:function(a,b){a=a.get("name");b=b.get("name");return void 0==a?
-1:void 0==b?1:a.localeCompare(b)},url:"/api/1/organisations/",searchDiagrams:function(a){var b=[];this.each(function(d){d.searchDiagrams(a).each(function(a){b.push(a)})});return b}}),organisationTemplate=" <span class='expand' title='Expand organisation'>\u2192</span> <span class='collapse' title='Collapse organisation'>\u2190</span> <div class='meta'><img src='"+CDN+"/img/sharing.png' title='Invite people to <%- name %>' class='share'><h3 class='title'><%- name %></h3> <input type='text' name='title' class='title'/></div><span class='read-only-tip tip'>(limited access)</span><a class='leave tip'>leave<span class='areyousure'> &mdash; are you sure? <span class='yes'>I&#39;m sure</span></span></a><a href='/organisations/<%= _id %>/diagrams/new'><img src='"+
CDN+"/img/plus.png' title='Create new Coggle in this Organisation.' class='create'></a>",OrganisationView=Backbone.View.extend({tagName:"div",className:"organisation",template:_.template(organisationTemplate),events:{"click .share":"share","click .create":"create","click .leave":"leaveAreYouSure","click .leave .areyousure .yes":"leaveOrg","click h3.title":"edit","keypress .title":"updateOnEnter","click .expand":"expand","click .collapse":"collapse","blur .title":"close"},initialize:function(){_.bindAll(this,
"render","remove","setContent","destroy");this.diagramList=new DiagramList({collection:this.model.getDiagrams(),userId:this.options.userId});this.memberList=new MemberIconList({collection:this.model.getAccess()});this.model.get("my_access")&&-1==this.model.get("my_access").indexOf("write")&&this.$el.addClass("read-only");this.model.get("my_access")&&-1==this.model.get("my_access").indexOf("admin")&&this.$el.addClass("write-only");this.model.bind("change",this.render);this.model.getAccess().bind("left",
this.destroy);this.el.view=this},destroy:function(){this.$el.slideUp()},leaveAreYouSure:function(){var a=this.$el;a.find(".leave .areyousure").show();window.setTimeout(function(){a.find(".leave .areyousure").hide()},4E3)},leaveOrg:function(){this.model.getAccess().getMe().destroy()},render:function(){this.$el.html(this.template(this.model.toJSON()));this.$el.find("input.title").attr("value",this.model.get("name"));this.setContent();"own"==this.model.get("_id")&&this.$el.addClass("no-organisation");
1==$.cookie("collapseorg"+this.model.id)&&(this.$el.addClass("collapsed"),this.collapse());return this},setContent:function(){this.$el.append(this.memberList.render().$el);this.$el.append(this.diagramList.render().$el)},edit:function(){this.model.get("my_access")&&-1!=this.model.get("my_access").indexOf("admin")&&(this.$el.addClass("editing"),this.$el.find("input").focus())},create:function(){this.expand()},expand:function(){$.removeCookie("collapseorg"+this.model.id);this.$el.removeClass("collapsed");
this.$el.find(".diagram-list").slideDown()},collapse:function(){var a=new Date;a.setTime(a.getTime()+31536E6);$.cookie("collapseorg"+this.model.id,1,{expires:a});this.$el.find(".diagram-list").slideUp(150,function(){this.$el.addClass("collapsed")}.bind(this))},close:function(){var a=this.$el.find("input").val();a||(a=this.$el.find("h3.title").text());a||(a="Mystery Organisation");this.$el.find("h3.title").text()!=a&&(this.model.save({name:a}),_gaq.push(["_trackEvent","Organisation","Renamed"]));this.$el.removeClass("editing")},
updateOnEnter:function(a){13==a.keyCode&&this.close()},addDragging:function(){if(this.model.get("_id")&&"own"!=this.model.get("_id")&&this.model.get("my_access")&&-1==this.model.get("my_access").indexOf("write"))return console.log("limited access organisation",this.model.get("_id"));var a=this;this.$el.find(".diagram-list").sortable({connectWith:".diagram-drag-target",dropOnEmpty:!0,items:"li.held.permission-write",delay:0,handle:".diagramInfo",receive:function(a,d){var f=$(d.item).parents(".organisation")[0].view.model.get("_id");
d.item[0].view.model.set("organisation","own"!==f?f:null);d.item[0].view.model.save()},deactivate:function(b,d){d.item[0].view.$el.removeClass("held");d.item[0].view.$el.attr("style","");a.$el.find(".diagram-list").sortable("refresh")}});this.$el.find(".diagram-list").addClass("diagram-drag-target")},share:function(a){if(!this.shareView){this.shareView=new OrganisationShareView({model:this.model,userId:this.options.userId});var b=this.shareView.render().el;this.$el.append(b)}$(".dialog").hide();this.shareView.$el.show();
this.shareView.$el.position({my:"center top",at:"center top",of:this.$el,collision:"none"});this.shareView.$el.closeable(function(a){a.hide()});a.stopPropagation();_gaq.push(["_trackEvent","Organisation","OpenShare"])}}),organisationAccessTemplate="<img src='"+CDN+"/img/plus.png' title='Remove from Organisation' class='remove'>",OrganisationAccessView=Backbone.View.extend({tagName:"div",className:"organisation-access",template:_.template(organisationAccessTemplate),events:{"click .remove":"removeAccess"},
initialize:function(){_.bindAll(this,"render")},removeAccess:function(){this.model.destroy()},render:function(){var a=this.model.toJSON();a.picture||(a.picture=CDN+"/img/anon.png");$(this.el).html(this.template(a));return this}}),OrganisationList=Backbone.View.extend({tagName:"ul",className:"organisations",events:{},initialize:function(){_.bindAll(this,"addOne","addAll","render","createOrg");this.collection.bind("add",this.addOne);this.collection.bind("reset",this.addAll);this.collection.bind("all",
this.render)},createOrg:function(){this.collection.create({name:"Mystery Organisation",my_access:["read","write","admin"]},{wait:!0,success:function(a,b){a.getAccess().fetch()}});_gaq.push(["_trackEvent","Organisation","Create"])},render:function(){return this},addOne:function(a){a=new OrganisationView({model:a,userId:this.options.userId});$(this.el).append(a.render().el);a.render().$el.disableSelection();a.addDragging()},addAll:function(){this.$el.empty();this.collection.each(this.addOne)},search:function(a){$("body").trigger("filter");
this.collection.searchDiagrams(a).map(function(a){a.trigger("filtered")})}});var PrivateLinkModel=Backbone.Model.extend({idAttribute:"key",hasTag:function(a){return-1!=this.get("tags").indexOf(a)}}),PrivateLinkCollection=Backbone.Collection.extend({model:PrivateLinkModel,initialize:function(a,b){this.diagram=b.resource;this.url=b.resource.url()+"/links"},ofType:function(a){return _filter(this,function(b){return b.hasTag(a)})}}),privateLinkTemplate=" <div class='icons'>   <img src='"+CDN+"/img/clonable.png' class='icon clonable' title='Viewers may create their own copies.'>   <img src='"+
CDN+"/img/nonclonable.png' class='icon nonclonable' title='Viewers may not create copies.'>   <img src='"+CDN+"/img/bin.png' class='icon delete'> </div> <div class='content'>   <span class='tags'> <% _.each(tags, function(tag) { %>     <span class='tag'><%= tag %></span> <% }); %>   </span>   <span class='link'></span> </div>",PrivateLinkView=Backbone.View.extend({tagName:"li",className:"privatelink",template:_.template(privateLinkTemplate),events:{"click    .delete":"remove","click    .clonable":"toggleClone",
"click    .nonclonable":"toggleClone","click    .link":"select"},initialize:function(){_.bindAll(this,"render","remove","setContent","select");this.model.bind("change",this.render)},render:function(){$(this.el).html(this.template(this.model.toJSON()));this.setContent();-1!=this.model.get("permissions").indexOf("clone")?this.$el.addClass("clone-on"):this.$el.removeClass("clone-on");return this},setContent:function(){var a="https://coggle.it/diagram/"+this.model.collection.diagram.get("_id")+"/"+this.model.get("key");
this.$(".link").text(a)},select:function(){var a=window.getSelection(),b=document.createRange();b.selectNodeContents(this.$el.find(".link")[0]);a.removeAllRanges();a.addRange(b)},remove:function(){this.model.destroy({success:function(){$(this.el).remove()}.bind(this)})},toggleClone:function(){var a=this.model.get("permissions"),a=-1==a.indexOf("clone")?_.union(a,["clone"]):_.without(a,"clone");this.model.set("permissions",a);this.model.save({wait:!0})}}),PrivateLinkList=Backbone.View.extend({tagName:"ul",
className:"cogglelist",events:{},initialize:function(){_.bindAll(this,"addOne","addAll","render");this.collection.bind("add",this.addOne);this.collection.bind("reset",this.addAll);this.collection.bind("all",this.render)},render:function(){return this},addOne:function(a){a=new PrivateLinkView({model:a});$(this.el).append(a.render().el)},addAll:function(){this.collection.each(this.addOne)}});var ShareView=Backbone.View.extend({tagName:"div",className:"share-view dialog",googleContacts:[],events:{},initialize:function(){_.bindAll(this,"render","remove","setContent");this.access=new AccessList({model:this.model,userId:this.options.userId,ownerId:this.model.get("owner_id")})},render:function(){this.$el.html(this.template(this.model.toJSON()));this.$el.find(".inputs").googleContacts({target:this.$el.find(".google-contacts")[0]});this.$el.find(".green.button").hide();this.$el.click(function(a){a.stopPropagation();
a.preventDefault()});this.setContent();return this},setContent:function(){this.$(".inputs").after(this.access.render().el)},onGoogleContacts:function(a,b){this.googleContacts=[];b.map(function(a){a.email&&(0<a.name.length?a.email.map(function(b){this.googleContacts.push(a.name+" <"+b.address+">")}.bind(this)):a.email.map(function(a){this.googleContacts.push(a.address)}.bind(this)))}.bind(this));this.toggleSend()},toggleSend:function(a){this.$el.find(".green.button").show();this.$el.find(".google").click(function(){this.$el.find(".green.button").toggle()}.bind(this))},
acceptOnEnter:function(a){13==a.keyCode&&this.submit()},submit:function(){var a=this.$el.find(".inputs").googleContacts.state.selected(),b=this.$el.find(".emails").val();this.$el.find(".spinner").show();b=b.split(/([^@]*@[^\s,;@]*)[\s,;@]*/);b=b.map(function(a){a=a.substring(a.indexOf("<")+1).replace(" ","");return-1!=a.indexOf(">")?a.substring(0,a.indexOf(">")):a});b=b.map(function(a){return a.replace(/[<>]/g,"")});b=_.reject(b,function(a){return""==a});b=b.concat(a);b.map(function(a){var b=this.model.getInvites();
b.create({email:a,permissions:["read","write","clone"]},{wait:!0,url:b.url,type:"POST",success:function(){this.$el.find("input").val("");this.$el.find(".inputs").googleContacts.state.clearSelection();this.model.getAccess().reset().fetch();this.model.getInvites().reset().fetch()}.bind(this),complete:function(){this.$el.find(".spinner").hide()}.bind(this)})}.bind(this));_gaq.push(["_trackEvent","Invite","Invite"]);trackOutboundLink({href:"/diagram/"+this.model.get("_id")+"/share"},!0)},addAutocomplete:function(){this.autoCompleteAdded||
(this.autoCompleteAdded=!0,$.ajax({url:"/api/1/me/invited"}).done(function(a){this.$el.find(".emails").autocomplete({delay:100,minLength:2,source:function(b,d){d($.ui.autocomplete.filter(a.concat(this.googleContacts),b.term.split(/,\s*/).pop()))}.bind(this),focus:function(){return!1},select:function(a,d){var f=this.value.split(/,\s*/);f.pop();f.push(d.item.value);f.push("");this.value=f.join(", ");return!1}})}.bind(this)))}}),diagramSharingTemplate=" <div class='inputs'> <input name='emails' class='emails' placeholder='friend@example.com' /> <ul class='google-contacts'></ul> <div class='green button'>SEND</div><div style='clear:both'/> </div> <img src='"+
CDN+"/img/move-spinner.gif' style='display:none' class='spinner'> <div  class='privatelinks'> <h3>Private Links</h3> <br/> <a class='newLink'> <span class='small'>New Link</span></a> <div class='social'> <a  href='/diagram/<%= _id %>/share/facebook' class='facebook' title='Share on Facebook'> <img src='"+CDN+"/img/facebook.png' style='height:35px'/> </a> <a href='/diagram/<%= _id %>/share/twitter' class='twitter' title='Share on Twitter'> <img src='"+CDN+"/img/twitter.png' style='height:35px'/> </a> </div> <span class='tip'>These let you share your diagram with people that haven't discovered Coggle yet, but be careful they let <strong>anyone</strong> with the link see your work! </span> </div> <br style='clear:both'/> <a class='embed'>Embed this Coggle</a> <textarea class='embed-code'></textarea> ",
embedTemplate="<iframe width='853' height='480' src='https://embed.coggle.it/diagram/<%= diagram %>/<%= key %>' frameborder='0' allowfullscreen></iframe> ",DiagramShareView=ShareView.extend({template:_.template(diagramSharingTemplate),embedTemplate:_.template(embedTemplate),events:{"click .facebook":"facebook","click .twitter":"twitter","click .newLink":"newLink","keypress .emails":"acceptOnEnter","keypress input":"addAutocomplete","contacts .inputs":"onGoogleContacts","click .green.button":"submit",
"click .embed":"embed"},initialize:function(){this.constructor.__super__.initialize.apply(this);this.privatelinks=new PrivateLinkList({collection:this.model.getPrivateLinks()});this.model.getPrivateLinks().fetch({wait:!0,data:{filter:[{revoked:!1}]}})},setContent:function(){this.constructor.__super__.setContent.apply(this);this.$(".privatelinks h3").after(this.privatelinks.render().el);this.model.get("organisation")||this.$el.addClass("no-organisation");this.model.getPrivateLinks().bind("add",function(a){a.hasTag("embed")&&
this.showEmbed(a)}.bind(this))},showEmbed:function(a){a.bind("destroy",this.hideEmbed.bind(this));this.$el.addClass("embedded");a=a.toJSON();a.diagram=this.model.id;this.$el.find(".embed-code").text(this.embedTemplate(a))},hideEmbed:function(){this.$el.removeClass("embedded");this.$el.find(".embed-code").text("")},newLink:function(){this.model.getPrivateLinks().create({},{wait:!0});_gaq.push(["_trackEvent","Invite","Link"]);trackOutboundLink(this,!0)},embed:function(){this.model.getPrivateLinks().create({type:"embed"},
{wait:!0});_gaq.push(["_trackEvent","Share","Embed"])},facebook:function(a,b){var d=this.$el.find(".facebook")[0];_gaq.push(["_trackEvent","Share","Facebook"]);trackOutboundLink(d)},twitter:function(a){a=this.$el.find(".twitter")[0];_gaq.push(["_trackEvent","Share","Twitter"]);trackOutboundLink("/diagram/"+this.model.get("_id")+"/links/new",!0);window.open(a.href)}}),organisationSharingTemplate=" <div class='inputs'> <input name='emails' class='emails' placeholder='friend@example.com'></input> <ul class='google-contacts'></ul> <div class='green button'>SEND</div><div style='clear:both'/> <p class='tip'>Invite people to <%- name %>, it's a shared folder to work together in.</p></div> <img src='"+
CDN+"/img/move-spinner.gif' style='display:none' class='spinner'> <br style='clear:both'/> ",OrganisationShareView=ShareView.extend({template:_.template(organisationSharingTemplate),events:{"keypress .emails":"acceptOnEnter","keypress input":"addAutocomplete","contacts .inputs":"onGoogleContacts","click .green.button":"submit"},initialize:function(){this.constructor.__super__.initialize.apply(this);this.access=new AccessList({model:this.model,userId:this.options.userId,readers:"Limited Access",writers:"Contributing Members"})},
setContent:function(){this.constructor.__super__.setContent.apply(this)}});var tutorialItems=[{id:"Guide_UserAddedNode_Done",text:"Add a new item",action:"add node",triggers:"Guide_StartAtAdd",completed:!1},{id:"Guide_UserEditedText_Done",text:"Edit an item",action:"edit node",triggers:"Guide_StartAtEdit",completed:!1},{id:"Guide_UserMovedNode_Done",text:"Move an item",action:"move node",triggers:"Guide_StartAtMove",completed:!1},{id:"Guide_UserRemovedNode_Done",text:"Remove an item",action:"remove node",triggers:"Guide_StartAtRemove",completed:!1},{id:"UserUndid",text:"Undo a change",
action:"undid",triggers:"Guide_StartAtUndo",completed:!1},{id:"UserRedid",text:"Redo a change",action:"redid",triggers:"Guide_StartAtRedo",completed:!1}],TutorialItemModel=Backbone.Model.extend({idAttribute:"id",initialize:function(){$("#holder").on(this.id,function(){this.set("completed",!0)}.bind(this))}}),TutorialItemCollection=Backbone.Collection.extend({model:TutorialItemModel,url:"#tutorial",updateActions:function(a){this.forEach(function(b){-1!=a.indexOf(b.get("action"))&&b.set("completed",
!0)})}}),tutorialItemTemplate="<span class='indicator'></span><span class='text'><%=text%></span><span class='skip'>skip</span>",TutorialItemView=Backbone.View.extend({tagName:"li",className:"tutorialitem",template:_.template(tutorialItemTemplate),events:{"click .skip":"skip",click:"trigger"},initialize:function(){_.bindAll(this,"render","complete");this.model.bind("change",this.render);$("#holder").on("Guide_Skip",function(){$(this.el).find(".skip").hide()}.bind(this));$("#holder").on(this.model.get("triggers"),
function(){$(this.el).parent().find(".skip").hide();$(this.el).find(".skip").show()}.bind(this))},trigger:function(){$("#holder").trigger("Guide_Skip");$("#holder").trigger(this.model.get("triggers"))},render:function(){var a=this.model.toJSON();$(this.el).html(this.template(a));this.model.get("completed")&&this.complete();return this},skip:function(a){$("#holder").trigger("Guide_Skip");a.stopPropagation()},complete:function(){$(this.el).addClass("complete")}}),tutorialTemplate="<h3>Getting Started<a class='hide'>hide</a><a class='show'>show</a></h3><ul class='cogglelist'></ul>",
tutorialCookieExpiry=new Date;tutorialCookieExpiry.setTime(tutorialCookieExpiry.getTime()+31536E6);
var TutorialView=Backbone.View.extend({tagName:"div",className:"tutorial",template:_.template(tutorialTemplate),events:{"click .hide":"hide","click .show":"show"},initialize:function(){_.bindAll(this,"addOne","addAll","render");this.collection.bind("add",this.addOne);this.collection.bind("reset",this.addAll);this.collection.bind("all",this.render);"true"==$.cookie("hidetutorial")?this.hide():this.show();$(this.el).html(this.template())},render:function(){return this},hide:function(){$(this.el).addClass("hidden");
$.cookie("hidetutorial","true",{expires:tutorialCookieExpiry})},show:function(){$(this.el).removeClass("hidden");$.cookie("hidetutorial","false",{expires:tutorialCookieExpiry})},addOne:function(a){a=new TutorialItemView({model:a});$(this.el).find(".cogglelist").append(a.render().el)},addAll:function(){this.collection.each(this.addOne)}});var BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"unknown";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"unknown";this.OS=this.searchString(this.dataOS)||"unknown"},searchString:function(a){for(var b=0;b<a.length;b++){var d=a[b].string,f=a[b].prop;this.versionSearchString=a[b].versionSearch||a[b].identity;if(d){if(-1!=d.indexOf(a[b].subString))return a[b].identity}else if(f)return a[b].identity}},searchVersion:function(a){var b=
a.indexOf(this.versionSearchString);if(-1!=b)return parseFloat(a.substring(b+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"Googlebot",identity:"Googlebot"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.userAgent,subString:" Qt/",identity:"WebKit",versionSearch:"WebKit"},{string:navigator.vendor,subString:"Apple",identity:"Safari",
versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,
subString:"Trident",identity:"Explorer",versionSearch:"rv"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"android",identity:"Android"},{string:navigator.appVersion,subString:"Android",identity:"Android"},{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},
{string:navigator.userAgent,subString:"iPhone",identity:"iOS"},{string:navigator.userAgent,subString:"iPad",identity:"iOS"},{string:navigator.platform,subString:"Linux",identity:"Linux"},{string:navigator.platform,subString:"BlackBerry",identity:"BlackBerry"}]};BrowserDetect.init();
(function(a){function b(){if("Android"==n.OS||"iOS"==n.OS||"BlackBerry"==n.OS)return f;switch(n.browser){case "Googlebot":return d;case "Safari":if(4<n.version&&"iOS"!=n.OS)return d;break;case "WebKit":if(530<n.version&&"iOS"!=n.OS&&"Android"!=n.OS)return d;break;case "Chrome":if(4<n.version)return d;break;case "Firefox":if(6<n.version)return d;break;case "Explorer":if(8<n.version)return d;break;case "Opera":if(11<=n.version)return d}return l}var d={supported:1,desktop:1},f={supported:1,desktop:0},
l={supported:0,desktop:1},n=BrowserDetect;a.redirectUnsupported=function(){if(a.cookie("continue_anyway"))console.log("cookie prevents unsupported redirect!");else{var d=b();if(!d.supported){console.log("unsupported browser:",n.browser,"version:",n.version,"os:",n.OS);var f=document.URL;-1==f.indexOf("/unsupported",f.length-12)&&d.desktop&&(window.location="/unsupported")}}}})(jQuery);$(document).on("coggle.loadcheatsheet",function(a,b,d,f){function l(a){$("#help").animate({"margin-left":0},{duration:a,complete:function(){w&&(w.reposition(),w.text(y))},progress:w?w.reposition:void 0});$("#help").removeClass("closed");$("#diagram-header").addClass("helpactive")}function n(a){$("#help").animate({"margin-left":"-268px"},{duration:a,complete:function(){w&&(w.reposition(),w.text(s))},progress:w?w.reposition:void 0});$("#help").addClass("closed");$("#diagram-header").removeClass("helpactive")}
function t(){$("#help").show();"undefined"===typeof $.cookie("showhelp")?w=$("#help .toggle_centre").displayHint(s,!0).onRemoved(function(){w=null}):0==$.cookie("showhelp")&&0.02>Math.random()&&(w=$("#help .toggle_centre").displayHint(s,!0).onRemoved(function(){w=null}))}var s="Show me some hints!",y="Hide this sidebar",w=null,E=new Date;E.setTime(E.getTime()+31536E6);$("#help .toggle").click(function(){var a=1==$.cookie("showhelp")||"undefined"===typeof $.cookie("showhelp")?0:1;a?l():n();$.cookie("showhelp",
a,{expires:E,path:"/"})}).disableSelection();a=0!=$.cookie("showhelp")&&"iOS"!=BrowserDetect.OS&&"Android"!=BrowserDetect.OS&&"Blackberry"!=BrowserDetect.OS;var q=new FactCollection,v=new RandomFact({collection:q});$("#help .content").prepend(v.render().el);q.reset(coggleFacts);v.random();q=new CheatView;$("#help .content").prepend(q.render().el);$("#help .remove").text(b.remove_modifier_key_text);$("#help .undo").text(b.undo_redo_modifier_key_text);q=new TutorialItemCollection;v=new TutorialView({collection:q});
$("#help .content").prepend(v.render().el);q.reset(tutorialItems);q.updateActions(d);b.touchUIOnly()||f?($("#help").hide(),w&&(w.remove(),w=null)):t();1==a&&!f?l(0):n(0)});(function(a){function b(a,b){if(a in b)return b[a];throw'missing required option: "'+a+'"';}a.fn.coggleLocalLinks=function(d){var f=a(b("target",d)),l="filter"in d?d.filter:null,n=location.href.replace(/#.*/,"");a(this).find("a,area").filter(function(){return this.href&&this.hash&&this.href.replace(this.hash,"")==n}).off("click").bind("click",function(a){if(!l||l(a))a&&a.preventDefault(),a=this.hash.slice(1),f.trigger("starc.localLink",[a]),location.hash=this.hash}).end().end()};a.fn.scrollToFragment=
function(){var b=location.hash.slice(1);b&&a(this).trigger("starc.localLink",[b])};a.fn.coggleLocalScroll=function(){var b=a(this),f={target:this,queue:!1,duration:500,hash:!1,axis:"xy",onBefore:function(f,n,t){a(n).addClass("scrolltarget");this.offset={top:-b.height()/2,left:-b.width()/2}},onAfter:function(b,d){a(b).removeClass("scrolltarget")}};b.bind("starc.scrollTo",function(l,n){n&&(!f.onBefore||!f.onBefore(l,n,f.target))&&b.scrollTo(a(n),f)})}})(jQuery);var FakeCoggleSocket=function(a,b){function d(a,b){$.each(f[a],function(a,d){d.apply(this,b)})}this.reconnectNow=function(){};this.reconnectTo=function(a){};this.host=a;var f={};this.on=function(a,b){f[a]||(f[a]=[]);f[a].push(b)};this.emit=function(a,f){"joindiagram"==a&&(d("deltas",[b]),d("done"))};this.disconnect=function(){};setTimeout(function(){d("connect")},500)},CoggleSocket=function(a,b,d){function f(){q.reconnectDelay*=y}function l(){if(q.socket.socket&&q.socket.socket.transport&&q.socket.socket.transport.name)return q.socket.socket.transport.name}
function n(){console.log("getting update");w=!1;$.ajax({url:b,timeout:4200,success:function(a){q.reconnectTo(a.server)},global:!1,error:function(a,b,d){console.log("failed to get new server after disconnect:",b,d);f();E()}})}this.next_transport=this.connect_failures=0;var t=["websocket","xhr-polling","jsonp-polling","htmlfile"];this.options={};this.options["force new connection"]=!0;this.options.reconnect=!1;this.options.transports=["websocket"];$.extend(this.options,d);this.endpoint=b;this.host=
a;this.socket=io.connect(this.host,this.options);var s=2500+4E3*Math.random(),y=1.45+0.5*Math.random();this.reconnectDelay=s;var w=!1,E=function(){!1===w?(console.log("transport:",l(),"failed"),q.connect_failures+=1,0==q.connect_failures%3&&(q.next_transport+=1),console.log("retrying in",q.reconnectDelay),w=window.setTimeout(n,q.reconnectDelay)):console.log("already updating")},q=this;this.reconnectNow=function(){!1!==w&&(window.clearTimeout(w),w=!1);q.reconnectDelay=s;E()};this.reconnectTo=function(a){console.log("reconnect to:",
a);q.host=a;var b=q.socket.$events;q.socket.removeAllListeners();q.socket.disconnect();try{var d=q.options,f=t[q.next_transport%t.length];console.log("try transport:",f);d.transports=[f];q.socket=io.connect(a,q.options)}catch(g){console.log("connect exception:",g),E()}q.socket.$events=b};this.socket.on("host_move",function(a){console.log("server requested move to",a);q.reconnectTo("//"+a)});this.socket.on("connect",function(){q.connect_failures=0;console.log("connected",l(),new Date);q.reconnectDelay=
s});this.socket.on("disconnect",function(a){console.log("disconnected",a,new Date);E()});this.socket.on("connect_failed",function(){console.log("connect failed",new Date);f();E()});this.socket.on("connect_timeout",function(){console.log("connect timeout",new Date);f();E()});this.socket.on("reconnect_error",function(a){console.log("reconnect error",a,new Date);f();E()});this.socket.on("reconnect_failed",function(a){console.log("reconnect failed",new Date);f();E()});this.socket.on("error",function(a){console.log("unhandled socket error:",
a);f();E()});$.each(["on","off","once","emit","disconnect"],function(a,b){q[b]=function(a){return q.socket[b].apply(q.socket,arguments)}});var v=[];this.emit=function(a,b){if(q.socket.socket.connected){if(v.length&&($.each(v,function(a,b){q.socket.emit(b.name,b.data);console.log("emit queued:",b.data)}),v=[]),a||b)return q.socket.emit(a,b)}else return(a||b)&&v.push({name:a,data:b}),window.setTimeout(function(){q.emit(null,null)},200*v.length),!1}};(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){function b(a){var b={x:0,y:0};a||(a=d.event);if(a.pageX||a.pageY)b.x=a.pageX,b.y=a.pageY;else if(a.clientX||a.clientY)b.x=a.clientX+f.body.scrollLeft+f.documentElement.scrollLeft,b.y=a.clientY+f.body.scrollTop+f.documentElement.scrollTop;return b}var d=window,f=document,l=function(l,n){var s=0,q=0,t=null,r=0,B=function(b,d,g){var f=Date.now();if(null!==t&&250>f-t){var e=s-b.x,m=q-b.y;if(200>e*e+m*m)return t=
null,a(l).trigger(new a.Event("touchdoubletap",{pageX:b.x,pageY:b.y,target:g.target}),[b.x,b.y,d])}s=b.x;q=b.y;t=f;r+=1;(function(e){window.setTimeout(function(){r==e&&null!==t&&a(l).trigger(new a.Event("touchtap",{pageX:b.x,pageY:b.y,target:g.target}),[b.x,b.y,d])},250)})(r)};a(l).bind("touchstart",function(q){if(q.originalEvent.touches&&!(1<q.originalEvent.touches.length)&&(!n||n())){var r=q.originalEvent.touches[0],g=r.identifier,p=b(r),e=!1,m=!1,h=function(){p=g=r=null;m=e=!1},u=function(d){if(!e&&
!m&&!d.originalEvent.touches||1<d.originalEvent.touches.length)h();else for(var f=0;f<d.originalEvent.changedTouches.length;f++){var u=d.originalEvent.changedTouches[f];if(u.identifier==g){d=b(u);var f=d.x-p.x,q=d.y-p.y;25<f*f+q*q&&(!e&&!m)&&(e=!0,a(l).trigger(new a.Event("touchdragstart",{pageX:d.x,pageY:d.y}),[d.x,d.y,r]));e&&!m&&a(l).trigger(new a.Event("touchdrag",{pageX:d.x,pageY:d.y}),[f,q,u]);return!1}}},A=function(d){for(var f=0;f<d.originalEvent.changedTouches.length;f++){var q=d.originalEvent.changedTouches[f];
if(q.identifier==g){a(l).unbind("touchend",A);a(l).unbind("touchcancel",A);a(l).unbind("touchmove",u);f=b(q);if(e){d=f.x-p.x;var n=f.y-p.y;a(l).trigger(new a.Event("touchdragend",{pageX:f.x,pageY:f.y}),[d,n,q])}else m||B(f,q,d);h();return!1}}};a(l).bind("touchend",A);a(l).bind("touchcancel",A);a(l).bind("touchmove",u);d.setTimeout(function(){null!==g&&!e&&(m=!0,a(l).trigger(new a.Event("touchhold",{pageX:p.x,pageY:p.y}),[p.x,p.y]))},500);q.stopPropagation();a(f).trigger(new a.Event("touchstart"))}})};
a.fn.attachTouchGestures=function(a){l(this,a)};var n={},t=function(b,d,f,l){var s=a("<div>",{"class":"ringmenu",tabindex:"0"}).css({width:0,height:0,left:d,top:f}),r=CDN+"/img/",t=r+"ringplain.svg",r=r+"colourwheel.png",t=t in n?n[t]:n[t]=a("<img>",{src:t}).css({top:0,left:0,width:"100%",height:"100%"}),r=r in n?n[r]:n[r]=a("<img>",{src:r}).css({top:0,left:0,width:"100%",height:"100%"});a(s).append(t);a(s).append(r);a("body").append(s);a(t).off("dragstart").on("dragstart",function(a){a.preventDefault()});
a(r).off("dragstart").on("dragstart",function(a){a.preventDefault()});a(s).off("dragstart").on("dragstart",function(a){a.preventDefault()});a(s).animate({width:b+"px",height:b+"px",left:d-b/2,top:f-b/2},200,"swing");var D=b/4,F=b/2+5,g="#7aa3e5 #67d7c4 #9ed56b #ebd95f #efa670 #e68782 #e096e9 #988ee3".split(" ");this.onHover=function(a,b){};this.onSelect=function(a,b){var d;a>D&&a<F?(d=(-1+b*g.length/(2*Math.PI))%g.length,d=(d+g.length)%g.length,d=g[Math.floor(d)]):d=null;l(d)};this.onTeardown=function(){a(s).animate({opacity:0},
200,"swing",function(){a(s).remove()})};a(s).focus();this.menu=s},s=function(d,f,l){function q(){a(l.menu).unbind("click",g);a(l.menu).unbind("mousedownoutside focusoutside touchstartoutside",F);a(l.menu).unbind("touchstart",p);a(d).unbind("touchend",t);a(d).unbind("touchmove",e);l.onTeardown()}var n=!0,r=function(a){var e=b(a);a=e.x-f.x;var d=e.y-f.y,e=a*a+d*d;a=Math.atan2(a,d);a=Math.PI-a;0>a&&(a+=2*Math.PI);return{r:Math.sqrt(e),theta:a}},s=function(a){a=r(a.originalEvent.changedTouches[0]);l.onSelect(a.r,
a.theta);n&&q()},t=function(a){s(a)},F=function(a){q()},g=function(a){a=r(a);try{l.onSelect(a.r,a.theta)}finally{n&&q()}return!1},p=function(a){s(a);return!1},e=function(a){var b=r(a.originalEvent.changedTouches[0]);l.onHover(b.r,b.theta);a.stopImmediatePropagation();return!1};a(l.menu).bind("click",g);a(l.menu).bind("mousedownoutside focusoutside touchstartoutside",F);a(l.menu).bind("touchstart",p);a(d).bind("touchend",t);a(d).bind("touchmove",e);l.closeOnAction=function(a){n=!!a};a(l).focus();return l};
a(d).on("starc.colourmenu",function(a,b,f,l){a=-1!=["iOS","Android","Blackberry"].indexOf(BrowserDetect.OS)?Math.min(d.innerWidth,d.innerHeight)/2:Math.min(d.innerWidth,d.innerHeight)/8;a=Math.max(80,Math.min(a,400));l=new t(a,f.x,f.y,l);s(b,f,l);return l})});function initialiseGuide(a,b){function d(){_.each(e,function(a){a()});e.length=0}function f(a){d();e.push(a)}function l(a,b){e.push(function(){$("#holder").unbind(a,b)});$("#holder").one(a,b)}function n(a){var e=b.rootNode();if(!e)return null;e.childNodes().length&&(e=e.childNodes()[0]);_.each(b.nodes,function(a){a.starc.access_time<=e.starc.access_time&&!a.starc.isRoot()&&(e=a)});e.starc.isRoot()&&a&&(e=null);return e}function t(a){return a&&a.starc&&a.starc.is_node}function s(a,b){t(b)||(b=n());
if(b){$("#holder").trigger("Guide_UserStarted");$("#holder").trigger("Guide_UserAddedNode_Done");var e=b.starc.displayHint("you can edit any text",10*b.starc.ltr(),-6);f(function(){t(b)&&b.starc.removeHint(e)});l("UserEditedText",y)}}function y(a,b){function e(a,b){t(b)&&0<b.starc.tree_level?w(a,b):l("UserMovedNode",e)}t(b)||(b=n());$("#holder").trigger("Guide_UserEditedText_Done");var d=b.starc.displayArrowlessHint(p?"and drag anything to move it":"and click + drag anything to move it");f(function(){t(b)&&
b.starc.removeHint(d)});l("UserMovedNode",e)}function w(a,b){t(b)||(b=n());if(!b.starc.isRoot()){$("#holder").trigger("Guide_UserMovedNode_Done");var e=null,e=p?b.starc.displayHint("now tap to add more",20,0):b.starc.displayHint("now click here to add child item",0,0);f(function(){t(b)&&b.starc.removeHint(e)})}l("UserAddedNode",E)}function E(a,b){$("#holder").trigger("Guide_UserAddedNode_Done");d();l("UserEditedText",q)}function q(a,e){t(e)||(e=n(!0));if(e)if($("#holder").trigger("Guide_UserEditedText_Done"),
p)F();else{var d=e.starc.displayHint("... or hold "+b.remove_modifier_key+" and click here to delete instead",0,0);f(function(){t(e)&&e.starc.removeHint(d)});l("UserRemovedNode",v)}else D("you can't remove the root of a Coggle!")}function v(a){$("#holder").trigger("Guide_UserRemovedNode_Done");var e=b.rootNode(),d=e.starc.displayArrowlessHint("you can use "+b.undo_key+" to undo any anything you do!");f(function(){e.starc.removeHint(d)});l("UserUndid",r)}function r(a){$("#holder").trigger("Guide_UserUndid_Done");
var e=b.rootNode(),d=e.starc.displayArrowlessHint("and "+b.redo_key+" to re-do things again afterwards");f(function(){e.starc.removeHint(d)});l("UserRedid",B)}function B(a){$("#holder").trigger("Guide_UserRedid_Done");F()}function D(a){var e=b.rootNode(),d=e.starc.displayArrowlessHint(a);f(function(){e.starc.removeHint(d)});window.setTimeout(function(){e.starc.removeHint(d)},6E3)}function F(){D("neat you've got the hang of the basics!");$("#holder").trigger("Guide_UserDone")}var g={};a.fn.displayHint=
function(a,b){function e(){var a=n.offset();if(a){var b=$(window).height()-a.top,d=$(window).width()-a.left,h=a.left<d?"left ":"right ",m=a.top<b?"top ":"bottom ",d=a.left<d?"right ":"left ",a=a.top<b?"bottom ":"top ";$(p).empty();"right "==h&&"top "==m?(("tr"in g?g.tr:g.tr=$("<img/>",{src:CDN+"/img/uihint_topright.svg",width:"30px",height:"55px"}).css({top:"3px",right:"-15px"})).appendTo(p),$("<p/>",{html:q}).css({top:"47px",right:"12px",width:"280px",padding:"0 0 6px 20px"}).appendTo(p)):($("<p/>",
{html:q}).css({bottom:"71px",left:"-6px",width:"280px",padding:"0 0 6px 20px"}).appendTo(p),("bl"in g?g.bl:g.bl=$("<img/>",{src:CDN+"/img/uihint.svg",width:"30px",height:"55px"}).css({bottom:"18px",left:"3px"})).appendTo(p));$(f).position({my:h+m,at:d+a,collision:"none",of:l})}}function d(){$(f).fadeOut(200,function(){$(window).unbind("resize",e);$(f).remove();r&&r()});return this}var f=$("<div/>",{"class":"dhint"}),p=$("<div/>",{"class":"dhintcontent"}).appendTo(f).noSelect();$("#page").append(f);
var l=this,n=$(this),q=a;e();$(window).bind("resize",e);n.bind("layout_changed",e);var r=void 0;b&&f.hover(function(){window.setTimeout(d,500)});return{remove:d,reposition:e,text:function(a){$(p).children("p").html(a);q=a;return this},onRemoved:function(a){r=a;return this}}};var p=b.touchUIOnly(),e=[];$("#holder").on("coggle.startGuide",function(){d();l("UserAddedNode",s)});$("#holder").on("Guide_Skip",d);$("#holder").on("Guide_StartAtAdd",function(){d();w()});$("#holder").on("Guide_StartAtEdit",
function(){d();s()});$("#holder").on("Guide_StartAtMove",function(){d();y()});$("#holder").on("Guide_StartAtRemove",function(){d();q()});$("#holder").on("Guide_StartAtUndo",function(){d();v()});$("#holder").on("Guide_StartAtRedo",function(){d();r()})};/*
 
 Copyright Coggle 2013. All Rights reserved.
*/
(function(a){function b(a){for(var b="",d=0;d<a;d++)b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return b}var d=40,f=14,l="---newline"+b(8)+"---",n="---32"+b(8)+"---",t=function(a,b){for(var d="",e=!1,f=!1,h=0,l=0;l<a.length;l++)"\\"==a[l]?f=!f:("'"===a[l]||'"'===a[l]&&!f&&!e?e=a[l]:a[l]===e&&!f?e=!1:e&&"\n"==a[l]&&(d+=a.substr(h,l-h),d+=b,h=l+1),f=!1);return d+=a.substr(h)},s=function(a,b){for(var d="",e=function(b){for(b+=1;b<a.length;b++)if(a.charAt(b).match(/\s/))return b;
return a.length},f=function(a,b){return a.replace(RegExp("^["+(b||"\\s*")+"]+","g"),"")},h=0,l=0,n=e(0);n<=a.length;n=e(n)){for(var q=a.substr(l,n-l),r=f(q),l=l+(q.length-r.length);r.length>=b;)h=r.substr(0,b),r=r.substr(b,r.length-b),d=d.length?d+("\n"+h):d+h,last_new_line=l+=h.length,h=b;l=0<h?" ":"";h+r.length+l.length>=b?(d+="\n"+r,h=r.length):(d+=l+r,h+=l.length+r.length);"\n"==a.charAt(n)&&(h=0,d+="\n");l=n;if(n==a.length)break}return d},y=function(b,d){function f(b,d){for(var g=0;g<b.length;g++){var u=
a(b[g]),q=u.attr("TEXT");q&&(q=q.replace(RegExp(l,"g"),"\n").replace(RegExp(n,"g"),"'"))&&u.attr("TEXT",s(q,d));q||u.attr("TEXT","");f(u.children("node"),d)}}f(b,d&&d.wrap_to||80)},w=function(b){for(var d=0;d<b.length;d++){var f=a(b[d]),e=f.attr("POSITION");("undefined"===typeof e||!1===e)&&f.attr("POSITION",["left","right"][d%2])}},E=function(b,d){function f(b){function d(){var b=a(this).attr("src"),e=a(this).text();a(this).replaceWith("!["+e+"]("+b+")")}for(var g=0;g<b.length;g++){var l=a(b[g]),
n=l.children("richcontent");n.length&&(console.log("add text from rich content:",a.trim(n.text())),n.find("img").each(d),l.attr("TEXT",a.trim(n.text())));n=l.attr("TEXT");("undefined"===typeof n||!1===n)&&l.attr("TEXT","");f(l.children("node"))}}f(b)},q=function(b,d){function f(b,d){for(var g=0;g<b.length;g++){var l=a(b[g]),n=Diagram.getSizeOfContent(l.attr("TEXT"),d);l.attr({"starc-width":n.w,"starc-height":n.h});f(l.children("node"),d+1)}}f(b,d&&d.initial_level||0)},v=function(b,d,f,e,m,h){var l=
0,n=0;b?e=e.filter("[POSITION="+b+"]"):b="";e.each(function(){var b=a(this);n=Math.max(n,parseFloat(b.attr("starc-treewidth")));l+=parseFloat(b.attr("starc-treeheight"))});l+=e.length?(e.length-1)*h:0;b=m+n+d;f=Math.max(f/2,l);return{w:b,h:f}},r=function(b,g){function p(){var b=a(this),d=b.children("node");d.each(p);_.each(["left","right",""],function(a){var g=v(a,parseFloat(b.attr("starc-width")),parseFloat(b.attr("starc-height")),d,e,m),f={};f["starc-"+a+"treewidth"]=g.w;f["starc-"+a+"treeheight"]=
g.h;b.attr(f)})}var e=g&&g.x_space||d,m=g&&g.y_space||f;b.each(p)},B=function(b,d){function f(){var b=a(this);b.children("edge").each(function(){var d=a(this);attrs={};_.each(e,function(a){var b=d.attr(a);"undefined"!=typeof b&&!1!==b&&(attrs[a]=b)});b.attr(attrs)});b.children("node").each(f)}var e=d&&d.attrs||["COLOR"];b.each(f)},D=function(a){for(var b=0,d=0;d<a.length;d++)if(" "==a[d])b++;else if("\t"==a[d])b+=4;else break;return b};a.fn.diagramDrop=function(b){function g(b,e,h,m){if(b.length){m||
(m="");var l=d,n=f,q=a(b[0]).parent(),u=h.starc.ltr();0===h.starc.tree_level&&"left"==m&&(u=-1);var r=e.x+u*(l+_.reduce(b.map(function(){var b=a(this);return b.children("node").length?parseFloat(b.attr("starc-width")):l}).get(),function(a,b){return Math.max(a,b)},0)),A=e.y;e="starc-"+m+"treeheight";void 0!==q.attr(e)&&(A-=parseFloat(q.attr(e))/2);b.each(function(){if("NODE"===this.nodeName.toUpperCase()){var b=a(this),e=parseFloat(b.attr("starc-treeheight")),d=b.attr("TEXT");var f=b.attr("COLOR");
A+=e/2;d=p(d,{x:r,y:A},"#000"==f||"#000000"==f?void 0:f,h);g(b.children("node"),{x:r,y:A},d.node);A+=e/2+n}})}}function p(a,b,e,d,g){var f=null;a=a||"";b?(d||(d=h.closestNode(b.x,b.y)),f=b):(g=!1,d||(d=h.rootNode()),f=d.starc.positionForChild(a));if(d){e=e?e:d.starc.tree_level?h.randomWalkColour(d.starc.colour):h.getColour(d.childNodes().length);b=h.newNodeId();var m=0===d.starc.tree_level?1:-1+2*(f.x>d.starc.translate.x);a=h.performAndSendNodeAdded({node_id:b,data:{text:a,colour:e.substring(1,7),
pos:{x:g?f.x:m*(f.x-d.starc.translate.x),y:g?f.y:f.y-d.starc.translate.y},parent_id:d.starc.node_id}});h.pushUndo(a);return(a=h.getNodeForId(b))?{id:b,node:a,bbox:a.getBBox_fixed()}:null}console.log("no parent to attach to!")}function e(b,e){var d=a.Deferred();if(b.isDirectory){var g=function(a){a&&!a.entry&&(a.entry=b);d.resolve([a])};b.createReader().readEntries(function(a){I(a,e+b.name+"/").done(function(a){d.resolve(a)}).fail(g)},g)}else d.resolve([]);return d.promise()}function m(a,b,e){for(var d in a)if(a.hasOwnProperty(d)&&
RegExp(d).test(b))return a[d](b,e),!0;return!1}var h=b.diagram,u={},A={},s={},v=null;s[".*\\.dropbox\\.com/.*\\.(jpg|gif|png|jpeg|tiff|mng|svg|JPG|GIF|PNG|JPEG|TIFF|MNG|SVG)(\\?.*)?$"]=function(a,b){var e=a.replace("www.dropbox.com","dl.dropboxusercontent.com");return m(A,e,b)};A["(jpg|gif|png|jpeg|tiff|mng|svg|JPG|GIF|PNG|JPEG|TIFF|MNG|SVG)(\\?.*)?$"]=function(a,b){var e="![dropped image link]("+a+")",d=h.closestNode(b.x,b.y);p(e,b,null,d)};A["^file:"]=function(a,b){console.log("ignoring dropped file URL")};
v=function(a,b){var e="[link to "+a.replace(/^[^.\/]*?:?\/\//g,"").replace(/\/.*/,"")+"]("+a+")",d=h.closestNode(b.x,b.y);p(e,b,null,d)};u["text/plain"]=function(b,e,d){function g(){return Diagram.getSizeOfContent(this.text,this.level,this.width)}d=e.x;e=e.y;b=b.split(/\r?\n/);d=h.closestNode(d,e);e={};e.offset={x:d.starc.relX(),y:d.starc.relY()};e.text=d.starc.markdown();e.width=d.starc.boxWidth();e.children=[];e.starc_node=d;e.level=d.starc.tree_level;e.reverse_side=0<d.starc.ltr()?!0:!1;e.bbox=
g;for(var f=e,m=[],l=[],n=0;n<b.length;n++){var q=D(b[n]);if(q!=b[n].length){var u=_.sortedIndex(l,q);if(m.length&&(u<=m.length||n==b.length-1))f=u?m[u-1]:e,m=m.slice(0,u),l=l.slice(0,u);u={offset:void 0,text:a.trim(b[n]),width:void 0,reverse_side:void 0,level:f.level+1,children:[],bbox:g};f.children.push(u);m.push(u);l.push(q)}}1===e.children.length&&(d.starc.isRoot()&&!d.childNodes().length)&&(b=e.children[0],d.starc.setLabelText(b.text),d.starc.setLabelWidth(b.width),e.children=b.children);a.starcArrangeNodeTree(e,
d.starc.isRoot(),function(a,b){function e(a,b){var d=a.starc_node;d||(d=p(a.text,a.offset,void 0,b,!0).node);window.setTimeout(function(){_.each(a.children,function(a){e(a,d)})},20)}_.each(b.children,function(a){e(a,b.starc_node)})})};u["text/uri-list"]=function(a,b){console.log("handle uri list:",a);if(!m(s,a,b)&&!m(A,a,b))return v(a,b)};b=function(b,d,g){e(b).always(function(b){if(!b.length)return console.log("Could not read mindnode bundle: try using Google Chrome!");a.each(b,function(b,e){if("contents.xml"==
e.name){var d=new FileReader;d.onloadend=function(b){b=d.result;console.log("got mindnode xml:",b.length);b=a(a.parseXML(b));window.mnfile=b;console.log("mindnode file:",b)};d.readAsText(e);return!1}})})};b.pass_raw_file_entry=!0;u[".mindnode$"]=b;u[".mm$"]=function(b,e,f){f=a(a.parseXML(t(b.replace(/'/g,n),l))).find("map");b=h.closestNode(e.x,e.y);f=f.children("node");B(f);y(f);0===b.starc.tree_level&&(1==f.length?w(f.children("node")):w(f));E(f);q(f);r(f);if(0===b.starc.tree_level)if(1==f.length){e=
a(f[0]);e.attr("starc-treeheight",0);b.starc.setLabelText(e.attr("TEXT"));var m=b.starc.translate.x,p=b.starc.translate.y;f={x:m-Math.abs(e.attr("starc-width")/2+d),y:p};m={x:m+Math.abs(e.attr("starc-width")/2+d),y:p};g(e.children("node [POSITION=left]"),f,b,"left");g(e.children("node [POSITION=right]"),m,b,"right");g(e.children("node :not([POSITION])"),m,b)}else g(f,{x:e.x,y:e.y},b);else g(f,{x:e.x,y:e.y},b)};var R=function(b,e){var d=a.Deferred(),g=function(a){a&&!a.entry&&(a.entry=b);d.resolve([a])};
e=e||"";b.isFile?b._file?(b._file.relativePath=e,d.resolve(b._file)):b.file(function(a){a.relativePath=e;d.resolve(a)},g):b.isDirectory?d.resolve(b):d.resolve([]);return d.promise()},I=function(b,e){return a.when.apply(a,a.map(b,function(a){return R(a,e)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},H=function(b){b=b||{};var e=b.items;return e&&e.length&&(e[0].webkitGetAsEntry||e[0].getAsEntry)?I(a.map(e,function(a){var b;if(a.webkitGetAsEntry){if(b=a.webkitGetAsEntry())b._file=
a.getAsFile();return b}return a.getAsEntry()})):a.Deferred().resolve(a.makeArray(b.files)).promise()},N=function(a,b){var e=function(e){if(u[e].pass_raw_file_entry)u[e](a,b,a.name);else{var d=new FileReader;d.onloadend=function(g){u[e](d.result,b,a.name)};d.readAsText(a)}},d;for(d in u)if(u.hasOwnProperty(d)&&RegExp(d).test(a.type))return e(d),!0;var g=/\.[^.]*$/i.exec(a.name);if(g&&g.length)for(d in g=g[0],u)if(u.hasOwnProperty(d)&&RegExp(d).test(g))return e(d),!0},P=function(a,b){for(var e in u)if(u.hasOwnProperty(e)&&
RegExp(e).test("text/uri-list")){u[e](a,b);break}};a(this).bind("drop",function(b){if(!h.readOnly()){var e=h.coordsFromEvent(b.originalEvent),d=!1,g=b.dataTransfer=b.originalEvent.dataTransfer;g&&(g.files&&g.files.length)&&H(g).always(function(b){a.each(b,function(a,b){console.log("drop file:",b.type,b.name);N(b,e)&&(d=!0)})});if(g=g.getData("URL"))console.log("URL dropped:",g),d||P(g,e),b.preventDefault();if(d)return!1}});a(this).bind("dragenter dragover",function(a){(a.dataTransfer=a.originalEvent.dataTransfer).dropEffect=
"copy";return!1});a(this).bind("paste",function(a){console.log("paste:",a)})}})(jQuery);(function(a){"function"===typeof define&&define.amd?define(["jquery","underscore"],a):a(jQuery,_)})(function(a,b){function d(a,b){a._size=a.bbox();a._size.w>t&&"undefined"===typeof a.width&&(a.width=t,a._size=a.bbox());window.setTimeout(function(){function f(d){if(d)return l=-1,b(d);--l||b(!1,a)}var l=a.children.length;if(l)for(var n=0;n<a.children.length;n++)d(a.children[n],f);else b(!1,a)},0)}function f(a,b,d){function f(a,b){var d;if(b){var l=0,g=0;for(d=0;d<a.children.length;d++)"undefined"===
typeof a.children[d].reverse_side&&(a.children[d].reverse_side=g<l),!0===a.children[d].reverse_side?g+=a.children[d]._size.h:l+=a.children[d]._size.h,f(a.children[d],!1)}else for(d=0;d<a.children.length;d++)"undefined"===typeof a.children[d].reverse_side&&(a.children[d].reverse_side=!1),f(a.children[d],!1)}"reverse_side"in a||(a.reverse_side=!1);f(a,b);d(!1,a)}function l(a,d){function f(a,d,g,p){var e=0,m=0;b.each(p,function(b){m=Math.max(m,b._subtree_size[a].w);e+=b._subtree_size[a].h});e+=p.length?
(p.length-1)*t:0;d=n+m+d;g=Math.max(g,e);return{w:d,h:g}}function l(a){var d=a.children;b.each(d,l);b.each(["reverse","forward"],function(g){var p=b.filter(d,function(a){return a.reverse_side==("reverse"===g)});a._subtree_size=a._subtree_size||{};a._subtree_size[g]=f("forward",a._size.w,a._size.h,p);p.length!==d.length&&p.length&&(console.log("not all children on side:",p.length,d.length),console.log(g,a._subtree_size[g]))})}var n=s,t=y;l(a);d(!1,a)}function n(a,d){function f(a){var d=b.reduce(b.map(a.children,
function(a){return a.children.length?a._size.w:2*l}),function(a,b){return Math.max(a,b)},0),d=d+a._subtree_size.forward.h/12,s=-a._subtree_size.forward.h/2,g=-a._subtree_size.reverse.h/2;b.each(a.children,function(a){var b=a._subtree_size.forward.h;a.reverse_side?(console.log("move child on reverse side:",g,b),g+=b/2,a.offset={x:-d,y:g},g+=b/2+n):(s+=b/2,a.offset={x:d,y:s},s+=b/2+n);f(a)})}var l=s,n=y;f(a);d(!1,a)}var t=300,s=50,y=14;a.starcArrangeNodeTree=function(a,b,q){function s(a,b){if(a)return q(a);
l(b,r)}function r(a,b){if(a)return q(a);n(b,q)}d(a,function(a,d){if(a)return q(a);f(d,b,s)})}});(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){a.fn.callout=function(b,d){function f(){d.hasOwnProperty("closeDelay")&&0<d.closeDelay?setTimeout(function(){t--;0>=t&&(y.trigger("closed"),y.hide())},d.closeDelay):(y.trigger("closed"),y.hide())}function l(){function l(){s?(s=!1,y.find(".contents").html(b),y.prepend(a('<div class="arrow"></div>')),d.closeOn&&y.bind(d.closeOn,f),d.openOn&&y.bind(d.openOn,function(a){t++}),y.bind("mousedown touchdown click",
function(a){a.stopPropagation()}),a(d.appendTo).append(y),d.filter()||y.hide()):d.filter()&&y.show();y.position({of:n,at:d.at,my:d.my,collision:"none"});y.trigger("opened")}d.hasOwnProperty("openDelay")&&0<d.openDelay?setTimeout(function(){0<t&&l()},d.closeDelay):l()}var n=a(this);d=a.extend({appendTo:n,at:"center bottom",my:"center top",filter:function(a){return!0},closeOn:"mousedownoutside touchdownoutside focusoutside",openOn:void 0,closeDelay:0,openDelay:0},d);var t=0,s=!0,y=a('<div class="callout '+
d.my+'"><div class="contents"></div></div>');d.hasOwnProperty("openOn")&&d.openOn?(n.bind(d.openOn,function(){t++||l()}),n.bind(d.closeOn,f)):l();return y}});/*
 
 Copyright Coggle 2013. All Rights reserved.
*/
(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){function b(a,b){if(a in b)return b[a];throw'missing required option: "'+a+'"';}a.fn.checkable=function(d){var f="checkIndex"in d?d.checkIndex:0,l=b("text",d),n=b("setTextFn",d);d=a(this);d.bind("mousedown",function(){return!1});d.bind("mouseup",function(){return!1});d.bind("click",function(a){"undefined"!=typeof a.stopPropagation?a.stopPropagation():"undefined"!=typeof a.cancelBubble&&(a.cancelBubble=
!0)});d.bind("change",function(){var a=this.checked?"X":" ",b=0;l=l.replace(/^( {0,3}- \[)[xX/\\ ](\])/gm,function(d,l,n,q,v){return b++===f?l+a+n:d});n(l)})}});(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){a.coalesceCalls=function(a,d){return function(){var f=null;return function(){var l=this;null===f&&window.setTimeout(function t(){var d=(new Date).getTime();f<=d?(a.call(l),f=null):window.setTimeout(t,f-d)},d);f=(new Date).getTime()+d}}()}});/*
 
 Copyright Coggle 2013. All Rights reserved.
*/
(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){function b(a,b){if(a in b)return b[a];throw'missing required option: "'+a+'"';}var d=window;a.fn.addExportIcon=function(f){var l=b("extension",f),n=b("name",f),t="icon"in f?f.icon:"img/generic_export.png",s=b("start",f);f=a(this);var y=a("<div>",{"class":"dltype"}),w=a("<a>").bind("click",function(){_gaq.push(["_trackEvent","Download",n]);console.log("do ",n," export");context=s();if("undefined"==typeof context.generate||
"undefined"==context.finish)throw"export start() must return both generate and finish methods";d.diagram.visitDepthFirst(context.generate).always(function(){var a=d.document.title+l,b=context.finish();saveAs(new Blob([b],{type:"application/octet-stream;charset=utf-8"}),a)})});w.append(a("<img>",{src:t}));w.append(a("<p>").text(n));y.append(w);f.append(y)}});(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){function b(){console.log("mm export");var a=new XMLWriter,b=-1;a.indentChar=" ";a.indentation=4;a.writeStartDocument();a.writeStartElement("map");a.writeAttributeString("version","0.9.0");return{generate:function(l){console.log("generate:",l);for(var n=0,n=l.level;n<=b;n++)a.writeEndElement();a.writeStartElement("node");a.writeAttributeString("TEXT",l.markdown);a.writeAttributeString("FOLDED","false");
1==l.level&&a.writeAttributeString("POSITION",l.leftright);a.writeStartElement("edge");a.writeAttributeString("COLOR",l.colour);a.writeEndElement();a.writeStartElement("font");a.writeAttributeString("NAME","Helvetica");a.writeAttributeString("SIZE","10");a.writeEndElement();b=l.level},finish:function(){return a.flush({suppress_xml_tag:!0})}}}a.fn.addMMExportIcon=function(){a(this).addExportIcon({extension:".mm",name:".mm File",icon:CDN+"/img/mm_export.png",start:b})}});(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){function b(a,b){var d=Array(b+1).join(f);return d+a.split(/\r?\n/).join("\n"+d)}function d(){console.log("plaintext export");var a=[];return{generate:function(d){a.push(b(d.markdown,d.level))},finish:function(){return a.join("\n")}}}var f="    ";a.fn.addTextExportIcon=function(){a(this).addExportIcon({extension:".txt",name:"Plain-Text Outline",icon:CDN+"/img/txt_export.png",start:d})}});(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){a.discreteSlider=function(b){return a.discreteSlider.init(a(b))};a.extend(a.discreteSlider,{settings:{draggable:{containment:"parent",axis:"y",grid:[20,20],stop:function(){var b=parseInt(a(this).css("top")),b=a(this).parent().children()[Math.round(b/a.discreteSlider.settings.draggable.grid[1])];a(this).trigger("positionchange",b)}}},maxElements:function(b){var f=a.discreteSlider.settings.draggable.grid[1];
return Math.floor(a(b).height()/f)}});var b={init:function(){return this},addStop:function(b){var f=a("<li data="+b.data.toJSON()+">");b["class"]&&f.addClass(b["class"]);var l=a('<div class="marker">');if(b.label){var n=a('<div class="label">');n.append(b.label);f.append(n)}f.append(l);a(this).append(f);f.click(function(){if("disabled"!=a(this).parent().attr("disabled")){a(this).trigger("positionchange",this);var b=a(this).prevAll().length*a.discreteSlider.settings.draggable.grid[1],d=a(this).parent().children(".slider");
0!=d.length&&(d.css("top",d.position().top),d.animate({top:b}))}})},addSlider:function(){var b=a('<div class="slider">');a(this).append(b);a(b).draggable(a.discreteSlider.settings.draggable)}};a.fn.discreteSlider=function(a,f){var l=a?b[a]:b.init;if(!l)throw Error("Unknown function name '"+a+"' for discreteSlider");this.each(function(){l.call(this,f)});return this}});(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){a.fn.getInputSelection=function(){var a=this[0],d=0,f=0,l,n,t;if("number"==typeof a.selectionStart&&"number"==typeof a.selectionEnd)d=a.selectionStart,f=a.selectionEnd;else if((n=document.selection.createRange())&&n.parentElement()==a)t=a.value.length,l=a.value.replace(/\r\n/g,"\n"),f=a.createTextRange(),f.moveToBookmark(n.getBookmark()),a=a.createTextRange(),a.collapse(!1),-1<f.compareEndPoints("StartToEnd",
a)?d=f=t:(d=-f.moveStart("character",-t),d+=l.slice(0,d).split("\n").length-1,-1<f.compareEndPoints("EndToEnd",a)?f=t:(f=-f.moveEnd("character",-t),f+=l.slice(0,f).split("\n").length-1));return{start:d,end:f}}});(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){a.fn.googleContacts=function(b){function d(){this.settings=a.extend(a.fn.googleContacts.defaults,b);this.addIcon=function(){var b=a("<a class='google'><img src='"+CDN+"/img/google-icon.png'/ alt='Google' title='Import contacts'></a>");a(f).append(b);b.click(this.auth.bind(this));a(this.settings.target).hide();a(f).bind("contacts",function(){a(this.settings.target).slideDown();b.click(function(){_gaq.push(["_trackEvent",
"Invite","Contacts","Click"]);a(this.settings.target).slideToggle("down")}.bind(this))}.bind(this));window.setTimeout(function(){var a=this.settings.scopes,b=this.settings.clientId;window.gapi&&window.gapi.auth&&gapi.auth.authorize({client_id:b,scope:a,immediate:!0},function(){})}.bind(this),2E3);return this};this.auth=function(){console.log("authing....");var a=this.settings.scopes,b=this.settings.clientId;gapi.auth.getToken()?this.contacts():gapi.auth.authorize({client_id:b,scope:a,immediate:!1},
this.contacts.bind(this));return this};this.myContactsId=function(b){var d=gapi.auth.getToken();a.getJSON("https://www.google.com/m8/feeds/groups/default/full?callback=?",{access_token:d.access_token,alt:"json"},function(a){this.groups=a;b()}.bind(this))};this.contacts=function(){console.log("getting contacts");if(this.gotContacts)return console.log("already got contacts");if(!this.groups)return this.myContactsId(this.contacts.bind(this));if(gapi.auth.getToken()){a(this.settings.target).empty();var b=
gapi.auth.getToken();a.getJSON("https://www.google.com/m8/feeds/contacts/default/thin?callback=?",{access_token:b.access_token,alt:"json","max-results":5E3,group:"http://www.google.com/m8/feeds/groups/"+this.groups.feed.id.$t+"/base/6"},function(b){this.gotContacts=!0;var d=[];b.feed.entry.map(function(a){a.gd$email&&d.push({name:a.title.$t,email:a.gd$email})});d.sort(function(a,b){return(0<a.name.length?a.name:a.email[0].address).localeCompare(0<b.name.length?b.name:b.email[0].address)});a(f).trigger("contacts",
[d]);this.addAllContact();d.map(function(a){this.addContact.bind(this)(a)}.bind(this))}.bind(this))}else this.auth.bind(this)(this.contacts);return this};this.addContact=function(b){if(b.email){var d=a("<li></li>"),f=a('<span class="name"></span>');d.attr("name",b.name);var s=b.email.map(function(b){var d=a('<div class="container"></div>'),f=a('<span class="email">'+b.address+"</span>");d.append(f);d.attr("email",b.address);d.attr("title",b.address);return d});0<b.name.length?f.text(b.name):f.text(b.email[0].address);
d.append(f);d.append(s);d.click(function(){a(this).find(".container").toggleClass("selected")});s.map(function(b){b.click(function(b){a(this).toggleClass("selected");b.stopPropagation()})});a(this.settings.target).append(d);return this}};this.addAllContact=function(){var b=a('<li class="all"></li>'),d=a('<span class="name">Select All</span>');b.append(d);b.click(function(){0<this.selected().length?a(this.settings.target).find(".container").removeClass("selected"):a(this.settings.target).find(".container").addClass("selected")}.bind(this));
a(this.settings.target).append(b);return this};this.selected=function(){var b=a(this.settings.target).find(".selected"),d=[];a(b).each(function(){a(this).hasClass("all")||d.push(a(this).attr("email"))});return d}.bind(this);this.clearSelection=function(){a(this.settings.target).find(".selected").removeClass("selected");return this}.bind(this);return this.addIcon()}var f=this;this.googleContactsInitialised||(this.googleContacts.state=new d,this.googleContactsInitialised=!0);return this};a.fn.googleContacts.defaults=
{clientId:"",scopes:"https://www.google.com/m8/feeds"}});/*
 
 Copyright Coggle 2013. All Rights reserved.
*/
(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){a.fn.detectInputTypes=function(){function a(){y.length>t&&y.splice(0,y.length-t)}function d(){var a=_.countBy(y,function(a){return a}),b=a[n]||0,a=b/(b+(a[l]||0))>w?n:l;s!==a&&(s=a,f.trigger(a))}var f=this,l="mouseInputPrevalent",n="touchInputPrevalent",t=8,s=null,y=[],w=0.4;f.each(function(f,q){q.addEventListener("mousedown",function(f){y.push(l);a();d()},!0);q.addEventListener("touchstart",function(f){y.push(n);
a();d()},!0)})};a.fn.touchResponsive=function(b,d){function f(){a(n).removeClass(s).addClass(t);a(window).width()>E?a(n).removeClass(y).addClass(w):a(n).removeClass(w).addClass(y)}function l(){a(n).removeClass(t).addClass(s);a(n).removeClass(w).removeClass(y)}d=d||{};var n=d.selector||"body",t=d.touch_class||"touch",s=d.desktop_class||"desktop",y=d.phone_class||"phone",w=d.tablet_class||"tablet",E=d.phone_width||600;a(b).detectInputTypes();a(b).on("touchInputPrevalent",f);a(b).on("mouseInputPrevalent",
l);var q=BrowserDetect;"iOS"==q.OS||"Android"==q.OS||"Blackberry"==q.OS?f():l()}});(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){a.fn.markdownShortcuts=function(b){function d(a,b,d){a.createTextRange?(a=a.createTextRange(),a.collapse(!0),a.moveStart("character",b),a.moveEnd("character",d),a.select()):void 0!==a.selectionStart&&a.setSelectionRange(b,d)}function f(a,b,f){var l=a.value;if(l.lastIndexOf(f,b.start)==b.start-f.length&&l.indexOf(f,b.end)==b.end)a.value=l.slice(0,b.start-f.length)+l.slice(b.start,b.end)+l.slice(b.end+f.length),
d(a,b.start-f.length,b.end-f.length);else if((-1==l.lastIndexOf(f,b.start)||l.lastIndexOf(f,b.start)!=b.start-f.length)&&(-1==l.indexOf(f,b.end)||l.indexOf(f,b.end)!=b.end))a.value=l.slice(0,b.start)+f+l.slice(b.start,b.end)+f+l.slice(b.end),d(a,b.start+f.length,b.end+f.length)}var l=a(this),n=b.modifier_tracker;if("undefined"===typeof n||"undefined"===typeof n.control_key_pressed||"undefined"===typeof n.meta_key_pressed)throw"options.modifier_tracker must be set to an object that tracks modifier keys";
l.on("keydown",function(a){if((66==a.keyCode||73==a.keyCode)&&(n.control_key_pressed||n.meta_key_pressed)&&!n.shift_key_pressed&&!n.alt_key_pressed){var b=l.getInputSelection();66==a.keyCode&&f(l[0],b,"**");73==a.keyCode&&f(l[0],b,"*")}})}});(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){var b={left_min:0,left_max:800,top_min:0,top_max:600};a.fn.restrictScroll=function(d){function f(){var a=l.scrollLeft(),b=l.scrollTop(),d=n.left_min,f=n.left_max,E=n.top_min,q=n.top_max;a<d?l.scrollLeft(Math.round((d+a+1)/2)):a>f&&l.scrollLeft(Math.round((f+a-1)/2));b<E?l.scrollTop(Math.round((E+b+1)/2)):b>q&&l.scrollTop(Math.round((q+b-1)/2))}var l=a(this),n=a.extend(b,d);l.on("RestrictScroll_SetBounds",
function(a,b){"undefined"!==typeof b.left_min&&(n.left_min=b.left_min);"undefined"!==typeof b.left_max&&(n.left_max=b.left_max);"undefined"!==typeof b.top_min&&(n.top_min=b.top_min);"undefined"!==typeof b.top_max&&(n.top_max=b.top_max);f()});l.on("scroll",f)}});/*

 Sage Menu Copyright Coggle 2014
*/
(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){function b(a){_gaq&&_gaq.push&&_gaq.push(["_trackEvent"].concat(a))}function d(a){return"function"===typeof a?a():a}function f(a){var b=50+39*Math.sin(a);a=50-39*Math.cos(a);return{left:b+"%",top:a+"%"}}function l(a){a.preventDefault()}var n=Math.PI,t=50,s=25;Coggle_Version||Math.random().toString(16).slice(2,6);var y=function(a){a=tinytinycolor(a).toHsl();a.l*=0.5;a.s*=0.7;return tinytinycolor(a).toHexString()};
a.fn.sageButton=function(b,d,f){var l=a("<div/>",{"class":"sagebutton"}).css({width:0.2*b+"px",height:0.2*b+"px","background-color":f});"#fff"==f|"#ffffff"==f&&l.css({border:"2px solid rgba(0,0,0,0.1)"});d&&(a(d).hasClass(".sagebuttonicon")||a(d).addClass("sagebuttonicon"),l.append(d));l.animate({width:b+"px",height:b+"px"},150,"swing");return l};a.fn.sageHint=function(b,d,f,l,n){return a("<div/>",{"class":"sagehint"}).html(b).css({color:l,left:d+"px",top:f+"px",width:n.toFixed(2)+"%"}).hide().appendTo(a(this)).fadeIn(400)};
a.fn.sage=function(w){function E(a){var b=a.button;b.bind("mousedown",function(b){v(a);H.bind("mousemove ",r);H.one("mouseup",function(a){H.unbind("mousemove",r);F();return!1});return!1});b.attachTouchGestures();b.one("touchdragend",function(a){b.unbind("touchdrag",r);F();return!1});b.bind("touchdrag",r);b.bind("touchdragstart",function(b){v(a);return!1});b.bind("touchtap",function(){v(a);F()})}function q(a){var b=a.pageX-G.position().left-m/2,d=a.pageY-G.position().top-m/2;a=Math.sqrt(b*b+d*d);b=
Math.atan2(b,-d);return{r:a,t:b}}function v(a){b(["Sage","Commit",d(a.action.tip)]);V&&window.clearTimeout(Z);O=a;a.action.commit(G,a,C)}function r(a){O&&O.action.setParameter&&(a=q(a),O.action.setParameter(G,O,2*a.r/m,180*(a.t-O.theta)/n))}function B(a){z&&(null===aa&&(aa=a.pageX,X=a.pageY),Y=Math.max(Y,(a.pageX-aa)*(a.pageX-aa)+(a.pageY-X)*(a.pageY-X)),Y>s&&p());if(A&&!(G.outerWidth()<0.95*m)){var b=q(a),d=b.r,e=b.t;if(null===O){a=Math.min(1,3*d/m);var g=C.slice(0).sort(function(a,b){return Math.abs((a.theta-
e+n)%(2*n)-n)-Math.abs((b.theta-e+n)%(2*n)-n)})[0],b=g.action;W!==g&&(W&&(d=W.action,d.deactivate&&d.deactivate(G,W,C)),W=g);b.activate&&b.activate(a,G,g,C);1==a&&V!==g&&(V&&window.clearTimeout(Z),V=g,Z=window.setTimeout(function(){V=Z=null;v(g)},t))}else r(a)}}function D(a){27==a.keyCode&&(O&&O.action.cancel&&O.action.cancel(),O=null,F(),b(["Sage","Interact","Escape"]))}function F(){Q||(Q=!0,V&&(window.clearTimeout(Z),V=null),da&&(window.clearTimeout(da),da=null),O?(b(["Sage","Act",d(O.action.tip)]),
O.action.finish&&O.action.finish(),W=O=null):W?(b(["Sage","Act (Closest)",d(W.action.tip)]),W.action.finish&&W.action.finish(),W=null):b(["Sage","Interact","Abandon"]),G.animate({opacity:0},400,"swing",function(){G.remove()}),H.unbind("mousemove",B),I.unbind("mouseup",F),I.unbind("mouseup",e),I.trigger("sage.closed"),N.unbind("keydown",D),H.unbind("modifierschanged",g))}function g(){_.each(C,function(a){a.button.find(".sagehint").html(d(a.action.tip));var b=d(a.action.icon);b.hasClass(".sagebuttonicon")||
b.addClass("sagebuttonicon");a.button.find(".sagebuttonicon").replaceWith(b)})}function p(){Q||(I.bind("mouseup toughdragend",F),A=!0,b(["Sage","Interact","ClickHold"]))}function e(){z=!1}var m=w.size,h=w.x,u=w.y,A=w.clickhold||!1,z=!1,J=w.actions||{},R=w.colour,I=a(this),H=a(window),N=a(document),P="#fff"==R|"#ffffff"==R?1:0,G=a("<div>",{"class":"sagemenu",tabindex:"0"}).css({width:0.2*m+"px",height:0.2*m+"px",left:h-0.2*m/2+"px",top:u-0.2*m/2+"px"});w=m-0.40625*m;var S=a("<div/>",{"class":"sagering"}).css({width:0.2*
w+"px",height:0.2*w+"px",left:0.003125*m+"px",top:0.003125*m+"px",borderWidth:0.2*0.1875*m+"px",borderColor:R});P&&S.css({boxShadow:"0 0 5px rgba(0,0,0,0.2), inset 0 0 5px rgba(0,0,0,0.2)"});G.append(S);var C=[],K;for(K in J)if(J.hasOwnProperty(K)){var M=J[K],P=G.sageButton(0.25*m,d(M.icon),R),L=(M.at*(n/180)+n)%(2*n)-n,M={theta:L,action:M,button:P};C.push(M);P.css(f(L));E(M);G.append(P)}C.sort(function(a,b){return a.theta-b.theta});I.append(G);S.off("dragstart").on("dragstart",l);G.off("dragstart").on("dragstart",
l);G.animate({width:m+"px",height:m+"px",left:h-m/2+"px",top:u-m/2+"px"},150,"swing");S.animate({width:w+"px",height:w+"px",left:0.015625*m+"px",top:0.015625*m+"px",borderWidth:0.1875*m+"px"},150,"swing");var O=null,W=null,V=null,Z=null,Y=0,aa=null,X=null,Q=!1,da=null;A&&p();G.attachTouchGestures();G.bind("focusout",F);G.focus();N.bind("keydown",D);H.bind("mousemove",B);I.bind("mouseup",e);H.bind("modifierschanged",g);da=window.setTimeout(function(){Q||O||_.each(C,function(a){var b=d(a.action.tip),
e=(a.action.at*(n/180)+n)%(2*n)-n,g=-0.25*m/2+m*(1.34-1)*Math.sin(e),e=-8+-m*(1.34-1)*Math.cos(e);a.button.sageHint(b,g,e,y(R),200)})},1800);G.convertToClickHold=function(){z=!0};I.trigger("sage.opened");return G};a.fn.sage.Button_Scale=0.25;a.fn.sage.fadeOthers=function(a,b,d,f){d.button.css({opacity:1});_.each(_.filter(f,function(a){return a!==d}),function(b){b.button.css({opacity:Math.max(0,Math.min(1,1.2-1.2*a))})})};a.fn.sage.hideOthers=function(a,b,d){b.button.css({opacity:1});_.each(_.filter(d,
function(a){return a!==b}),function(a){a.button.hide()})};a.fn.sage.buttonLeftTopCss=f;a.fn.sage.version="unknown"});/*
 
 Copyright Coggle 2013. All Rights reserved.
*/
(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){function b(a,b){if(a in b)return b[a];throw'missing required option: "'+a+'"';}a.fn.trackModifiers=function(d){function f(){l({altKey:!1,shiftKey:!1,metaKey:!1,ctrlKey:!1})}function l(a){var b=a.altKey,d=a.shiftKey,f=a.metaKey||!a.metaKey&&a.altKey&&a.shiftKey,l=a.ctrlKey;"keyup"==a.type&&(16==a.keyCode&&d&&(d=!1),17==a.keyCode&&l&&(l=!1),18==a.keyCode&&b&&(b=!1));if(!(b==n[s]&&d==n[y]&&f==n[w]&&l==n[t]))for(x in a=
{},a[s]=b,a[y]=d,a[w]=f,a[t]=l,E.trigger("modifierschanged",a),a)a.hasOwnProperty(x)&&(n[x]=a[x])}var n=b("set_modifiers_on",d),t="control_modifier_property"in d?d.control_modifier_property:"control_key_pressed",s="alt_modifier_property"in d?d.alt_modifier_property:"alt_key_pressed",y="shift_modifier_property"in d?d.shift_modifier_property:"shift_key_pressed",w="meta_modifier_property"in d?d.meta_modifier_property:"meta_key_pressed",E=a(this);E.bind("keydown",l);E.bind("keyup",l);E.bind("blur",f);
f()}});var mathjaxconf='<script type="text/x-mathjax-config">MathJax.Ajax.config.root = "https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/",MathJax.Hub.Config({  messageStyle:"none",  skipStartupTypeset:true,});\x3c/script>';$("head").append($(mathjaxconf));window.mathjax_load_state="none";var queued_callbacks=[];
function ensureMathJax(a){queued_callbacks.push(a);if("loaded"==window.mathjax_load_state){for(a=0;a<queued_callbacks.length;a++)if(queued_callbacks[a])queued_callbacks[a]();queued_callbacks=[]}else"loading"!=window.mathjax_load_state&&(console.log("loading mathjax..."),$.getScript("https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML",function(){window.mathjax_load_state="loaded";ensureMathJax()}),window.mathjax_load_state="loading")};(function(a){"function"===typeof define&&define.amd?define(["underscore"],a):a(_)})(function(a){window.getLocalQueue=function(b){function d(){if(null===E)try{localStorage.setItem("testforlocalstorage","testforlocalstorage"),localStorage.removeItem("testforlocalstorage"),E=!0}catch(a){E=!1}return E}function f(){null===s&&(d()&&(s=JSON.parse(localStorage.getItem(n))),s||(s=[]),s.length?(y=JSON.parse(localStorage.getItem(t))||0,y+=1):y=0)}function l(){d()&&(localStorage.setItem(n,JSON.stringify(s)),
w||localStorage.setItem(t,JSON.stringify(y)),w=!0)}var n=("localqueue.v1.["+(location.protocol+"//"+location.host+location.pathname)+"]."+b).toLowerCase(),t=n+".load_count",s=null,y=null,w=!1,E=null;return{push:function(a){f();s.push(JSON.parse(JSON.stringify(a)));l();if(d()){if(localStorage.getItem(n)!==JSON.stringify(s))throw console.log("stored:",localStorage.getItem(n)),console.log("memory:",JSON.stringify(s)),"local storage round-trip failed!";}else console.log("local storage not saved: not supported!")},
pop:function(){f();var a=s.shift();l();return a},peek:function(){f();return s.length?s[0]:null},remove:function(a){s.splice(a,1);l()},any:function(b){f();var d=this;return a.some(s,function(a,f){a._remove=function(){d.remove(f)};var l=b(a,f);delete a._remove;return l})},length:function(){f();return s.length},clear:function(){s=[];l()},getArray:function(){f();return s},loadCount:function(){f();l();return y},supported:function(){return d()}}}});(function(){function a(){if(!f){f=!0;b.stored.disconnected=b.error("Connection lost: changes made now may not be saved. You could try to <a id='reconnectNow'>reconnect now</a>, or <a onclick='location.reload()'>reload the page</a>.",!1).hide();b.stored.history_mode=b.info("You are viewing previous versions of this Coggle! Close the history viewer to make changes.",!1).hide();b.stored.contact=b.suggestion("Questions? Feedback? Email us at <a href=mailto:hello@coggle.it>hello@coggle.it</a> We like to talk!",
!0,function(){$.cookie("dnd_contact","1",{expires:365,path:"/"})}).hide();b.stored.follow=b.suggestion('Follow us on <a href=https://twitter.com/intent/user?screen_name=coggleit id=Twitterfollow>Twitter</a>, <a href=https://www.facebook.com/coggleit id=Facebookfollow>facebook</a> or <a href="http://google.com/+CoggleIt">Google+</a> to keep up with the latest hints and features!',!0,function(){$.cookie("dnd_follow","1",{expires:365,path:"/"})}).hide();b.stored.autosaved=b.suggestion("Coggles are saved automatically, no need to wear out the S key!<br>(pro tip: open the same diagram in another window to see how fast changes are being synchronised!)",
!0).hide();for(var a in["Facebook","Twitter"])$("#"+a+"follow").click(function(){$.cookie("dnd_follow","1",{expires:365,path:"/"});_gaq.push(["_trackEvent","Follow",a]);trackOutboundLink(this);return!1})}}var b={createFor:function(a,b,d,f){if(this.enabled){a=$("<li>").append(b+"").addClass(a);if(d||void 0==d)d=$('<img id="notify-close" src="/img/notification-close.png"/>'),d.click(function(){$(this).parent().fadeOut(300,function(){$(this).remove();f&&f()})}),a.append(d);a.attr("refcount",1);a.hide_default=
a.hide;a.hide=function(){var a=this.attr("refcount");0==--a&&this.hide_default();this.attr("refcount",0>a?0:a);return this};a.show_default=a.show;a.show=function(a){var b=this.attr("refcount");0==b++&&this.show_default();a&&(self=this,window.setTimeout(function(){self.hide()},a));this.attr("refcount",0>b?0:b);return this};return a}},find:function(a){var b=null;$.each($("#notifications").find("li"),function(d,f){if($(f).text()==a)return b=f,!1});return b},remove:function(a){$(this.find(a)).find("#notify-close").trigger("click")},
error:function(a,d,f){a=b.createFor("error",a,d,f);$("#notifications").append(a);return a},warning:function(a,d,f){a=b.createFor("warning",a,d,f);$("#notifications").append(a);return a},info:function(a,d,f){a=b.createFor("info",a,d,f);$("#notifications").append(a);return a},suggestion:function(a,d,f){a=b.createFor("suggestion",a,d,f);$("#notifications").append(a);return a},enabled:!0,setEnabled:function(a){this.enabled=a},stored:{}},d={createFor:function(a,b){return $("<li>").append(b+"").addClass(a)},
hoverHint:function(a){a=d.createFor("hoverhint",a);$("#hints").append(a);return a}},f=!1;$(document).ready(a);$(window).bind("notify-info",function(a,d){var f=b.info(d);window.setTimeout(function(){f.fadeOut(300,function(){$(this).remove()})},3E3)});$(window).bind("notify-warning",function(a,d){var f=b.warning(d);$("#notifications").append(f);window.setTimeout(function(){f.fadeOut(300,function(){$(this).remove()})},6E3)});$(window).bind("notify-error",function(a,d){b.error(d)});window.ensureNotificationsSetup=
a;window.notifications=b;window.hints=d})();$(document).on("coggle.loadsidebar",function(a,b,d,f,l){function n(a){if($(".dialog.visible").length)return dialogAnimateOut.bind($(".dialog.visible"))();_gaq.push(["_trackEvent","Download","Select"]);trackOutboundLink({href:"/diagram/#{diagram._id}/print"},!0);a&&a.stopPropagation&&a.stopPropagation();dialogAnimateIn.bind(E)()}var t=$("#history").css("right"),s=$("#chat-toggle").colourCycler(function(){return $("#chat").is(":visible")});b.bind("chat",function(a){s.start(b.get("user",a.from).colour)});
$("#chat-toggle").click(function(){$("#chat").toggle();$("#chat").is(":hidden")?(_gaq.push(["_trackEvent","Sidebar","Show"]),$("#history").css("right",t)):($("#history").css("right","250px"),d.resizeChat())});$("#chat").toggle();var y=null;$("#viewhistory").click(function(a){y||(console.log("creating history view"),y=new HistoryView({diagramId:f.get("_id"),diagram:l}),$("#history").append(y.el));_gaq.push(["_trackEvent","History","View"]);$("#history").is(":visible")?(console.log("closing history mode"),
y.reset(function(){l.stopHistoryMode();$("#history").hide()})):(console.log("creating history view"),y.render(),l.startHistoryMode(),$("#history").show());a.preventDefault()});var w=null;$("#sharing-button").click(function(a){if($(".dialog.visible").length)return dialogAnimateOut.bind($(".dialog.visible"))();if(!w){w=new DiagramShareView({model:f,userId:globalUserId});var b=w.render().$el;b.closeable(function(a){dialogAnimateOut.bind(a)()});$("body").append(b)}a.stopPropagation();dialogAnimateIn.bind(w.$el)();
_gaq.push(["_trackEvent","Invite","Manage"]);trackOutboundLink({href:"/diagram/#{diagram._id}/share/manage"},!0)});var E=$("#print_select");E.closeable(function(a){dialogAnimateOut.bind(a)()});$("#holder").bind("starc.downloaddialog",n);$("#download").click(n);$("html").click(function(){dialogAnimateOut.bind($(".dialog.visible"))()});$("html").click(function(){dialogAnimateOut.bind($(".dialog.visible"))()});socket.on("joined",function(a){_gaq.push(["_trackEvent","Colab","joined","",b.users.count]);
$("#chat-toggle").text(b.users.count)});socket.on("left",function(a){$("#chat-toggle").text(b.users.count)})});(function(a){"function"===typeof define&&define.amd?define(["jquery","underscore"],a):a(jQuery,_)})(function(a,b){function d(){return{w:this.starc_node.starc.textWidth(),h:this.starc_node.starc.textHeight()}}function f(a){var l={offset:{x:a.starc.relX(),y:a.starc.relY()},reverse_side:void 0,children:[],bbox:d,starc_node:a};b.each(a.childNodes(),function(a){l.children.push(f(a))});return l}function l(a){if(a.starc_node.starc){var d=a.starc_node;d.starc.isRoot()||(d.starc.translate.toRelative(a.offset.x,
a.offset.y),d.paper.diagram.nodeMovedLocally(d));window.setTimeout(function(){b.each(a.children,function(a){l(a)})},5)}}a.fn.setupArrangeBranch=function(){a(this).bind("starc.arrange",function(b,d){var s=f(d);a.starcArrangeNodeTree(s,d.starc.isRoot(),function(a,b){if(a)throw a;l(b)})})}});(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){function b(a){return a+"px"}function d(a){for(var b=0;b<a.length;b++)(new Image).src=a[b]}function f(a){_gaq&&_gaq.push&&_gaq.push(["_trackEvent"].concat(a))}function l(d,f,l,s,t){function w(a){u||(a.append(m),m.css({transform:"rotate("+(d-p+"deg)"),"webkit-transform":"rotate("+(d-p+"deg)")}),u=!0)}var g=a.fn.sage.Button_Scale,p=90*(s-2)/-1.75,e=90-p,m=a("<img>",{src:y[l]}).css("z-index",1);m.css({opacity:0});
var h=0.3*g,u=!1;return{at:d,icon:a("<img/>",{src:E[l]}),tip:"zoom page",activate:function(d,e,p,l){a.fn.sage.fadeOthers(d,e,p,l);p.button.css({width:b(g*f*Math.max(h/g,1-d)),height:b(g*f*Math.max(h/g,1-d))});w(e);this.icon.css({opacity:Math.max(0.2,Math.min(1,1.2-1.2*d))});m.css({opacity:d})},deactivate:function(a,d,e){d.button.animate({width:b(g*f),height:b(g*f)},100,"swing");this.icon.css({opacity:""});m.animate({opacity:0},100,"swing")},commit:function(d,e,g){a.fn.sage.hideOthers(d,e,g);u?(e.button.css({width:b(h*
f),height:b(h*f)}),this.icon.css({opacity:0})):(w(d),e.button.animate({width:b(h*f),height:b(h*f)},200,"swing"),m.css({opacity:1},400,"swing"),this.icon.animate({opacity:0},400,"swing"))},setParameter:function(b,d,g,h){g=-p;h=Math.min(Math.max(g,h),e);g=2+-1.75*(h-g)/(e-g);b=b.offset();this.cx=b.left+f/2;this.cy=b.top+f/2;t.trigger("sage.zoom",[g,this.cx,this.cy]);d.button.css(a.fn.sage.buttonLeftTopCss((this.at+h)*n/180));d.button.find(".sagehint").text(Math.round(100*g)+"%")},finish:null,cancel:function(){t.trigger("sage.zoom",
[s,this.cx||0,this.cy||0])}}}var n=Math.PI,t=CDN+"/img/sage/",s="?"+(Coggle_Version||Math.random().toString(16).slice(2,6)),y=[t+"zoomscale-w.png"+s,t+"zoomscale.png"+s],w=[t+"undo-w.png"+s,t+"undo.png"+s],E=[t+"zoom-w.png"+s,t+"zoom.png"+s];d(y);d(E);d(w);a.fn.sageBackground=function(b){var d=a(this),n=b.initial_zoom,s=b.size,t=b.colour,t="#fff"==t|"#ffffff"==t?1:0,y=b.hasOwnProperty("readonly")?b.readonly:!1,n={zoom:l(55,s,t,n,d)};y||(n.undo={at:210,icon:a("<img/>",{src:w[t]}),tip:"undo",activate:a.fn.sage.fadeOthers,
commit:a.fn.sage.hideOthers,finish:function(){d.trigger("starc.undo")}},n.redo={at:150,icon:a("<img/>",{src:w[t]}).css({transform:"scaleX(-1)","webkit-transform":"scaleX(-1)"}),tip:"redo",activate:a.fn.sage.fadeOthers,commit:a.fn.sage.hideOthers,finish:function(){d.trigger("starc.redo")}});f(["Sage","Open","Background"]);return a(this).sage(a.extend(b,{actions:n}))};a.fn.sageBackground.zoomAction=l;a.fn.enableBackgroundSage=function(b){var d=b.filter,f=a(b.append_to),l=b.getInitialZoom,n=b.isReadOnly||
function(){return!1},s=a(this),g=100;s.bind("mousedown contextmenu touchhold",function(b){function e(b){var d=b.pageX-f.position().left,e=b.pageY-f.position().top,m=f.sageBackground({size:"touchhold"==b.type?160:128,x:d,y:e,clickhold:!1,initial_zoom:l(b),colour:"#ffffff",readonly:n()}),p=!0;"Windows"===BrowserDetect.OS&&"contextmenu"===b.type?p=!1:(a(window).one("mouseup",function(a){a.which==b.which&&(p=!1)}),window.setTimeout(function(){p&&m&&m.convertToClickHold()},g))}function m(){function a(){g&&
window.clearTimeout(g);s.unbind("mouseup",a);s.unbind("mousemove",d);g=null}function d(b){1<(b.pageX-f)*(b.pageX-f)+(b.pageY-m)*(b.pageY-m)&&a()}var g=window.setTimeout(function(){e(b);a()},700),f=b.pageX,m=b.pageY;s.bind("mouseup",a);s.bind("mousemove",d)}if(!d||d(b)){if("contextmenu"===b.type||"touchhold"===b.type)return e(b),b.preventDefault(),!1;m()}})}});(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){function b(a,b){if(a in b)return b[a];throw'missing required option: "'+a+'"';}!Coggle_Version&&(console&&console.warn)&&console.warn("No version available for static resources!");var d=CDN+"/img/",f="?"+(Coggle_Version||Math.random().toString(16).slice(2,6)),l={},n={},t=0,s=a(window),y=null,w=null,E=null,q=null,v=null,r=function(a){a.$img.attr({src:d+"addbutton.svg"+f});a.setSize();a.$button.removeClass("rotated")},
B=function(a){a.$img.attr({src:d+"addbutton.svg"+f});a.$button.addClass("rotated")},D=function(a){a.$img.attr({src:d+"squashbutton.svg"+f});a.$button.removeClass("rotated")},F=function(a,b){a.starc.addChildNode(b)},g=function(a,b){a.starc.insertNode(b)},p=function(a){a.starc.removeNode()},e=function(a){a.starc.squashNode()},m=function(a,b){var h=b.alt_key_pressed,m=b.shift_key_pressed,l=b.meta_key_pressed,n=b.control_key_pressed;a.ignores_modifiers||(h&&!m&&!l&&!n?(B(a),w=p,q="remove this branch: release [alt] to add branch instead"):
m&&!h&&!l&&!n?(a.$img.attr({src:d+"insertbutton.svg"+f}),a.$button.removeClass("rotated"),w=g,q="insert text: release [shift] to add branch instead"):l&&!m&&!h&&!n?(D(a),w=e,q="squash text: release [cmd] to add branch instead"):n&&m&&!h&&!l?(D(a),w=e,q="squash text: release [ctrl]+[shift] to add branch instead"):n&&!m&&!h&&!l?(B(a),w=p,q="remove this branch: use [ctrl]+[shift] to squash this text instead"):(r(a),w=F,q="click to add branch: hold "+E+" to remove instead"),s.trigger("starc.changehint",
[q]))},w=F,h=function(a,b){for(var d in l)l.hasOwnProperty(d)&&m(l[d],b);y=b};a.fn.addStarcButton=function(d){function e(a){W=a||"#fff";L.css("background-color",W)}function g(a){Z=a;a-=1;var b=2*a-4;L.css({width:2*a+"px",height:2*a+"px",margin:-(a+1.5)+"px"});V.$img.css({width:b+"px",height:b+"px",left:a-b/2+"px",top:a-b/2+"px"})}function f(a){y&&m(V,y);var b=/^#?([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})$/i.exec(W);c=b?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16)}:null;L.css({opacity:"1",
"background-color":"rgba("+c.r+","+c.g+","+c.b+","+a+")"});l[O]=V}function p(){L.css({opacity:""});delete l[O]}function B(a){if(D&&D.starc&&D.starc.drag&&D.starc.drag.move_fn){var b=P(a);D.starc.drag.move_fn.call(D,b.x-Y.x,b.y-Y.y,b.x,b.y,a)}}function H(a){var b;S()&&(w&&!D.starc.drag.not_a_short_drag&&(D.starc.drag.completed=!0,M?F(D,K):w(D,K)),b=!1);s.unbind("mousemove",B);s.unbind("mouseup",H);L.unbind("mouseup",H);D&&(D.starc&&D.starc.drag&&D.starc.drag.up_fn)&&D.starc.drag.up_fn.call(D,a);return b}
var D=b("target",d),P=b("coordsFromEvent",d),G=b("visibleFilter",d),S=b("actionFilter",d),C=b("modifier_events",d);E=b("remove_modifier_key",d);q="click to add branch: hold "+E+" to remove instead";var K=b("side",d),M="ignores_modifiers"in d?d.ignores_modifiers:!1;$el=a(this);var L=a("<div/>",{"class":"starcbutton"}),O=t++,W=null,V={};V.$img=a("<img/>").appendTo(L);n[O]=V;var Z=null;L.hover(function(){G()&&(f(1),s.trigger("starc.showhint",[q]))},function(){p();s.trigger("starc.hidehint")});var Y=
null;L.on("mousedown",function(a){if(!(a.which&&3==a.which||a.button&&2==a.button)&&S())return s.on("mousemove",B),s.on("mouseup",H),L.on("mouseup",H),D&&(D.starc&&D.starc.drag&&D.starc.drag.down_fn)&&(Y=P(a),D.starc.drag.down_fn.call(D,Y.x,Y.y,a)),!1});v||(v=h,C.on("modifierschanged",h));V.show=function(a){G()&&f(a)};V.hide=function(){p()};V.remove=function(){delete n[O];delete l[O];L.remove()};V.setSize=function(a){"undefined"===typeof a?g(Z):g(a)};V.setColour=function(a){e(a)};V.setOffset=function(a,
b){L.css({top:b+"px",left:a+"px"})};V.$button=L;V.ignores_modifiers=M;e(b("colour",d));g(b("radius",d));y?m(V,y):r(V);L.appendTo($el);return V}});(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){function b(a,b){var d=/^\[([^\]]+)\]\(([^)]+)\)$/.exec(a);d&&(a=d[1]);return"["+a+"]("+b+")"}function d(b,d,f){console.log("Failed to create linked coggle:",b,d,f);a(window).trigger("notify-error","Failed to create linked Coggle: "+d)}function f(b,d,l,n){var s=[];b.starc.foreachChild(function(b){var B=a.Deferred();a.ajax({type:"POST",url:t+"diagrams/"+l+"/nodes",contentType:"application/json; charset=utf-8",
dataType:"json",data:JSON.stringify({text:b.starc.markdown(),offset:{x:n?b.starc.relX()*b.starc.ltr():b.starc.relX(),y:b.starc.relY()},parent:d,color:b.starc.hexColour()})}).then(function(a){f(b,a._id,l,!1).then(B.resolve,B.reject)},function(a,b,d){B.reject(JSON.parse(a.responseText))});s.push(B)});return a.when.apply(a,s)}var l=window.location,n=l.origin||l.protocol+"//"+l.hostname+(l.port?":"+l.port:""),t="/api/1/",s=n+"/diagram/";a.fn.setupCogglify=function(){a(this).bind("starc.coggleify",function(l,
w,E){l=w.starc.displayedText();var q=w.starc.markdown();a.ajax({type:"POST",url:t+"diagrams",data:JSON.stringify({title:b(l||"Unnamed Coggle",n+window.location.pathname+"#"+w.starc.node_id.slice(0,6))}),contentType:"application/json; charset=utf-8",dataType:"json"}).fail(d).done(function(l,n,B){n=diagramModel.get("organisation");a.ajax({type:"PUT",url:t+"diagrams/"+l._id,data:JSON.stringify({organisation:n}),contentType:"application/json; charset=utf-8",dataType:"json"}).fail(function(a,b,d){console.log("Failed to set organisation:",
a,b,d)}).done(function(){});var y=b(q,s+l._id);a.ajax({type:"GET",url:t+"diagrams/"+l._id+"/nodes",contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(a){f(w,a[0]._id,l._id,!0).done(function(){console.log("copied successfully!");w.starc.setLabelText(y);E&&w.starc.foreachChild(function(a){a.starc.removeNode()})}).fail(function(a){console.log("copy failed :(",a)})}).fail(d)})})}});(function(a,b){a.fn.enableStarcEditText=function(d){var f=d.diagram,l=d.fns.textSizeFromLevel,n=d.fns.getSizeOfHtml,t=!1;a(this).bind("starc.edittext",function(d,y,w,E){function q(){E?A.focus():f.touchUIOnly()?(A.focus(),A[0].setSelectionRange(0,9999)):(A.focus(),window.setTimeout(function(){A[0].select()},1))}if(!t){t=!0;var v=w.starc.$text_div;y.starc.access_time=Date.now();var r=E?"":w.current_markdown,B=y.starc.tree_level,D=-1!=r.indexOf("\n");parseInt(v.css("paddingLeft"));parseInt(v.css("paddingRight"));
var F=parseInt(v.css("paddingTop")),g=parseInt(v.css("paddingBottom"));v.position();a("#holder").scrollTop();v.position();a("#holder").scrollLeft();var p="undefined"!==typeof y.starc.width,e=null,e=p?y.starc.width:60<v.width()?v.width():60,m=l(B);d=m+2;F=v.outerHeight()-F-g;F=F<m?m:F;m="#fff";"#fff"==w.text_colour&&(m=y.starc.colour);var h=y.paper;r==w.text_when_empty&&(r="");var u=a("<div/>",{id:"textAreaHolder"}).css({width:e+"px",height:F+"px"});p||v.css("width",e+"px");w.starc.text_popup=u;var A=
a("<textarea>",{id:"modalTxtArea",maxLength:3200}).css({"min-width":"60px","min-height":d+"px",resize:"none",color:w.text_colour,"background-color":m,"font-size":w.starc.font_size+"px"}).val(r);v.contents().hide();v.addClass("active");A.appendTo(u);v.append(u);u.bind("mousedown",function(a){a.stopPropagation()});u.bind("touchstart",function(a){a.stopPropagation()});A.markdownShortcuts({modifier_tracker:f});0<B&&!f.touchUIOnly()&&(0.5>Math.random()?f.displayModifierKeyHint("use [shift] + [return] to add more text at the same level"):
f.displayModifierKeyHint("use [tab] to add text at the next level"));var z=A.height()-A.outerHeight(),J=!1,R=function(){if(!p&&!D){var a=n(b.escape(A.val()),{"font-size":A.css("font-size")},!0).w+24;a>A.width()&&u.width(a)}else a=A[0].scrollHeight+z,a>A.height()&&u.height(a);J&&u.resizable("enable")},I=function(d){v.removeClass("active");A.triggerHandler("contentchanged");var e=A.val(),g=p&&e.length?u.width():void 0;p||v.css("width","");f.hideModifierKeyHint();u.remove();v.contents().show();!d&&y.starc&&
(e!==w.current_markdown&&!(0===e.replace(/ /g,"").length&&y.starc.text_label.isEmpty())&&y.starc.setLabelText(e),g!==y.starc.width&&y.starc.setLabelWidth(g));f.nodeClearFocus(y);b.each(y.starc.new_buttons,function(a){a.hide()});w.starc&&(w.starc.hover.out_fn&&w.starc.hover.out_fn.call(w),w.starc.text_popup=void 0,h.safari(),a("#holder").trigger("UserEditedText",y));t=!1},H=function(b,d){I();a("#holder").trigger("starc.edittext",[b,b.starc.text_label,d])},N=function(a,b){return b.starc.access_time-
a.starc.access_time},P=function(a){return a.starc.text_label.current_markdown===a.starc.text_label.text_when_empty},G=function(a){return function(b){return b!==a}},S=function(a){return function(b){return b.starc.translate.x<=a.starc.translate.x}},C=function(a){return function(b){return b.starc.translate.x>a.starc.translate.x}},K=function(){var a=b.filter(y.childNodes(),P).sort(N);a.length?H(a[0]):(a=0>y.starc.relX()?"left":"right",a=h.starc_child(y,"",a),H(a,!0))};A.focusout(function(){I()});A.keydown(function(a){a||
(a=window.event);var d;9==a.keyCode&&(a.preventDefault&&a.preventDefault(),f.shift_key_pressed?0<y.starc.tree_level&&(d=y.parentNode(),H(d)):K());if(f.shift_key_pressed&&f.alt_key_pressed&&37<=a.keyCode&&40>=a.keyCode)if(a.preventDefault&&a.preventDefault(),0===B)d=[],37==a.keyCode?d=b.filter(y.childNodes(),S(y)):39==a.keyCode&&(d=b.filter(y.childNodes(),C(y))),d.length&&H(d.sort(N)[0]);else{var e=y.starc.ltr();d=y.parentNode();if(39==a.keyCode&&0<e||37==a.keyCode&&0>e)d=y.childNodes(),d.length&&
H(d.sort(N)[0]);else if(39==a.keyCode&&0>e||37==a.keyCode&&0<e)H(d);else if(38==a.keyCode||40==a.keyCode){e=d.childNodes().sort(function(a,b){return b.starc.translate.y-a.starc.translate.y});1==B&&(e=y.starc.translate.x<=d.starc.translate.x?b.filter(e,S(d)):b.filter(e,C(d)));for(d=0;d<e.length;d++)if(e[d]==y){38==a.keyCode?H(e[(d+1)%e.length]):H(e[(d+e.length-1)%e.length]);break}}}});var M=function(){return f.control_key_pressed||f.alt_key_pressed||f.meta_key_pressed};A.keydown(function(b){b||(b=
window.event);var d;if(13==b.keyCode&&!f.shift_key_pressed){if(D||M()){D=!0;b=a(A[0]).getInputSelection().end;var e=A[0].value;A[0].value=e.substring(0,b)+"\n"+e.substring(b,e.length);e=A[0];b+=1;e.createTextRange?(e=e.createTextRange(),e.move("character",b),e.select()):void 0!==e.selectionStart&&e.setSelectionRange(b,b);A.triggerHandler("contentchanged")}}else if(90==b.keyCode&&(f.control_key_pressed||f.meta_key_pressed)&&A.val()==r)d=!1,I();return d});A.keyup(function(a){a||(a=window.event);var d;
13==a.keyCode&&f.shift_key_pressed?0!==B&&(a=b.filter(b.filter(y.parentNode().childNodes(),P),G(y)).sort(N),a.length?H(a[0]):(a=0>y.starc.relX()?"left":"right",a=h.starc_child(y.parentNode(),"",a),H(a,!0))):13==a.keyCode?(!D&&!M()&&I(),d=!1):90==a.keyCode&&(f.control_key_pressed||f.meta_key_pressed)?A.val()==r&&(d=!1,I()):27==a.keyCode&&(console.log("cancel edit:",A.val()),I(!0),d=!0);A.triggerHandler("contentchanged");return d});A.keypress(function(a){a||(a=window.event);var b;if(13==a.keyCode)M()&&
(D=!0),b=!1;else if(90==a.keyCode&&(f.control_key_pressed||f.meta_key_pressed)&&A.val()==r)b=!1,I();return b});A.bind("paste",function(){window.setTimeout(function(){A.trigger("contentchanged")},10)});A.bind("contentchanged",function(){var a=A.val();3200<a.length&&A.val(a.slice(0,3200));R()});if("Android"==BrowserDetect.OS||"Explorer"==BrowserDetect.browser&&10<=BrowserDetect.version){var L=0;A.click(function(a){L++||(q(),A.focus())});A.trigger("click")}else q();e=y.childNodes().length;y.starc.ttb();
m=y.starc.ltr();F="s";F=1==m!==0<e||0===y.starc.tree_level?F+"e":F+"w";u.resizable({minWidth:60,minHeight:d,handles:F});u.find(".ui-resizable-sw").addClass("ui-icon ui-icon-gripsmall-diagonal-sw");u.find(".ui-resizable-ne").addClass("ui-icon ui-icon-gripsmall-diagonal-ne");u.find(".ui-resizable-nw").addClass("ui-icon ui-icon-gripsmall-diagonal-nw");u.on("resizestart",function(){var a=u.width(),b=u.height();u.removeClass("resize-transition");u.on("resizestop",function(){u.width()!==a&&(p=!0);u.height()>
b&&(D=!0);u.off("resizestop");u.addClass("resize-transition")})});J=!0;R();u.addClass("resize-transition");f.nodeFocus(y)}})}})(jQuery,_);/*
 
 Copyright Coggle 2013. All Rights reserved.
*/
(function(a){function b(b,d,f,g,p){function e(a,b,d,e){q&&(l.scrollLeft(l.scrollLeft()-(b-r)),l.scrollTop(l.scrollTop()-(d-s)));r=b;s=d}function m(a,b,d,g){l.unbind("touchdrag",e);l.unbind("touchdragend",m)}this.paper=null;this.socket=b;this.mode=d?"r":"rw";this.user_actions=g;this.display_guide=(a.cookie("force_show_guide")||-1==g.indexOf("edit node"))&&!d;this.nodes={};this.root_node=null;this.viewpos={x:0,y:0};this.drop_target=this.drag_initial_viewpos=null;this.unreconciled=getLocalQueue("starc.unreconciled");
this.oldest_unreconciled_last_time_checked=this.unreconciled.peek();this.modifier_hint_text=this.modifier_hint=this.unreconciled_warning=null;var h=!0;this.undo_stack=[];this.redo_stack=[];this.queued_changes=[];this.panning_disabled=0;this.zoom_control=null;var l=a("#holder");a("#holder svg");var n=this;this.checkUnreconciled=function(){var a=null;n.unreconciled.length()&&(a=n.unreconciled.peek());null!==a&&a==n.oldest_unreconciled_last_time_checked&&(null===n.unreconciled_warning||!n.unreconciled_warning.is(":visible"))?
(n.unreconciled_warning=notifications.stored.disconnected,n.unreconciled_warning.show()):null===a&&null!==n.unreconciled_warning&&(n.unreconciled_warning.hide(),n.unreconciled_warning=null);n.oldest_unreconciled_last_time_checked=a};this.touchTap=function(a,b,d,e){document.activeElement.blur()};this.touchDoubleTap=function(a,b,d,e){};var q=!0;this.preventTouchDragging=function(){q=!1};this.allowTouchDragging=function(){q=!0};var r=0,s=0;this.touchDragStart=function(a,b,d,g){q&&!n.textPopupActive()&&
(l.bind("touchdrag",e),l.bind("touchdragend",m),s=r=0)};this.touchDragMove=e;this.touchDragEnd=m;this.onModifiersChanged=function(a,b){var d=b.shift_key_pressed,e=b.meta_key_pressed,g=b.control_key_pressed;b.alt_key_pressed||d||e||g?n.disableLabelEditing():n.enableLabelEditing()};var t=0;this.onKeyDown=function(b){b||(b=window.event);if(90==b.keyCode&&(n.meta_key_pressed||n.control_key_pressed)&&!n.alt_key_pressed&&!n.shift_key_pressed&&!n.textPopupActive())n.warnIfHistoryMode()||(n.undoStep(),b.preventDefault&&
b.preventDefault());else if(89==b.keyCode&&(n.meta_key_pressed||n.control_key_pressed)&&!n.alt_key_pressed&&!n.shift_key_pressed&&!n.textPopupActive())n.warnIfHistoryMode()||(n.redoStep(),b.preventDefault&&b.preventDefault());else if(90==b.keyCode&&(n.meta_key_pressed||n.control_key_pressed)&&n.shift_key_pressed&&!n.alt_key_pressed&&!n.textPopupActive())n.warnIfHistoryMode()||(n.redoStep(),b.preventDefault&&b.preventDefault());else if(83==b.keyCode&&(n.meta_key_pressed||n.control_key_pressed)&&!n.alt_key_pressed&&
!n.shift_key_pressed){var d=new Date;2E4<d.getTime()-t&&(t=d.getTime(),notifications.stored.autosaved.show(5E3),b.preventDefault&&b.preventDefault())}else if(80==b.keyCode&&(n.meta_key_pressed||n.control_key_pressed)&&!n.alt_key_pressed&&!n.shift_key_pressed)a("#holder").trigger("starc.downloaddialog"),b.preventDefault&&b.preventDefault();if(8==b.keyCode||32==b.keyCode)d=b.srcElement||b.target,"INPUT"===d.tagName.toUpperCase()&&("TEXT"===d.type.toUpperCase()||"PASSWORD"===d.type.toUpperCase()||"FILE"===
d.type.toUpperCase())||"TEXTAREA"===d.tagName.toUpperCase()?(d.readOnly||d.disabled)&&b.preventDefault():b.preventDefault();n.shift_key_pressed&&(n.alt_key_pressed&&37<=b.keyCode&&40>=b.keyCode)&&!n.textPopupActive()&&(d=n.rootNode(),a("#holder").trigger("starc.edittext",[d,d.starc.text_label,!1]));27==b.keyCode&&"Firefox"==BrowserDetect.browser&&b.preventDefault()};this.setViewBoxToContent=function(){var b=n.getSVGContentsBoundingRect(100);n.viewpos.x=b.xmin;n.viewpos.y=b.ymin;n.paper_width=b.xmax-
b.xmin;n.paper_height=b.ymax-b.ymin;n.paper.setSize(n.paper_width,n.paper_height);n.updateViewBox();l.scrollTop(0);l.scrollLeft(0);a("#holder svg").css({position:"static"})};this.onDrop=function(a){n.drop_target=n.coordsFromEvent(a)};this.disableLabelEditing=function(){h&&(h=!1)};this.enableLabelEditing=function(){!h&&!n.readOnly()&&(h=!0)};this.labelEditingEnabled=function(){return h};this.disableLabelInteraction=function(){l.addClass("suppress-label-events")};this.enableLabelInteraction=function(){l.removeClass("suppress-label-events")};
this.visitDepthFirst=function(a,b){function d(a,b){return a.starc.translate.y-b.starc.translate.y}function e(b){var g=b.starc.text_label;a({level:b.starc.tree_level,colour:b.starc.colour,width:b.starc.width,markdown:g.current_markdown!==g.text_when_empty?g.current_markdown:"",leftright:0<b.starc.tree_level&&b.starc.translate.x>=b.parentNode().starc.translate.x?"right":"left"});b.starc.foreachChild(e,d)}var g=new jQuery.Deferred;"undefined"==typeof b&&(b=this.rootNode());e(b);g.resolve();return g.promise()};
this.nameForUserId=function(a){return!p?"Unknown User":(a=p.get(a))?a.get("name"):"Unknown User"};this.colourForUserId=function(a){if(!p)return w(0);var b=0;p.find(function(d){b++;return d.id==a});return w(b)}}function d(b){b=b.clone();b.find(".callout").remove();b.find("img").replaceWith(function(){return a(this).attr("alt")||a(this).attr("title")});return b.text()}var f={fill:"#c8c8c8",stroke:"none"},l={fill:"none",stroke:"#c8c8c8","stroke-width":2.5,"stroke-dasharray":"-","stroke-linecap":"round"},
n={"font-size":"14px",fill:"#c8c8c8","font-family":"Comic Sans MS",cursor:"default"},t=function(a){return(18*Math.pow(0.8,a)+2)/2},s=function(a){return 0<=a&&5>=a?[17,15.3,13,11,9.4,9][a]:5<a?9:17},y=function(b,d){var f=document.createElement("div");document.body.appendChild(f);a(f).css({position:"absolute",left:0,bottom:-100,"white-space":"nowrap",display:"none",padding:"none",margin:"none"});a(f).html(b);a("font-size font-style font-weight font-family line-height text-transform letter-spacing width white-space".split(" ")).each(function(){var b=
this.toString();b in d&&a(f).css(b,d[b])});var g={w:a(f).outerWidth(),h:a(f).outerHeight()};a(f).remove();return g},w=function(a){var b="#7aa3e5 #67d7c4 #9ed56b #ebd95f #efa670 #e68782 #e096e9 #988ee3".split(" ");return b[r(a)%b.length]},E=function(a){return(words=_.filter(_.map(a.split(/[\s_#[\]()&.,;:!<>-]/,20),function(a){return a.replace(/'/g,"").toLowerCase()}),function(a){return a.length}))?words.join("-"):""},q=Math.max,v=Math.min,r=Math.abs;b.getSizeOfContent=function(a,b,d){b={"font-size":s(b)};
"undefined"!==typeof d&&(b.width=d+"px",b["white-space"]="");return y(marked(a),b)};b.toTitleText=function(b){return d(a("<div>",{html:marked(b).replace(/<br\/>|\n/g," ")})).replace(/^ *| *$/g,"")};(function(d){d.browser_platform="iOS"==BrowserDetect.OS||"Android"==BrowserDetect.OS||"Blackberry"==BrowserDetect.OS?"touch":0<=navigator.platform.search("Mac")?"darwin":"unknown";d.remove_modifier_key_text="darwin"==d.browser_platform?"alt":"ctrl";d.remove_modifier_key="["+d.remove_modifier_key_text+"]";
d.undo_redo_modifier_key_text="darwin"==d.browser_platform?" \u2318 ":"ctrl";d.undo_key="["+d.undo_redo_modifier_key_text+"] + [Z]";d.redo_key="["+d.undo_redo_modifier_key_text+"] + [shift] + [Z]";d.touchUIOnly=function(){return"touch"==this.browser_platform};d.init=function(b,d){var e=this;if(null===this.paper){this.paper_width=2E4<a(window).width()?a(window).width():2E4;this.paper_height=2E4<a(window).height()?a(window).height():2E4;this.paper=Raphael("holder",this.paper_width,this.paper_height);
a("#holder").scrollTop(this.paper_height/2);a("#holder").scrollLeft(this.paper_width/2);a("#holder").dragscrollable({preventDefault:!1,filter:function(){return!e.panning_disabled},dragScale:function(){return 1/e.zoom_control.current_zoom}});a("#holder").restrictScroll({left_min:this.paper_width/2,left_max:this.paper_width/2,top_min:this.paper_height/2,top_max:this.paper_height/2});a("#holder").on("Diagram_LayoutChanged",function(){e.qScrollBoundsUpdate()});marked.setOptions({gfm:!0,tables:!1,breaks:!0,
pedantic:!1,sanitize:!0,smartLists:!0,smartypants:!1});this.paper.diagram=this;if(Raphael.hasOwnProperty("diagram"))throw"only a single diagram per Raphael instance is supported";Raphael.diagram=this;Math.seedrandom?Math.seedrandom():f.trigger("notify-warning","Failed to seed random number generator, please reload.");var f=a(window),h=a("#holder");f.trackModifiers({set_modifiers_on:this});f.bind("keydown",this.onKeyDown);f.bind("modifierschanged",this.onModifiersChanged);f.bind("starc.showhint",function(a,
b){e.displayModifierKeyHint(b)});f.bind("starc.changehint",function(a,b){e.modifier_hint_text&&e.displayModifierKeyHint(b)});f.bind("starc.hidehint",function(a){e.hideModifierKeyHint()});d||h.attachTouchGestures(function(){return!(e.textPopupActive()||e.historyMode()||e.readOnly())});h.bind({touchtap:this.touchTap,touchdragstart:this.touchDragStart,touchdoubletap:this.touchDoubleTap});h.bind("drop",this.onDrop);f=a("#holdersquared");e.zoom_control=a("#zoomcontainer").starcZoom({scroll_element:h,container_element:f,
post_zoom:function(){e.updateScrollBounds()}});h.enableBackgroundSage({filter:function(b){return a(b.target).is("svg")||a(b.target).is("#holder")},append_to:f,getInitialZoom:function(){return diagram.zoom_control.current_zoom},isReadOnly:function(){return e.readOnly()||e.historyMode()}});f.bind("sage.opened",function(){e.panning_disabled+=1});f.bind("sage.closed",function(){0<e.panning_disabled&&(e.panning_disabled-=1)});f.bind("starc.undo",function(){e.undoStep()});f.bind("starc.redo",function(){e.redoStep()});
f.bind("starc.add",function(a,b,d){b.starc&&b.starc.addChildNode(d)});f.bind("starc.remove",function(a,b){b.starc&&0<b.starc.tree_level&&b.starc.removeNode()});f.bind("starc.squash",function(a,b){b.starc&&0<b.starc.tree_level&&b.starc.squashNode()});f.bind("starc.duplicate",function(a,b){function d(a,b){_.each(a.childNodes(),function(a){if(a!==g){var f=e.paper.starc_child(b,a.starc.markdown());f.starc.translate.toRelative(a.starc.relX(),a.starc.relY());e.nodeMovedLocally(f);d(a,f)}})}var g=null,g=
b.starc.isRoot()?e.paper.starc_child(b,b.starc.markdown()):e.paper.starc_child(b.parentNode(),b.starc.markdown());g.starc.translate.to(b.starc.translate.x,b.starc.translate.y+100);e.nodeMovedLocally(g);d(b,g)});f.setupCogglify();f.setupArrangeBranch();h.enableStarcTextWidgets({diagram:this});h.enableStarcEditText({diagram:this,fns:{textSizeFromLevel:s,getSizeOfHtml:y}});h.coggleLocalScroll();h.bind("starc.localLink",function(a,b){var d=e.elementsForFragment(b);d.length&&h.trigger("starc.scrollTo",
d)});h.setupStarcLinkEvents({normalise_fn:E});h.setupStarcLinkControl({diagram:this});window.setInterval(this.checkUnreconciled,5E3)}d&&this.disableLabelEditing();this.updateViewBox();this.socket=b};d.onDelta=function(a,b){a.data&&("width"in a.data&&null===a.data.width)&&(a.data.width=void 0);"data"in a&&("escaped"in a&&a.escaped)&&"text"in a.data&&(a.data.text=_.unescape(a.data.text));if(this.historyMode()&&!b)this.queued_changes.push(a);else switch(a.type){case "node focused":this.onNodeFocus(a);
break;case "focus cleared":this.onNodeClearFocus(a);break;case "root node added":this.onRootNodeAdded(a);break;case "node added":this.onNodeAdded(a);break;case "node reparented":this.onNodeReparented(a);break;case "node edited":this.onNodeEdited(a);break;case "node painted":this.onNodePainted(a);break;case "node resized":this.onNodeResized(a);break;case "root edited":this.onRootEdited(a);break;case "node moved":this.onNodeMoved(a);break;case "node removed":this.onNodeRemoved(a,b)}};d.onLoaded=function(){console.log("loaded: perform reconciliation");
this.applyUnreconciled()};d.onFileUpload=function(b){if(!this.warnIfHistoryMode()){if(!this.drop_target)throw"no target position for file!";var d=this.closestNode(this.drop_target.x,this.drop_target.y);b=this.paper.starc_child(d,"![image description]("+b+")",this.drop_target.x<d.starc.translate.x?"left":"right");b.starc.translate.to(this.drop_target.x,this.drop_target.y);a("#holder").trigger("starc_subtreemoved",[b]);b.starc.setOxOy();1==b.starc.tree_level&&b.parentNode().starc.displayAddNodeHintsIfNecessary();
this.nodeMovedLocally(b);this.drop_target.x+=60*b.starc.ltr()}};d.startHistoryMode=function(){this.historyMode()||(a("#holder").addClass("historymode"),notifications.stored.history_mode.show(),this.mode+="h",this.queued_changes=[],a.each(this.nodes,function(a,b){b.starc.showOwner()}))};d.stopHistoryMode=function(){if(this.historyMode()){a("#holder").removeClass("historymode");notifications.stored.history_mode.hide();this.mode=this.mode.replace("h","");for(var b=0;b<this.queued_changes.length;b++)this.onDelta(this.queued_changes[b]);
this.queued_changes=[];a.each(this.nodes,function(a,b){b.starc.hideOwner()})}};d.historyMode=function(){return-1!=this.mode.indexOf("h")};d.readOnly=function(){return-1==this.mode.indexOf("w")};d.displayHistoryModeWarning=function(){notifications.warning("Unable to do that at the moment! Try closing the history viewer first.")};d.warnIfHistoryMode=function(){return this.historyMode()?(this.displayHistoryModeWarning(),!0):!1};d.mouseCoordsRelToDoc=function(a){var b={x:0,y:0};a||(a=window.event);if(a.pageX||
a.pageY)b.x=a.pageX,b.y=a.pageY;else if(a.clientX||a.clientY)b.x=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,b.y=a.clientY+document.body.scrollTop+document.documentElement.scrollTop;return b};d.textPopupActive=function(){return!!a("#modalTxtArea").length};d.updateViewBox=function(){this.paper.setViewBox(this.viewpos.x,this.viewpos.y,this.paper_width,this.paper_height);_.each(this.nodes,function(a){a.starc.text_label.updateHtmlPosition()})};d.collides=function(a,b,d,f){var h=
a;a+=d;d=b-f/2;b+=f/2;a<h&&(f=a,a=h,h=f);for(f=this.paper.bottom;f;){if(f.starc&&f.starc.$text_div){var l=f.getBBox_fixed();if(!(a<l.x&&h<l.x||a>l.x2&&h>l.x2||b<l.y&&d<l.y||b>l.y2&&d>l.y2))return!0}f=f.next}return!1};d.getSVGContentsBoundingRect=function(a){for(var b={xmin:null,ymin:null,xmax:null,ymax:null},d=this.paper.bottom;d;){if(!(d.starc.translate.x-100>b.xmin&&d.starc.translate.x+100<b.xmax&&d.starc.translate.y-100>b.ymin&&d.starc.translate.y+100<b.ymax)){var f=d.getBBox_fixed?d.getBBox_fixed():
d.getBBox();b.xmin=null===b.xmin||f.x<b.xmin?f.x:b.xmin;b.ymin=null===b.ymin||f.y<b.ymin?f.y:b.ymin;b.xmax=null===b.xmax||f.x2>b.xmax?f.x2:b.xmax;b.ymax=null===b.ymax||f.y2>b.ymax?f.y2:b.ymax}d=d.next}b.xmin=Math.round(b.xmin-a);b.ymin=Math.round(b.ymin-a);b.xmax=Math.round(b.xmax+a);b.ymax=Math.round(b.ymax+a);return b};d.updateScrollBounds=function(){var b=this.getSVGContentsBoundingRect(0),d=a("#zoomcontainer").height(),e=a("#zoomcontainer").width();b.xmin+=-this.viewpos.x+20-e;b.xmax+=-this.viewpos.x-
20;b.ymin+=-this.viewpos.y+20-d;b.ymax+=-this.viewpos.y-20;a("#holder").trigger("RestrictScroll_SetBounds",{left_min:Math.round(b.xmin),left_max:Math.round(b.xmax),top_min:Math.round(b.ymin),top_max:Math.round(b.ymax)})};d.qScrollBoundsUpdate=a.coalesceCalls(function(){this.updateScrollBounds()},500);d.checkVersion=function(a){3<a.server_version&&location.reload(!0)};d.displayModifierKeyHint=function(a){!this.readOnly()&&a&&this.modifier_hint_text!=a&&(null!==this.modifier_hint&&this.modifier_hint.remove(),
this.modifier_hint=hints.hoverHint(a),this.modifier_hint_text=a)};d.hideModifierKeyHint=function(){null!==this.modifier_hint&&(this.modifier_hint.remove(),this.modifier_hint_text=this.modifier_hint=null)};d.getNodeForId=function(a){return this.nodes[a]};d.newNodeId=function(){var a=function(){return Math.floor(4294967296*Math.random()).toString(16)};return a()+a()+a()};d.ensureNodeHasId=function(a){a.starc.node_id||(a.starc.node_id=this.newNodeId())};d.pushUndo=function(a,b){b||(this.redo_stack.length=
0);a._undo_ts=new Date;this.undo_stack.push(a)};d.pushRedo=function(a){a._undo_ts=new Date;this.redo_stack.push(a)};d.doDelta=function(a){switch(a.type){case "node added":return this.performAndSendNodeAdded(a);case "node removed":return this.performAndSendNodeRemoved(a);case "node moved":return this.performAndSendNodeMoved(a);case "node edited":return this.performAndSendNodeEdited(a);case "node painted":return this.performAndSendNodePainted(a);case "node resized":return this.performAndSendNodeResized(a);
case "node reparented":return this.performAndSendNodeReparented(a);case "root edited":return this.performAndSendRootEdited(a);default:return console.log('un/re do "',a.type,'" not supported'),null}};d.undoStep=function(){if(0===this.undo_stack.length)notifications.find("Nothing more to undo!")||(notifications.info("Nothing more to undo!"),window.setTimeout(function(){notifications.remove("Nothing more to undo!")},5E3));else{a("#holder").trigger("UserUndid");for(var b=this.undo_stack,d=b[b.length-
1]._undo_ts.getTime()-200,e=null,f=null;0<b.length&&b[b.length-1]._undo_ts.getTime()>d;)e=b.pop(),f=this.doDelta(e),null!==f?this.pushRedo(f):console.log("WARNING: doDelta provided no reversal",e),d=e._undo_ts.getTime()-200;this.socket&&!("undid"in this.user_actions)&&this.socket.emit("update",{client_version:3,node_id:"0",type:"undid"})}};d.redoStep=function(){if(0===this.redo_stack.length)notifications.find("Nothing more to redo!")||(notifications.info("Nothing more to redo!"),window.setTimeout(function(){notifications.remove("Nothing more to redo!")},
5E3));else{a("#holder").trigger("UserRedid");for(var b=this.redo_stack,d=b[b.length-1]._undo_ts.getTime()-200,e=null,f=null;0<b.length&&b[b.length-1]._undo_ts.getTime()>d;)e=b.pop(),f=this.doDelta(e),null!==f?this.pushUndo(f,!0):console.log("WARNING: doDelta provided no reversal",e),d=e._undo_ts.getTime()-200;this.socket&&!("redid"in this.user_actions)&&this.socket.emit("update",{client_version:3,node_id:"0",type:"redid"})}};d.centreInScrolledView=function(b){var d=b.starc.translate.x;b=b.starc.translate.y;
var e=window.innerWidth,f=window.innerHeight;!1!==d&&("undefined"!==typeof d&&!1!==b&&"undefined"!==typeof b&&e&&f)&&(this.viewpos.x=d-e/2-window.pageXOffset-a("#holder").scrollLeft(),this.viewpos.y=b-f/2-window.pageYOffset-a("#holder").scrollTop(),this.updateViewBox())};d.applyUnreconciled=function(){if(this.unreconciled.supported()){var b=this,d=b.unreconciled.loadCount();if(5<=d){var e=b.unreconciled.length();notifications.warning("Changes made while disconnected have not been synchronised after "+
d+" attempts! If you continue to edit it may not be possible to reconcile future changes.<br>You can <a onclick='location.reload()'>reload the page</a> to try again, or <a id=syncdiscardrefresh>discard "+e+" change"+(1<e?"s":"")+"</a>",!0);a("#syncdiscardrefresh").on("click",function(){console.log("Discarding unsynchronised changes:",b.unreconciled.getArray());b.unreconciled.clear();window.location.reload()})}b.unreconciled.any(function(a){var d={server_version:3,owner_id:null,action_ts:new Date,
node_id:a.node_id};switch(a.type){case "add node":d.type="node added";d.data={text:a.text,colour:a.colour,width:a.width,pos:a.pos,parent_id:a.parent_id};break;case "move node":d.type="node moved";d.data={pos:a.pos};break;case "reparent node":d.type="node reparented";d.data={old_parent_id:a.old_parent_id,new_parent_id:a.new_parent_id};break;case "edit node":d.type="node edited";d.data={text:a.text};break;case "paint node":d.type="node painted";d.data={colour:a.colour};break;case "resize node":d.type=
"node resized";d.data={width:a.width};break;case "edit root":d.type="root edited";d.data={text:a.text};break;case "remove node":d.type="node removed";d.data={};break;default:throw'unknown unreconciled type: "'+a.type+'"';}try{switch(d.type){case "node added":b.performNodeAdded(d);break;case "node removed":b.performNodeRemoved(d,!0);break;case "node moved":b.performNodeMoved(d);break;case "node edited":b.performNodeEdited(d);break;case "node painted":b.performNodePainted(d);break;case "node resized":b.performNodeResized(d);
break;case "node reparented":b.performNodeReparented(d);break;case "root edited":b.performRootEdited(d);break;default:console.log('apply unreconciled: "',d.type,'" ',d," unknown!")}}catch(e){console.log("perform for reconciliation:",e),console.log("(probably because the change was already syncd)")}b.socket.emit("update",a);return!1})}else console.log("local storage not supported: will not preserve offline changes!")};d.onRootNodeAdded=function(d){this.checkVersion(d);if(void 0!==this.nodes[d.node_id])throw"Will not add root that already exists! Incremental compression error?";
if(this.root_node)throw"Only one root supported.";var f=this.paper.starc_root(d.data.text,d.data.width);f.starc.owner_id=d.owner_id;f.starc.action_ts=d.action_ts;f.starc.node_id=d.node_id;this.root_node=this.nodes[d.node_id]=f;f.starc.translate.to_actuallyDoTranslate(d.data.pos.x,d.data.pos.y);this.centreInScrolledView(f);window.setTimeout(f.starc.displayAddNodeHintsIfNecessary,200);this.historyMode()&&f.starc.showOwner();a("#holder").trigger("starc_rootadded",[f.starc.node_id,d.data.text]);a("#holder").trigger("Diagram_LayoutChanged");
window.document.title=b.toTitleText(d.data.text);this.display_guide&&a("#holder").trigger("coggle.startGuide")};d.onNodeAdded=function(a){this.checkVersion(a);this.unreconciled.any(function(b){if("add node"===b.type&&b.node_id===a.node_id&&b.parent_id===a.data.parent_id&&b.text===a.data.text&&b.width===a.data.width&&1E-4>r(parseFloat(b.pos.x)-parseFloat(a.data.pos.x))&&1E-4>r(parseFloat(b.pos.y)-parseFloat(a.data.pos.y)))return b._remove(),!0})||this.performNodeAdded(a)};d.performAndSendNodeAdded=
function(a){var b=this.performNodeAdded(a);return this.nodeAddedLocally_noUndo(this.nodes[a.data.parent_id],a.data.text,b)};d.performNodeAdded=function(b){var d=this.nodes[b.data.parent_id];if("undefined"===typeof d)throw console.log("unknown parent!",b.data.parent_id,b,this),"can't perform node added: unknown parent";if(void 0!==this.nodes[b.node_id])throw"Will not add node that already exists! Incremental compression error?";d=this.paper.starc_child_noMsg(d,b.data.text,"","#"+b.data.colour,b.data.width,
!1,!0);d.starc.translate.toRelative(b.data.pos.x,b.data.pos.y);d.starc.setOxOy();d.starc.owner_id=b.owner_id;d.starc.action_ts=b.action_ts;d.starc.node_id=b.node_id;this.nodes[b.node_id]=d;1==d.starc.tree_level&&d.parentNode().starc.displayAddNodeHintsIfNecessary();this.historyMode()&&d.starc.showOwner();a("#holder").trigger("starc_childadded",[d.starc.node_id,b.data.text]);a("#holder").trigger("Diagram_LayoutChanged");return d};d.onNodeMoved=function(a){this.checkVersion(a);this.unreconciled.any(function(b){if("move node"===
b.type&&b.node_id===a.node_id&&1E-4>r(parseFloat(b.pos.x)-parseFloat(a.data.pos.x))&&1E-4>r(parseFloat(b.pos.y)-parseFloat(a.data.pos.y)))return b._remove(),!0})||this.performNodeMoved(a)};d.performAndSendNodeMoved=function(a){var b=this.getNodeForId(a.node_id);if(void 0===b)throw"can't perform node moved: unknown node";var d=b.starc.relX(),f=b.starc.relY();this.performNodeMoved(a);return this.nodeMovedLocally_noUndo(b,d,f)};d.performNodeMoved=function(b){var d=this.getNodeForId(b.node_id);if(void 0===
d||d.starc.node_id!=b.node_id)throw console.log("unknown node!",d,b),"can't perform node move";d.parentNode();d.starc.translate.toRelative(b.data.pos.x,b.data.pos.y);d.starc.owner_id=b.owner_id;d.starc.action_ts=b.action_ts;this.historyMode()&&d.starc.showOwner();a("#holder").trigger("starc_subtreemoved",[d]);a("#holder").trigger("Diagram_LayoutChanged")};d.onNodeReparented=function(a){this.checkVersion(a);this.unreconciled.any(function(b){if("reparent node"===b.type&&b.node_id===a.node_id&&b.old_parent_id===
a.data.old_parent_id&&b.new_parent_id===a.data.new_parent_id)return b._remove(),!0})||this.performNodeReparented(a)};d.performAndSendNodeReparented=function(a){var b=this.getNodeForId(a.node_id),d=this.getNodeForId(a.data.old_parent_id),f=this.getNodeForId(a.data.new_parent_id);if(void 0===b||void 0===d||d!=b.parentNode()||void 0===f||b.starc.node_id!=a.node_id)throw console.log("can't perform node reparented",a,b,d,f),"can't perform node reparented";this.performNodeReparented(a);return this.nodeReparentedLocally_noUndo(b,
d,f)};d.performNodeReparented=function(b){var d=this.getNodeForId(b.node_id),e=this.getNodeForId(b.data.new_parent_id);if(void 0===d||void 0===e||d.starc.node_id!=b.node_id)throw console.log("can't perform node reparented",b,d,e),"can't perform node reparented";d.paper.starc_reparentBranchLogical(d,e);d.starc.owner_id=b.owner_id;d.starc.action_ts=b.action_ts;0===e.starc.tree_level&&d.parentNode().starc.displayAddNodeHintsIfNecessary();this.historyMode()&&d.starc.showOwner();a("#holder").trigger("Diagram_LayoutChanged")};
d.onNodeEdited=function(a){this.checkVersion(a);this.unreconciled.any(function(b){if("edit node"===b.type&&b.node_id===a.node_id&&b.text===a.data.text)return b._remove(),!0})||this.performNodeEdited(a)};d.performAndSendNodeEdited=function(a){var b=this.getNodeForId(a.node_id);if(void 0===b)throw"can't perform node edit: unknown node";var d=b.starc.markdown();if(void 0===d)throw"bad";this.performNodeEdited(a);return this.nodeEditedLocally_noUndo(b,a.data.text,d)};d.performNodeEdited=function(b){var d=
this.getNodeForId(b.node_id);if(void 0===d)throw console.log("unknown node!",d,b),"can't perform node edit: unknown node";if(d.starc.node_id!=b.node_id)throw console.log("id mismatch!",d,b),"id mismatch";d.starc.setLabelText(b.data.text,!0);d.starc.owner_id=b.owner_id;d.starc.action_ts=b.action_ts;this.historyMode()&&d.starc.showOwner();a("#holder").trigger("Diagram_LayoutChanged")};d.onNodePainted=function(a){this.checkVersion(a);this.unreconciled.any(function(b){if("paint node"===b.type&&b.node_id===
a.node_id)return b._remove(),!0})||this.performNodePainted(a)};d.performAndSendNodePainted=function(a){var b=this.getNodeForId(a.node_id);if(void 0===b)throw"can't perform node paint: unknown node";var d=b.starc.colour;if(void 0===d)throw"bad";this.performNodePainted(a);return this.nodePaintedLocally_noUndo(b,"#"+a.data.colour,d)};d.performNodePainted=function(a){var b=this.getNodeForId(a.node_id);if(void 0===b)throw console.log("unknown node!",b,a),"can't perform node paint: unknown node";if(b.starc.node_id!=
a.node_id)throw console.log("id mismatch!",b,a),"id mismatch";b.starc.setColour_noRecursion("#"+a.data.colour,!0);b.starc.owner_id=a.owner_id;b.starc.action_ts=a.action_ts;this.historyMode()&&b.starc.showOwner()};d.onNodeResized=function(a){this.checkVersion(a);this.unreconciled.any(function(b){if("resize node"===b.type&&b.node_id===a.node_id&&b.width===a.data.width)return b._remove(),!0})||this.performNodeResized(a)};d.performAndSendNodeResized=function(a){var b=this.getNodeForId(a.node_id);if(void 0===
b)throw"can't perform node resize: unknown node";var d=b.starc.width;this.performNodeResized(a);return this.nodeResizedLocally_noUndo(b,a.data.width,d)};d.performNodeResized=function(b){var d=this.getNodeForId(b.node_id);if(void 0===d)throw console.log("unknown node!",d,b),"can't perform node resize: unknown node";if(d.starc.node_id!=b.node_id)throw console.log("id mismatch!",d,b),"id mismatch";d.starc.setLabelWidth(b.data.width,!0);d.starc.owner_id=b.owner_id;d.starc.action_ts=b.action_ts;this.historyMode()&&
d.starc.showOwner();a("#holder").trigger("Diagram_LayoutChanged")};d.onRootEdited=function(a){this.checkVersion(a);window.document.title=b.toTitleText(a.data.text);this.unreconciled.any(function(b){if("edit root"===b.type&&b.node_id===a.node_id&&b.text===a.data.text)return b._remove(),!0})||this.performNodeEdited(a)};d.performAndSendRootEdited=function(a){var b=this.getNodeForId(a.node_id);if(void 0===b||0!==b.starc.tree_level)throw"root edit failed";var d=b.starc.markdown();if(void 0===d)throw"bad";
this.performRootEdited(a);return this.rootEditedLocally_noUndo(b,a.data.text,d)};d.performRootEdited=function(a){var b=this.getNodeForId(a.node_id);b.starc.setLabelText(a.data.text,!0);b.starc.owner_id=a.owner_id;b.starc.action_ts=a.action_ts;this.historyMode()&&b.starc.showOwner()};d.onNodeRemoved=function(a,b){this.checkVersion(a);this.unreconciled.any(function(b){if("remove node"===b.type&&b.node_id===a.node_id)return b._remove(),!0})||this.performNodeRemoved(a,b)};d.performAndSendNodeRemoved=
function(a){var b=this.getNodeForId(a.node_id);if(void 0===b)throw"cannot perform and send node removed";b=this.nodeRemovedLocally_noUndo(b);this.performNodeRemoved(a);return b};d.performNodeRemoved=function(b,d){var e=this.getNodeForId(b.node_id);if(void 0===e){if(d)return;console.log("unknown node!",b,this);throw"can't perform node removed: unknown node";}var f=e.parentNode();e.paper.starc_removeNodeAndChildren(e,!0);delete this.nodes[b.node_id];0===f.starc.tree_level&&f.starc.displayAddNodeHintsIfNecessary();
a("#holder").trigger("Diagram_LayoutChanged")};d.onNodeFocus=function(a){var b=this.getNodeForId(a.node_id),d=this.getColourForUser(a.data.socket);if(void 0!==b){if(void 0===d)throw console.log("bad node focus:",a,b,d),"no colour!";b.starc.focus_level+=1;1==b.starc.focus_level&&b.starc.text_label.starc.focus(d)}};d.onNodeClearFocus=function(a){var b=this.getNodeForId(a.node_id);void 0!==b&&window.setTimeout(function(){b.starc&&(0<b.starc.focus_level&&(b.starc.focus_level-=1),0===b.starc.focus_level&&
b.starc.text_label.starc.clearFocus())},500)};d.nodeAddedLocally=function(a,b,d){b=this.nodeAddedLocally_noUndo(a,b,d);this.pushUndo(b);0===a.starc.tree_level&&window.setTimeout(a.starc.displayAddNodeHintsIfNecessary,50)};d.nodeAddedLocally_noUndo=function(b,d,e){a("#holder").trigger("Diagram_LayoutChanged");var f=b.starc.node_id;this.ensureNodeHasId(e);b=e.starc.node_id;e.starc.owner_id=null;e.starc.action_ts=null;f={client_version:3,type:"add node",node_id:b,parent_id:f,text:d,colour:String(e.starc.colour).substring(1,
7),pos:{x:e.starc.relX(),y:e.starc.relY()},width:e.starc.width};this.nodes[b]=e;a("#holder").trigger("starc_childadded",[e.starc.node_id,d]);this.unreconciled.push(f);this.socket&&this.socket.emit("update",f);return{server_version:3,type:"node removed",node_id:b,owner_id:null,action_ts:null,data:{}}};d.nodeInsertedLocally=function(a,b,d){var f=a.parentNode();if(f==a)throw"eh?";this.pushUndo(this.nodeAddedLocally_noUndo(f,b,a));this.pushUndo(this.nodeReparentedLocally_noUndo(d,f,a))};d.nodeSquashedLocally=
function(a){for(var b=a.childNodes(),d=0;d<b.length;d++)this.pushUndo(this.nodeReparentedLocally_noUndo(b[d],a,a.parentNode()));this.pushUndo(this.nodeRemovedLocally_noUndo(a));1==a.starc.tree_level&&window.setTimeout(a.parentNode().starc.displayAddNodeHintsIfNecessary,50)};d.nodeMovedLocally=function(b){a("#holder").trigger("UserMovedNode",b);this.pushUndo(this.nodeMovedLocally_noUndo(b,b.starc.drag.old_relx,b.starc.drag.old_rely))};d.nodeMovedLocally_noUndo=function(b,d,e){a("#holder").trigger("Diagram_LayoutChanged");
var f=b.starc.node_id;b.starc.owner_id=null;b.starc.action_ts=null;b={client_version:3,type:"move node",node_id:f,pos:{x:b.starc.relX(),y:b.starc.relY()}};this.unreconciled.push(b);this.socket&&this.socket.emit("update",b);return{server_version:3,type:"node moved",node_id:f,owner_id:null,action_ts:null,data:{pos:{x:d,y:e}}}};d.nodeEditedLocally=function(a,b){this.pushUndo(this.nodeEditedLocally_noUndo(a,b,a.starc.markdown()))};d.nodeEditedLocally_noUndo=function(b,d,e){a("#holder").trigger("Diagram_LayoutChanged");
var f=b.starc.node_id;b.starc.owner_id=null;b.starc.action_ts=null;b={client_version:3,type:"edit node",node_id:f,text:d};this.unreconciled.push(b);this.socket&&this.socket.emit("update",b);return{server_version:3,type:"node edited",node_id:f,owner_id:null,action_ts:null,data:{text:e}}};d.nodePaintedLocally=function(a,b){this.pushUndo(this.nodePaintedLocally_noUndo(a,b,a.starc.colour))};d.nodePaintedLocally_noUndo=function(a,b,d){var f=a.starc.node_id;a.starc.owner_id=null;a.starc.action_ts=null;
a={client_version:3,type:"paint node",node_id:f,colour:String(b).substring(1,7)};this.unreconciled.push(a);this.socket&&this.socket.emit("update",a);return{server_version:3,type:"node painted",node_id:f,owner_id:null,action_ts:null,data:{colour:String(d).substring(1,7)}}};d.nodeResizedLocally=function(a,b){this.pushUndo(this.nodeResizedLocally_noUndo(a,b,a.starc.width))};d.nodeResizedLocally_noUndo=function(a,b,d){a=a.starc.node_id;b={client_version:3,type:"resize node",node_id:a,width:b};this.unreconciled.push(b);
this.socket&&this.socket.emit("update",b);return{server_version:3,type:"node resized",node_id:a,owner_id:null,action_ts:null,data:{width:d}}};d.nodeReparentedLocally=function(a,b,d){this.pushUndo(this.nodeReparentedLocally_noUndo(a,b,d))};d.nodeReparentedLocally_noUndo=function(b,d,e){a("#holder").trigger("Diagram_LayoutChanged");var f=b.starc.node_id;b.starc.owner_id=null;b.starc.action_ts=null;b={client_version:3,type:"reparent node",node_id:f,old_parent_id:d.starc.node_id,new_parent_id:e.starc.node_id};
this.unreconciled.push(b);this.socket&&this.socket.emit("update",b);return{client_version:3,type:"node reparented",node_id:f,owner_id:null,action_ts:null,data:{old_parent_id:e.starc.node_id,new_parent_id:d.starc.node_id}}};d.nodeRemovedLocally=function(a){delete this.nodes[a.starc.node_id];this.pushUndo(this.nodeRemovedLocally_noUndo(a));1==a.starc.tree_level&&window.setTimeout(a.parentNode().starc.displayAddNodeHintsIfNecessary,50)};d.nodeRemovedLocally_noUndo=function(b){a("#holder").trigger("Diagram_LayoutChanged");
var d=b.starc.node_id;b.starc.owner_id=null;b.starc.action_ts=null;var e={client_version:3,type:"remove node",node_id:d};this.unreconciled.push(e);this.socket&&this.socket.emit("update",e);e=null;e=null!==b.starc.saved_text?b.starc.saved_text:b.starc.markdown();if(null===e)throw"eh?";return{server_version:3,type:"node added",node_id:d,owner_id:null,action_ts:null,data:{text:e,colour:String(b.starc.colour).substring(1,7),pos:{x:b.starc.relX(),y:b.starc.relY()},width:b.starc.width,parent_id:b.parentNode().starc.node_id}}};
d.rootEditedLocally=function(a,b){this.pushUndo(this.rootEditedLocally_noUndo(a,b,a.starc.markdown()))};d.rootEditedLocally_noUndo=function(b,d,e){a("#holder").trigger("Diagram_LayoutChanged");var f=b.starc.node_id;b.starc.owner_id=null;b.starc.action_ts=null;b={client_version:3,type:"edit root",node_id:f,text:d};this.unreconciled.push(b);this.socket&&this.socket.emit("update",b);return{server_version:3,type:"root edited",node_id:f,owner_id:null,action_ts:null,data:{text:e}}};d.nodeFocus=function(a){a.starc.focus_level+=
1;a={client_version:3,type:"focus node",node_id:a.starc.node_id};this.socket&&this.socket.emit("update",a)};d.nodeClearFocus=function(a){a.starc&&(a.starc.focus_level-=1,a={client_version:3,type:"clear focus",node_id:a.starc.node_id},this.socket&&this.socket.emit("update",a))};d.closestNode=function(a,b,d){var f=null,h=null,l=null,n=function(d){var e=d.starc.translate.x;d=d.starc.translate.y;return(e-a)*(e-a)+(d-b)*(d-b)},q;for(q in this.nodes)if(this.nodes.hasOwnProperty(q)&&(l=this.nodes[q],!d||
d(l)))if(null===h||n(l)<h)f=l,h=n(l);return f};d.closestAttachedNode=function(a,b){return this.closestNode(a,b,function(a){return!(a.starc.drag.participating_in_move||a.starc.drag.move_is_detached_from_parent)})};d.reparentTo=function(b,d,e){if(e){var f=b.starc.translate.x,h=b.starc.translate.y;b.paper.starc_reparentBranch(b,e);this.pushUndo(this.nodeReparentedLocally_noUndo(b,d.node,e));b.starc.translate.to(f,h,!0);this.pushUndo(this.nodeMovedLocally_noUndo(b,d.relx,d.rely));a("#holder").trigger("starc_subtreemoved",
[b])}else console.log("no reparent target")};d.clickToEditTextTextOrEmptyText=function(){return this.readOnly()?"[no text]":d.touchUIOnly()?"[hold to edit]":"[click to edit]"};d.rootNode=function(){return this.root_node};d.coordsFromEvent=function(b){var d=null,d=b.originalEvent?this.mouseCoordsRelToDoc(b.originalEvent):this.mouseCoordsRelToDoc(b);d.x+=this.viewpos.x+a("#holder").scrollLeft();d.y+=this.viewpos.y+a("#holder").scrollTop();return d};d.getColour=w;var f=0,l={};d.getColourForUser=function(a){if(l.hasOwnProperty(a))return w(l[a]);
l[a]=++f;return w(f)};d.randomWalkColour=function(a){colour=Raphael.color(a);colour.h+=(Math.floor(11*Math.random())-5)/256;colour.s+=(Math.floor(11*Math.random())-5)/256;colour.l+=(Math.floor(11*Math.random())-5)/256;0>colour.h&&(colour.h=1-colour.h);1<colour.h&&(colour.h-=1);0>colour.s&&(colour.s=0);1<colour.s&&(colour.s=1);0>colour.l&&(colour.l=0);1<colour.l&&(colour.l=1);return Raphael.hsl(colour.h,colour.s,colour.l)};d.elementsForFragment=function(a){a=a.toLowerCase();var b=[],d=null;if(a.match(/^[a-fA-F0-9]*$/)){if(this.nodes.hasOwnProperty(a))return[this.nodes[a].starc.text_label.starc.$text_div];
if(4<=a.length)for(d in this.nodes)this.nodes.hasOwnProperty(d)&&0===d.toLowerCase().lastIndexOf(a,0)&&b.push(this.nodes[d].starc.text_label.starc.$text_div);if(b.length)return b}for(d in this.nodes)if(this.nodes.hasOwnProperty(d)){var f=this.nodes[d];0===E(f.starc.markdown()).lastIndexOf(a,0)&&b.push(f.starc.text_label.starc.$text_div)}return b}})(b.prototype);(function(b){function q(a){if(0!==a.length){if(1==a.length)return a[0];a.sort(function(a,b){return a-b});var b=Math.floor(a.length/2);return a.length%
2?a[b]:(a[b-1]+a[b])/2}}b.initStarcData=function(){var b=this,g=this.paper.diagram,p=a("#holder");this.parent_item=null;this.child_items=[];this.starc={translate:{x:0,y:0,fixup_connection_fn:null,rigid_move_with_parent:!1,moveChildrenBy:function(a,d,f,g){if("child_items"in b)for(var l=0;l<b.child_items.length;l++)if(!b.child_items[l].starc.is_node||!g)b.child_items[l].starc.translate.rigid_move_with_parent=!0,b.child_items[l].starc.translate.by(a,d,f,g),b.child_items[l].starc.translate.rigid_move_with_parent=
!1},reset:function(){this.y=this.x=0;b.transform("")},by:function(a,d,f,g){b.stop();this.x+=a;this.y+=d;b.transform("T"+this.x+","+this.y);this.moveChildrenBy(a,d,f,g);this.fixupConnection(1,!f)},to:function(a,d,f,g){b.stop();var l=a-this.x,n=d-this.y;this.x=a;this.y=d;b.transform("T"+this.x+","+this.y);this.moveChildrenBy(l,n,f,g);this.fixupConnection(1,!f);if(g){a=b.childNodes();for(d=0;d<a.length;d++)a[d].starc.translate.fixupConnection(1,!f)}},toRelative:function(a,d){var f=b.parentNode();this.to(a*
f.starc.ltr()+f.starc.translate.x,d+f.starc.translate.y)},setConnectedParent:function(a){this.fixup_connection_fn=a},fixupConnection:function(a,d,f){a-=1;if((!1===this.rigid_move_with_parent||0<a)&&null!==this.fixup_connection_fn)a+=this.fixup_connection_fn.call(b,d,f);if(a&&"child_items"in b)for(d=0;d<b.child_items.length;d++)b.child_items[d].starc.translate.fixupConnection(a,!1,f)}},drag:{ox:0,oy:0,old_relx:0,old_rely:0,not_a_short_drag:!1,completed:!1,down_fn:null,move_fn:null,up_fn:null,move_is_detached_from_parent:!1,
participating_in_move:!1,down:function(b,d,f){if(!g.historyMode()&&(f||(f=window.event),!isNaN(b)&&!isNaN(d)&&!(f.which&&3==f.which||f.button&&2==f.button)))if(a(":focus").focusout(),this.starc.setOxOy(),this.starc.drag.not_a_short_drag=!1,this.starc.drag.completed=!1,this.starc.is_node&&this.parent_item){var l=this.childNodes();this.starc.setSnapCount();g.shift_key_pressed&&(!g.control_key_pressed&&!this.starc.drag.participating_in_move)&&(this.starc.drag.move_is_detached_from_parent||(this.starc.drag.move_is_detached_from_parent=
{node:this.parentNode(),relx:this.starc.relX(),rely:this.starc.relY()}),this.setChildNodeOpacityRecursively(0.75),this.parent_item.attr({opacity:0.25}),this.parent_item.starc.connection.root.attr({opacity:0.25}),this.parent_item.starc.connection.tip.attr({opacity:0.25}),g.disableLabelInteraction());_.each(l,function(a){a.starc.drag.participating_in_move=!0;a.starc.drag.down.call(a,b,d,f)});!this.starc.drag.participating_in_move&&0<this.starc.tree_level&&(g.nodeFocus(this),a("#holder").trigger("starc_move_started",
[this]));"undefined"!=typeof f.stopPropagation?f.stopPropagation():"undefined"!=typeof f.cancelBubble&&(f.cancelBubble=!0);g.preventTouchDragging()}},move:function(d,f,h,l,n){if(!g.historyMode())if(n||(n=window.event),isNaN(d)||isNaN(f))console.log("!!!! broken move:",d,f,h,l,n);else{if(this.starc.is_node){var p=g.control_key_pressed||g.meta_key_pressed;if(0<this.starc.tree_level&&this.starc.reduceSnapCount()||p){var q=this.starc.drag.ox+d;l=this.starc.drag.oy+f;var s=h=null,t=null,s=null;p?(h=8,
s=20,t=Math.round(q/s)*s,s*=Math.round(l/s)):(h=5,t=this.starc.getSiblingMedian());t&&(p=t-q,r(p)<h&&(d+=p));s&&(l=s-l,r(l)<h&&(f+=l))}this.starc.drag.move_is_detached_from_parent&&(h=g.closestAttachedNode(this.starc.drag.ox+d,this.starc.drag.oy+f),h!=this.parentNode()&&b.paper.starc_reparentBranch(this,h),this.parent_item.attr({opacity:0.25}),this.parent_item.starc.connection.root.attr({opacity:0.25}),this.parent_item.starc.connection.tip.attr({opacity:0.25}));a("#holder").trigger("starc_subtreemoved",
[this])}n.which&&3==n.which||n.button&&2==n.button||(this.starc.translate.to(this.starc.drag.ox+d,this.starc.drag.oy+f),2<d*d+f*f&&(this.starc.drag.not_a_short_drag=!0),g.paper.safari())}},up:function(b){function d(a){a.starc.drag.participating_in_move=!1;_.each(a.childNodes(),d)}g.historyMode()||(b||(b=window.event),b.which&&3==b.which||b.button&&2==b.button||(b=!1,this.starc.drag.move_is_detached_from_parent&&(this.setChildNodeOpacityRecursively(1),this.starc.drag.completed||(g.reparentTo(this,
this.starc.drag.move_is_detached_from_parent,g.closestAttachedNode(this.starc.translate.x,this.starc.translate.y)),b=!0),this.starc.drag.move_is_detached_from_parent=!1,this.parent_item.attr({opacity:1}),this.parent_item.starc.connection.root.attr({opacity:1}),this.parent_item.starc.connection.tip.attr({opacity:1})),this.starc.is_node&&(g.enableLabelInteraction(),d(this),b||(this.starc.drag.ox!=this.starc.translate.x||this.starc.drag.oy!=this.starc.translate.y)&&g.nodeMovedLocally(this),a("#holder").trigger("starc_move_completed",
[this]),g.nodeClearFocus(this)),this.starc.is_node&&g.allowTouchDragging()))},delegateDownToParent:function(a,b,d){d||(d=window.event);this.starc.drag.down.call(this,a,b,d);this.parent_item.starc.drag.down_fn.call(this.parent_item,a,b,d)},delegateMoveToParent:function(a,b,d,f,g){g||(g=window.event);this.parent_item.starc.drag.move_fn.call(this.parent_item,a,b,d,f,g)},delegateUpToParent:function(a){a||(a=window.event);this.parent_item.starc.drag.up_fn.call(this.parent_item,a)}},hover:{in_fn:null,out_fn:null,
delegateHoverInToParent:function(a){this.parent_item.starc.hover.in_fn&&this.parent_item.starc.hover.in_fn.call(this.parent_item,a)},delegateHoverOutToParent:function(a){null!==this.starc&&this.parent_item.starc.hover.out_fn&&this.parent_item.starc.hover.out_fn.call(this.parent_item,a)}},setLabelText:function(a,d,f){var l=this.text_label;0===a.replace(/ /g,"").length?(d||g.nodeEditedLocally(b,""),l.updateText(a,l.no_text_colour,!0)):(d||g.nodeEditedLocally(b,a),l.updateText(a,l.text_colour,f))},setLabelWidth:function(a,
d){d||g.nodeResizedLocally(b,a);this.text_label.updateWidth(a)},hexColour:function(){return this.colour},setColourRecursive:function(a,b){a==this.colour||(0===this.tree_level||!this.is_node)||this.setColour_noUndoStep(a,b)},setColour:function(a,b){a==this.colour||(0===this.tree_level||!this.is_node)||this.setColour_noRecursion(a,b)},setColour_noRecursion:function(a,d){0!==this.tree_level&&(d||g.pushUndo(g.nodePaintedLocally_noUndo(b,a,this.colour)),b.attr("color",a),this.colour=a,_.each(this.new_buttons,
function(b){b.setColour(a)}),_.each(_.values(this.xlinks_to),function(b){_.each(b,function(b){b.attr({stroke:a})})}),b.parent_item.attr("stroke",a),b.parent_item.starc.connection.root.attr("fill",a),b.parent_item.starc.connection.tip.attr("fill",a),this.text_label.updateColour(a))},setColour_noUndoStep:function(a,d){this.setColour_noRecursion(a,d);for(var f=b.childNodes(),l=0;l<f.length;l++)f[l].starc.setColour_noUndoStep(g.randomWalkColour(a),d)},setOxOy:function(){this.drag.ox=this.translate.x;
this.drag.oy=this.translate.y;this.drag.old_relx=this.relX();this.drag.old_rely=this.relY()},setSnapCount:function(){this.drag.snaps_remaining=100},reduceSnapCount:function(){return this.drag.snaps_remaining&&0<this.drag.snaps_remaining--},foreachSibling:function(a){for(var d=this.parentNode().childNodes(),f=0;f<d.length;f++){var g=d[f];g!=b&&a(g)}},foreachChild:function(a,d){var f=b.childNodes();"undefined"!=typeof d&&f.sort(d);for(var g=0;g<f.length;g++)a(f[g])},getSiblingMedian:function(a){var b=
[],d=this.parentNode().starc.translate.x;a||(a=this.translate.x<d?"left":"right");var f=this;this.foreachSibling(function(g){1==f.tree_level?g.starc.translate.x<d==("left"==a)&&b.push(g.starc.translate.x):b.push(g.starc.translate.x)});return q(b)},getChildrenMedian:function(a){var b=[],d=this.translate.x,f=this;this.foreachChild(function(g){0===f.tree_level&&a?g.starc.translate.x<d==("left"==a)&&b.push(g.starc.translate.x):b.push(g.starc.translate.x)});return q(b)},getSiblingYCoordSpaces:function(a,
d){return this.parentNode().starc.getChildrenYCoordSpaces(a,d,b)},getChildrenYCoordSpaces:function(a,b,d){var f=[],g=[],l=this.translate.x,n=null,p=null;d&&!a&&(a=d.starc.translate.x<l?"left":"right");var q=this;this.foreachChild(function(b){if(!(void 0!==d&&b==d)){null===n&&(n=parseInt(b.starc.$el().css("paddingTop")),p=parseInt(b.starc.$el().css("paddingBottom")));b.starc.textHeight();var f={max:b.starc.text_label.getBBox_fixed().y2-p,min:b.starc.text_label.getBBox_fixed().y+n};0===q.tree_level&&
a?b.starc.translate.x<l==("left"==a)&&g.push(f):g.push(f)}});g.length&&(g.sort(function(a,b){return b.max-a.max}),f.push(g[0].max+b/2),g.sort(function(a,b){return a.min-b.min}),f.push(g[0].min-b/2));return f},positionForChild:function(a,d,f){a=0===this.tree_level?"right"==d?1:-1:this.ltr();var l=s(this.tree_level),n=6*l,p=this.translate.x+a*(n+(0===this.tree_level?b.getBBox().width/2:0)),q=this.translate.y,t=[],v=null,w=null,y=b.childNodes();f?(v=f.starc.getSiblingMedian(d),void 0===v&&(v=p),t=f.starc.getSiblingYCoordSpaces(d,
3*l)):(v=this.getChildrenMedian(d),void 0===v&&(v=p),y.length&&(t=this.getChildrenYCoordSpaces(d,3*l)));t.sort(function(a,b){return r(a-q)-r(b-q)});for(d=0;d<t.length&&null===w;d++)g.collides(v,t[d],n*a,l)||(w=t[d]);null===w&&0<t.length&&(w=t[0]);null===w&&(w=q);return{x:v,y:w}},relX:function(){return 0===this.tree_level?this.translate.x:this.parentNode().starc.ltr()*(this.translate.x-this.parentNode().starc.translate.x)},relY:function(){return 0===this.tree_level?this.translate.y:this.translate.y-
this.parentNode().starc.translate.y},isRoot:function(){return 0===this.tree_level},ltr:function(){return 0===this.tree_level?1:-1+2*(this.translate.x>this.parentNode().starc.translate.x)},ttb:function(){return 0===this.tree_level?1:-1+2*(this.translate.y>1+this.parentNode().starc.translate.y)},parentNode:function(){return b.parentNode()},displayedText:function(){return this.text_label&&this.text_label.starc?d(this.text_label.starc.$text_div):""},markdown:function(){return this.text_label?this.text_label.current_markdown||
"":""},textWidth:function(){return this.text_label?this.$el().outerWidth():0},boxWidth:function(){return this.width||0},textHeight:function(){return this.text_label?this.$el().outerHeight():0},createHintWithTextAndOffset:function(a,d,h){var g=b.paper.starc_arrowHead().attr(f);g.initStarcData();g.starc.translate.to(this.translate.x+d+5,this.translate.y+h-24);d=b.paper.path("m 0,0 c 7,-16 -3,-27 -11,-34 -8,-7 -8,-7 -8,-7").attr(l);d.insertBefore(g);d.initStarcData();d.parent_item=g;g.child_items.push(d);
d.starc.translate.to(g.starc.translate.x+4,g.starc.translate.y-7);a=b.paper.text(g.starc.translate.x+5,g.starc.translate.y-58,a).attr(n).attr({"text-anchor":"end"});a.initStarcData();a.insertBefore(d);a.parent_item=d;d.child_items.push(a);return g},displayHint:function(a,d,f){a=this.createHintWithTextAndOffset(a,d,f);a.parent_item=b;b.child_items.push(a);this.hint_key++;this.currently_displayed_hints[this.hint_key]=a;return this.hint_key},displayArrowlessHint:function(a){a=b.paper.text(this.translate.x,
this.translate.y-110,a).attr(n).attr({"text-anchor":"middle"});a.initStarcData();a.insertBefore(b);a.parent_item=b;b.child_items.push(a);this.hint_key++;this.currently_displayed_hints[this.hint_key]=a;return this.hint_key},removeHint:function(a){this.currently_displayed_hints.hasOwnProperty(a)&&void 0!==this.currently_displayed_hints[a]&&(this.currently_displayed_hints[a].removeChildrenRecursive(),this.currently_displayed_hints[a]=void 0)},addChildNode:function(a){if(this.is_node)return a=b.paper.starc_child(b,
"",a),p.trigger("starc.edittext",[a,a.starc.text_label,!0]),a},insertNode:function(a){if(this.is_node)return a=b.paper.starc_insertNode(b,"",a,null),p.trigger("UserInsertedNode",a),p.trigger("starc.edittext",[a,a.starc.text_label,!0]),a},removeNode:function(){this.is_node&&(p.trigger("UserRemovedNode",b),g.hideModifierKeyHint(),b.paper.starc_removeNodeAndChildren(b))},squashNode:function(){this.is_node&&(p.trigger("UserSquashedNode",b),g.hideModifierKeyHint(),b.paper.starc_squashNode(b))},showOwner:function(){if(this.owner_id&&
this.is_node&&!this.owner_displayed){this.owner_displayed=!0;var b=g.colourForUserId(this.owner_id),d="0 0 2px "+(0===this.tree_level?this.colour:"#fff")+",0 0 3px "+(0===this.tree_level?this.colour:"#fff")+",0 0 5px "+b+",0 0 8px "+b;this.$el().css({"text-shadow":d});var f=this,l=0,n=null;this.$el().bind("mouseover",function(){function d(){window.setTimeout(function(){l--;0===l&&(f.text_label&&f.text_label.starc)&&(f.$el().css({"margin-left":"","z-index":"1"}),n&&(n.remove(),n=null))},50);f.text_label.starc&&
f.$el().unbind("mouseout",d)}l++;if(null===n){n=a("<div>",{"class":"blamecallout blametext"}).css({"background-color":b,color:"#fff"});var m=a("<div>",{"class":"blametext",text:a.timeago(new Date(f.action_ts))}),p=a("<div>",{"class":"blametext",text:g.nameForUserId(f.owner_id)+":"}),q=a("<div>",{"class":"blamepointy"}).css("background-color",b);a(n).prepend(m);a(n).prepend(p);a(n).prepend(q);f.$el().prepend(n);n.css({"margin-left":(f.$el().width()-n.width())/2});f.$el().css({"z-index":4})}f.$el().bind("mouseout",
d)})}},hideOwner:function(){this.is_node&&(this.owner_displayed&&this.text_label.starc)&&(this.$el().css({"text-shadow":""}),this.$el().children(".blametext").remove(),this.$el().unbind("mouseover"),this.owner_displayed=!1)},$el:function(){return this.text_label&&this.text_label.starc?this.text_label.starc.$text_div:a()},$container:function(){return this.text_label&&this.text_label.starc?this.text_label.starc.$node_container:a()},removeChild:function(a){for(var d=0;d<b.child_items.length;d++)if(b.child_items[d]===
a){b.child_items[d].remove();b.child_items.splice(d,1);return}console.error("element:",_.clone(b),"has no child to remove:",_.clone(a))},connection:{root:null,tip:null},colour:"#b4b4b4",tree_level:0,focus_level:0,old_ltr:1,old_ttb:1,old_num_children:0,is_node:!1,text_label:null,access_time:0,owner_id:null,action_ts:null,owner_displayed:!1,saved_text:null,new_buttons:[],xlinks_to:{},xlinks_from:{},hint_key:0,currently_displayed_hints:{}}};b.drag_default=b.drag;b.drag=function(a,b,d){Raphael.diagram.readOnly()||
(this.starc.drag.move_fn=a,this.starc.drag.down_fn=b,this.starc.drag.up_fn=d,this.drag_default(a,b,d))};b.undrag_default=b.undrag;b.undrag=function(){(null!==this.starc.drag.move_fn||null!==this.starc.drag.down_fn||null!==this.starc.drag.up_fn)&&this.undrag_default();this.starc.drag.move_fn=null;this.starc.drag.down_fn=null;this.starc.drag.up_fn=null};b.hover_default=b.hover;b.hover=function(a,b){Raphael.diagram.readOnly()||(this.starc.hover.in_fn=a,this.starc.hover.out_fn=b,this.hover_default(a,
b))};b.unhover_default=b.unhover;b.unhover=function(){this.starc.hover.in_fn=null;this.starc.hover.out_fn=null;this.unhover_default()};b.parentNode=function(){for(var a=this.parent_item;a&&("undefined"===typeof a.starc||!a.starc.is_node);)a=a.parent_item;if(a)return a;console.log("no parent node!",this);return this};b.setChildNodeOpacityRecursively=function(a){var b=this.childNodes();this.parent_item&&(this.parent_item.attr({opacity:a}),this.parent_item.starc.connection.root.attr({opacity:a}),this.parent_item.starc.connection.tip.attr({opacity:a}));
for(var d=0;d<b.length;d++)b[d].setChildNodeOpacityRecursively(a)};b.childNodes=function(){for(var a=[],b=0,d=this.child_items.length;b!=d;b++)if("child_items"in this.child_items[b])for(var e=0,f=this.child_items[b].child_items.length;e!=f;e++)"starc"in this.child_items[b].child_items[e]&&this.child_items[b].child_items[e].starc.is_node&&a.push(this.child_items[b].child_items[e]);return a};b.removeChildrenRecursive=function(b){if("starc"in this){this.starc.is_node&&(this.starc.saved_text=this.starc.markdown(),
this.starc.text_label.starc.clearFocus(),a("#holder").trigger("starc_abouttoremove",this.starc.node_id));var d,f=this.child_items.slice();for(d=0;d<f.length;d++)f[d].removeChildrenRecursive(b);for(d=0;d<this.parent_item.child_items.length;d++)if(this.parent_item.child_items[d]===this){this.parent_item.child_items.splice(d,1);break}this.unhover();this.undrag();this.starc.is_node&&(b?delete this.paper.diagram.nodes[this.starc.node_id]:this.paper.diagram.nodeRemovedLocally(this),_.each(this.starc.new_buttons,
function(a){a.remove()}));this.starc.node_id in this.paper.diagram.nodes&&console.log("!!! node still in list",this)}else console.log("Non-starc item in hierachy!",this);this.remove()};b.fixupTextLabel=function(a){0<this.starc.tree_level&&(a=this.childNodes().length+a,this.starc.old_num_children!=a&&(this.starc.old_num_children=a,this.starc.text_label.updateClasses(this.starc.ltr(),this.starc.ttb(),a)))}})(Raphael.el);(function(d){function w(a,b){var d=b.starc.tree_level+1,f=a.starc.tree_level!==
d;a.parent_item&&(a.parent_item.starc.tree_level=d);a.starc.tree_level=d;f&&_.each(a.childNodes(),function(b){w(b,a)});a.paper.starc_fixupParentConnection.call(a,!0,!0);_.each(a.starc.new_buttons,function(b){b.setSize(s(q(2,a.starc.tree_level)))});a.starc.text_label.updateTextSize()}function y(a,b){var d=-1+2*(b.starc.translate.x>a.starc.translate.x),f=d,g=0;0===a.starc.tree_level?g=(a.starc.root_width/2+11)*d:(f=-1+2*(a.starc.translate.x>a.parent_item.parent_item.starc.translate.x),g=4.5*f);var g=
a.starc.translate.x+g,l=a.starc.translate.y,n=b.starc.translate.x+-3.75*d+0.15*d,p=b.starc.translate.y,s=q((r(g-n)+v(0.6*r(l-p),1200))/2,8);return["M",g.toFixed(4),l.toFixed(4),"C",g+s*f,l,n-s*d,p,n.toFixed(4),p.toFixed(4)].join()}function g(a,b){var d=-1+2*(b.starc.translate.y>a.starc.translate.y),f=a.getBBox_fixed(),g=b.getBBox_fixed(),l=(0>d?f.y:f.y2)+5*d,n=(0<d?g.y:g.y2)+-5*d,f=(f.x+f.x2)/2,g=(g.x+g.x2)/2,p=q((v(0.6*r(f-g),1200)+r(l-n))/2,8);return["M",f.toFixed(4),l.toFixed(4),"C",f,l+p*d,g,
n-p*d,g.toFixed(4),n.toFixed(4)].join()}var p=function(b,d,f,g){Raphael.diagram.readOnly()||(a(b.node).attachTouchGestures(g),a(b.node).bind("touchhold",f&&f.hasOwnProperty("touchhold")?f.touchhold:function(b,e,f){if(!g||g())return d.starc&&a("#holder").trigger("starc.edittext",[d,d.starc.text_label,!1]),!1}),a(b.node).bind("touchdragstart",f&&f.hasOwnProperty("touchdragstart")?f.touchdragstart:function(a,b,e,f){if(!g||g())return d.starc&&d.starc.drag.down_fn&&d.starc.drag.down_fn.call(d,b,e,f),!1}),
a(b.node).bind("touchdrag",f&&f.hasOwnProperty("touchdrag")?f.touchdrag:function(a,b,e,f){if(!g||g())return a=d.paper.diagram.mouseCoordsRelToDoc(f),d.starc&&d.starc.drag.move_fn&&d.starc.drag.move_fn.call(d,b,e,a.x,a.y,f),!1}),a(b.node).bind("touchdragend",f&&f.hasOwnProperty("touchdragend")?f.touchdragend:function(a,b,e,f){if(!g||g())return d.starc&&d.starc.drag.up_fn&&d.starc.drag.up_fn.call(d,f),!1}),a(b.node).bind("touchtap",f&&f.hasOwnProperty("touchtap")?f.touchtap:function(a,b,d,e){if(!g||
g())return!1}))};d.starc_arrowHead=function(){return this.path(Raphael.transformPath("m 0,0 c -0.21792,0.0562 -0.3821,0.27507 -0.375,0.5 l 0,7 c 0.009,0.41642 0.66346,0.61967 0.90625,0.28125 l 4,-6 C 4.73316,1.48443 4.48395,1.00517 4.125,1 l -1.90625,0 -1.875,-0.9375 c -0.10224,-0.0608 -0.22664,-0.0835 -0.34375,-0.0625 z","s 1.75,1.75"))};d.starc_xAnchorForLtrAndNumChildren=function(a,b){return 0===b?1==a?"start":"end":1==a?"end":"start"};d.starc_yAnchorForTtbAndNumChildren=function(a,b){return 0===
b?"center":1==a?"below":"above"};d.starc_removeNodeAndChildren=function(a,b){a.parentNode().fixupTextLabel(-1);a.parent_item.starc.connection.root.removeChildrenRecursive(b);a.parent_item.removeChildrenRecursive(b)};d.starc_squashNode=function(a,b){if(a.parentNode()!=a){a.paper.diagram.nodeSquashedLocally(a);for(var d=a.childNodes(),f=0;f<d.length;f++)this.starc_reparentBranchLogical(d[f],a.parentNode());0<a.childNodes().length&&console.log("super badness!");this.starc_removeNodeAndChildren(a,!0)}};
d.starc_addChildButton=function(b,d){var f=b.starc.$container().addStarcButton({target:b,modifier_events:a(window),coordsFromEvent:diagram.mouseCoordsRelToDoc,radius:s(q(2,b.starc.tree_level)),colour:b.starc.colour,visibleFilter:function(){return!(b.paper.diagram.touchUIOnly()||b.paper.diagram.readOnly())},actionFilter:function(){return b&&b.paper&&b.paper.diagram&&!b.paper.diagram.historyMode()},side:d,remove_modifier_key:b.paper.diagram.remove_modifier_key,ignores_modifiers:0===b.starc.tree_level});
b.starc.new_buttons.push(f);return f};d.starc_root=function(d,g){function h(){var a=K();s.attr({path:q(a.w,a.h)});s.starc.root_width=a.w;C(a);s.starc.translate.fixupConnection(3,!0,!0)}var q=function(a,b){return"M -"+a/2+",-"+(6.875+b/2)+" c -1.385,0 -2.5,1.115 -2.5,2.5 l 0,"+b/2+" -6.25,4.375 6.25,4.375 0,"+b/2+" c 0,1.385 1.115,2.5 2.5,2.5 l "+a+",0 c 1.385,0 2.46671,-1.1154 2.5,-2.5 l 0,-"+b/2+" 6.25,-4.375 -6.25,-4.375 0,-"+b/2+" c 0,-1.385 -1.115,-2.5 -2.5,-2.5 z"},r=b.getSizeOfContent(d,0);
"undefined"!==typeof g&&(r.w=g);var s=this.path(q(r.w,r.h));s.attr({fill:"#b4b4b4",stroke:"none",cursor:"move"});s.initStarcData();s.starc.root_width=r.w;s.starc.tree_level=0;s.starc.is_node=!0;var t=this.starc_editableText(s,"Unnamed Coggle","Unnamed Coggle");s.child_items.push(t);s.starc.text_label=t;var v=null,w=null;!this.diagram.touchUIOnly()&&!this.diagram.readOnly()&&(v=this.starc_addChildButton(s,"right"),w=this.starc_addChildButton(s,"left"));var y=null,B=null,D=null,E=null,F=function(){var a=
s.paper.diagram.getSVGContentsBoundingRect(10),a=s.paper.rect(a.xmin,a.ymin,a.xmax-a.xmin,a.ymax-a.ymin,5);a.insertAfter(s);a.attr({opacity:0,stroke:"none",fill:"#000"});a.initStarcData();a.parent_item=s;s.child_items.push(a);w&&v&&a.hover(function(){w.show(0.4);v.show(0.4)},function(){w.hide();v.hide()});return a},C=function(a){a=a.w;v&&v.setOffset(4+a/2,0);w&&w.setOffset(-(4+a/2),0);null!==y&&y.starc.translate.to(s.starc.translate.x+4+a/2+10,s.starc.translate.y-20);null!==B&&B.starc.translate.to(s.starc.translate.x-
(4+a/2)-10,s.starc.translate.y+14);null!==D&&(D.removeChildrenRecursive(),D=F());null!==E&&E.starc.translate.to(s.starc.translate.x+a/6,s.starc.translate.y-34)},K=function(){var a=s.starc.$el(),b=a.outerWidth()+6,a=a.outerHeight()-14;return{w:20>b?20:b,h:6>a?6:a}};s.starc.sizeForRootLayout=K;s.starc.setLabelText=function(a,b){function d(){console.log("Root Image Managed",K());h();t.starc&&t.starc.$text_div.find("img").unbind("load",d)}0===a.replace(/ /g,"").length?(t.updateText(t.text_when_empty,
t.text_colour,!0),b||s.paper.diagram.rootEditedLocally(s,t.text_when_empty)):(t.updateText(a,t.text_colour,!0),b||s.paper.diagram.rootEditedLocally(s,a));h();t.starc.$text_div.find("img").bind("load",d)};s.starc.setLabelWidth=function(a,b){b||s.paper.diagram.nodeResizedLocally(s,a);t.updateWidth(a);h()};s.starc.displayAddNodeHintsIfNecessary=function(){if(0<s.childNodes().length)null!==y&&(y.removeChildrenRecursive(),y=null),null!==B&&(B.removeChildrenRecursive(),B=null),null!==D&&(D.removeChildrenRecursive(),
D=null),null!==E&&(E.removeChildrenRecursive(),E=null);else{var a=s.paper;if(v){var b=a.starc_arrowHead().attr(f);b.insertBefore(s);b.initStarcData();b.parent_item=s;s.child_items.push(b);var d=a.path("m 0,0 c 7,-16 -3,-27 -11,-34 -8,-7 -8,-7 -8,-7").attr(l);d.insertBefore(b);d.initStarcData();d.parent_item=b;b.child_items.push(d);d.starc.translate.by(4,-7);var e=a.diagram.touchUIOnly()?"touch here":"click here",e=a.text(-15,-58,e).attr(n);e.initStarcData();e.insertBefore(d);e.parent_item=d;d.child_items.push(e);
y=b}w&&(b=a.path(Raphael.transformPath("m 0,0 c -0.19611,0.0149 -0.37659,0.15674 -0.4375,0.34375 l -2.3125,6.84375 c -0.0955,0.33299 0.2563,0.70335 0.59375,0.625 l 1.84375,-0.46875 2.0625,0.40625 c 0.32864,0.0533 0.64998,-0.30377 0.5625,-0.625 l -1.8125,-6.75 c -0.0562,-0.21792 -0.27507,-0.3821 -0.5,-0.375 z","s 1.75,1.75")).attr(f),b.insertBefore(s),b.initStarcData(),b.parent_item=s,s.child_items.push(b),d=a.path("m 0,0 c -2.62038,17.26655 9.88589,25.30355 19.42503,29.99447 9.53914,4.69093 9.53914,4.69093 9.53914,4.69093").attr(l),
d.insertBefore(b),d.initStarcData(),d.parent_item=b,b.child_items.push(d),d.starc.translate.by(-0.5,15),e=a.text(58,48,"or here").attr(n),e.initStarcData(),e.insertBefore(d),e.parent_item=d,d.child_items.push(e),B=b);a.diagram.touchUIOnly()&&(b=a.starc_arrowHead().attr(f),b.insertBefore(s),b.initStarcData(),b.parent_item=s,s.child_items.push(b),d=a.path("m 0,0 c 7,-16 -3,-27 -11,-34 -8,-7 -8,-7 -8,-7").attr(l),d.insertBefore(b),d.initStarcData(),d.parent_item=b,b.child_items.push(d),d.starc.translate.by(4,
-7),a=a.text(-15,-58,"tap to begin").attr(n),a.initStarcData(),a.insertBefore(d),a.parent_item=d,d.child_items.push(a),E=b);C(s.starc.sizeForRootLayout());D=F()}};s.drag(s.starc.drag.move,function(a,b,d){s.paper.diagram.historyMode()||(d||(d=window.event),d.which&&3==d.which||d.button&&2==d.button||(s.starc.drag.down.call(s,a,b,d),s.starc.translate.effective_x=s.starc.translate.x,s.starc.translate.effective_y=s.starc.translate.y))},function(b){function d(a){a.starc.drag.participating_in_move=!1;_.each(a.childNodes(),
d)}s.paper.diagram.historyMode()||(b||(b=window.event),b.which&&3==b.which||b.button&&2==b.button||(s.paper.diagram.enableLabelInteraction(),d(this),a("#holder").trigger("UserMovedNode",s)))});p(s,s,{},function(){return!(s.paper.diagram.readOnly()||s.paper.diagram.historyMode())});s.starc.translate.to_actuallyDoTranslate=s.starc.translate.to;s.starc.translate.to=function(b,d){a("#holder").scrollLeft(a("#holder").scrollLeft()-(b-this.effective_x));a("#holder").scrollTop(a("#holder").scrollTop()-(d-
this.effective_y));this.effective_x=b;this.effective_y=d;t.starc.translate.by(0,0)};s.getBBox_fixed=function(){var a=t.getBBox_fixed();a.x+=a.width/2.2;a.x2+=a.width/2.2;a.y-=a.height/2;a.y2-=a.height/2;return a};s.starc.setLabelText(d,!0);s.starc.setLabelWidth(g,!0);C(s.starc.sizeForRootLayout());return s};d.starc_editableText=function(b,d,f){function g(){return!(v.readOnly()||v.historyMode()||v.textPopupActive())}var l="#fff",n=function(a){a=Raphael.color(a);a.l*=0.5;a.s*=0.7;return Raphael.hsl(a.h,
a.s,a.l)};0<b.starc.tree_level&&(l=n(b.starc.colour));var p=this.rect(0,0,0,0);p.attr({fill:"none",stroke:"none"});p.initStarcData();p.parent_item=b;p.text_colour=l;p.no_text_colour="#888";p.text_when_empty=f;var q=a(document.createElement("div")).addClass("nodecontainer"),r=document.createElement("div"),t=a(r).addClass("textlabel").addClass("branchor");0===b.starc.tree_level&&t.addClass("roottextlabel");var v=b.paper.diagram,w=null,y=null,B=!1,C=function(a){a||(a=window.event);var b=v.mouseCoordsRelToDoc(a);
y&&(window.clearTimeout(y),y=null);p&&(p.starc&&!B)&&p.starc.drag.move_fn.call(p,b.x-w.x,b.y-w.y,b.x,b.y,a)},D=function(a){B||t.trigger("mouseup")},E=function(b){function d(){a(window).unbind("mousemove",C);a(window).unbind("mouseup",D);a(r).unbind("mouseup",E)}y&&(window.clearTimeout(y),y=null);if(v.labelEditingEnabled())return b||(b=window.event),p&&p.starc&&p.starc.drag.up_fn.call(p,b),B=!0,d(),!1;d()};t.mousedown(function(d){d||(d=window.event);if(!(d.which&&3==d.which||d.button&&2==d.button)&&
p.starc&&v.labelEditingEnabled()&&!v.historyMode()&&!v.textPopupActive())return w=v.mouseCoordsRelToDoc(d),p.starc.drag.down_fn.call(p,w.x,w.y,d),B=!1,a(window).bind("mousemove",C),a(window).bind("mouseup",D),t.bind("mouseup",E),y=window.setTimeout(function(){B=!0;b.starc.drag.completed=!0;a("#holder").trigger("starc_node_sage");t.trigger("starc.triggersage",[d])},500),!1});v.readOnly()||t.attachTouchGestures(g);t.bind("touchhold",function(d,f,g){a("#holder").trigger("starc.edittext",[b,p,!1]);return!1});
t.bind("touchdragstart",function(a,b,d,e){p.starc&&p.starc.drag.down_fn&&p.starc.drag.down_fn.call(p,b,d,e)});t.bind("touchdrag",function(a,b,d,e){a=v.mouseCoordsRelToDoc(e);p.starc&&p.starc.drag.move_fn&&p.starc.drag.move_fn.call(p,b,d,a.x,a.y,e)});t.bind("touchdragend",function(a,b,d,e){p.starc&&p.starc.drag.up_fn&&p.starc.drag.up_fn.call(p,e)});t.click(function(a){a||(a=window.event);if(!(a.which&&3==a.which||a.button&&2==a.button)&&v.labelEditingEnabled()&&!v.historyMode())return!1});t.hover(function(a){v.touchUIOnly()||
(t.find("a").length?"darwin"==v.browser_platform?v.displayModifierKeyHint("drag to move, click to edit, [ \u2318 ] + click to follow links"):v.displayModifierKeyHint("drag to move, click to edit, [ ctrl ] + click to follow links"):v.displayModifierKeyHint("drag to move, click to edit"),b.paper&&(!v.historyMode()&&!v.textPopupActive())&&_.each(b.starc.new_buttons,function(a){a.show(0.4)}),b.starc&&b.starc.xlinks_to&&_.each(_.values(b.starc.xlinks_to),function(a){_.each(a,function(a){a.attr({"stroke-opacity":0.75})})}))},
function(a){v.touchUIOnly()||(v.hideModifierKeyHint(),b.paper&&(!v.historyMode()&&!v.textPopupActive())&&_.each(b.starc.new_buttons,function(a){a.hide()}),b.starc&&b.starc.xlinks_to&&_.each(_.values(b.starc.xlinks_to),function(a){_.each(a,function(a){a.attr({"stroke-opacity":0.25})})}))});var F=t.enableSageNode({append_to:a("#holdersquared"),getInitialZoom:function(){return v.zoom_control.current_zoom},filter:function(a){return!t.find("textarea").length&&!v.historyMode()&&!v.readOnly()&&("contextmenu"==
a.type||"touchtap"==a.type||v.alt_key_pressed&&v.shift_key_pressed)},root:0===b.starc.tree_level,node:b,getColour:function(){return b.starc.colour}});t.on("starc.triggersage",function(a,b){F.trigger(b)});t.append("<p></p>");q.append(r);q.appendTo(a("#holder"));p.starc.$text_div=t;p.starc.$node_container=q;p.getBBox_fixed=function(){var a=b.starc.ttb(),d=b.starc.ltr(),f=b.childNodes().length,g={x:this.attr("x")+this.starc.translate.x,y:this.attr("y")+this.starc.translate.y},h=0,m=0,l=t.outerWidth(),
p=t.outerHeight();1===d&&0===f?(h=0,m=-0.5*p):1===d&&1===a&&0<f?(h=-0.9*l,m=0):1===d&&1!==a&&0<f?(h=-0.9*l,m=-1*p):1!==d&&0===f?(h=-1*l,m=-0.5*p):1!==d&&1===a&&0<f?(h=-0.1*l,m=0):1!==d&&(1!==a&&0<f)&&(h=-0.1*l,m=-1*p);g.x+=h;g.y+=m;g.width=l;g.height=p;g.x2=g.x+g.width;g.y2=g.y+g.height;return g};p.updateTextSize=function(){var a=s(this.parentNode().starc.tree_level);this.starc.font_size=a;t.css("font-size",a)};p.isEmpty=function(){return this.current_markdown===this.text_when_empty};p.updateClasses=
function(d,f,g){1===d?t.addClass("ltr"):t.removeClass("ltr");1===f?t.addClass("ttb"):t.removeClass("ttb");0!==g?t.addClass("haschildren"):t.removeClass("haschildren");"undefined"!==typeof b.starc.node_id&&a("#holder").trigger("starc_labelrepositioned",[b.starc.node_id,b])};p.updateText=function(d,g,m){t.empty();var l=0===d.replace(/ /g,"").length?f:d;l==f&&d!=f&&(g=this.no_text_colour);g||(g=this.text_colour);l=marked(l);this.current_markdown=0===d.replace(/ /g,"").length?f:d;this.current_colour=
g;t.append(l);t.css("color",g);a("#holder").trigger("starc.labelchanged",[b,p,m]);"undefined"!==typeof b.starc.node_id&&a("#holder").trigger("starc_markdownchanged",[b.starc.node_id,d,b]);"undefined"===typeof this.parentNode().starc.width&&this.updateWidth(void 0)};p.updateWidth=function(d){this.parentNode().starc.width=d;"undefined"===typeof d?(t.css("width","auto"),t.css("white-space","nowrap")):(t.css("width",d+"px"),t.css("white-space",""));"undefined"!==typeof b.starc.node_id&&a("#holder").trigger("starc_widthchanged",
[b.starc.node_id,d,b])};p.updateColour=function(a){this.text_colour=n(a);this.current_colour!=this.no_text_colour&&t.css("color",this.text_colour)};p.updateHtmlPosition=function(){var a=this.starc.translate.x-v.viewpos.x,b=this.starc.translate.y-v.viewpos.y;q.css({top:b,left:a});this.starc.text_popup&&this.starc.text_popup.css({left:a,top:b})};p.remove_default=p.remove;p.remove=function(){q.remove();p.remove_default()};p.starc.translate.to=function(a,b){p.stop();this.x=a;this.y=b;p.transform("T"+
this.x+","+this.y);p.updateHtmlPosition()};p.starc.translate.by=function(a,b){p.stop();this.x+=a;this.y+=b;p.transform("T"+this.x+","+this.y);p.updateHtmlPosition()};p.drag(p.starc.drag.delegateMoveToParent,p.starc.drag.delegateDownToParent,function(b){var d=p.parentNode();!d.starc.drag.not_a_short_drag&&!d.starc.drag.completed&&a("#holder").trigger("starc.edittext",[d,this,!1]);p.starc.drag.delegateUpToParent.call(p,b)});p.starc.focus=function(a){t.addClass("focused");t.css({boxShadow:"0px 0px 3pt 2pt "+
a})};p.starc.clearFocus=function(){t.removeClass("focused");t.css({boxShadow:"none"})};p.updateTextSize();p.updateText(d,p.text_colour);p.updateWidth(b.starc.width);return p};d.starc_childTextLabel=function(a,b,d,f){a.childNodes();return this.starc_editableText(a,b,a.paper.diagram.clickToEditTextTextOrEmptyText())};d.starc_child=function(b,d,f,g,l){f=this.starc_child_noMsg(b,d,f,g,l,!1);b.paper.diagram.nodeAddedLocally(b,d,f);a("#holder").trigger("UserAddedNode",f);return f};d.starc_insertNode=function(a,
b,d,f,g){d=this.starc_child_noMsg(a,b,d,f,g,!0);d.starc.setOxOy();a.paper.diagram.nodeInsertedLocally(d,b,a);1==a.starc.tree_level&&a.paper.diagram.nodeMovedLocally(a);return d};d.starc_reparentBranchLogical=function(b,d){var f=b.starc.relX(),g=b.starc.relY();this.starc_reparentBranch(b,d);b.starc.translate.toRelative(f,g);a("#holder").trigger("starc_subtreemoved",[b])};d.starc_reparentBranch=function(a,b){var d=a.parentNode();if(d!=b){a.starc.relX();a.starc.relY();var f=a.parent_item;f.parent_item!=
d&&console.log("super badness",f);f.starc.connection.root.removeChildrenRecursive(!0);f.starc.connection.tip.removeChildrenRecursive(!0);d.starc.removeChild(f);f=this.starc_connection(b,a);a.parent_item=f;d.fixupTextLabel(0);b.fixupTextLabel(0);w(a,b)}};d.starc_child_noMsg=function(b,d,f,g,l,n,q){var r=1,s=b.starc.tree_level+1-n;0<b.starc.tree_level?r=b.starc.ltr():"left"==f&&(r=-1);b.fixupTextLabel(1);var t=this.rect(-6,-9,12.01,18);t.attr({fill:"none",stroke:"none"});t.initStarcData();t.starc.tree_level=
s;t.starc.is_node=!0;g||(g=1==s&&!n?b.paper.diagram.getColour(b.childNodes().length):b.paper.diagram.randomWalkColour(b.starc.colour));t.starc.colour=g;t.starc.width=l;t.drag(t.starc.drag.move,t.starc.drag.down,t.starc.drag.up);p(t,t,{},function(){return!(node.paper.diagram.readOnly()||node.paper.diagram.historyMode())});g=b;n&&0<b.starc.tree_level&&(g=b.parentNode());l=this.starc_connection(g,t);t.parent_item=l;t.starc.translate.setConnectedParent(this.starc_fixupParentConnection);t.starc.old_ltr=
r;t.starc.old_ttb=t.starc.ttb();var v=this.starc_childTextLabel(t,d,r,t.starc.old_ttb);t.child_items.push(v);t.starc.text_label=v;v.starc.translate.to(t.starc.translate.x,t.starc.translate.y);!this.diagram.touchUIOnly()&&!this.diagram.readOnly()&&this.starc_addChildButton(t).$button.bind("contextmenu",function(b){a(v.starc.$text_div).trigger("starc.triggersage",[b]);b.preventDefault();return!1});q||(n?t.starc.translate.to(b.starc.translate.x,b.starc.translate.y):(d=g.starc.positionForChild(d,f,t),
t.starc.translate.to(d.x,d.y)),n&&0<b.starc.tree_level&&(n=b.starc.relX(),d=b.starc.relY(),this.starc_reparentBranch(b,t),b.starc.translate.toRelative(n,d),0===g.starc.tree_level&&0>n&&(b.starc.setOxOy(),b.starc.translate.toRelative(-n,d))));t.getBBox_fixed=function(){return v.getBBox_fixed()};this.starc_fixupParentConnection.call(t,!1,!0);return t};d.starc_fixupParentConnection=function(a,b){var d=!1,f=!1,g=this.starc.ltr(),l=this.starc.ttb();this.starc.old_ltr!=g&&(f=!0);this.starc.old_ttb!=l&&
(d=!0);this.starc.old_ltr=g;this.starc.old_ttb=l;var p=null,n=null;if(f||d||b)p=this.childNodes(),n=p.length;if(f&&a)for(var q=0,r=n;q!=r;q++){var s=p[q];s.starc.translate.by(2*(this.starc.translate.x-s.starc.translate.x),0)}p=this.parent_item.attr("opacity");this.parent_item.starc.translate.reset();this.parent_item.attr({path:y(this.parentNode(),this),"stroke-width":t(this.starc.tree_level),opacity:p});if(null!==this.starc.text_label&&(f||d||!0===b))this.starc.text_label.updateClasses(g,l,n),this.paper.starc_replaceRootAndTipForConnection(this.parentNode(),
this.parent_item,this);this.fixupTextLabel(0);return f};d.starc_fixupXLinksInSubtree=function(a){function b(a){d[a.starc.node_id]=a;f=f.concat.apply(f,_.values(a.starc.xlinks_from).concat(_.values(a.starc.xlinks_to)));_.each(a.childNodes(),b)}var d={},f=[];b(a);_.each(f,function(a){var b=a.starc.xlink_from,e=a.starc.xlink_to;if(!d.hasOwnProperty(e.starc.node_id)||!d.hasOwnProperty(b.starc.node_id))a.starc.translate.reset(),a.attr({path:g(b,e),"stroke-width":3})})};d.starc_fixupXLinksForNode=function(a){a.starc&&
_.each(_.values(a.starc.xlinks_from).concat(_.values(a.starc.xlinks_to)),function(a){_.each(a,function(a){if(a.starc){var b=a.starc.xlink_from,d=a.starc.xlink_to;a.starc.translate.reset();a.attr({path:g(b,d),"stroke-width":3})}})})};d.starc_replaceRootAndTipForConnection=function(a,b,d){null!==b.starc.connection.root&&a.starc.removeChild(b.starc.connection.root);null!==b.starc.connection.tip&&d.starc.removeChild(b.starc.connection.tip);var f=-1+2*(d.starc.translate.x>a.starc.translate.x),g=f,l=0,
p=-3.75*f;0===a.starc.tree_level?l=(a.starc.root_width/2+6)*f:(g=-1+2*(a.starc.translate.x>a.parent_item.parent_item.starc.translate.x),l=0*g);g=this.starc_arcroot(g,t(d.starc.tree_level),d.starc.colour,{opacity:b.attr("opacity")});g.initStarcData();g.parent_item=a;a.child_items.push(g);g.starc.translate.to(a.starc.translate.x+l,a.starc.translate.y);g.insertBefore(b);g.node.setAttribute("stroke-dasharray",99999);a=this.starc_arctip(f,t(d.starc.tree_level),d.starc.colour,{opacity:b.attr("opacity")});
a.initStarcData();a.parent_item=d;d.child_items.push(a);a.starc.translate.to(d.starc.translate.x+p,d.starc.translate.y);a.insertBefore(b);a.node.setAttribute("stroke-dasharray",99999);b.starc.connection.root=g;b.starc.connection.tip=a};d.starc_connection=function(b,d){function f(a){d.starc&&null!==a&&d.starc.setColourRecursive(a)}function g(a){d.starc&&null!==a&&d.starc.setColour(a)}var l=d.paper.diagram,n=this.path(y(b,d));n.attr({stroke:d.starc.colour,"stroke-width":t(d.starc.tree_level)});n.node.setAttribute("stroke-dasharray",
99999);n.insertBefore(b);n.initStarcData();n.parent_item=b;n.child_items.push(d);n.starc.connection={root:null,tip:null};b.child_items.push(n);p(n,d,{touchhold:function(b,d,e){a(window).trigger("starc.colourmenu",[n.node,{x:d,y:e},g]);return!1},touchtap:function(b,d,e){a(window).trigger("starc.colourmenu",[n.node,{x:d,y:e},f]);return!1}},function(){return!(l.readOnly()||l.historyMode())});var q=null,r={};n.drag(function(a,b,e,f,g){!l.historyMode()&&d.starc&&d.starc.drag.move_fn.call(d,a,b,e,f,g)},
function(a,b,e){!l.historyMode()&&d.starc&&(q=l.mouseCoordsRelToDoc(e),r={shift:l.shift_key_pressed,constrol:l.control_key_pressed,alt:l.alt_key_pressed,meta:l.meta_key_pressed},d.starc.drag.down_fn.call(d,a,b,e))},function(b){!l.historyMode()&&d.starc&&(q&&(!d.starc.drag.not_a_short_drag&&!r.alt&&!r.control&&!r.meta)&&(a(window).trigger("starc.colourmenu",[d,q,r.shift?g:f]),d.starc.drag.completed=!0),d.starc.drag.up_fn.call(d,b))});this.starc_replaceRootAndTipForConnection(b,n,d);return n};d.starc_xlink=
function(a,b){var d=this.path(g(a,b));d.attr({stroke:a.starc.colour,"stroke-width":3,"stroke-opacity":0.25});d.node.setAttribute("stroke-dasharray","3, 3");d.insertBefore(a);d.initStarcData();d.parent_item=a;d.starc.xlink_from=a;d.starc.xlink_to=b;d.starc.xlink={root:null,tip:null};a.child_items.push(d);a.starc.xlinks_to.hasOwnProperty(b.starc.node_id)||(a.starc.xlinks_to[b.starc.node_id]=[]);b.starc.xlinks_from.hasOwnProperty(a.starc.node_id)||(b.starc.xlinks_from[a.starc.node_id]=[]);a.starc.xlinks_to[b.starc.node_id].push(d);
b.starc.xlinks_from[a.starc.node_id].push(d);return d};d.starc_arcroot=function(a,b,d,f){a=this.path("m "+0.2*a+","+-b/2+" "+-0.2*a+",0 "+4.54688*a*b/6+","+b/2+" "+-4.54688*a*b/6+","+b/2+" "+5*a+",0 "+0.2*a+",0 0,"+-b+" z");a.attr(_.extend({fill:d,stroke:"none"},f||{}));a.initStarcData();return a};d.starc_arctip=function(a,b,d,f){a=this.path("m "+-0.2*a+","+-b/2+" "+0.2*a+",0 "+4.54688*a*b/6+","+b/2+" L 0,"+b/2+" "+-0.2*a+","+b/2+" z");a.attr(_.extend({fill:d,stroke:"none"},f||{}));a.initStarcData();
return a}})(Raphael.fn);window.Diagram=b})(jQuery);(function(a){"function"===typeof define&&define.amd?define(["jquery","underscore"],a):a(jQuery,_)})(function(a,b){a.fn.setupStarcLinkControl=function(d){var f=d.diagram,l=f.paper;d=a(this);var n={},t=!0,s={},y=function(a){b.each(b.values(n),function(d){b.each(b.values(d),function(d){b.each(b.values(d),function(d){b.each(d,function(b){a(b)})})})})},w=function(){var a=[];y(function(b){a.push(b.node)});return a},E=function(){a(w()).fadeOut(200,function(){t=!1})},q=function(){t=!0;b.each(b.values(s),
function(a){l.starc_fixupXLinksInSubtree(a)});s={};a(w()).fadeIn(200)};d.bind("starc_link_new",function(a,b,d,e){b!==d&&(n.hasOwnProperty(b)||(n[b]={}),n[b].hasOwnProperty(d)||(n[b][d]={}),n[b][d].hasOwnProperty(e)||(n[b][d][e]=[]),n[b][d][e].push(l.starc_xlink(f.nodes[b],f.nodes[d])))});d.bind("starc_link_destroy",function(a,d,l,e){if(d!==l){!n.hasOwnProperty(d)||!n[d].hasOwnProperty(l)||!n[d][l].hasOwnProperty(e)?console.error("no such link to remove"):(n[d][l][e].pop(),n[d][l][e].length||delete n[d][l][e],
b.keys(n[d][l]).length||delete n[d][l],b.keys(n[d]).length||delete n[d]);a=f.nodes[d];e=f.nodes[l];l=a.starc.xlinks_to[l].pop();var m=e.starc.xlinks_from[d].pop();m!==l&&(e.starc.xlinks_from[d].push(m),console.error("xlinks array order inconsistent"));a.starc.removeChild(l)}});var v=0,r=0;d.bind("starc_move_started",function(){v=1;window.setTimeout(function(){0<v&&(E(),r=1)},50)});d.bind("starc_move_completed UserRemovedNode UserSquashedNode starc_node_sage",function(){r&&q();v=0});d.bind("starc_subtreemoved",
function(a,d){b.keys(n).length&&(t?l.starc_fixupXLinksInSubtree(d):s[d.starc.node_id]=d)});var B={},D=a.coalesceCalls(function(){b.each(b.keys(B),function(a){l.starc_fixupXLinksForNode(f.nodes[a])})},200);d.bind("starc_labelrepositioned",function(a,d,f){if(b.keys(f.starc.xlinks_to).length||b.keys(f.starc.xlinks_from).length)B[d]=1,D()});d.bind("starc_markdownchanged starc_widthchanged",function(a,d,f,e){if(b.keys(e.starc.xlinks_to).length||b.keys(e.starc.xlinks_from).length)B[d]=1,D()})}});(function(a){"function"===typeof define&&define.amd?define(["jquery","underscore"],a):a(jQuery,_)})(function(a,b){var d=marked;a.fn.setupStarcLinkEvents=function(f){function l(a,b,d){r.hasOwnProperty(a)||(r[a]={},console.error("adding state for non-existent node:",a,b,d));r[a].hasOwnProperty(d)||(console.error("adding state for non-existent link source:",a,b,d),r[a][d]={});r[a][d][b]=1;B.hasOwnProperty(b)||(B[b]={});B[b].hasOwnProperty(a)||(B[b][a]={});B[b][a][d]=1}function n(a,d,f){delete B[d][a][f];
b.keys(B[d][a]).length||(delete B[d][a],b.keys(B[d]).length||delete B[d]);delete r[a][f][d]}function t(a,d){b.keys(r[a][d]).length&&console.error("link source is not unused:",a,d,r[a][d]);delete r[a][d];b.keys(r[a]).length||delete r[a]}function s(a){return function(d){var f={};b.each(b.pairs(a),function(a){var b=a[0];w(d,a[1],b)&&(f.hasOwnProperty(b)||(f[b]={}),f[b][d]=1)});return f}}function y(b){b=d(b);var e={};a(b).find("a").each(function(b,d){var f=a(this).attr("href");0===f.indexOf("#")&&(e[f.slice(1)]=
1)});return e}function w(a,b,d){return 1>a.length?!1:d&&0===d.toLowerCase().indexOf(a.toLowerCase())||0===b.indexOf(a.toLowerCase())?!0:!1}function E(a,d,f){var g={};b.each(b.pairs(f),function(f){var l=f[0];b.each(b.keys(f[1]),function(b){w(b,a,d)&&(g.hasOwnProperty(l)||(g[l]={}),g[l][b]=1)})});return g}var q=a(this),v={},r={},B={},D={},F=function(a){return a};"function"===typeof f.normalise_fn&&(F=f.normalise_fn);var g=a.coalesceCalls(function(){var a=[],d={};b.each(b.pairs(D),function(a){d[a[0]]=
F(a[1])});var f=b.extend(b.clone(v),d),g=s(f);b.each(b.pairs(d),function(d){var e=d[0],f=y(D[e]),m=b.reduce(b.map(b.keys(f),g),function I(a,d){b.each(b.keys(d),function(b){a.hasOwnProperty(b)?a[b]=I(a[b],d[b]):a[b]=d[b]});return a},{});r.hasOwnProperty(e)&&b.each(b.pairs(r[e]),function(d){var g=d[0];d=d[1];f.hasOwnProperty(g)?(b.each(b.keys(d),function(b){m.hasOwnProperty(b)&&m[b].hasOwnProperty(g)?delete m[b][g]:(n(e,b,g),a.push(["starc_link_destroy",e,b,g]))}),delete f[g]):(b.each(b.keys(d),function(b){n(e,
b,g);a.push(["starc_link_destroy",e,b,g])}),t(e,g))});b.each(b.keys(f),function(a){r.hasOwnProperty(e)||(r[e]={});r[e].hasOwnProperty(a)&&console.error("link source already exists:",e,a,r[e][a]);r[e][a]={}});b.each(b.pairs(m),function(d){var f=d[0];b.each(b.keys(d[1]),function(b){l(e,f,b);a.push(["starc_link_new",e,f,b])})})});b.each(b.pairs(d),function(d){var e=d[0],f=E(d[1],e,r);b.each(b.pairs(f),function(d){var f=d[0];b.each(b.keys(d[1]),function(b){if(!r.hasOwnProperty(f)||!r[f].hasOwnProperty(b)||
!r[f][b].hasOwnProperty(e))l(f,e,b),a.push(["starc_link_new",f,e,b])})});b.each(b.pairs(B[e]),function(d){var g=d[0];d=d[1];var h=f.hasOwnProperty(g);b.each(b.keys(d),function(b){if(!h||!f[g].hasOwnProperty(b))n(g,e,b),a.push(["starc_link_destroy",g,e,b])})})});v=f;D={};b.each(a,function(a){q.trigger(a[0],a.splice(1))})},100);q.bind("starc_markdownchanged",function(a,b,d){D[b]=d;g()});q.bind("starc_abouttoremove",function(a,d){delete v[d];D.hasOwnProperty(d)&&delete D[d];r.hasOwnProperty(d)&&b.each(b.keys(r[d]),
function(a){b.each(b.keys(r[d][a]),function(b){q.trigger("starc_link_destroy",[d,b,a]);n(d,b,a)});t(d,a)});B.hasOwnProperty(d)&&b.each(b.keys(B[d]),function(a){b.each(b.keys(B[d][a]),function(b){q.trigger("starc_link_destroy",[a,d,b]);n(a,d,b)})})});q.bind("starc_rootadded starc_childadded",function(a,b,d){D[b]=d;g()})}});(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){function b(a){_gaq&&_gaq.push&&_gaq.push(["_trackEvent"].concat(a))}function d(a){for(var b=0;b<a.length;b++)(new Image).src=a[b]}var f=CDN+"/img/sage/",l="?"+(Coggle_Version||Math.random().toString(16).slice(2,6)),n=[f+"undo-w.png"+l,f+"undo.png"+l],t=[f+"plus-w.png"+l,f+"plus.png"+l],s=[f+"cross-w.png"+l,f+"cross.png"+l],y=[f+"minus-w.png"+l,f+"minus.png"+l],w=[f+"dup-w.png"+l,f+"dup.png"+l],E=[f+"cogglify-w.png"+
l,f+"cogglify.png"+l];d(n);d(t);d(s);d(y);d(w);d(E);var q=null;a(window).on("modifierschanged",function(a,b){q=_.clone(b)});a.fn.sageNode=function(b){function d(){return!(q&&(q.alt_key_pressed||q.control_key_pressed)&&!q.shift_key_pressed)}function f(){return q&&q.alt_key_pressed&&q.shift_key_pressed&&!q.control_key_pressed}var l=a(this),F=b.node,g=b.root,p=b.colour,e="#fff"==p|"#ffffff"==p?1:0,m={zoom:a.fn.sageBackground.zoomAction(55,b.size,e,b.initial_zoom,l),undo:{at:202,icon:a("<img/>",{src:n[e],
alt:"undo"}),tip:"undo",activate:a.fn.sage.fadeOthers,commit:a.fn.sage.hideOthers,finish:function(){l.trigger("starc.undo")}},redo:{at:158,icon:a("<img/>",{src:n[e],alt:"redo"}).css({transform:"scaleX(-1)","webkit-transform":"scaleX(-1)"}),tip:"redo",activate:a.fn.sage.fadeOthers,commit:a.fn.sage.hideOthers,finish:function(){l.trigger("starc.redo")}},add:{at:245,icon:a("<img/>",{src:t[e],alt:"add"}),tip:"add branch",activate:a.fn.sage.fadeOthers,commit:a.fn.sage.hideOthers,finish:function(){l.trigger("starc.add",
[F,g?"left":void 0])}},duplicate:{at:305,icon:function(){return f()?a("<img/>",{src:E[e],alt:"neatify"}):a("<img/>",{src:w[e],alt:"duplicate"})},tip:function(){return f()?"rearrange branch":"duplicate branch"},activate:a.fn.sage.fadeOthers,commit:a.fn.sage.hideOthers,finish:function(){f()?l.trigger("starc.arrange",F):l.trigger("starc.duplicate",F)}}};g?m["add right"]={at:115,icon:a("<img/>",{src:t[e],alt:"add"}),tip:"add branch",activate:a.fn.sage.fadeOthers,commit:function(b,d,e){a.fn.sage.hideOthers(b,
d,e)},finish:function(){l.trigger("starc.add",[F,"right"])}}:(m.remove={at:115,icon:function(){return!d()?a("<img/>",{src:y[e],alt:"squash"}):a("<img/>",{src:s[e],alt:"remove"})},tip:function(){return!d()?"squash item":"delete branch"},activate:a.fn.sage.fadeOthers,commit:function(b,d,e){a.fn.sage.hideOthers(b,d,e)},finish:function(){d()?l.trigger("starc.remove",F):l.trigger("starc.squash",F)}},m.coggleify={at:0,icon:a("<img/>",{src:E[e],alt:"cogglify"}),tip:function(){return d()?"move branch to Coggle":
"copy branch to Coggle"},activate:a.fn.sage.fadeOthers,commit:a.fn.sage.hideOthers,finish:function(){l.trigger("starc.coggleify",[F,d()])}});return a(this).sage(a.extend(b,{actions:m,colour:p}))};a.fn.enableSageNode=function(d){function f(d){var l=d.pageX-n.position().left,q=d.pageY-n.position().top,r=n.sageNode({size:"touchtap"===d.type?160:128,x:l,y:q,clickhold:!1,initial_zoom:e(d),node:g,root:p,colour:m()}),s=!0;"Windows"===BrowserDetect.OS&&"contextmenu"===d.type?s=!1:(a(window).one("mouseup",
function(a){a.which==d.which&&(s=!1)}),window.setTimeout(function(){s&&r&&r.convertToClickHold()},h));b(["Sage","Open","Node"]);return r}var l=a(this),n=a(d.append_to),q=d.filter,g=d.node,p=d.root||!1,e=d.getInitialZoom,m=d.getColour,h=100;l.bind("mousedown contextmenu touchtap",function(a){if(!q||q(a))return f(a),a.preventDefault(),!1});return{trigger:f}}});(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){a.fn.enableStarcTextWidgets=function(b){var d=b.diagram;a(this).bind("starc.labelchanged",function(b,l,n,t){function s(){return!(d.historyMode()||d.readOnly()||d.textPopupActive())}function y(){return!d.textPopupActive()}function w(){return y()&&s()}function E(b){var f,g;console.log("Image Managed",a(b.target).attr("src"));if(n.starc&&!d.readOnly()){var p=a(b.target).attr("src");"coggle-images.s3.amazonaws.com"===
a("<a>").prop("href",p).prop("hostname")&&(console.log("limiting maximum image size for coggle-hosted image"),g=f=96);var e=!1;a(b.target).unbind("load",E);a(b.target).resizable({handles:"se",autoHide:!0,aspectRatio:!0,maxWidth:f,minWidth:10,maxHeight:g,minHeight:10,stop:function(a,b){e=!1;if(l.starc){var d=q.indexOf(p)+p.length,f=q.indexOf(")",d),g=Math.round(b.size.width),n=Math.round(b.size.height),d=q.slice(0,d)+" "+g+"x"+n+q.slice(f);l.starc.setLabelText(d)}}});a(b.target).siblings(".ui-resizable-handle").bind("mousedown",
function(){e=!0;a(b.target).css("max-height","none")}).attr("title","Drag to resize");a(b.target).parent().bind("mousedown",function(a){e&&a.stopPropagation()})}}var q=n.current_markdown,v=n.starc.$text_div,r=n.starc.$node_container;b=v.find("a");var B=a("#holder");!t&&(-1!=q.indexOf("$$")||-1!=q.indexOf("\\\\(")||-1!=q.indexOf("\\\\["))&&ensureMathJax(function(){console.log("I solemnly swear that I am up to no math.");MathJax.Hub.Queue(["Typeset",MathJax.Hub,v[0]]);MathJax.Hub.Queue(function(){console.log("MathJax Managed")})});
b&&(v.coggleLocalLinks({target:B,filter:y}),v.attachTouchGestures(w),b.each(function(){a(this).attachTouchGestures(w);var b=a(this).attr("href");a(this).bind("touchdoubletap",function(){window.open(b,"_blank")});a(this).callout(a("<a>",{text:b,href:b,target:"_blank"}),{at:"center top",my:"center bottom",openOn:"mouseover",closeOn:"mouseout",filter:s,openDelay:1400,closeDelay:200}).on("opened",function(){a(this).coggleLocalLinks({target:B});r.css("z-index","3")}).on("closed",function(){r.css("z-index",
"")})}));v.find("img").bind("load",E);d.readOnly()?v.find("input:checkbox").prop("disabled",!0):v.find("input:checkbox").each(function(b,f){a(f).checkable({text:q,checkIndex:b,setTextFn:function(a){d.nodeFocus(l);l.starc.setLabelText(a);d.nodeClearFocus(l)}})})})}});(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){var b=function(a){return a+"px"};a.fn.starcZoom=function(d){function f(a,f,q){var s="scale("+a+")";t.css({left:b(Math.round(0.5*(1-1/a)*n.width())),top:b(Math.round(0.5*(1-1/a)*n.height())),width:100/a+"%",height:100/a+"%",transform:s,"-webkit-transform":s,"-ms-transform":s,"-webkit-font-smoothing":"subpixel-antialiased"});l.scrollLeft(l.scrollLeft()+f*l.width()*(a/y.current_zoom-1));l.scrollTop(l.scrollTop()+
q*l.height()*(a/y.current_zoom-1));y.current_zoom=a;d.post_zoom&&d.post_zoom(a)}var l=d.scroll_element,n=d.container_element,t=a(this),s=a(window),y={current_zoom:1};n.bind("sage.zoom",function(a,b,d,l){f(b,d/s.width(),l/s.height())});s.bind("resize",function(a){f(y.current_zoom,0.5,0.5)});s.keypress(function(a){if(a.ctrlKey^a.metaKey&&!a.shiftKey&&!a.altKey){if("+"==String.fromCharCode(a.which)||"="==String.fromCharCode(a.which))return f(Math.min(2,1.25992105*y.current_zoom),0.5,0.5),a.preventDefault(),
!1;if("-"==String.fromCharCode(a.which))return f(Math.max(0.25,y.current_zoom/1.25992105),0.5,0.5),a.preventDefault(),!1}});s.on("mousewheel",function(a){if(a.ctrlKey^a.metaKey&&!a.shiftKey&&!a.altKey){var b=0;void 0!=event.wheelDeltaY?b=a.originalEvent.wheelDeltaY/5:void 0!=event.wheelDelta?b=event.wheelDelta/5:void 0!=event.detail&&(b=-event.detail/3);f(Math.max(0.25,Math.min(2,y.current_zoom*(100+b)/100)),0.5,0.5);a.preventDefault();return!1}});return y}});$(function(){$("a.ajaxDialog").click(function(a){var b=this.href,d=$("#dialog");0==$("#dialog").length&&(d=$('<div id="dialog" style="display:hidden"></div>').appendTo("body"));d.load(b,function(){d.dialog({modal:!0,draggable:!1,resizable:!1,width:"600px"})});a.preventDefault();return!1})});function sortUL(a){$(a).children("li").sort(function(a,d){a=$(a).text();d=$(d).text();return a.localeCompare(d)}).appendTo(a)}
(function(a){a.fn.disableSelection=function(){return this.attr("unselectable","on").css("user-select","none").on("selectstart",!1)}})(jQuery);function clickAndHold(a){var b;a.bind("touchstart mousedown",function(d){window.clearTimeout(b);b=window.setTimeout(function(){a.trigger("hold",[d])},300)});$(document).bind("touchend mouseup",function(d){b&&(window.clearTimeout(b),b=!1);a.trigger("unhold",[d])})}
$(document).ready(function(){function a(){$(this).unbind("click");$(this).removeClass("on").html("NO").parent().next('input[type="checkbox"]').removeAttr("checked");$(this).click(b);$(this).trigger("changed",{state:!1})}function b(){$(this).unbind("click");$(this).addClass("on").html("YES").parent().next('input[type="checkbox"]').attr("checked","checked");$(this).click(a);$(this).trigger("changed",{state:!0})}$(".slider-button").each(function(d,f){$(f).hasClass("on")?$(f).click(a):$(f).click(b)})});
(function(a){a.fn.trackMouse=function(b){void 0==b.events&&(events="dragover mousemove");a(this).on(events,function(a){a.pageX?(b.target.x=a.pageX,b.target.y=a.pageY):(b.target.x=a.originalEvent.clientX||a.originalEvent.pageX,b.target.y=a.originalEvent.clientY||a.originalEvent.pageY)})}})(jQuery);(function(a){a.fn.styleChanges=function(b){void 0==b&&(b="keyup keydown");a(this).on(b,function(b){a(this).val&&(a(this).val(),0<a(this).val().length?a(this).addClass("hasvalue"):a(this).removeClass("hasvalue"))})}})(jQuery);
(function(a){a.fn.closeable=function(b){var d=a('<div class="close"></div>');a(this).prepend(d);var f=this;d.click(function(){b(a(f))})}})(jQuery);function dialogAnimateIn(){$(this).addClass("visible modal");$("#grayout").fadeIn();$(this).show();$(this).position({my:"center bottom",at:"center top",of:$("body"),collision:"none"});$(this).position({my:"center top",at:"center top+15",of:$("body"),using:function(a){$(this).stop(!0,!1).animate(a,130)},collision:"none"})}
function dialogAnimateOut(){$(this).position({my:"center bottom",at:"center top",of:$("body"),using:function(a){$(this).stop(!0,!1).animate(a,130,function(){$(this).hide();$(this).removeClass("visible modal")});$("#grayout").fadeOut()},collision:"none"})}
(function(a){a.fn.colourCycler=function(b){this.cycle=[];this.going=!1;this.initialColour=a(this).css("background-color");this.stop=b;var d=this;this.cycle.push(this.initialColour);this.start=function(a){-1==d.cycle.indexOf(a)&&d.cycle.push(a);d.going||0<d.cycle.length&&d.step()};this.step=function(){d.stop()?(a(d).css("background-color",this.initialColour),d.cycle=[],d.going=!1):(d.cycle.push(d.cycle.shift()),a(d).css("background-color",d.cycle[0]),window.setTimeout(function(){d.step()},1600),d.going=
!0)};return this}})(jQuery);(function(a){var b;b=window.location.search.substr(1).split("&");if(""==b)b={};else{for(var d={},f=0;f<b.length;++f){var l=b[f].split("=");2==l.length&&(d[l[0]]=decodeURIComponent(l[1].replace(/\+/g," ")))}b=d}a.queryString=b})(jQuery);(function(a,b){function d(a,b){var n=null,t=null;for(k in a)a.hasOwnProperty(k)&&(t=a[k],n=typeof t,("_id"===k||"id"===k)&&"string"===n||("object"===n&&null!=t?a[k]=d(t,b):"string"===n&&(a[k]=b(t))));return a}a.unescapeRecursive=function(a){return d(a,b.unescape)};a.escapeRecursive=function(a){return d(a,b.escape)}})(window,_);(function(a){a.fn.resizingImageUpload=function(b){var d;a(this).fileupload({url:b.url,dataType:"json",imageMaxWidth:150,imageMaxHeight:150,progressInterval:100,disableImageResize:!1,progressall:function(a,b){var n=parseInt(100*(b.loaded/b.total),10);d&&d.progressbar({value:n})},submit:function(f,l){console.log("submit file, type:",l.files[0].type);_gaq.push(["_trackEvent","Image","Process",l.files[0].type]);d||(d=a("<div>"),a(b.target).append(d));d.progressbar({value:0.1});d.show();d.removeClass("uploaderror");
d.css({top:b.progress_position.y+"px",left:b.progress_position.x+"px"})},fail:function(a,b){d&&(d.addClass("uploaderror"),d.progressbar({value:100}),d.fadeOut(1E3))},done:function(a,b){d&&(d.progressbar({value:100}),d.fadeOut(1E3));b.result.error?(console.log("upload error:",b),d&&d.addClass("uploaderror")):(_gaq.push(["_trackEvent","Image","Uploaded"]),diagram.onFileUpload(b.result.path))},maxNumberOfFiles:10})}})(jQuery);
